var e={871:(e,t,i)=>{i.d(t,{k:()=>s}),e=i.hmd(e);class s{constructor(e,t,i){this.graphUrl=e,this.graphReadyEvent=t,this.graphNewStateEvent=i,this.xmlHttpWidget=new XMLHttpRequest,this.xmlHttpWidget.onreadystatechange=this.readyEvent.bind(this),this.xmlHttpWidget.open("GET",this.graphUrl),this.xmlHttpWidget.send(null)}readyEvent(e){if(4==e.target.readyState&&200==e.target.status){var t=new DOMParser;this.xmlDoc=t.parseFromString(e.target.responseText,"text/xml"),this.graphReadyEvent()}}setInitialState(e){null!=this.xmlDoc.querySelector("[name='"+e+"']")&&(this.state=e,this.graphNewStateEvent(this.state))}sendMessage(e){var t=this.xmlDoc.querySelector("[name='"+this.state+"']");if(null!=t){var i=t.querySelector("[message='"+e+"']");if(null!=i||(e=e.split("//")[0],null!=(i=t.querySelector("[message='"+e+"']")))){var s=i.getAttribute("to");this.state=s,this.graphNewStateEvent(this.state)}}}}!function(t){"object"==typeof exports?e.exports=t():"function"==typeof define&&i.amdO?define([],t):("undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:this).Animated_GIF=t()}((function(){return function e(t,i,s){function a(n,c){if(!i[n]){if(!t[n]){if(l)return l(n,!0);var h=new Error("Cannot find module '"+n+"'");throw h.code="MODULE_NOT_FOUND",h}var o=i[n]={exports:{}};t[n][0].call(o.exports,(function(e){return a(t[n][1][e]||e)}),o,o.exports,e,t,i,s)}return i[n].exports}for(var l=void 0,n=0;n<s.length;n++)a(s[n]);return a}({1:[function(e,t,i){function s(e,t,i,s){for(var a=e[t++],l=1<<a,n=l+1,c=n+1,h=a+1,o=(1<<h)-1,d=0,r=0,m=0,u=e[t++],b=new Int32Array(4096),p=null;;){for(;d<16&&0!==u;)r|=e[t++]<<d,d+=8,1===u?u=e[t++]:--u;if(d<h)break;var y=r&o;if(r>>=h,d-=h,y!==l){if(y===n)break;for(var Z=y<c?y:p,g=0,v=Z;v>l;)v=b[v]>>8,++g;var G=v;if(m+g+(Z!==y?1:0)>s)return void console.log("Warning, gif stream longer than expected.");i[m++]=G;var I=m+=g;for(Z!==y&&(i[m++]=G),v=Z;g--;)v=b[v],i[--I]=255&v,v>>=8;null!==p&&c<4096&&(b[c++]=p<<8|G,c>=o+1&&h<12&&(++h,o=o<<1|1)),p=y}else c=n+1,o=(1<<(h=a+1))-1,p=null}return m!==s&&console.log("Warning, gif stream shorter than expected."),i}try{i.GifWriter=function(e,t,i,s){function a(e){var t=e.length;if(t<2||t>256||t&t-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return t}var l=0,n=void 0===(s=void 0===s?{}:s).loop?null:s.loop,c=void 0===s.palette?null:s.palette;if(t<=0||i<=0||t>65535||i>65535)throw"Width/Height invalid.";e[l++]=71,e[l++]=73,e[l++]=70,e[l++]=56,e[l++]=57,e[l++]=97;var h=0,o=0;if(null!==c){for(var d=a(c);d>>=1;)++h;if(d=1<<h,--h,void 0!==s.background){if((o=s.background)>=d)throw"Background index out of range.";if(0===o)throw"Background index explicitly passed as 0."}}if(e[l++]=255&t,e[l++]=t>>8&255,e[l++]=255&i,e[l++]=i>>8&255,e[l++]=(null!==c?128:0)|h,e[l++]=o,e[l++]=0,null!==c)for(var r=0,m=c.length;r<m;++r){var u=c[r];e[l++]=u>>16&255,e[l++]=u>>8&255,e[l++]=255&u}if(null!==n){if(n<0||n>65535)throw"Loop count invalid.";e[l++]=33,e[l++]=255,e[l++]=11,e[l++]=78,e[l++]=69,e[l++]=84,e[l++]=83,e[l++]=67,e[l++]=65,e[l++]=80,e[l++]=69,e[l++]=50,e[l++]=46,e[l++]=48,e[l++]=3,e[l++]=1,e[l++]=255&n,e[l++]=n>>8&255,e[l++]=0}var b=!1;this.addFrame=function(t,i,s,n,h,o){if(!0===b&&(--l,b=!1),o=void 0===o?{}:o,t<0||i<0||t>65535||i>65535)throw"x/y invalid.";if(s<=0||n<=0||s>65535||n>65535)throw"Width/Height invalid.";if(h.length<s*n)throw"Not enough pixels for the frame size.";var d=!0,r=o.palette;if(null!=r||(d=!1,r=c),null==r)throw"Must supply either a local or global palette.";for(var m=a(r),u=0;m>>=1;)++u;m=1<<u;var p=void 0===o.delay?0:o.delay,y=void 0===o.disposal?0:o.disposal;if(y<0||y>3)throw"Disposal out of range.";var Z=!1,g=0;if(void 0!==o.transparent&&null!==o.transparent&&(Z=!0,(g=o.transparent)<0||g>=m))throw"Transparent color index.";if((0!==y||Z||0!==p)&&(e[l++]=33,e[l++]=249,e[l++]=4,e[l++]=y<<2|(!0===Z?1:0),e[l++]=255&p,e[l++]=p>>8&255,e[l++]=g,e[l++]=0),e[l++]=44,e[l++]=255&t,e[l++]=t>>8&255,e[l++]=255&i,e[l++]=i>>8&255,e[l++]=255&s,e[l++]=s>>8&255,e[l++]=255&n,e[l++]=n>>8&255,e[l++]=!0===d?128|u-1:0,!0===d)for(var v=0,G=r.length;v<G;++v){var I=r[v];e[l++]=I>>16&255,e[l++]=I>>8&255,e[l++]=255&I}l=function(e,t,i,s){function a(i){for(;m>=i;)e[t++]=255&u,u>>=8,m-=8,t===n+256&&(e[n]=255,n=t++)}function l(e){u|=e<<m,m+=r,a(8)}e[t++]=i;var n=t++,c=1<<i,h=c-1,o=c+1,d=o+1,r=i+1,m=0,u=0,b=s[0]&h,p={};l(c);for(var y=1,Z=s.length;y<Z;++y){var g=s[y]&h,v=b<<8|g,G=p[v];if(void 0===G){for(u|=b<<m,m+=r;m>=8;)e[t++]=255&u,u>>=8,m-=8,t===n+256&&(e[n]=255,n=t++);4096===d?(l(c),d=o+1,r=i+1,p={}):(d>=1<<r&&++r,p[v]=d++),b=g}else b=G}return l(b),l(o),a(1),n+1===t?e[n]=0:(e[n]=t-n-1,e[t++]=0),t}(e,l,u<2?2:u,h)},this.end=function(){return!1===b&&(e[l++]=59,b=!0),l}},i.GifReader=function(e){var t=0;if(71!==e[t++]||73!==e[t++]||70!==e[t++]||56!==e[t++]||56!=(e[t++]+1&253)||97!==e[t++])throw"Invalid GIF 87a/89a header.";var i=e[t++]|e[t++]<<8,a=e[t++]|e[t++]<<8,l=e[t++],n=l>>7,c=1<<1+(7&l);e[t++],e[t++];var h=null;n&&(h=t,t+=3*c);var o=!0,d=[],r=0,m=null,u=0,b=null;for(this.width=i,this.height=a;o&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(11!==e[t]||78==e[t+1]&&69==e[t+2]&&84==e[t+3]&&83==e[t+4]&&67==e[t+5]&&65==e[t+6]&&80==e[t+7]&&69==e[t+8]&&50==e[t+9]&&46==e[t+10]&&48==e[t+11]&&3==e[t+12]&&1==e[t+13]&&0==e[t+16])t+=14,b=e[t++]|e[t++]<<8,t++;else for(t+=12;0!==(R=e[t++]);)t+=R;break;case 249:if(4!==e[t++]||0!==e[t+4])throw"Invalid graphics extension block.";var p=e[t++];r=e[t++]|e[t++]<<8,m=e[t++],0==(1&p)&&(m=null),u=p>>2&7,t++;break;case 254:for(;0!==(R=e[t++]);)t+=R;break;default:throw"Unknown graphic control label: 0x"+e[t-1].toString(16)}break;case 44:var y=e[t++]|e[t++]<<8,Z=e[t++]|e[t++]<<8,g=e[t++]|e[t++]<<8,v=e[t++]|e[t++]<<8,G=e[t++],I=G>>6&1,X=h,S=!1;G>>7&&(S=!0,X=t,t+=3*(1<<1+(7&G)));var W=t;for(t++;;){var R;if(0===(R=e[t++]))break;t+=R}d.push({x:y,y:Z,width:g,height:v,has_local_palette:S,palette_offset:X,data_offset:W,data_length:t-W,transparent_index:m,interlaced:!!I,delay:r,disposal:u});break;case 59:o=!1;break;default:throw"Unknown gif block: 0x"+e[t-1].toString(16)}this.numFrames=function(){return d.length},this.loopCount=function(){return b},this.frameInfo=function(e){if(e<0||e>=d.length)throw"Frame index out of range.";return d[e]},this.decodeAndBlitFrameBGRA=function(t,a){var l=this.frameInfo(t),n=l.width*l.height,c=new Uint8Array(n);s(e,l.data_offset,c,n);var h=l.palette_offset,o=l.transparent_index;null===o&&(o=256);var d=l.width,r=i-d,m=d,u=4*(l.y*i+l.x),b=4*((l.y+l.height)*i+l.x),p=u,y=4*r;!0===l.interlaced&&(y+=4*i*7);for(var Z=8,g=0,v=c.length;g<v;++g){var G=c[g];if(0===m&&(m=d,(p+=y)>=b&&(y=4*r+4*i*(Z-1),p=u+(d+r)*(Z<<1),Z>>=1)),G===o)p+=4;else{var I=e[h+3*G],X=e[h+3*G+1],S=e[h+3*G+2];a[p++]=S,a[p++]=X,a[p++]=I,a[p++]=255}--m}},this.decodeAndBlitFrameRGBA=function(t,a){var l=this.frameInfo(t),n=l.width*l.height,c=new Uint8Array(n);s(e,l.data_offset,c,n);var h=l.palette_offset,o=l.transparent_index;null===o&&(o=256);var d=l.width,r=i-d,m=d,u=4*(l.y*i+l.x),b=4*((l.y+l.height)*i+l.x),p=u,y=4*r;!0===l.interlaced&&(y+=4*i*7);for(var Z=8,g=0,v=c.length;g<v;++g){var G=c[g];if(0===m&&(m=d,(p+=y)>=b&&(y=4*r+4*i*(Z-1),p=u+(d+r)*(Z<<1),Z>>=1)),G===o)p+=4;else{var I=e[h+3*G],X=e[h+3*G+1],S=e[h+3*G+2];a[p++]=I,a[p++]=X,a[p++]=S,a[p++]=255}--m}}}}catch(e){}},{}],2:[function(e,t,i){t.exports=function(t){function i(e){g.length,G=e;for(var t=0;t<h&&t<g.length;t++)s(t)}function s(e){var t,i;return(t=g[e]).beingProcessed||t.done?(console.error("Frame already being processed or done!",t.position),void l()):(t.sampleInterval=c,t.beingProcessed=!0,(i=function(){if(0===S.length)throw"No workers left!";return S.pop()}()).onmessage=function(e){var s=e.data;delete t.data,t.pixels=Array.prototype.slice.call(s.pixels),t.palette=Array.prototype.slice.call(s.palette),t.done=!0,t.beingProcessed=!1,function(e){S.push(e)}(i),l()},void i.postMessage(t))}function a(){for(var e=-1,t=0;t<g.length;t++){var i=g[t];if(!i.done&&!i.beingProcessed){e=t;break}}e>=0&&s(e)}function l(){var e=g.every((function(e){return!e.beingProcessed&&e.done}));v++,I(.75*v/g.length),e?W||function(e,t){var i,s=[],a={loop:y};null!==m&&null!==u&&(i=u,a.palette=i);var l=new o(s,d,r,a);W=!0,e.forEach((function(t,s){var a;i||(a=t.palette),I(.75+.25*t.position*1/e.length),l.addFrame(0,0,d,r,t.pixels,{palette:a,delay:Z})})),l.end(),I(1),e=[],W=!1,t(s)}(g,G):setTimeout(a,1)}function n(e){return 0!==e&&0==(e&e-1)}t=t||{};var c,h,o=e("omggif").GifWriter,d=t.width||160,r=t.height||120,m=t.dithering||null,u=t.palette||null,b=null,p=null,y=0,Z=250,g=[],v=0,G=function(){},I=function(){},X=[],S=[],W=!1;if(u){if(!(u instanceof Array))throw u;if(u.length<2||u.length>256){for(console.error("Palette must hold only between 2 and 256 colours");u.length<2;)u.push(0);u.length>256&&(u=u.slice(0,256))}if(!n(u.length))for(console.error("Palette must have a power of two number of colours");!n(u.length);)u.splice(u.length-1,1)}c=(t=t||{}).sampleInterval||10,h=t.numWorkers||2;for(var R=0;R<h;R++){var V=new Worker(window.URL.createObjectURL(new Blob(['(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module \'"+o+"\'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\nfunction colorClamp(value) {\n\tif(value < 0) return 0;\n\telse if(value > 255) return 255;\n\n\treturn value;\n}\n\nvar bayerMatrix8x8 = [\n\t[  1, 49, 13, 61,  4, 52, 16, 64 ],\n\t[ 33, 17, 45, 29, 36, 20, 48, 32 ],\n\t[  9, 57,  5, 53, 12, 60,  8, 56 ],\n\t[ 41, 25, 37, 21, 44, 28, 40, 24 ],\n\t[  3, 51, 15, 63,  2, 50, 14, 62 ],\n\t[ 35, 19, 47, 31, 34, 18, 46, 30 ],\n\t[ 11, 59,  7, 55, 10, 58,  6, 54 ],\n\t[ 43, 27, 39, 23, 42, 26, 38, 22 ]\n\t];\n\n\t// int r, int g, int b, int[][] palette, int paletteLength\n\tfunction getClosestPaletteColorIndex(r, g, b, palette, paletteLength) {\n\t\tvar minDistance = 195076;\n\t\tvar diffR, diffG, diffB;\n\t\tvar distanceSquared;\n\t\tvar bestIndex = 0;\n\t\tvar paletteChannels;\n\n\t\tfor(var i = 0; i < paletteLength; i++) {\n\n\t\t\tpaletteChannels = palette[i];\n\t\t\tdiffR = r - paletteChannels[0];\n\t\t\tdiffG = g - paletteChannels[1];\n\t\t\tdiffB = b - paletteChannels[2];\n\n\t\t\tdistanceSquared = diffR*diffR + diffG*diffG + diffB*diffB;\n\n\t\t\tif(distanceSquared < minDistance) {\n\t\t\t\tbestIndex = i;\n\t\t\t\tminDistance = distanceSquared;\n\t\t\t}\n\n\t\t}\n\n\t\treturn bestIndex;\n\t}\n\n// TODO: inPixels -> inComponents or inColors or something more accurate\nfunction BayerDithering(inPixels, width, height, palette) {\n\tvar offset = 0;\n\tvar indexedOffset = 0;\n\tvar r, g, b;\n\tvar pixel, threshold, index;\n\tvar paletteLength = palette.length;\n\tvar matrix = bayerMatrix8x8;\n\tvar indexedPixels = new Uint8Array( width * height );\n\n\tvar modI = 8;\n\tvar modJ = 8;\n\n\tfor(var j = 0; j < height; j++) {\n\t\tvar modj = j % modJ;\n\n\t\tfor(var i = 0; i < width; i++) {\n\n\t\t\tthreshold = matrix[i % modI][modj];\n\n\t\t\tr = colorClamp( inPixels[offset++] + threshold );\n\t\t\tg = colorClamp( inPixels[offset++] + threshold );\n\t\t\tb = colorClamp( inPixels[offset++] + threshold );\n\n\t\t\tindex = getClosestPaletteColorIndex(r, g, b, palette, paletteLength);\n\t\t\tindexedPixels[indexedOffset++] = index;\n\n\t\t}\n\t}\n\n\treturn indexedPixels;\n}\n\n\nfunction ClosestDithering(inPixels, width, height, palette) {\n\n\tvar offset = 0;\n\tvar indexedOffset = 0;\n\tvar r, g, b;\n\tvar index;\n\tvar paletteLength = palette.length;\n\tvar matrix = bayerMatrix8x8;\n\tvar numPixels = width * height;\n\tvar indexedPixels = new Uint8Array( numPixels );\n\n\tfor(var i = 0; i < numPixels; i++) {\n\n\t\tr = inPixels[offset++];\n\t\tg = inPixels[offset++];\n\t\tb = inPixels[offset++];\n\n\t\tindexedPixels[i] = getClosestPaletteColorIndex(r, g, b, palette, paletteLength);\n\n\t}\n\n\treturn indexedPixels;\n\n}\n\n\nfunction FloydSteinberg(inPixels, width, height, palette) {\n\tvar paletteLength = palette.length;\n\tvar offset = 0;\n\tvar indexedOffset = 0;\n\tvar r, g, b;\n\tvar widthLimit = width - 1;\n\tvar heightLimit = height - 1;\n\tvar offsetNextI, offsetNextJ;\n\tvar offsetPrevINextJ;\n\tvar channels, nextChannels;\n\tvar indexedPixels = new Uint8Array( width * height );\n\n\tfor(var j = 0; j < height; j++) {\n\t\tfor(var i = 0; i < width; i++) {\n\n\t\t\tr = colorClamp(inPixels[offset++]);\n\t\t\tg = colorClamp(inPixels[offset++]);\n\t\t\tb = colorClamp(inPixels[offset++]);\n\n\t\t\tvar colorIndex = getClosestPaletteColorIndex(r, g, b, palette, paletteLength);\n\t\t\tvar paletteColor = palette[colorIndex];\n\t\t\tvar closestColor = paletteColor[3];\n\n\t\t\t// We are done with finding the best value for this pixel\n\t\t\tindexedPixels[indexedOffset] = colorIndex;\n\n\t\t\t// Now find difference between assigned value and original color\n\t\t\t// and propagate that error forward\n\t\t\tvar errorR = r - paletteColor[0];\n\t\t\tvar errorG = g - paletteColor[1];\n\t\t\tvar errorB = b - paletteColor[2];\n\n\t\t\tif(i < widthLimit) {\n\n\t\t\t\toffsetNextI = offset + 1;\n\n\t\t\t\tinPixels[offsetNextI++] += (errorR * 7) >> 4;\n\t\t\t\tinPixels[offsetNextI++] += (errorG * 7) >> 4;\n\t\t\t\tinPixels[offsetNextI++] += (errorB * 7) >> 4;\n\n\t\t\t}\n\n\n\t\t\tif(j < heightLimit) {\n\n\t\t\t\tif(i > 0) {\n\n\t\t\t\t\toffsetPrevINextJ = offset - 1 + width;\n\n\t\t\t\t\tinPixels[offsetPrevINextJ++] += (errorR * 3) >> 4;\n\t\t\t\t\tinPixels[offsetPrevINextJ++] += (errorG * 3) >> 4;\n\t\t\t\t\tinPixels[offsetPrevINextJ++] += (errorB * 3) >> 4;\n\n\t\t\t\t}\n\n\t\t\t\toffsetNextJ = offset + width;\n\n\t\t\t\tinPixels[offsetNextJ++] += (errorR * 5) >> 4;\n\t\t\t\tinPixels[offsetNextJ++] += (errorG * 5) >> 4;\n\t\t\t\tinPixels[offsetNextJ++] += (errorB * 5) >> 4;\n\n\n\t\t\t\tif(i < widthLimit) {\n\n\t\t\t\t\tinPixels[offsetNextJ++] += errorR >> 4;\n\t\t\t\t\tinPixels[offsetNextJ++] += errorG >> 4;\n\t\t\t\t\tinPixels[offsetNextJ++] += errorB >> 4;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tindexedOffset++;\n\t\t}\n\t}\n\n\treturn indexedPixels;\n}\n\nmodule.exports = {\n\tBayer: BayerDithering,\n\tClosest: ClosestDithering,\n\tFloydSteinberg: FloydSteinberg\n};\n\n\n},{}],2:[function(require,module,exports){\nvar NeuQuant = require(\'./lib/NeuQuant\');\nvar Dithering = require(\'node-dithering\');\n\nfunction channelizePalette( palette ) {\n    var channelizedPalette = [];\n\n    for(var i = 0; i < palette.length; i++) {\n        var color = palette[i];\n\n        var r = (color & 0xFF0000) >> 16;\n        var g = (color & 0x00FF00) >>  8;\n        var b = (color & 0x0000FF);\n\n        channelizedPalette.push([ r, g, b, color ]);\n    }\n\n    return channelizedPalette;\n\n}\n\n\nfunction dataToRGB( data, width, height ) {\n    var i = 0;\n    var length = width * height * 4;\n    var rgb = [];\n\n    while(i < length) {\n        rgb.push( data[i++] );\n        rgb.push( data[i++] );\n        rgb.push( data[i++] );\n        i++; // for the alpha channel which we don\'t care about\n    }\n\n    return rgb;\n}\n\n\nfunction componentizedPaletteToArray(paletteRGB) {\n\n    var paletteArray = [];\n\n    for(var i = 0; i < paletteRGB.length; i += 3) {\n        var r = paletteRGB[ i ];\n        var g = paletteRGB[ i + 1 ];\n        var b = paletteRGB[ i + 2 ];\n        paletteArray.push(r << 16 | g << 8 | b);\n    }\n\n    return paletteArray;\n}\n\n\n// This is the "traditional" Animated_GIF style of going from RGBA to indexed color frames\nfunction processFrameWithQuantizer(imageData, width, height, sampleInterval) {\n\n    var rgbComponents = dataToRGB( imageData, width, height );\n    var nq = new NeuQuant(rgbComponents, rgbComponents.length, sampleInterval);\n    var paletteRGB = nq.process();\n    var paletteArray = new Uint32Array(componentizedPaletteToArray(paletteRGB));\n\n    var numberPixels = width * height;\n    var indexedPixels = new Uint8Array(numberPixels);\n\n    var k = 0;\n    for(var i = 0; i < numberPixels; i++) {\n        r = rgbComponents[k++];\n        g = rgbComponents[k++];\n        b = rgbComponents[k++];\n        indexedPixels[i] = nq.map(r, g, b);\n    }\n\n    return {\n        pixels: indexedPixels,\n        palette: paletteArray\n    };\n\n}\n\n\n// And this is a version that uses dithering against of quantizing\n// It can also use a custom palette if provided, or will build one otherwise\nfunction processFrameWithDithering(imageData, width, height, ditheringType, palette) {\n\n    // Extract component values from data\n    var rgbComponents = dataToRGB( imageData, width, height );\n\n\n    // Build palette if none provided\n    if(palette === null) {\n\n        var nq = new NeuQuant(rgbComponents, rgbComponents.length, 16);\n        var paletteRGB = nq.process();\n        palette = componentizedPaletteToArray(paletteRGB);\n\n    }\n\n    var paletteArray = new Uint32Array( palette );\n    var paletteChannels = channelizePalette( palette );\n\n    // Convert RGB image to indexed image\n    var ditheringFunction;\n\n    if(ditheringType === \'closest\') {\n        ditheringFunction = Dithering.Closest;\n    } else if(ditheringType === \'floyd\') {\n        ditheringFunction = Dithering.FloydSteinberg;\n    } else {\n        ditheringFunction = Dithering.Bayer;\n    }\n\n    pixels = ditheringFunction(rgbComponents, width, height, paletteChannels);\n\n    return ({\n        pixels: pixels,\n        palette: paletteArray\n    });\n\n}\n\n\n// ~~~\n\nfunction run(frame) {\n    var width = frame.width;\n    var height = frame.height;\n    var imageData = frame.data;\n    var dithering = frame.dithering;\n    var palette = frame.palette;\n    var sampleInterval = frame.sampleInterval;\n\n    if(dithering) {\n        return processFrameWithDithering(imageData, width, height, dithering, palette);\n    } else {\n        return processFrameWithQuantizer(imageData, width, height, sampleInterval);\n    }\n\n}\n\n\nself.onmessage = function(ev) {\n    var data = ev.data;\n    var response = run(data);\n    postMessage(response);\n};\n\n},{"./lib/NeuQuant":3,"node-dithering":1}],3:[function(require,module,exports){\n/*\n* NeuQuant Neural-Net Quantization Algorithm\n* ------------------------------------------\n*\n* Copyright (c) 1994 Anthony Dekker\n*\n* NEUQUANT Neural-Net quantization algorithm by Anthony Dekker, 1994. See\n* "Kohonen neural networks for optimal colour quantization" in "Network:\n* Computation in Neural Systems" Vol. 5 (1994) pp 351-367. for a discussion of\n* the algorithm.\n*\n* Any party obtaining a copy of these files from the author, directly or\n* indirectly, is granted, free of charge, a full and unrestricted irrevocable,\n* world-wide, paid up, royalty-free, nonexclusive right and license to deal in\n* this software and documentation files (the "Software"), including without\n* limitation the rights to use, copy, modify, merge, publish, distribute,\n* sublicense, and/or sell copies of the Software, and to permit persons who\n* receive copies from any such party to do so, with the only requirement being\n* that this copyright notice remain intact.\n*/\n\n/*\n* This class handles Neural-Net quantization algorithm\n* @author Kevin Weiner (original Java version - kweiner@fmsware.com)\n* @author Thibault Imbert (AS3 version - bytearray.org)\n* @version 0.1 AS3 implementation\n* @version 0.2 JS->AS3 "translation" by antimatter15\n* @version 0.3 JS clean up + using modern JS idioms by sole - http://soledadpenades.com\n* Also implement fix in color conversion described at http://stackoverflow.com/questions/16371712/neuquant-js-javascript-color-quantization-hidden-bug-in-js-conversion\n*/\n\nmodule.exports = function NeuQuant() {\n\n    var netsize = 256; // number of colours used\n\n    // four primes near 500 - assume no image has a length so large\n    // that it is divisible by all four primes\n    var prime1 = 499;\n    var prime2 = 491;\n    var prime3 = 487;\n    var prime4 = 503;\n\n    // minimum size for input image\n    var minpicturebytes = (3 * prime4);\n\n    // Network Definitions\n\n    var maxnetpos = (netsize - 1);\n    var netbiasshift = 4; // bias for colour values\n    var ncycles = 100; // no. of learning cycles\n\n    // defs for freq and bias\n    var intbiasshift = 16; // bias for fractions\n    var intbias = (1 << intbiasshift);\n    var gammashift = 10; // gamma = 1024\n    var gamma = (1 << gammashift);\n    var betashift = 10;\n    var beta = (intbias >> betashift); // beta = 1/1024\n    var betagamma = (intbias << (gammashift - betashift));\n\n    // defs for decreasing radius factor\n    // For 256 colors, radius starts at 32.0 biased by 6 bits\n    // and decreases by a factor of 1/30 each cycle\n    var initrad = (netsize >> 3);\n    var radiusbiasshift = 6;\n    var radiusbias = (1 << radiusbiasshift);\n    var initradius = (initrad * radiusbias);\n    var radiusdec = 30;\n\n    // defs for decreasing alpha factor\n    // Alpha starts at 1.0 biased by 10 bits\n    var alphabiasshift = 10;\n    var initalpha = (1 << alphabiasshift);\n    var alphadec;\n\n    // radbias and alpharadbias used for radpower calculation\n    var radbiasshift = 8;\n    var radbias = (1 << radbiasshift);\n    var alpharadbshift = (alphabiasshift + radbiasshift);\n    var alpharadbias = (1 << alpharadbshift);\n\n\n    // Input image\n    var thepicture;\n    // Height * Width * 3\n    var lengthcount;\n    // Sampling factor 1..30\n    var samplefac;\n\n    // The network itself\n    var network;\n    var netindex = [];\n\n    // for network lookup - really 256\n    var bias = [];\n\n    // bias and freq arrays for learning\n    var freq = [];\n    var radpower = [];\n\n    function NeuQuantConstructor(thepic, len, sample) {\n\n        var i;\n        var p;\n\n        thepicture = thepic;\n        lengthcount = len;\n        samplefac = sample;\n\n        network = new Array(netsize);\n\n        for (i = 0; i < netsize; i++) {\n            network[i] = new Array(4);\n            p = network[i];\n            p[0] = p[1] = p[2] = ((i << (netbiasshift + 8)) / netsize) | 0;\n            freq[i] = (intbias / netsize) | 0; // 1 / netsize\n            bias[i] = 0;\n        }\n\n    }\n\n    function colorMap() {\n        var map = [];\n        var index = new Array(netsize);\n        for (var i = 0; i < netsize; i++)\n            index[network[i][3]] = i;\n        var k = 0;\n        for (var l = 0; l < netsize; l++) {\n            var j = index[l];\n            map[k++] = (network[j][0]);\n            map[k++] = (network[j][1]);\n            map[k++] = (network[j][2]);\n        }\n        return map;\n    }\n\n    // Insertion sort of network and building of netindex[0..255]\n    // (to do after unbias)\n    function inxbuild() {\n        var i;\n        var j;\n        var smallpos;\n        var smallval;\n        var p;\n        var q;\n        var previouscol;\n        var startpos;\n\n        previouscol = 0;\n        startpos = 0;\n\n        for (i = 0; i < netsize; i++)\n        {\n\n            p = network[i];\n            smallpos = i;\n            smallval = p[1]; // index on g\n            // find smallest in i..netsize-1\n            for (j = i + 1; j < netsize; j++) {\n\n                q = network[j];\n\n                if (q[1] < smallval) { // index on g\n                    smallpos = j;\n                    smallval = q[1]; // index on g\n                }\n            }\n\n            q = network[smallpos];\n\n            // swap p (i) and q (smallpos) entries\n            if (i != smallpos) {\n                j = q[0];\n                q[0] = p[0];\n                p[0] = j;\n                j = q[1];\n                q[1] = p[1];\n                p[1] = j;\n                j = q[2];\n                q[2] = p[2];\n                p[2] = j;\n                j = q[3];\n                q[3] = p[3];\n                p[3] = j;\n            }\n\n            // smallval entry is now in position i\n            if (smallval != previouscol) {\n\n                netindex[previouscol] = (startpos + i) >> 1;\n\n                for (j = previouscol + 1; j < smallval; j++) {\n                    netindex[j] = i;\n                }\n\n                previouscol = smallval;\n                startpos = i;\n\n            }\n\n        }\n\n        netindex[previouscol] = (startpos + maxnetpos) >> 1;\n        for (j = previouscol + 1; j < 256; j++) {\n            netindex[j] = maxnetpos; // really 256\n        }\n\n    }\n\n\n    // Main Learning Loop\n\n    function learn() {\n        var i;\n        var j;\n        var b;\n        var g;\n        var r;\n        var radius;\n        var rad;\n        var alpha;\n        var step;\n        var delta;\n        var samplepixels;\n        var p;\n        var pix;\n        var lim;\n\n        if (lengthcount < minpicturebytes) {\n            samplefac = 1;\n        }\n\n        alphadec = 30 + ((samplefac - 1) / 3);\n        p = thepicture;\n        pix = 0;\n        lim = lengthcount;\n        samplepixels = lengthcount / (3 * samplefac);\n        delta = (samplepixels / ncycles) | 0;\n        alpha = initalpha;\n        radius = initradius;\n\n        rad = radius >> radiusbiasshift;\n        if (rad <= 1) {\n            rad = 0;\n        }\n\n        for (i = 0; i < rad; i++) {\n            radpower[i] = alpha * (((rad * rad - i * i) * radbias) / (rad * rad));\n        }\n\n\n        if (lengthcount < minpicturebytes) {\n            step = 3;\n        } else if ((lengthcount % prime1) !== 0) {\n            step = 3 * prime1;\n        } else {\n\n            if ((lengthcount % prime2) !== 0) {\n                step = 3 * prime2;\n            } else {\n                if ((lengthcount % prime3) !== 0) {\n                    step = 3 * prime3;\n                } else {\n                    step = 3 * prime4;\n                }\n            }\n\n        }\n\n        i = 0;\n\n        while (i < samplepixels) {\n\n            b = (p[pix + 0] & 0xff) << netbiasshift;\n            g = (p[pix + 1] & 0xff) << netbiasshift;\n            r = (p[pix + 2] & 0xff) << netbiasshift;\n            j = contest(b, g, r);\n\n            altersingle(alpha, j, b, g, r);\n\n            if (rad !== 0) {\n                // Alter neighbours\n                alterneigh(rad, j, b, g, r);\n            }\n\n            pix += step;\n\n            if (pix >= lim) {\n                pix -= lengthcount;\n            }\n\n            i++;\n\n            if (delta === 0) {\n                delta = 1;\n            }\n\n            if (i % delta === 0) {\n                alpha -= alpha / alphadec;\n                radius -= radius / radiusdec;\n                rad = radius >> radiusbiasshift;\n\n                if (rad <= 1) {\n                    rad = 0;\n                }\n\n                for (j = 0; j < rad; j++) {\n                    radpower[j] = alpha * (((rad * rad - j * j) * radbias) / (rad * rad));\n                }\n\n            }\n\n        }\n\n    }\n\n    // Search for BGR values 0..255 (after net is unbiased) and return colour index\n    function map(b, g, r) {\n        var i;\n        var j;\n        var dist;\n        var a;\n        var bestd;\n        var p;\n        var best;\n\n        // Biggest possible distance is 256 * 3\n        bestd = 1000;\n        best = -1;\n        i = netindex[g]; // index on g\n        j = i - 1; // start at netindex[g] and work outwards\n\n        while ((i < netsize) || (j >= 0)) {\n\n            if (i < netsize) {\n\n                p = network[i];\n\n                dist = p[1] - g; // inx key\n\n                if (dist >= bestd) {\n                    i = netsize; // stop iter\n                } else {\n\n                    i++;\n\n                    if (dist < 0) {\n                        dist = -dist;\n                    }\n\n                    a = p[0] - b;\n\n                    if (a < 0) {\n                        a = -a;\n                    }\n\n                    dist += a;\n\n                    if (dist < bestd) {\n                        a = p[2] - r;\n\n                        if (a < 0) {\n                            a = -a;\n                        }\n\n                        dist += a;\n\n                        if (dist < bestd) {\n                            bestd = dist;\n                            best = p[3];\n                        }\n                    }\n\n                }\n\n            }\n\n            if (j >= 0) {\n\n                p = network[j];\n\n                dist = g - p[1]; // inx key - reverse dif\n\n                if (dist >= bestd) {\n                    j = -1; // stop iter\n                } else {\n\n                    j--;\n                    if (dist < 0) {\n                        dist = -dist;\n                    }\n                    a = p[0] - b;\n                    if (a < 0) {\n                        a = -a;\n                    }\n                    dist += a;\n\n                    if (dist < bestd) {\n                        a = p[2] - r;\n                        if (a < 0) {\n                            a = -a;\n                        }\n                        dist += a;\n                        if (dist < bestd) {\n                            bestd = dist;\n                            best = p[3];\n                        }\n                    }\n\n                }\n\n            }\n\n        }\n\n        return (best);\n\n    }\n\n    function process() {\n        learn();\n        unbiasnet();\n        inxbuild();\n        return colorMap();\n    }\n\n    // Unbias network to give byte values 0..255 and record position i\n    // to prepare for sort\n    function unbiasnet() {\n        var i;\n        var j;\n\n        for (i = 0; i < netsize; i++) {\n            network[i][0] >>= netbiasshift;\n            network[i][1] >>= netbiasshift;\n            network[i][2] >>= netbiasshift;\n            network[i][3] = i; // record colour no\n        }\n    }\n\n    // Move adjacent neurons by precomputed alpha*(1-((i-j)^2/[r]^2))\n    // in radpower[|i-j|]\n    function alterneigh(rad, i, b, g, r) {\n\n        var j;\n        var k;\n        var lo;\n        var hi;\n        var a;\n        var m;\n\n        var p;\n\n        lo = i - rad;\n        if (lo < -1) {\n            lo = -1;\n        }\n\n        hi = i + rad;\n\n        if (hi > netsize) {\n            hi = netsize;\n        }\n\n        j = i + 1;\n        k = i - 1;\n        m = 1;\n\n        while ((j < hi) || (k > lo)) {\n\n            a = radpower[m++];\n\n            if (j < hi) {\n\n                p = network[j++];\n\n                try {\n\n                    p[0] -= ((a * (p[0] - b)) / alpharadbias) | 0;\n                    p[1] -= ((a * (p[1] - g)) / alpharadbias) | 0;\n                    p[2] -= ((a * (p[2] - r)) / alpharadbias) | 0;\n\n                } catch (e) {}\n\n            }\n\n            if (k > lo) {\n\n                p = network[k--];\n\n                try {\n\n                    p[0] -= ((a * (p[0] - b)) / alpharadbias) | 0;\n                    p[1] -= ((a * (p[1] - g)) / alpharadbias) | 0;\n                    p[2] -= ((a * (p[2] - r)) / alpharadbias) | 0;\n\n                } catch (e) {}\n\n            }\n\n        }\n\n    }\n\n\n    // Move neuron i towards biased (b,g,r) by factor alpha\n    function altersingle(alpha, i, b, g, r) {\n\n        // alter hit neuron\n        var n = network[i];\n        var alphaMult = alpha / initalpha;\n        n[0] -= ((alphaMult * (n[0] - b))) | 0;\n        n[1] -= ((alphaMult * (n[1] - g))) | 0;\n        n[2] -= ((alphaMult * (n[2] - r))) | 0;\n\n    }\n\n    // Search for biased BGR values\n    function contest(b, g, r) {\n\n        // finds closest neuron (min dist) and updates freq\n        // finds best neuron (min dist-bias) and returns position\n        // for frequently chosen neurons, freq[i] is high and bias[i] is negative\n        // bias[i] = gamma*((1/netsize)-freq[i])\n\n        var i;\n        var dist;\n        var a;\n        var biasdist;\n        var betafreq;\n        var bestpos;\n        var bestbiaspos;\n        var bestd;\n        var bestbiasd;\n        var n;\n\n        bestd = ~(1 << 31);\n        bestbiasd = bestd;\n        bestpos = -1;\n        bestbiaspos = bestpos;\n\n        for (i = 0; i < netsize; i++) {\n\n            n = network[i];\n            dist = n[0] - b;\n\n            if (dist < 0) {\n                dist = -dist;\n            }\n\n            a = n[1] - g;\n\n            if (a < 0) {\n                a = -a;\n            }\n\n            dist += a;\n\n            a = n[2] - r;\n\n            if (a < 0) {\n                a = -a;\n            }\n\n            dist += a;\n\n            if (dist < bestd) {\n                bestd = dist;\n                bestpos = i;\n            }\n\n            biasdist = dist - ((bias[i]) >> (intbiasshift - netbiasshift));\n\n            if (biasdist < bestbiasd) {\n                bestbiasd = biasdist;\n                bestbiaspos = i;\n            }\n\n            betafreq = (freq[i] >> betashift);\n            freq[i] -= betafreq;\n            bias[i] += (betafreq << gammashift);\n\n        }\n\n        freq[bestpos] += beta;\n        bias[bestpos] -= betagamma;\n        return (bestbiaspos);\n\n    }\n\n    NeuQuantConstructor.apply(this, arguments);\n\n    var exports = {};\n    exports.map = map;\n    exports.process = process;\n\n    return exports;\n}\n\n},{}]},{},[2])'],{type:"text/javascript"})));X.push(V),S.push(V)}var L=function(){for(var e=[],t=0;t<256;t++)e[t]=String.fromCharCode(t);return function(t){for(var i=t.length,s="",a=0;a<i;a++)s+=e[t[a]];return s}}();this.setSize=function(e,t){d=e,r=t,(b=document.createElement("canvas")).width=e,b.height=t,p=b.getContext("2d")},this.setDelay=function(e){Z=.1*e},this.setRepeat=function(e){y=e},this.addFrame=function(e){null===p&&this.setSize(d,r),p.drawImage(e,0,0,d,r);var t=p.getImageData(0,0,d,r);this.addFrameImageData(t)},this.addFrameImageData=function(e){var t=(e.length,new Uint8Array(e.data));g.push({data:t,width:e.width,height:e.height,palette:u,dithering:m,done:!1,beingProcessed:!1,position:g.length})},this.onRenderProgress=function(e){I=e},this.isRendering=function(){return W},this.getBase64GIF=function(e){i((function(t){var i=L(t),s="data:image/gif;base64,"+btoa(i);e(s)}))},this.getBlobGIF=function(e){i((function(t){var i=new Uint8Array(t),s=new Blob([i],{type:"image/gif"});e(s)}))},this.destroy=function(){X.forEach((function(e){e.terminate()}))}}},{omggif:1}]},{},[2])(2)}))}},t={};function i(s){var a=t[s];if(void 0!==a)return a.exports;var l=t[s]={id:s,loaded:!1,exports:{}};return e[s](l,l.exports,i),l.loaded=!0,l.exports}i.amdO={},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var s={};(()=>{i.d(s,{l:()=>b});let e={LivenessMode:{None:0,Passive:3},ExceptionType:{CameraError:0,ExtractorError:1,ControlNotInitializedError:2,ImageCropResizeError:3,UnexpectedCaptureError:4},TemplateFormat:{ByteArray:0,Base64:1},ImageFormat:{None:0,Gray_8bpp:1,RGB_24bpp:2,BGR_24bpp:3,ARGB_32bpp:4,YUV_NV21:5,ABGR_32bpp:6,BGRA_32bpp:7,RGBA_32bpp:8},SampleDiagnostic:{Ok:0,FaceNotFound:1,RightEyeNotFound:2,LeftEyeNotFound:3,EyesNotFound:4,FaceTooFar:5,FaceTooClose:6,TooCloseToWindowSide:7,AngleExceeded:8,QualityCheckFailed:9,NotRated:10},FinalDiagnostic:{InsufficientValidSamples:0,TemplateCreationInProgress:1,TemplateCreated:2},LivenessDiagnostic:{NotRated:0,PhotoDetected:1,LivenessDetected:2,Unsuccess:3,UnsuccessLowPerformance:4,UnsuccessGlasses:5,UnsuccessLight:6,UnsuccessNoMovement:7,UnsuccessWrongDirection:8,UnsuccessTooFar:9},RecorderType:{Local:0,Remote:1},CameraType:{Front:0,Back:1},TrackStatus:{ChangeState:0,Tap:1,FaceState:2,AccessibilityData:3,Diagnostic:4},Version:"5.16.0"};var t=i(871);class a{constructor(e,t,i,s,a,l,n){var c="";this.status=0,this.logDebug=!1,this.eventStatus=s,this.caller=i,this.baseURL=e,t.length>0&&(c=t+"."),this.widgetLoaded=0,this.languageCustomLoaded=0,this.languageDefaultLoaded=0,this.urlWidget=e+"widget.xml",this.urlLanguageCustom=e+"strings/strings."+c+"xml",this.resourceDict={},this.dpiList=a,this.browserDpi=l,this.scaleFactor=n;for(var h=163*l*n,o=this.dpiList.length-1,d=0;d<this.dpiList.length;d++)if(this.dpiList[d]>h){o=d;break}this.dpi=this.dpiList[o],this.imageScale=163/this.dpi,this.xmlHttpWidget=new XMLHttpRequest,this.xmlHttpWidget.rm=this,this.xmlHttpWidget.onreadystatechange=e=>{if(4==e.target.readyState&&200==e.target.status){var t=new DOMParser;e.target.rm.widgetLoaded=1,e.target.rm.xmlDoc=t.parseFromString(e.target.responseText,"text/xml")}else 4==e.target.readyState&&200!=e.target.status&&(e.target.rm.widgetLoaded=-1);e.target.rm.readyEvent(e)},this.xmlHttpWidget.open("GET",this.urlWidget),this.xmlHttpWidget.send(null),this.xmlHttpLanguageCustom=new XMLHttpRequest,this.xmlHttpLanguageCustom.rm=this,this.xmlHttpLanguageCustom.onreadystatechange=e=>{4==e.target.readyState&&200==e.target.status?e.target.rm.languageCustomLoaded=1:4==e.target.readyState&&200!=e.target.status&&(e.target.rm.languageCustomLoaded=-1),e.target.rm.readyEvent(e)},this.xmlHttpLanguageCustom.open("GET",this.urlLanguageCustom),this.xmlHttpLanguageCustom.send(null)}readyEvent(e){if(0!==e.target.rm.widgetLoaded&&(0!==e.target.rm.languageCustomLoaded||0!==e.target.rm.languageDefaultLoaded)){if(-1==e.target.rm.widgetLoaded)e.target.rm.status=-1;else if(1==e.target.rm.languageCustomLoaded){var t=e.target.rm.xmlHttpLanguageCustom.responseText,i=new DOMParser;e.target.rm.xmlLang=i.parseFromString(t,"text/xml"),e.target.rm.status=1}else 1==e.target.rm.languageDefaultLoaded?(t=e.target.rm.xmlHttpLanguageDefault.responseText,i=new DOMParser,e.target.rm.xmlLang=i.parseFromString(t,"text/xml"),e.target.rm.status=1):e.target.rm.status=-1;if(1==e.target.rm.status){for(var s,a={},l=e.target.rm.xmlDoc.querySelectorAll("[font]"),n=0;n<l.length;n++)(s=l[n].getAttribute("font")).length>0&&(a[s]=s);if(e.target.rm.fontRequestVector=[],null==document.getElementById("FPhi_Widget_style")){var c,h=document.createElement("style");for(c in h.id="FPhi_Widget_style",a){var o=e.target.rm.getResourceUrlBase(a[c]),d=a[c],r=new XMLHttpRequest;r.open("GET",o,!1),r.send(),200==r.status&&h.appendChild(document.createTextNode("@font-face { font-family: '"+d+"'; src: url('"+o+"'); }"))}document.head.appendChild(h)}e.target.rm.eventStatus(e.target.rm.caller,!0)}else e.target.rm.eventStatus(e.target.rm.caller,!1)}}static httpGet(e,t){var i=new XMLHttpRequest;return i.onreadystatechange=t,i.open("GET",e),i.send(null),200!=i.status?"":i.responseText}getElement(e,t,i){if("facephi-widget-conf"==e)return this.xmlDoc.getElementsByTagName("facephi-widget-conf")[0];var s="_portrait";i&&(s="_landscape");var a=this.xmlDoc.querySelector("[id="+e+s+"]");if(null!=a&&null!=a||(a=this.xmlDoc.querySelector("[id="+e+"]")),this.logDebug&&console.log(a),null!=a){var l=a.querySelector("[id="+t+"]");return this.logDebug&&console.log(l),null==l?void console.log("ResourceManager::getElement Error. elementId="+t+" undefined. Please verify resource's bundle."):l}console.log("ResourceManager::getElement Error. viewId="+e+" undefined. Please verify resource's bundle.")}getElements(e,t){var i="_portrait";t&&(i="_landscape");var s=this.xmlDoc.querySelector("[id="+e+i+"]");null!=s&&null!=s||(s=this.xmlDoc.querySelector("[id="+e+"]"));var a=[];if(s)for(var l=0;l<s.childNodes.length;l++)if(s.childNodes[l].nodeType==Node.ELEMENT_NODE){var n=null;void 0!==s.childNodes[l].attributes.mode&&(n=s.childNodes[l].attributes.mode.value),a.push({type:s.childNodes[l].nodeName,id:s.childNodes[l].attributes.id.value,mode:n})}return 0==a.length&&console.log("FPhi.ResourceManager: No elements for view="+e),a}isAttributeAvailable(e,t,i,s){var a=null;if("facephi-widget-conf"==e)a=this.xmlDoc.getElementsByTagName("facephi-widget-conf")[0];else{var l="_portrait";i&&(l="_landscape");var n=this.xmlDoc.querySelector("[id="+e+l+"]");if(null!=n&&null!=n||(n=this.xmlDoc.querySelector("[id="+e+"]")),null!=n){var c=n.querySelector("[id="+t+"]");null!=c&&(a=c)}}if(null==a||null==a)return!1;var h=a.getAttribute(s);return null!=h&&null!=h}getSetupColor(e,t,i,s){var a=this.getElement(e,t,i);if(null==a||null==a)return null;var l,n,c,h,o=a.getAttribute(s);return null==o||null==o?null:(9==o.length&&(l=parseInt(o.substring(1,3),16),n=parseInt(o.substring(3,5),16),c=parseInt(o.substring(5,7),16),h=parseInt(o.substring(7,9),16),o="rgba("+l+", "+n+", "+c+", "+(h/=255).toFixed(3)+")"),o)}getSetupColorWithAlpha(e,t,i,s,a){var l=this.getElement(e,t,i).getAttribute(s);return"rgba("+parseInt(l.substring(1,3),16)+", "+parseInt(l.substring(3,5),16)+", "+parseInt(l.substring(5,7),16)+", "+a.toFixed(3)+")"}getSetupFloat(e,t,i,s){var a=this.getElement(e,t,i).getAttribute(s);return parseFloat(a)}getSetupAlign(e,t,i,s){return this.getElement(e,t,i).getAttribute(s)}getSetupResourceId(e,t,i,s){var a=this.getElement(e,t,i).getAttribute(s),l=a.split(",");return l&&l.length>1?l[Math.floor(Math.random()*l.length)].trim():a}getSetupTextId(e,t,i,s){return this.getElement(e,t,i).getAttribute(s)}getSetupNodeType(e,t,i){return this.getElement(e,t,i).getAttribute("content_type")}getResourceUrl(e){return this.baseURL+"resources/"+this.dpi+"dpi/"+e}getResourceUrlBase(e){return this.baseURL+"resources/"+this.dpiList[0]+"dpi/"+e}getImageScale(){return this.imageScale}getImage(e){if(!(e in this.resourceDict)){var t=this.getResourceUrl(e),i=document.createElement("img");i.src=t,this.resourceDict[e]=i}return this.resourceDict[e]}translate(e){var t=e,i=this.xmlLang.querySelector("[id="+e+"]");return this.logDebug&&console.log(i),null!=i&&(t=i.textContent),t}}if(!l)var l={};l.SelphID=e;class n extends class{constructor(e){this.width=0,this.height=0,this.landscape=!1}cacheResources(){}setCanvasSize(e,t){this.width=e,this.height=t,this.landscape=this.width>=this.height}getCameraRect(e,t,i,s){this.setCanvasSize(e.canvas.clientWidth,e.canvas.clientHeight);var a=this.scaleRect({width:t,height:i},{x:0,y:0,width:this.width,height:this.height});return a.visible=!0,a}getResourceIdForState(e){throw new Error("FPhi.Widget.drawer.abstract.js: Can't instantiate abstract class")}onMouseMove(e,t,i,s,a){e.style.cursor="button"==a||"buttonImage"==a?"pointer":"default"}draw(e,t,i,s,a,l,n,c,h){throw new Error("Can't instantiate abstract class")}getLayout(e,t,i,s,a,l,n){throw new Error("Can't instantiate abstract class")}cacheAnimation(e,t){if(this.rm.isAttributeAvailable(e,t,this.landscape,"id"))for(var i=this.rm.getSetupResourceId(e,t,this.landscape,"name"),s=this.rm.getSetupResourceId(e,t,this.landscape,"ext"),a=parseInt(this.rm.getSetupResourceId(e,t,this.landscape,"start")),l=parseInt(this.rm.getSetupResourceId(e,t,this.landscape,"end")),n=a;n<=l;n++){var c=i+("0"+n).slice(-2)+"."+s;this.rm.getImage(c)}}scaleRect(e,t,i){var s=t.x+t.width/2,a=t.y+t.height/2,l=t.width/e.width,n=t.height/e.height,c=e.width*l,h=e.height*l;return null==i?h<t.height&&(c=e.width*n,h=e.height*n):h>=t.height&&(c=e.width*n,h=e.height*n),{x:s-c/2,y:a-h/2,width:c,height:h}}drawButtonImage(e,t,i,s,a,l,n,c){var h=this.rm.getSetupResourceId(i,s,this.landscape,"value"),o=this.rm.getImage(h),d=this.canvasSizeFactor*this.rm.getImageScale(),r=o.width*d,m=o.height*d;e.drawImage(o,t.x+t.width/2-r/2,t.y+t.height/2-m/2,r,m)}fillRoundRect(e,t,i,s,a,l){s<2*l&&(l=s/2),a<2*l&&(l=a/2),e.beginPath(),e.moveTo(t+l,i),e.arcTo(t+s,i,t+s,i+a,l),e.arcTo(t+s,i+a,t,i+a,l),e.arcTo(t,i+a,t,i,l),e.arcTo(t,i,t+s,i,l),e.closePath(),e.fill()}drawButton(e,t,i,s){if(this.rm.isAttributeAvailable(i,s,this.landscape,"radius")){let a=this.rm.getSetupFloat(i,s,this.landscape,"radius");e.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"decorator"),this.fillRoundRect(e,t.x,t.y+4,t.width,t.height-4,a),e.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"background"),this.fillRoundRect(e,t.x,t.y,t.width,t.height-4,a)}else e.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"decorator"),e.fillRect(t.x,t.y+4,t.width,t.height-4),e.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"background"),e.fillRect(t.x,t.y,t.width,t.height-4);var a=this.rm.getSetupAlign(i,s,this.landscape,"align"),l=this.rm.getSetupNodeType(i,s),n=10*this.canvasSizeFactor;if("TEXT_ID"==l){var c=this.rm.getSetupTextId(i,s,this.landscape,"content"),h=this.rm.translate(c),o=this.rm.getSetupFloat(i,s,this.landscape,"font_size");o=Math.round(o*this.fontSizeFactor);var d=this.rm.getSetupResourceId(i,s,this.landscape,"font");e.font=o+"px '"+d+"'",e.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"foreground");var r=e.measureText(h);"LEFT"==a?e.fillText(h,t.x+n,t.y+t.height/2):"RIGHT"==a?e.fillText(h,t.x+t.width-r.width-n,t.y+t.height/2):e.fillText(h,t.x+t.width/2-r.width/2,t.y+t.height/2)}else{c=this.rm.getSetupResourceId(i,s,this.landscape,"content");var m=this.rm.getImage(c),u=this.canvasSizeFactor*this.rm.getImageScale();"LEFT"==a?e.drawImage(m,t.x+n,t.y+t.height/2-m.height*u/2,m.width*u,m.height*u):"RIGHT"==a?e.drawImage(m,t.x+t.width-m.width*u-n,t.y+t.height/2-m.height*u/2,m.width*u,m.height*u):e.drawImage(m,t.x+t.width/2-m.width*u/2,t.y+t.height/2-m.height*u/2,m.width*u,m.height*u)}}drawImage(e,t,i,s,a,l,n,c){var h=this.rm.getSetupResourceId(i,s,this.landscape,"value"),o=this.rm.getImage(h),d=!1;if(this.rm.isAttributeAvailable(i,s,this.landscape,"scale")&&"CONTAINER"==this.rm.getSetupResourceId(i,s,this.landscape,"scale")&&(d=!0),d)e.drawImage(o,t.x,t.y,t.width,t.height);else{var r=this.canvasSizeFactor*this.rm.getImageScale(),m=o.width*r,u=o.height*r;e.drawImage(o,t.x+t.width/2-m/2,t.y+t.height/2-u/2,m,u)}}drawImageWithClippingCircle(e,t,i,s,a,l){e.save(),e.beginPath(),e.arc(s,a,l,0,2*Math.PI,!1),e.clip(),e.drawImage(i,t.x,t.y,t.width,t.height),e.restore()}drawStringMultiline(e,t,i,s,a,l,n,c,h){var o=t.split("\n");e.imageSmoothingEnabled=!1,l=Math.round(l*this.fontSizeFactor),e.font=l+"px '"+a+"'",e.fillStyle=s,e.textBaseline="middle";var d=i.y;if("CENTER"==h){var r=o.length*n;d=i.y+i.height/2-r/2+l/2}else"BOTTOM"==h&&(r=o.length*n,d=i.y+i.height-r);for(var m=0;m<o.length;m++){var u=e.measureText(o[m]),b=i.width/2-u.width/2;"LEFT"==c?b=0:"RIGHT"==c&&(b=i.width-u.width),e.fillText(o[m],i.x+b,d+m*n)}}}{constructor(e){super(e),this.livenessMode=e.livenessMode,this.stabilizationStage=e.stabilizationStage,this.canvasSizeFactor=e.canvasSizeFactor,this.fontSizeFactor=e.fontSizeFactor,this.buttonHeight=60*this.canvasSizeFactor,this.faceCenterOffset={x:0,y:0},this.faceCenterOffsetTarget={x:0,y:0}}setCanvasSize(e,t){this.width=e,this.height=t,this.landscape=this.width>=this.height,this.circleX=this.width/2,this.circleY=.38*this.height,this.circleRadius=.31*this.height,this.circleRadius>this.width/2-15&&(this.circleRadius=this.width/2-15)}getCameraRect(e,t,i,s){this.setCanvasSize(e.canvas.clientWidth,e.canvas.clientHeight);var a=this.scaleRect({width:t,height:i},{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius});return a.visible=!0,a}faceInsideCircle(e){var t=this.circleRadius,i=this.circleX,s=this.circleY,a=i-t,l=i+t,n=s-t,c=s+t,h={x:e.x,y:e.y,width:e.width,height:e.height};return Math.max(0,Math.min(h.x+h.width,l)-Math.max(h.x,a))*Math.max(0,Math.min(h.y+h.height,c)-Math.max(h.y,n))/(h.width*h.height)>.75}getResourceIdForState(e){return"UCWaitingFaceStart"==e?"StartExtractor":"UCExtracting"==e||"UCLivenessDetectionStep1"==e||"UCLivenessDetectionStep2"==e||"UCLivenessDetectionStep3"==e||"UCWaitingEyeDetection"==e?"Extractor":"UCLivenessMoveStabilizing"==e||"UCLivenessMoveStabilized"==e||"UCLivenessMoveDetecting"==e||"UCLivenessMoveProcessing"==e?"LivenessMove":"UCLivenessMoveInfo"==e?"LivenessInfo":"UCTutorialRegister1"==e?"RegistrationTips":"UCTutorialRegister2"==e?"FaceMovementTips":"UCShowResults"==e?"Results":"UCWizardCompleted"==e?"Success":"UCTutorialBlink1"==e?"Tutorial1":"UCTutorialBlink2"==e?"Tutorial2":"UCTutorialBlink3"==e?"Tutorial3":"UCTutorialMove1"==e?"TutorialMove1":"UCTutorialMove2"==e?"TutorialMove2":"UCTutorialMove3"==e?"TutorialMove3":"UCWaitRecording"==e?"WaitRecording":"UCErrors"==e||"UCErrorFinish"==e?"Error":"UCFinish"==e?"Finish":null}onMouseMove(e,t,i,s,a){e.style.cursor="button"==a||"buttonImage"==a?"pointer":"default"}draw(e,t,i,s,a,l,n,c,h){if(e.imageSmoothingEnabled=!0,"background"==a)this.drawBackground(e,t,i,s,l,n,c,h);else if("backgroundFull"==a)this.drawBackgroundFull(e,t,i,s,l,n,c,h);else if("button"==a)this.drawButton(e,t,i,s);else if("buttonImage"==a)this.drawButtonImage(e,t,i,s,l,n,c,h);else if("image"==a)this.drawImage(e,t,i,s,l,n,c,h);else if("imageError"==a)this.drawImageError(e,t,i,s,l,n,c,h);else if("text"==a)this.drawText(e,t,i,s,l,n,c,h);else if("faceSearcher"==a)this.drawFaceSearcher(e,t,i,s,l,n,c,h);else if("video"==a)"Extractor"==i||this.drawImageWithClippingCircle(e,t,h.player,t.x+t.width/2,t.y+t.height/2,t.width/2);else if("camera"==a){var o=h.progress,d=this.rm.getSetupFloat("facephi-widget-conf","",this.landscape,"width_progress_bar"),r=this.rm.getSetupColor("facephi-widget-conf","",this.landscape,"color_progress_bar"),m=this.rm.getSetupColor("facephi-widget-conf","",this.landscape,"color_warning_message"),u=this.rm.getSetupColor("facephi-widget-conf","",this.landscape,"color_quality_excellent"),b=this.rm.getSetupColor("facephi-widget-conf","",this.landscape,"color_quality_low");let a="solid";this.rm.isAttributeAvailable(i,s,this.landscape,"type")&&(a=this.rm.getSetupResourceId(i,s,this.landscape,"type")),e.save(),e.beginPath(),e.arc(this.circleX,this.circleY,this.circleRadius,0,2*Math.PI,!1),e.clip(),"UCLivenessMoveStabilizing"!=h.state&&"UCLivenessMoveStabilized"!=h.state&&"UCLivenessMoveDetecting"!=h.state&&"UCLivenessMoveProcessing"!=h.state||(e.fillStyle="#00000033",e.fillRect(t.x,t.y,t.width,t.height)),e.restore();var p=r;if("Warning"==c&&(p=m),"UCLivenessMoveStabilized"==h.state||"UCLivenessMoveDetecting"==h.state||"UCLivenessMoveProcessing"==h.state)o=1,p=h.liveness_move_last_result?u:b,"UCLivenessMoveDetecting"!=h.state&&"UCLivenessMoveProcessing"!=h.state||(e.beginPath(),e.strokeStyle=r,e.lineWidth=d,e.lineCap="round",e.arc(this.circleX,this.circleY,this.circleRadius-e.lineWidth/2+.5,-Math.PI/2,2*Math.PI-Math.PI/2),e.stroke());else if(o>1&&(o=1),o=o*o*(3-2*o),"solid"==a)"UCLivenessMoveStabilizing"==h.state&&(o=1),0==o&&"Warning"==c&&(e.beginPath(),e.strokeStyle=b,e.lineWidth=d,e.lineCap="round",e.arc(this.circleX,this.circleY,this.circleRadius-e.lineWidth/2+.5,-Math.PI/2,2*Math.PI-Math.PI/2),e.stroke()),e.beginPath(),e.strokeStyle=p,e.lineWidth=d,e.lineCap="round",e.arc(this.circleX,this.circleY,this.circleRadius-e.lineWidth/2+.5,-Math.PI/2,2*Math.PI*o-Math.PI/2),e.stroke();else if("bars"==a){let t=this.rm.getSetupFloat(i,s,this.landscape,"elements"),a=this.rm.getSetupFloat(i,s,this.landscape,"area");a=2*Math.PI*this.circleRadius/t*a;let l=2;this.rm.isAttributeAvailable(i,s,this.landscape,"offset")&&(l=this.rm.getSetupFloat(i,s,this.landscape,"offset"));let n="#939298";this.rm.isAttributeAvailable(i,s,this.landscape,"background_color")&&(n=this.rm.getSetupColor(i,s,this.landscape,"background_color")),"Warning"!=c&&0==o&&(p=n);let r=2*Math.PI*o;e.save(),e.translate(this.circleX,this.circleY);let m=2*Math.PI/t;for(let i=0;i<t;i++)(m*i<r||0==r)&&"UCExtracting"==h.state?e.fillStyle=p:e.fillStyle=n,e.fillRect(-a/2,-this.circleRadius-l-d,a,d),e.rotate(m);e.restore()}}else if("results"==a){var y=n/(1+1.5*h.progress);y>1&&(y=1),y=(y*=2-y)<.5?2*y*y:(4-2*y)*y-1,e.beginPath(),e.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"background_color"),e.arc(this.circleX,this.circleY,this.circleRadius,-Math.PI/2,2*Math.PI-Math.PI/2),e.fill();var Z=this.rm.getSetupColor("facephi-widget-conf","",this.landscape,"color_quality_excellent");h.progress<=.33?Z=this.rm.getSetupColor("facephi-widget-conf","",this.landscape,"color_quality_low"):h.progress<=.66&&(Z=this.rm.getSetupColor("facephi-widget-conf","",this.landscape,"color_quality_good")),e.beginPath(),e.strokeStyle=Z,e.lineWidth=this.rm.getSetupFloat("facephi-widget-conf","",this.landscape,"width_progress_bar"),e.lineCap="round",e.arc(this.circleX,this.circleY,this.circleRadius-e.lineWidth/2*.5,-Math.PI/2,2*Math.PI*h.progress*y-Math.PI/2),e.stroke();var g="",v="";h.progress>=1?(g=this.rm.translate("results_quality_excellent"),v=this.rm.translate("results_quality_message")):h.progress>=.333?(g=this.rm.translate("results_quality_good"),v=this.rm.translate("results_quality_message")):(g=this.rm.translate("results_quality_low"),v=this.rm.translate("results_quality_message"));var G=this.rm.getSetupFloat(i,s,this.landscape,"fontResult_size"),I=G+1,X=this.rm.getSetupResourceId(i,s,this.landscape,"fontResult"),S="CENTER",W="TOP";this.drawStringMultiline(e,g,{x:0,y:this.circleY-5,width:this.width,height:this.height},Z,X,G,I,S,W),I=(G=this.rm.getSetupFloat(i,s,this.landscape,"fontQuality_size"))+1,X=this.rm.getSetupResourceId(i,s,this.landscape,"fontQuality"),S="CENTER",W="TOP",this.drawStringMultiline(e,v,{x:0,y:this.circleY+5+G,width:this.width,height:this.height},Z,X,G,I,S,W)}else if("animation"==a){var R=0;"livenessMoveDirection"in h&&(R=h.livenessMoveDirection),"liveness_move"!=s&&(R=0),this.drawAnimation(e,t,i,s,l,n,c,h,R)}else if("progress"==s)e.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"background_color"),e.fillRect(t.x,t.y,t.width,t.height),e.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"progress_color"),e.fillRect(t.x,t.y,t.width*h.progress,t.height);else if("progressRecord"==s){e.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"background_color"),e.fillRect(t.x,t.y,t.width,t.height),e.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"progress_color");let a=.2*t.width,l=n%2/1.6,c=t.width*l-a,h=c+a;c<0&&(c=0),c>t.width&&(c=t.width),h>t.width&&(h=t.width),e.fillRect(t.x+c,t.y,h-c,t.height)}}getLayout(e,t,i,s,a,l,n){if("Tutorial1"==e||"Tutorial2"==e||"Tutorial3"==e||"TutorialMove1"==e||"TutorialMove2"==e||"TutorialMove3"==e){if("background"==t)return{x:0,y:0,width:this.width,height:this.height};if("backgroundFull"==i)return{x:0,y:0,width:this.width,height:this.height};if("video"==i)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("tip"==t)return{x:0,y:.75*this.height,width:this.width,height:.1*this.height};if("tip_detail"==t)return{x:0,y:.82*this.height,width:this.width,height:.1*this.height};if("button_skip"==t)return{x:0,y:this.height-this.buttonHeight,width:this.width/2,height:this.buttonHeight};if("button_back"==t)return{x:0,y:this.height-this.buttonHeight,width:this.width/2,height:this.buttonHeight};if("button_next"==t)return{x:this.width/2,y:this.height-this.buttonHeight,width:this.width/2,height:this.buttonHeight};if("button_done"==t)return{x:this.width/2,y:this.height-this.buttonHeight,width:this.width/2,height:this.buttonHeight};if("button_exit"==t){var c=this.rm.getSetupResourceId(e,t,this.landscape,"value"),h=this.rm.getImage(c),o=this.canvasSizeFactor*this.rm.getImageScale(),d=h.width*o,r=h.height*o;return{x:this.width-d-30,y:0,width:d+30,height:r+30}}if("liveness_move"==t)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}else{if("background"==t)return{x:0,y:0,width:this.width,height:this.height};if("backgroundFull"==i)return{x:0,y:0,width:this.width,height:this.height};if("tip_video"==t)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("imageError"==t)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("video_success"==t)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("extraction_video"==t)return{x:this.width/2-.1*this.width,y:.73*this.height,width:.2*this.width,height:.2*this.width};if("tip"==t)return{x:0,y:.75*this.height,width:this.width,height:.1*this.height};if("text_error"==t)return{x:0,y:.75*this.height,width:this.width,height:.1*this.height};if("text"==t)return{x:0,y:this.circleY+this.circleRadius+10,width:this.width,height:this.height-this.buttonHeight+10-(this.circleY+this.circleRadius)};if("tip_detail"==t)return{x:0,y:.82*this.height,width:this.width,height:.1*this.height};if("button_skip"==t)return{x:0,y:this.height-this.buttonHeight,width:this.width/2,height:this.buttonHeight};if("button_next"==t)return{x:this.width/2,y:this.height-this.buttonHeight,width:this.width/2,height:this.buttonHeight};if("button_done"==t)return{x:this.width/2,y:this.height-this.buttonHeight,width:this.width/2,height:this.buttonHeight};if("button_start"==t){let e=209*this.canvasSizeFactor;return{x:this.width/2-e/2,y:this.height-this.buttonHeight+10,width:e,height:this.buttonHeight-10}}if("button_error"==t)return{x:this.width/4,y:this.height-this.buttonHeight+10,width:this.width/2,height:this.buttonHeight-10};if("button_back"==t)return{x:0,y:this.height-this.buttonHeight,width:this.width/2,height:this.buttonHeight};if("button_repeat"==t)return{x:.05*this.width,y:this.height-this.buttonHeight,width:.4*this.width,height:this.buttonHeight};if("button_finish"==t)return{x:.55*this.width,y:this.height-this.buttonHeight,width:.4*this.width,height:this.buttonHeight};if("button_exit"==t)return c=this.rm.getSetupResourceId(e,t,this.landscape,"value"),h=this.rm.getImage(c),o=this.canvasSizeFactor*this.rm.getImageScale(),d=h.width*o,r=h.height*o,{x:this.width-d-30,y:0,width:d+30,height:r+30};if("button_info"==t);else{if("warning"==t)return{x:0,y:this.circleY+this.circleRadius+10,width:this.width,height:this.height-this.buttonHeight+10-(this.circleY+this.circleRadius)};if("warningTooFar"==t)return{x:0,y:.89*this.height,width:this.width,height:.1*this.height};if("camera"==i)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("results"==i)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("liveness_move_text"==t)return"UCLivenessMoveProcessing"==n.state&&a<.5?null:{x:0,y:this.circleY+this.circleRadius+10,width:this.width,height:this.height-this.buttonHeight+10-(this.circleY+this.circleRadius)};if("liveness_move_tip_text"==t)return{x:this.circleX-this.circleRadius,y:this.circleY-.39*this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("livenessInfo_text"==t)return{x:0,y:.89*this.height,width:this.width,height:.1*this.height};if("liveness_move"==t){if("UCLivenessMoveDetecting"==n.state&&a>=.25&&a<1.75){var m=!1;return this.rm.isAttributeAvailable(e,t,this.landscape,"fullscreen")&&"true"==this.rm.getSetupResourceId(e,t,this.landscape,"fullscreen")&&(m=!0),m?{x:0,y:0,width:this.width,height:this.height}:{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}return null}if("liveness_move_left"==t||"liveness_move_right"==t||"liveness_move_top"==t||"liveness_move_bottom"==t)return"UCLivenessMoveDetecting"==n.state&&a>=.25&&a<1.75?0==n.livenessMoveDirection&&"liveness_move_top"!=t||2==n.livenessMoveDirection&&"liveness_move_bottom"!=t||1==n.livenessMoveDirection&&"liveness_move_right"!=t||3==n.livenessMoveDirection&&"liveness_move_left"!=t?null:(m=!1,this.rm.isAttributeAvailable(e,t,this.landscape,"fullscreen")&&"true"==this.rm.getSetupResourceId(e,t,this.landscape,"fullscreen")&&(m=!0),m?{x:0,y:0,width:this.width,height:this.height}:{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}):null;if("face_searcher"==t)return{x:0,y:0,width:this.width,height:this.height};if("livenessMoveGlasses"==t){if(0==n.livenessMoveFailReason)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}else if("livenessMoveInfo"==t){if(1==n.livenessMoveFailReason)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}else if("progress"==t){if("UCLivenessMoveProcessing"==n.state&&a>this.processingMoveProgressStartTime)return{x:this.circleX-this.circleRadius,y:.8*this.height,width:2*this.circleRadius,height:19}}else if("progressRecord"==t)return{x:.146*this.width,y:.52*this.height,width:.7*this.width,height:18}}}return null}drawBackground(e,t,i,s,a,l,n,c){e.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"top"),e.fillRect(t.x,t.y,t.width,this.circleY-this.circleRadius+1),"true"==this.rm.getSetupResourceId(i,s,this.landscape,"clipped").toLowerCase()&&(e.save(),e.beginPath(),e.arc(this.circleX,this.circleY,this.circleRadius,0,2*Math.PI,!1),e.rect(0,0,this.width,this.height),e.clip("evenodd")),e.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"middle_top"),e.fillRect(t.x,this.circleY-this.circleRadius,t.width,2*this.circleRadius+1),"true"==this.rm.getSetupResourceId(i,s,this.landscape,"clipped").toLowerCase()&&e.restore(),e.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"middle_bottom"),e.fillRect(t.x,this.circleY+this.circleRadius,t.width,this.height-this.buttonHeight-(this.circleY+this.circleRadius)+1),e.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"bottom"),e.fillRect(t.x,this.height-this.buttonHeight,t.width,this.buttonHeight);var h=this.rm.getSetupColor(i,s,this.landscape,"pagination_separator");null!=h&&(e.fillStyle=h,e.fillRect(0,this.height-this.buttonHeight-1,t.width,1))}drawBackgroundFull(e,t,i,s,a,l,n,c){"true"==this.rm.getSetupResourceId(i,s,this.landscape,"clipped").toLowerCase()&&(e.save(),e.beginPath(),e.arc(this.circleX,this.circleY,this.circleRadius,0,2*Math.PI,!1),e.rect(0,0,this.width,this.height),e.clip("evenodd")),e.fillStyle=this.rm.getSetupColor(i,s,this.landscape,"color"),e.fillRect(t.x,t.y,t.width,t.height),"true"==this.rm.getSetupResourceId(i,s,this.landscape,"clipped").toLowerCase()&&e.restore()}drawPoint(e,t,i,s,a){e.fillStyle=a,e.beginPath(),e.arc(t,i,s,0,2*Math.PI),e.fill()}drawLine(e,t,i,s,a,l){e.lineWidth=1,e.strokeStyle=l,e.beginPath(),e.moveTo(t,i),e.lineTo(s,a),e.stroke()}drawFaceSearcher(e,t,i,s,a,l,n,c){c.progress;var h=c.leftEyeData,o=c.rightEyeData,d=c.faceDataRect;d&&(this.lastMoveFace=d,null==this.moveFace&&(this.moveFace=this.lastMoveFace)),h&&(this.lastMoveLeftEye=h,null==this.moveLeftEye&&(this.moveLeftEye=this.lastMoveLeftEye)),o&&(this.lastMoveRightEye=o,null==this.moveRightEye&&(this.moveRightEye=this.lastMoveRightEye)),this.moveFace&&(this.moveFace.x+=.1*(this.lastMoveFace.x-this.moveFace.x),this.moveFace.y+=.1*(this.lastMoveFace.y-this.moveFace.y),this.moveFace.width+=.1*(this.lastMoveFace.width-this.moveFace.width),this.moveFace.height+=.1*(this.lastMoveFace.height-this.moveFace.height)),this.moveLeftEye&&(this.moveLeftEye.x+=.15*(this.lastMoveLeftEye.x-this.moveLeftEye.x),this.moveLeftEye.y+=.15*(this.lastMoveLeftEye.y-this.moveLeftEye.y),this.drawPoint(e,this.moveLeftEye.x-.05*this.width,this.moveLeftEye.y,2,"#ffffff"),this.drawPoint(e,this.moveLeftEye.x+.04*this.width,this.moveLeftEye.y,2,"#ffffff"),this.drawPoint(e,this.moveLeftEye.x-.02*this.width,this.moveLeftEye.y-.05*this.height,2,"#ffffff"),this.drawLine(e,this.moveLeftEye.x-.05*this.width,this.moveLeftEye.y,this.moveLeftEye.x+.04*this.width,this.moveLeftEye.y,"#ffffff"),this.drawLine(e,this.moveLeftEye.x-.05*this.width,this.moveLeftEye.y,this.moveLeftEye.x-.02*this.width,this.moveLeftEye.y-.05*this.height,"#ffffff"),this.drawLine(e,this.moveLeftEye.x+.04*this.width,this.moveLeftEye.y,this.moveLeftEye.x-.02*this.width,this.moveLeftEye.y-.05*this.height,"#ffffff"),this.moveFace&&(this.drawLine(e,this.moveLeftEye.x+.04*this.width,this.moveLeftEye.y,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.05*this.moveFace.height,"#ffffff"),this.drawLine(e,this.moveLeftEye.x-.05*this.width,this.moveLeftEye.y,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.05*this.moveFace.height,"#ffffff"),this.drawLine(e,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.05*this.moveFace.height,this.moveFace.x+this.moveFace.width/2-.15*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.02*this.moveFace.height,"#ffffff"),this.drawLine(e,this.moveFace.x+this.moveFace.width/2-.15*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.02*this.moveFace.height,this.moveFace.x+this.moveFace.width/2-.35*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.3*this.moveFace.height,"#ffffff"),this.drawLine(e,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.05*this.moveFace.height,this.moveFace.x+this.moveFace.width/2-.2*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.25*this.moveFace.height,"#ffffff"),this.drawLine(e,this.moveFace.x+this.moveFace.width/2-.2*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.25*this.moveFace.height,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.5*this.moveFace.height,"#ffffff"),this.drawLine(e,this.moveFace.x+this.moveFace.width/2-.2*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.25*this.moveFace.height,this.moveFace.x+this.moveFace.width/2-.35*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.3*this.moveFace.height,"#ffffff"),this.drawLine(e,this.moveFace.x+this.moveFace.width/2-.35*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.3*this.moveFace.height,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.5*this.moveFace.height,"#ffffff"))),this.moveRightEye&&(this.moveRightEye.x+=.15*(this.lastMoveRightEye.x-this.moveRightEye.x),this.moveRightEye.y+=.15*(this.lastMoveRightEye.y-this.moveRightEye.y),this.drawPoint(e,this.moveRightEye.x+.05*this.width,this.moveRightEye.y,2,"#ffffff"),this.drawPoint(e,this.moveRightEye.x-.04*this.width,this.moveRightEye.y,2,"#ffffff"),this.drawPoint(e,this.moveRightEye.x+.02*this.width,this.moveRightEye.y-.05*this.height,2,"#ffffff"),this.drawLine(e,this.moveRightEye.x+.05*this.width,this.moveRightEye.y,this.moveRightEye.x-.04*this.width,this.moveRightEye.y,"#ffffff"),this.drawLine(e,this.moveRightEye.x+.05*this.width,this.moveRightEye.y,this.moveRightEye.x+.02*this.width,this.moveRightEye.y-.05*this.height,"#ffffff"),this.drawLine(e,this.moveRightEye.x-.04*this.width,this.moveRightEye.y,this.moveRightEye.x+.02*this.width,this.moveRightEye.y-.05*this.height,"#ffffff"),this.moveFace&&(this.drawLine(e,this.moveRightEye.x-.04*this.width,this.moveRightEye.y,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.05*this.moveFace.height,"#ffffff"),this.drawLine(e,this.moveRightEye.x+.05*this.width,this.moveRightEye.y,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.05*this.moveFace.height,"#ffffff"),this.drawLine(e,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.05*this.moveFace.height,this.moveFace.x+this.moveFace.width/2+.15*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.02*this.moveFace.height,"#ffffff"),this.drawLine(e,this.moveFace.x+this.moveFace.width/2+.15*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.02*this.moveFace.height,this.moveFace.x+this.moveFace.width/2+.35*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.3*this.moveFace.height,"#ffffff"),this.drawLine(e,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.05*this.moveFace.height,this.moveFace.x+this.moveFace.width/2+.2*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.25*this.moveFace.height,"#ffffff"),this.drawLine(e,this.moveFace.x+this.moveFace.width/2+.2*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.25*this.moveFace.height,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.5*this.moveFace.height,"#ffffff"),this.drawLine(e,this.moveFace.x+this.moveFace.width/2+.2*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.25*this.moveFace.height,this.moveFace.x+this.moveFace.width/2+.35*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.3*this.moveFace.height,"#ffffff"),this.drawLine(e,this.moveFace.x+this.moveFace.width/2+.35*this.moveFace.width,this.moveFace.y+this.moveFace.height/2+.3*this.moveFace.height,this.moveFace.x+this.moveFace.width/2,this.moveFace.y+this.moveFace.height/2+.5*this.moveFace.height,"#ffffff")))}drawImageError(e,t,i,s,a,n,c,h){var o=this.rm.getImage("livenessError.png");switch(h.livenessDiagnostic){case-1:o=this.rm.getImage("timeout.png");break;case l.Selphi.LivenessDiagnostic.UnsuccessLowPerformance:o=this.rm.getImage("livenessPerformance.png");break;case l.Selphi.LivenessDiagnostic.UnsuccessGlasses:o=this.rm.getImage("livenessGlasses.png");break;case l.Selphi.LivenessDiagnostic.UnsuccessLight:o=this.rm.getImage("livenessLights.png")}this.canvasSizeFactor,this.rm.getImageScale(),o.width,o.height;var d=this.scaleRect({width:o.width,height:o.height},t);e.drawImage(o,d.x,d.y,d.width,d.height)}drawAnimation(e,t,i,s,a,l,n,c,h){var o=l;switch((o/=2)>1&&(o=1),"videoProgress"in c&&(o=c.videoProgress),e.save(),e.translate(t.x+t.width/2,t.y+t.height/2),h){case 1:e.rotate(3*-Math.PI/2);break;case 2:e.rotate(Math.PI);break;case 3:e.rotate(1*-Math.PI/2)}e.translate(-(t.x+t.width/2),-(t.y+t.height/2));var d=this.rm.getSetupResourceId(i,s,this.landscape,"name"),r=this.rm.getSetupResourceId(i,s,this.landscape,"ext"),m=parseInt(this.rm.getSetupResourceId(i,s,this.landscape,"start")),u=parseInt(this.rm.getSetupResourceId(i,s,this.landscape,"end")),b=d+("0"+Math.floor((u-m)*o+m)).slice(-2)+"."+r,p=this.rm.getImage(b);e.drawImage(p,t.x,t.y,t.width,t.height),e.restore()}drawText(e,t,i,s,a,n,c,h){var o=this.rm.getSetupFloat(i,s,this.landscape,"font_size"),d=o+1;this.rm.isAttributeAvailable(i,s,this.landscape,"line_height")&&(d=this.rm.getSetupFloat(i,s,this.landscape,"line_height"));var r=this.rm.getSetupColor(i,s,this.landscape,"color"),m=this.rm.getSetupResourceId(i,s,this.landscape,"font"),u="CENTER";this.rm.isAttributeAvailable(i,s,this.landscape,"align")&&(u=this.rm.getSetupAlign(i,s,this.landscape,"align"));var b="TOP";this.rm.isAttributeAvailable(i,s,this.landscape,"valign")&&(b=this.rm.getSetupAlign(i,s,this.landscape,"valign"));var p="";if("Tutorial1"==i)p="tip"==s?this.rm.translate("tutorial1_tip"):this.rm.translate("tutorial1_tip_detail");else if("Tutorial2"==i)p="tip"==s?this.rm.translate("tutorial2_tip"):this.rm.translate("tutorial2_tip_detail");else if("Tutorial3"==i)p="tip"==s?this.rm.translate("tutorial3_tip"):this.rm.translate("tutorial3_tip_detail");else if("TutorialMove1"==i)p="tip"==s?this.rm.translate("tutorialMove1_tip"):this.rm.translate("tutorialMove1_tip_detail");else if("TutorialMove2"==i)p="tip"==s?this.rm.translate("tutorialMove2_tip"):this.rm.translate("tutorialMove2_tip_detail");else if("TutorialMove3"==i)p="tip"==s?this.rm.translate("tutorialMove3_tip"):this.rm.translate("tutorialMove3_tip_detail");else if("RegistrationTips"==i)p="tip"==s?this.rm.translate("registration_tips_title"):this.rm.translate("registration_tips_detail");else if("FaceMovementTips"==i)p="tip"==s?this.rm.translate("face_movement_tips_title"):this.rm.translate("face_movement_tips_detail");else if("WaitRecording"==i)p=this.rm.translate("waitRecording");else if("StartExtractor"==i)"text"==s&&(p=this.rm.translate("start_extractor_title"));else if("Extractor"==i)"warning"==s&&(p=this.rm.translate("error_message_face"));else if("LivenessMove"==i){if("liveness_move_text"==s)if("UCLivenessMoveStabilizing"==h.state||"UCLivenessMoveStabilized"==h.state)p=this.rm.translate("extracting_title");else if("UCLivenessMoveDetecting"==h.state)switch(h.livenessMoveDirection){case 0:p=this.rm.translate("liveness_move_tip_up");break;case 1:p=this.rm.translate("liveness_move_tip_right");break;case 2:p=this.rm.translate("liveness_move_tip_down");break;case 3:p=this.rm.translate("liveness_move_tip_left")}else"UCLivenessMoveProcessing"==h.state&&(p=this.rm.translate("liveness_move_processing"));else if("warning"==s&&("UCLivenessMoveStabilizing"==h.state||"UCLivenessMoveStabilized"==h.state))switch(h.livenessMoveLastStabilizedStatus){case 1:p=this.rm.translate("liveness_move_stabilizing_ok");break;case 2:p=this.rm.translate("liveness_move_stabilizing_not_stabilized");break;case 3:p=this.rm.translate("liveness_move_stabilizing_not_stabilized_too_far");break;case 4:p=this.rm.translate("liveness_move_stabilizing_not_stabilized_sun_glasses");break;case 5:p=this.rm.translate("liveness_move_stabilizing_not_stabilized_too_close");break;case 6:p=this.rm.translate("liveness_move_stabilizing_not_stabilized_too_movement");break;case 7:p=this.rm.translate("liveness_move_stabilizing_not_stabilized_low_performance");break;case 8:p=this.rm.translate("liveness_move_stabilizing_not_stabilized_no_frontal");break;case 9:p=this.rm.translate("liveness_move_stabilizing_not_stabilized_no_frontal_too_left");break;case 10:p=this.rm.translate("liveness_move_stabilizing_not_stabilized_no_frontal_too_right");break;case 11:p=this.rm.translate("liveness_move_stabilizing_not_stabilized_no_frontal_too_down");break;case 12:p=this.rm.translate("liveness_move_stabilizing_not_stabilized_no_frontal_too_up");break;case 13:p=this.rm.translate("liveness_move_stabilizing_not_stabilized_no_color");break;case 14:p=this.rm.translate("liveness_move_stabilizing_not_stabilized_low_quality");break;case 15:p=this.rm.translate("liveness_move_stabilizing_not_stabilized_low_face_quality");break;case 16:p=this.rm.translate("liveness_move_stabilizing_not_stabilized_low_pattern_quality");break;case 17:p=this.rm.translate("liveness_move_stabilizing_ok_glasses");break;default:p=this.rm.translate("extracting_title")}}else if("LivenessInfo"==i)"livenessInfo_text"==s&&(p=0==h.livenessMoveFailReason?this.rm.translate("liveness_move_info_sunglasses"):this.rm.translate("liveness_move_info_unsuccess"));else if("Results"==i){if("tip"==s){if(n<1)r="#00000000";else if(n>=1){var y=2*(n-1);y>1&&(y=1),r=this.rm.getSetupColorWithAlpha(i,s,this.landscape,"color",y)}p=h.progress>=1?this.rm.translate("results_message_excellent"):h.progress>=.333?this.rm.translate("results_message_good"):this.rm.translate("results_message_low")}}else if("Error"==i&&"text_error"==s)switch(h.livenessDiagnostic){case-1:p=this.rm.translate("timeout");break;case l.Selphi.LivenessDiagnostic.UnsuccessLowPerformance:p=this.rm.translate("livenessErrorPerformance");break;case l.Selphi.LivenessDiagnostic.UnsuccessGlasses:p=this.rm.translate("livenessErrorGlasses");break;case l.Selphi.LivenessDiagnostic.UnsuccessLight:p=this.rm.translate("livenessErrorDark");break;case l.Selphi.LivenessDiagnostic.UnsuccessNoMovement:p=this.rm.translate("livenessErrorNoMovement");break;case l.Selphi.LivenessDiagnostic.UnsuccessWrongDirection:p=this.rm.translate("livenessErrorWrongDirection");break;case l.Selphi.LivenessDiagnostic.UnsuccessTooFar:p=this.rm.translate("livenessErrorTooFar");break;default:p=this.rm.translate("livenessMoveError")}this.drawStringMultiline(e,p,t,r,m,o,d,u,b)}drawBlind(e,t,i,s,a,l,n,c){var h=(a-i)/s*.5+.5,o=2*s*h,d=2*s*(1-h);e.save(),e.beginPath(),e.arc(t,i,s,0,2*Math.PI,!1),e.clip(),e.fillStyle=n,e.fillRect(t-s,i-s,2*s,o*l),e.fillRect(t-s,i+s-d+d*(1-l),2*s,d*l),e.restore();var r=this.rm.getSetupResourceId("facephi-widget-conf","",this.landscape,"font_shutter_text");e.fillStyle=this.rm.getSetupColor("facephi-widget-conf","",this.landscape,"color_shutter_text"),e.font=26*this.fontSizeFactor+"px '"+r+"'";var m=e.measureText(c);e.fillText(c,t-m.width/2,i+s-d+d*(1-l)+30)}}class c{constructor(e,t,i,s){this.width=e,this.height=t,this.rate=i,this.rateInv=1/this.rate,this.lastFrame=performance.now()}frameReady(){let e=performance.now();return(e-this.lastFrame)/1e3>this.rateInv&&(this.lastFrame=e,!0)}addFrame(e){throw new Error("Method addFrame must be implemented.")}generateVideo(){throw new Error("Method generateVideo must be implemented.")}isReady(){throw new Error("Method isReady must be implemented")}}class h extends c{constructor(e,t,i,s){super(e,t,i,s),this.ag=new Animated_GIF,this.ag.setSize(e,t),this.ag.setDelay(this.rateInv),this.processing=!1}addFrame(e){this.frameReady()&&this.ag.addFrameImageData(e)}generateVideo(){this.processing=!0;let e=this;return new Promise((function(t,i){e.ag.getBase64GIF((function(e){t(e)}))}))}isReady(){return!this.processing}}let o=null;class d extends c{constructor(e,t,i,s){super(e,t,i),this.processing=!1,this.ready=!1,this.socketError=!1,this.worker=new Worker((null===o&&(o=URL.createObjectURL(new Blob([atob("c2VsZi53c1JlYWR5PSExLHNlbGYud3M9bmV3IFdlYlNvY2tldCgid3NzOi8vd3MtZGV2LmlkY2FwdHVyZS5lcyIpLHNlbGYud3Mub25vcGVuPWZ1bmN0aW9uKCl7cG9zdE1lc3NhZ2Uoe2NtZDoicmVhZHkifSl9LHNlbGYud3Mub25tZXNzYWdlPWZ1bmN0aW9uKGUpe3Bvc3RNZXNzYWdlKHtjbWQ6Im1lc3NhZ2UiLGRhdGE6ZS5kYXRhfSl9LHNlbGYud3Mub25lcnJvcj1mdW5jdGlvbihlKXtjb25zb2xlLmxvZyhlKSxwb3N0TWVzc2FnZSh7Y21kOiJ3c19vbmVycm9yIn0pfSxzZWxmLm9ubWVzc2FnZT1mdW5jdGlvbihlKXtpZigiYWRkRnJhbWUiPT1lLmRhdGEuY21kKXNlbGYud3Muc2VuZCgneyJ0eXBlIjoiVklERU9fRlJBTUUiLCJkYXRhVVJMIjoiJytlLmRhdGEuZGF0YSsnIn0nKTtlbHNlIGlmKCJnZW5lcmF0ZVZpZGVvIj09ZS5kYXRhLmNtZCl7bGV0IHM9J3sidHlwZSI6Ik1BS0VfVklERU8iLCJGUiI6JytlLmRhdGEuZnIrIn0iO3NlbGYud3Muc2VuZChzKX1lbHNlIHBvc3RNZXNzYWdlKHtjbWQ6InVua25vd25NZXNzYWdlIn0pfTs=")],{type:"text/javascript"}))),o)),this.worker.onmessage=this.onMessage.bind(this),this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t,this.promise=null,this.resolve=null,this.reject=null}onMessage(e){if("ready"==e.data.cmd)this.ready=!0;else if("message"==e.data.cmd){let t=JSON.parse(e.data.data);"SAVED_FRAME"==t.type?this.ready=!0:this.resolve(t.video)}else"ws_onerror"==e.data.cmd&&(this.socketError=!0)}addFrame(e){if(!this.frameReady())return;this.canvas.getContext("2d").putImageData(e,0,0);let t=this.canvas.toDataURL("image/jpeg");this.worker.postMessage({cmd:"addFrame",data:t})}generateVideo(){console.log("generateVideo"),this.processing=!0;let e=this;return this.promise=new Promise((function(t,i){e.resolve=t,e.reject=i,e.socketError?e.reject():e.worker.postMessage({cmd:"generateVideo",fr:e.rate})})),this.promise}isReady(){return!this.processing&&!!this.ready}}if(!r)var r={};r.Selphi=e;class m extends HTMLElement{constructor(){super(),this.__widgetContainer=this.attachShadow({mode:"closed"}),this.__widgetStyles=document.createElement("style"),this.__widgetStyles.innerText="\n            :host { display: block; position: relative; margin: 0; padding: 0; width: 100%; height: 100%; min-height: 300px; min-width: 300px }\n            #accessibilityContainer { position: absolute; z-index: 999; width: 100%; height: 100% }\n            #cameraContainer { width: 100%; height: 100%; min-height: 300px; min-width: 300px }\n        ",this.__widgetContainer.append(this.__widgetStyles),this.__config=new r.Selphi.ConfigurationManager,this.__config.setContainer(this.__widgetContainer),this.__elementMounted=!1,this.__accessibilityHasEnabled=!1}static get attributes(){return{bundlepath:{type:"string",property:"bundlePath"},resourcespath:{type:"string",property:"resourcesPath"},graphpath:{type:"string",property:"graphPath"},timeout:{type:"number",property:"timeout"},language:{type:"string",property:"language"},dpilist:{type:"string",property:"dpiList"},tutorial:{type:"boolean",property:"tutorial"},interactible:{type:"boolean",property:"interactible"},logimages:{type:"boolean",property:"logImages"},stabilizationstage:{type:"boolean",property:"stabilizationStage"},camerawidth:{type:"number",property:"cameraWidth"},cameraheight:{type:"number",property:"cameraHeight"},camerarotation:{type:"number",property:"cameraRotation"},cameratype:{type:"number",property:"cameraType"},livenessmode:{type:"number",property:"livenessMode"},livenessprecision:{type:"number",property:"livenessPrecision"},livenessmodeinitialerror:{type:"number",property:"livenessMoveInitialError"},livenessmoveinfotime:{type:"number",property:"livenessMoveInfoTime"},cropfactor:{type:"number",property:"cropFactor"},cropimage:{type:"boolean",property:"cropImage"},registertime:{type:"number",property:"registerTime"},authenticatetime:{type:"number",property:"authenticateTime"},imageformat:{type:"string",property:"imageFormat"},imagequality:{type:"number",property:"imageQuality"},templateformat:{type:"number",property:"templateFormat"},videorecord:{type:"boolean",property:"videoRecord"},videorecordrate:{type:"number",property:"videoRecordRate"},videorecordscale:{type:"number",property:"videoRecordScale"},videorecordtype:{type:"number",property:"videoRecordType"},showlog:{type:"boolean",property:"showLog"},debugmode:{type:"boolean",property:"debugMode"},accessibility:{type:"boolean",property:"accessibility"},accessibleelements:{type:"array",property:"accessibleElements"},onmoduleloaded:{type:"event",property:"FPhi.UserControl.ModuleLoaded.event"},onstabilizing:{type:"event",property:"FPhi.UserControl.Stabilizing.event"},onextractionfinish:{type:"event",property:"FPhi.UserControl.Finish.event"},onusercancel:{type:"event",property:"FPhi.UserControl.UserCancel.event"},onexceptioncaptured:{type:"event",property:"FPhi.UserControl.ExceptionCaptured.event"},onlivenesserror:{type:"event",property:"FPhi.UserControl.LivenessError.event"},onlivenesserrorbuttonclick:{type:"event",property:"FPhi.UserControl.LivenessErrorButtonClick.event"},onextractiontimeout:{type:"event",property:"FPhi.UserControl.ExtractionTimeout.event"},ontimeouterrorbuttonclick:{type:"event",property:"FPhi.UserControl.TimeoutErrorButtonClick.event"},ontrackstatus:{type:"event",property:"FPhi.UserControl.TrackStatus.event"}}}connectedCallback(){queueMicrotask((()=>{this.__createUserControl(this.__config).__startUserControl().then((()=>this.__elementMounted=!0))}))}disconnectedCallback(){queueMicrotask((()=>{this.__stopUserControl().then((()=>this.__elementMounted=!1))}))}attributeChangedCallback(e,t,i){this.__setNativeConfiguration(e,i)&&(this.disconnectedCallback(),this.connectedCallback())}addWidgetEventListener(e,t){this.addEventListener(e,t,!0)}addEventListener(e,t,i){const s=e.toLowerCase().replace("-",""),a=m.attributes[s];this.__widgetContainer.addEventListener(a.property,t,i)}static get observedAttributes(){return Object.getOwnPropertyNames(this.attributes)}static generateTemplateRawFromByteArray(e,t,i){const s=new r.Selphi.ConfigurationManager;"string"==typeof e?s.setBundlePath(e):"object"==typeof e&&Object.keys(e).forEach((t=>{const i=m.__getSetterAttr(t,s);(s?i.bind(s):i)(e[t])})),s.setContainer(document.createElement("div")),new r.Selphi.Widget(s).GenerateTemplateRawFromByteArray(t,i)}static async checkCapabilities(){return await r.Selphi.CheckCapabilities()}__createUserControl(e){return this.__fphiWidget=new r.Selphi.Widget(e),(null!==this.getAttribute("debugMode")&&void 0!==this.getAttribute("debugMode")||null!==this.getAttribute("debugmode")&&void 0!==this.getAttribute("debugmode"))&&(this.__fphiWidget.debug=m.__tryParsePrimitive(this.getAttribute("debugMode"))),this}async __startUserControl(){return this.__fphiWidget&&this.__fphiWidget.Start(),this}async __stopUserControl(){return this.__fphiWidget&&this.__fphiWidget.Stop(),this}routeClick(e,t){this.__fphiWidget.routeClick(e,t)}__setNativeConfiguration(e,t){let i=!1;if(void 0!==m.attributes[e]&&null!==m.attributes[e]){const s=m.attributes[e].property,a=m.attributes[e].type,l=t,n=Reflect.get(this.__config,s);if(null!=t&&l!==n){let e="event"!==a?m.__tryParsePrimitive(t):m.__tryParseFunction(t);if("debugMode"===s)void 0!==this.__fphiWidget&&null!==this.__fphiWidget&&"function"!=typeof e&&(this.__fphiWidget.debug=e,i=i||!1);else{if("accessibility"!==s||!0!==e||this.__accessibilityHasEnabled||(this.accessibilityRoot=document.createElement("div"),this.accessibilityRoot.id="accessibilityContainer",this.__widgetContainer.append(this.accessibilityRoot),this.__accessibilityHasEnabled=!0),"function"==typeof e&&"event"===a)this.__widgetContainer.addEventListener(s,e,!0);else{const t=m.__getSetterAttr(s,this.__config);(this.__config?t.bind(this.__config):t)(e)}i=this.__elementMounted}}}return i}static __getSetterAttr(e,t){return t["set"+e.charAt(0).toUpperCase()+e.slice(1)]}static __tryParsePrimitive(e){try{return JSON.parse(e)}catch(t){return e.toString()}}static __tryParseFunction(e){try{return new Function("event",e)}catch(t){return e.toString()}}}let u=null;const b={};function p(e){let t="",i=new Uint8Array(e),s=i.byteLength;for(let e=0;e<s;e++)t+=String.fromCharCode(i[e]);return window.btoa(t)}b.Selphi=e,b.Selphi.RecorderType={Local:0,Remote:1},b.Selphi.RecorderStatus={Ok:0,Unknown:1,SocketError:2},b.Selphi.ConfigurationManager=class{constructor(){this.container=null,this.language="es",this.dpiList=[163,326,489],this.cameraWidth=1280,this.cameraHeight=720,this.cameraType=e.CameraType.Front,this.cameraRotation=0,this.bundlePath="",this.resourcesPath=this.bundlePath+"/FPhi.Widget.Resources/",this.faceTracking=!1,this.accessibility=!1,this.accessibleElements=["button","buttonImage"],this.showLog=!1,this.onExtractionFinish=null,this.onUserCancel=null,this.onExceptionCaptured=null,this.onExtractionTimeout=null,this.onModuleLoaded=null,this.onLivenessError=null,this.onLivenessErrorButtonClick=null,this.onTimeoutErrorButtonClick=null,this.onStabilizing=null,this.onTrackStatus=null,this.livenessMode=e.LivenessMode.None,this.tutorial=!1,this.stabilizationStage=!1,this.livenessPrecision=2,this.livenessMoveInitialError=0,this.livenessMoveInfoTime=3,this.timeout=3e4,this.interactible=!0,this.registerTime=7,this.authenticateTime=1,this.graphPath=this.bundlePath+"/graph.xml",this.imageFormat="image/jpeg",this.imageQuality=.92,this.logImages=!1,this.cropFactor=1,this.cropImage=!0,this.templateFormat=e.TemplateFormat.Base64,this.videoRecord=!1,this.videoRecordRate=10,this.videoRecordScale=1,this.videoRecordType=e.RecorderType.Local}setContainer(e){this.container=e}getContainer(){return this.container}setLanguage(e){this.language=e}getLanguage(){return this.language}setDpiList(e){this.dpiList=e}getDpiList(){return this.dpiList}setCameraWidth(e){this.cameraWidth=e}getCameraWidth(){return this.cameraWidth}setCameraHeight(e){this.cameraHeight=e}getCameraHeight(){return this.cameraHeight}setCameraType(e){this.cameraType=e}getCameraType(){return this.cameraType}setCameraRotation(e){this.cameraRotation=e}getCameraRotation(){return this.cameraRotation}setResourcesPath(e){this.resourcesPath=e}getResourcesPath(){return this.resourcesPath}setBundlePath(e){const t=this.bundlePath;this.bundlePath=e,this.graphPath=this.bundlePath+"/graph.xml",this.resourcesPath===t+"/FPhi.Widget.Resources/"&&(this.resourcesPath=this.bundlePath+"/FPhi.Widget.Resources/")}getTimeout(){return this.timeout}setTimeout(e){this.timeout=e}getBundlePath(){return this.bundlePath}setOnExtractionFinish(e){this.onExtractionFinish=e}getOnExtractionFinish(){return this.onExtractionFinish}setOnUserCancel(e){this.onUserCancel=e}getOnUserCancel(){return this.onUserCancel}setOnExceptionCaptured(e){this.onExceptionCaptured=e}getOnExceptionCaptured(){return this.onExceptionCaptured}setOnExtractionTimeout(e){this.onExtractionTimeout=e}getOnExtractionTimeout(){return this.onExtractionTimeout}setOnModuleLoaded(e){this.onModuleLoaded=e}getOnModuleLoaded(){return this.onModuleLoaded}setOnLivenessError(e){this.onLivenessError=e}getOnLivenessError(){return this.onLivenessError}setOnLivenessErrorButtonClick(e){this.onLivenessErrorButtonClick=e}getOnLivenessErrorButtonClick(){return this.onLivenessErrorButtonClick}setOnTimeoutErrorButtonClick(e){this.onTimeoutErrorButtonClick=e}getOnTimeoutErrorButtonClick(){return this.onTimeoutErrorButtonClick}setOnStabilizing(e){this.onStabilizing=e}getOnStabilizing(){return this.onStabilizing}setOnTrackStatus(e){this.onTrackStatus=e}getOnTrackStatus(){return this.onTrackStatus}setLivenessMode(e){this.livenessMode=e}getLivenessMode(){return this.livenessMode}setTutorial(e){this.tutorial=e}getTutorial(){return this.tutorial}setStabilizationStage(e){this.stabilizationStage=e}getStabilizationStage(){return this.stabilizationStage}setLivenessPrecision(e){this.livenessPrecision=e}getLivenessPrecision(){return this.livenessPrecision}setLivenessMoveInitialError(e){this.livenessMoveInitialError=e}getLivenessMoveInitialError(){return this.livenessMoveInitialError}setLivenessMoveInfoTime(e){this.livenessMoveInfoTime=e}getLivenessMoveInfoTime(){return this.livenessMoveInfoTime}setInteractible(e){this.interactible=e}getInteractible(){return this.interactible}setRegisterTime(e){this.registerTime=e}getRegisterTime(){return this.registerTime}setAuthenticateTime(e){this.authenticateTime=e}getAuthenticateTime(){return this.authenticateTime}setGraphPath(e){this.graphPath=e}getGraphPath(){return this.graphPath}setImageFormat(e){this.imageFormat=e}getImageFormat(){return this.imageFormat}setImageQuality(e){this.imageQuality=e}getImageQuality(){return this.imageQuality}setLogImages(e){this.logImages=e}getLogImages(){return this.logImages}setCropFactor(e){this.cropFactor=e}getCropFactor(){return this.cropFactor}setCropImage(e){this.cropImage=e}getCropImage(){return this.cropImage}setTemplateFormat(e){this.templateFormat=e}getTemplateFormat(){return this.templateFormat}setVideoRecord(e){this.videoRecord=e}getVideoRecord(){return this.videoRecord}setVideoRecordRate(e){this.videoRecordRate=e}getVideoRecordRate(){return this.videoRecordRate}setVideoRecordScale(e){this.videoRecordScale=e}getVideoRecordScale(){return this.videoRecordScale}setVideoRecordType(e){this.videoRecordType=e}getVideoRecordType(){return this.videoRecordType}setShowLog(e){this.showLog=e}getShowLog(){return this.showLog}setFaceTracking(e){this.faceTracking=e}getFaceTracking(){return this.faceTracking}setAccessibility(e){this.accessibility=e}getAccessibility(){return this.accessibility}setAccessibleElements(e){this.accessibleElements=e}getAccessibleElements(){return this.accessibleElements}},b.Selphi.Widget=function(e){this.showLog=e.getShowLog(),this.printLog("FPhi.Selphi.Widget: Selphi Widget Web Version: "+b.Selphi.Version),this.printLog("FPhi.Selphi.Widget: Debug log enabled!"),this.cm=e,this.divContainer=this.cm.getContainer(),this.livenessMode=this.cm.getLivenessMode(),this.tutorial=this.cm.getTutorial(),this.stabilizationStage=this.cm.getStabilizationStage(),this.onExtractionFinish=this.cm.getOnExtractionFinish(),this.onUserCancel=this.cm.getOnUserCancel(),this.onExceptionCaptured=this.cm.getOnExceptionCaptured(),this.onExtractionTimeout=this.cm.getOnExtractionTimeout(),this.onModuleLoaded=this.cm.getOnModuleLoaded(),this.onLivenessError=this.cm.getOnLivenessError(),this.onLivenessErrorButtonClick=this.cm.getOnLivenessErrorButtonClick(),this.onTimeoutErrorButtonClick=this.cm.getOnTimeoutErrorButtonClick(),this.onStabilizing=this.cm.getOnStabilizing(),this.onTrackStatus=this.cm.getOnTrackStatus(),this.livenessPrecision=this.cm.getLivenessPrecision(),this.livenessMoveInitialError=this.cm.getLivenessMoveInitialError(),this.livenessMoveInfoTime=this.cm.getLivenessMoveInfoTime(),this.interactible=this.cm.getInteractible(),this.registerTime=this.cm.getRegisterTime(),this.authenticateTime=this.cm.getAuthenticateTime(),this.graphPath=this.isPathAbsolute(this.cm.getGraphPath())?this.cm.getGraphPath():this.getScriptPath()+this.cm.getGraphPath(),this.imageFormat=this.cm.getImageFormat(),this.imageQuality=this.cm.getImageQuality(),this.logImages=this.cm.getLogImages(),this.cropFactor=this.cm.getCropFactor(),this.cropImage=this.cm.getCropImage(),this.devicePixelRatio=window.devicePixelRatio,this.cameraReady=!1,this.bundlePath=this.isPathAbsolute(this.cm.getBundlePath())?this.cm.getBundlePath():this.getScriptPath()+this.cm.getBundlePath(),this.printLog("FPhi.Selphi.Widget: Serving from URL: "+this.bundlePath),this.printLog("FPhi.Selphi.Widget: wasm path: "+this.bundlePath+"/FPhiExtractor.wasm"),this.wasmReady=!1,this.wasmInitiated=!1,this.worker=new Worker((null===u&&(u=URL.createObjectURL(new Blob([atob("Y29uc3QgZT0oLi4uZSk9PntlLmZvckVhY2goKGU9PntudWxsIT09ZSYmdm9pZCAwIT09ZS5kZWxldGUmJmUuZGVsZXRlKCl9KSl9LHI9KGUscix0KT0+e2xldCBuPXI7aWYobi5zYW1wbGVEaWFnbm9zdGljPXQuZ2V0U2FtcGxlRGlhZ25vc3RpYygpLnZhbHVlLHQuZ2V0U2FtcGxlRGlhZ25vc3RpYygpPT09ZS5TYW1wbGVEaWFnbm9zdGljLk9rKXtsZXQgcixvLGEsaSxzLHUsYyxsO251bGwhPT0ocz10LmdldFRlbXBsYXRlKCkpJiZudWxsIT09KGM9bmV3IFVpbnQ4QXJyYXkoZS5nZXRCeXRlcyhzKSkpJiYobi50ZW1wbGF0ZT1jLHMuZGVsZXRlKCkpLG51bGwhPT0odT10LmdldFRlbXBsYXRlUmF3KCkpJiZudWxsIT09KGw9bmV3IFVpbnQ4QXJyYXkoZS5nZXRCeXRlcyh1KSkpJiYobi50ZW1wbGF0ZVJhdz1sLHUuZGVsZXRlKCkpLG51bGwhPT0obz10LmdldEZhY2UoKSkmJihuLmZhY2U9e3g6by5YLHk6by5ZLHdpZHRoOm8uV2lkdGgsaGVpZ2h0Om8uSGVpZ2h0fSksbnVsbCE9PShhPXQuZ2V0TGVmdEV5ZSgpKSYmKG4ubGVmdEV5ZT17eDphLlgseTphLll9KSxudWxsIT09KGk9dC5nZXRSaWdodEV5ZSgpKSYmKG4ucmlnaHRFeWU9e3g6aS5YLHk6aS5ZfSksbnVsbCE9PShyPXQuZ2V0VGVtcGxhdGVJbmZvKCkpJiYobi50ZW1wbGF0ZVNjb3JlPXIuZ2V0VGVtcGxhdGVTY29yZSgpLG4uZmFjaWFsU2NvcmU9dC5nZXRGYWNpYWxTY29yZSgpLG4uc3VuR2xhc3Nlc1Njb3JlPXIuZ2V0U3VuR2xhc3Nlc1Njb3JlKCksci5kZWxldGUoKSl9cmV0dXJuIG59LHQ9YXN5bmMgZT0+bnVsbCxuPWFzeW5jIGU9Pm51bGw7dmFyIG8sYT0obz0idW5kZWZpbmVkIiE9dHlwZW9mIGRvY3VtZW50JiZkb2N1bWVudC5jdXJyZW50U2NyaXB0P2RvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjOnZvaWQgMCxmdW5jdGlvbihlKXt2YXIgcix0OyhlPXZvaWQgMCE9PShlPWV8fHt9KT9lOnt9KS5yZWFkeT1uZXcgUHJvbWlzZSgoZnVuY3Rpb24oZSxuKXtyPWUsdD1ufSkpO3ZhciBuLGEsaT1PYmplY3QuYXNzaWduKHt9LGUpLHM9W10sdT0iLi90aGlzLnByb2dyYW0iLGM9IiI7InVuZGVmaW5lZCIhPXR5cGVvZiBkb2N1bWVudCYmZG9jdW1lbnQuY3VycmVudFNjcmlwdCYmKGM9ZG9jdW1lbnQuY3VycmVudFNjcmlwdC5zcmMpLG8mJihjPW8pLGM9MCE9PWMuaW5kZXhPZigiYmxvYjoiKT9jLnN1YnN0cigwLGMucmVwbGFjZSgvWz8jXS4qLywiIikubGFzdEluZGV4T2YoIi8iKSsxKToiIixuPWU9Pnt2YXIgcj1uZXcgWE1MSHR0cFJlcXVlc3Q7cmV0dXJuIHIub3BlbigiR0VUIixlLCExKSxyLnNlbmQobnVsbCksci5yZXNwb25zZVRleHR9LGE9KGUscix0KT0+e3ZhciBuPW5ldyBYTUxIdHRwUmVxdWVzdDtuLm9wZW4oIkdFVCIsZSwhMCksbi5yZXNwb25zZVR5cGU9ImFycmF5YnVmZmVyIixuLm9ubG9hZD0oKT0+ezIwMD09bi5zdGF0dXN8fDA9PW4uc3RhdHVzJiZuLnJlc3BvbnNlP3Iobi5yZXNwb25zZSk6dCgpfSxuLm9uZXJyb3I9dCxuLnNlbmQobnVsbCl9O3ZhciBsPWUucHJpbnR8fGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSksZD1lLnByaW50RXJyfHxjb25zb2xlLndhcm4uYmluZChjb25zb2xlKTtPYmplY3QuYXNzaWduKGUsaSksaT1udWxsLGUuYXJndW1lbnRzJiYocz1lLmFyZ3VtZW50cyksZS50aGlzUHJvZ3JhbSYmKHU9ZS50aGlzUHJvZ3JhbSksZS5xdWl0JiZlLnF1aXQ7dmFyIGYscD0wLGg9ZT0+e3A9ZX07ZS53YXNtQmluYXJ5JiYoZj1lLndhc21CaW5hcnkpLGUubm9FeGl0UnVudGltZSwib2JqZWN0IiE9dHlwZW9mIFdlYkFzc2VtYmx5JiZLKCJubyBuYXRpdmUgd2FzbSBzdXBwb3J0IGRldGVjdGVkIik7dmFyIG09ITE7ZnVuY3Rpb24gdihlLHIpe2V8fEsocil9dmFyIHk9InVuZGVmaW5lZCIhPXR5cGVvZiBUZXh0RGVjb2Rlcj9uZXcgVGV4dERlY29kZXIoInV0ZjgiKTp2b2lkIDA7ZnVuY3Rpb24gdyhlLHIsdCl7Zm9yKHZhciBuPXIrdCxvPXI7ZVtvXSYmIShvPj1uKTspKytvO2lmKG8tcj4xNiYmZS5idWZmZXImJnkpcmV0dXJuIHkuZGVjb2RlKGUuc3ViYXJyYXkocixvKSk7Zm9yKHZhciBhPSIiO3I8bzspe3ZhciBpPWVbcisrXTtpZigxMjgmaSl7dmFyIHM9NjMmZVtyKytdO2lmKDE5MiE9KDIyNCZpKSl7dmFyIHU9NjMmZVtyKytdO2lmKChpPTIyND09KDI0MCZpKT8oMTUmaSk8PDEyfHM8PDZ8dTooNyZpKTw8MTh8czw8MTJ8dTw8Nnw2MyZlW3IrK10pPDY1NTM2KWErPVN0cmluZy5mcm9tQ2hhckNvZGUoaSk7ZWxzZXt2YXIgYz1pLTY1NTM2O2ErPVN0cmluZy5mcm9tQ2hhckNvZGUoNTUyOTZ8Yz4+MTAsNTYzMjB8MTAyMyZjKX19ZWxzZSBhKz1TdHJpbmcuZnJvbUNoYXJDb2RlKCgzMSZpKTw8NnxzKX1lbHNlIGErPVN0cmluZy5mcm9tQ2hhckNvZGUoaSl9cmV0dXJuIGF9ZnVuY3Rpb24gZyhlLHIpe3JldHVybiBlP3coVCxlLHIpOiIifWZ1bmN0aW9uIEUoZSxyLHQsbil7aWYoIShuPjApKXJldHVybiAwO2Zvcih2YXIgbz10LGE9dCtuLTEsaT0wO2k8ZS5sZW5ndGg7KytpKXt2YXIgcz1lLmNoYXJDb2RlQXQoaSk7aWYocz49NTUyOTYmJnM8PTU3MzQzJiYocz02NTUzNisoKDEwMjMmcyk8PDEwKXwxMDIzJmUuY2hhckNvZGVBdCgrK2kpKSxzPD0xMjcpe2lmKHQ+PWEpYnJlYWs7clt0KytdPXN9ZWxzZSBpZihzPD0yMDQ3KXtpZih0KzE+PWEpYnJlYWs7clt0KytdPTE5MnxzPj42LHJbdCsrXT0xMjh8NjMmc31lbHNlIGlmKHM8PTY1NTM1KXtpZih0KzI+PWEpYnJlYWs7clt0KytdPTIyNHxzPj4xMixyW3QrK109MTI4fHM+PjYmNjMsclt0KytdPTEyOHw2MyZzfWVsc2V7aWYodCszPj1hKWJyZWFrO3JbdCsrXT0yNDB8cz4+MTgsclt0KytdPTEyOHxzPj4xMiY2MyxyW3QrK109MTI4fHM+PjYmNjMsclt0KytdPTEyOHw2MyZzfX1yZXR1cm4gclt0XT0wLHQtb31mdW5jdGlvbiBfKGUscix0KXtyZXR1cm4gRShlLFQscix0KX1mdW5jdGlvbiBiKGUpe2Zvcih2YXIgcj0wLHQ9MDt0PGUubGVuZ3RoOysrdCl7dmFyIG49ZS5jaGFyQ29kZUF0KHQpO24+PTU1Mjk2JiZuPD01NzM0MyYmKG49NjU1MzYrKCgxMDIzJm4pPDwxMCl8MTAyMyZlLmNoYXJDb2RlQXQoKyt0KSksbjw9MTI3PysrcjpyKz1uPD0yMDQ3PzI6bjw9NjU1MzU/Mzo0fXJldHVybiByfXZhciBrLFAsVCxTLEMsRCxGLEEsTSwkPSJ1bmRlZmluZWQiIT10eXBlb2YgVGV4dERlY29kZXI/bmV3IFRleHREZWNvZGVyKCJ1dGYtMTZsZSIpOnZvaWQgMDtmdW5jdGlvbiB4KGUscil7Zm9yKHZhciB0PWUsbj10Pj4xLG89bityLzI7IShuPj1vKSYmQ1tuXTspKytuO2lmKCh0PW48PDEpLWU+MzImJiQpcmV0dXJuICQuZGVjb2RlKFQuc3ViYXJyYXkoZSx0KSk7Zm9yKHZhciBhPSIiLGk9MDshKGk+PXIvMik7KytpKXt2YXIgcz1TW2UrMippPj4xXTtpZigwPT1zKWJyZWFrO2ErPVN0cmluZy5mcm9tQ2hhckNvZGUocyl9cmV0dXJuIGF9ZnVuY3Rpb24gTyhlLHIsdCl7aWYodm9pZCAwPT09dCYmKHQ9MjE0NzQ4MzY0NyksdDwyKXJldHVybiAwO2Zvcih2YXIgbj1yLG89KHQtPTIpPDIqZS5sZW5ndGg/dC8yOmUubGVuZ3RoLGE9MDthPG87KythKXt2YXIgaT1lLmNoYXJDb2RlQXQoYSk7U1tyPj4xXT1pLHIrPTJ9cmV0dXJuIFNbcj4+MV09MCxyLW59ZnVuY3Rpb24gUihlKXtyZXR1cm4gMiplLmxlbmd0aH1mdW5jdGlvbiBqKGUscil7Zm9yKHZhciB0PTAsbj0iIjshKHQ+PXIvNCk7KXt2YXIgbz1EW2UrNCp0Pj4yXTtpZigwPT1vKWJyZWFrO2lmKCsrdCxvPj02NTUzNil7dmFyIGE9by02NTUzNjtuKz1TdHJpbmcuZnJvbUNoYXJDb2RlKDU1Mjk2fGE+PjEwLDU2MzIwfDEwMjMmYSl9ZWxzZSBuKz1TdHJpbmcuZnJvbUNoYXJDb2RlKG8pfXJldHVybiBufWZ1bmN0aW9uIEkoZSxyLHQpe2lmKHZvaWQgMD09PXQmJih0PTIxNDc0ODM2NDcpLHQ8NClyZXR1cm4gMDtmb3IodmFyIG49cixvPW4rdC00LGE9MDthPGUubGVuZ3RoOysrYSl7dmFyIGk9ZS5jaGFyQ29kZUF0KGEpO2lmKGk+PTU1Mjk2JiZpPD01NzM0MyYmKGk9NjU1MzYrKCgxMDIzJmkpPDwxMCl8MTAyMyZlLmNoYXJDb2RlQXQoKythKSksRFtyPj4yXT1pLChyKz00KSs0Pm8pYnJlYWt9cmV0dXJuIERbcj4+Ml09MCxyLW59ZnVuY3Rpb24geihlKXtmb3IodmFyIHI9MCx0PTA7dDxlLmxlbmd0aDsrK3Qpe3ZhciBuPWUuY2hhckNvZGVBdCh0KTtuPj01NTI5NiYmbjw9NTczNDMmJisrdCxyKz00fXJldHVybiByfWUuSU5JVElBTF9NRU1PUlk7dmFyIEIsVyxOLEwsVSxIPVtdLFY9W10sWT1bXSxxPTAsRz1udWxsLFg9bnVsbDtmdW5jdGlvbiBKKHIpe3ErKyxlLm1vbml0b3JSdW5EZXBlbmRlbmNpZXMmJmUubW9uaXRvclJ1bkRlcGVuZGVuY2llcyhxKX1mdW5jdGlvbiBRKHIpe2lmKHEtLSxlLm1vbml0b3JSdW5EZXBlbmRlbmNpZXMmJmUubW9uaXRvclJ1bkRlcGVuZGVuY2llcyhxKSwwPT1xJiYobnVsbCE9PUcmJihjbGVhckludGVydmFsKEcpLEc9bnVsbCksWCkpe3ZhciB0PVg7WD1udWxsLHQoKX19ZnVuY3Rpb24gSyhyKXtlLm9uQWJvcnQmJmUub25BYm9ydChyKSxkKHI9IkFib3J0ZWQoIityKyIpIiksbT0hMCxyKz0iLiBCdWlsZCB3aXRoIC1zQVNTRVJUSU9OUyBmb3IgbW9yZSBpbmZvLiI7dmFyIG49bmV3IFdlYkFzc2VtYmx5LlJ1bnRpbWVFcnJvcihyKTt0aHJvdyB0KG4pLG59ZnVuY3Rpb24gWihyKXtmb3IoO3IubGVuZ3RoPjA7KXt2YXIgdD1yLnNoaWZ0KCk7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIHQpe3ZhciBuPXQuZnVuYzsibnVtYmVyIj09dHlwZW9mIG4/dm9pZCAwPT09dC5hcmc/cmUobikoKTpyZShuKSh0LmFyZyk6bih2b2lkIDA9PT10LmFyZz9udWxsOnQuYXJnKX1lbHNlIHQoZSl9fShXPSJGUGhpRXh0cmFjdG9yLndhc20iKS5zdGFydHNXaXRoKCJkYXRhOmFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbTtiYXNlNjQsIil8fChOPVcsVz1lLmxvY2F0ZUZpbGU/ZS5sb2NhdGVGaWxlKE4sYyk6YytOKTt2YXIgZWU9W107ZnVuY3Rpb24gcmUoZSl7dmFyIHI9ZWVbZV07cmV0dXJuIHJ8fChlPj1lZS5sZW5ndGgmJihlZS5sZW5ndGg9ZSsxKSxlZVtlXT1yPUIuZ2V0KGUpKSxyfXZhciB0ZT1bXSxuZT0wLG9lPTA7ZnVuY3Rpb24gYWUoZSl7dGhpcy5leGNQdHI9ZSx0aGlzLnB0cj1lLTI0LHRoaXMuc2V0X3R5cGU9ZnVuY3Rpb24oZSl7RFt0aGlzLnB0cis0Pj4yXT1lfSx0aGlzLmdldF90eXBlPWZ1bmN0aW9uKCl7cmV0dXJuIERbdGhpcy5wdHIrND4+Ml19LHRoaXMuc2V0X2Rlc3RydWN0b3I9ZnVuY3Rpb24oZSl7RFt0aGlzLnB0cis4Pj4yXT1lfSx0aGlzLmdldF9kZXN0cnVjdG9yPWZ1bmN0aW9uKCl7cmV0dXJuIERbdGhpcy5wdHIrOD4+Ml19LHRoaXMuc2V0X3JlZmNvdW50PWZ1bmN0aW9uKGUpe0RbdGhpcy5wdHI+PjJdPWV9LHRoaXMuc2V0X2NhdWdodD1mdW5jdGlvbihlKXtlPWU/MTowLFBbdGhpcy5wdHIrMTI+PjBdPWV9LHRoaXMuZ2V0X2NhdWdodD1mdW5jdGlvbigpe3JldHVybiAwIT1QW3RoaXMucHRyKzEyPj4wXX0sdGhpcy5zZXRfcmV0aHJvd249ZnVuY3Rpb24oZSl7ZT1lPzE6MCxQW3RoaXMucHRyKzEzPj4wXT1lfSx0aGlzLmdldF9yZXRocm93bj1mdW5jdGlvbigpe3JldHVybiAwIT1QW3RoaXMucHRyKzEzPj4wXX0sdGhpcy5pbml0PWZ1bmN0aW9uKGUscil7dGhpcy5zZXRfYWRqdXN0ZWRfcHRyKDApLHRoaXMuc2V0X3R5cGUoZSksdGhpcy5zZXRfZGVzdHJ1Y3RvcihyKSx0aGlzLnNldF9yZWZjb3VudCgwKSx0aGlzLnNldF9jYXVnaHQoITEpLHRoaXMuc2V0X3JldGhyb3duKCExKX0sdGhpcy5hZGRfcmVmPWZ1bmN0aW9uKCl7dmFyIGU9RFt0aGlzLnB0cj4+Ml07RFt0aGlzLnB0cj4+Ml09ZSsxfSx0aGlzLnJlbGVhc2VfcmVmPWZ1bmN0aW9uKCl7dmFyIGU9RFt0aGlzLnB0cj4+Ml07cmV0dXJuIERbdGhpcy5wdHI+PjJdPWUtMSwxPT09ZX0sdGhpcy5zZXRfYWRqdXN0ZWRfcHRyPWZ1bmN0aW9uKGUpe0RbdGhpcy5wdHIrMTY+PjJdPWV9LHRoaXMuZ2V0X2FkanVzdGVkX3B0cj1mdW5jdGlvbigpe3JldHVybiBEW3RoaXMucHRyKzE2Pj4yXX0sdGhpcy5nZXRfZXhjZXB0aW9uX3B0cj1mdW5jdGlvbigpe2lmKFdyKHRoaXMuZ2V0X3R5cGUoKSkpcmV0dXJuIERbdGhpcy5leGNQdHI+PjJdO3ZhciBlPXRoaXMuZ2V0X2FkanVzdGVkX3B0cigpO3JldHVybiAwIT09ZT9lOnRoaXMuZXhjUHRyfX1mdW5jdGlvbiBpZShlKXt0cnl7cmV0dXJuIHhyKG5ldyBhZShlKS5wdHIpfWNhdGNoKGUpe319dmFyIHNlPSJUbyB1c2UgZGxvcGVuLCB5b3UgbmVlZCBlbmFibGUgZHluYW1pYyBsaW5raW5nLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2Vtc2NyaXB0ZW4tY29yZS9lbXNjcmlwdGVuL3dpa2kvTGlua2luZyIsdWU9e307ZnVuY3Rpb24gY2UoZSl7Zm9yKDtlLmxlbmd0aDspe3ZhciByPWUucG9wKCk7ZS5wb3AoKShyKX19ZnVuY3Rpb24gbGUoZSl7cmV0dXJuIHRoaXMuZnJvbVdpcmVUeXBlKEZbZT4+Ml0pfXZhciBkZT17fSxmZT17fSxwZT17fTtmdW5jdGlvbiBoZShlKXtpZih2b2lkIDA9PT1lKXJldHVybiJfdW5rbm93biI7dmFyIHI9KGU9ZS5yZXBsYWNlKC9bXmEtekEtWjAtOV9dL2csIiQiKSkuY2hhckNvZGVBdCgwKTtyZXR1cm4gcj49NDgmJnI8PTU3PyJfIitlOmV9ZnVuY3Rpb24gbWUoZSxyKXtyZXR1cm4gZT1oZShlKSxuZXcgRnVuY3Rpb24oImJvZHkiLCJyZXR1cm4gZnVuY3Rpb24gIitlKycoKSB7XG4gICAgInVzZSBzdHJpY3QiOyAgICByZXR1cm4gYm9keS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xufTtcbicpKHIpfWZ1bmN0aW9uIHZlKGUscil7dmFyIHQ9bWUociwoZnVuY3Rpb24oZSl7dGhpcy5uYW1lPXIsdGhpcy5tZXNzYWdlPWU7dmFyIHQ9bmV3IEVycm9yKGUpLnN0YWNrO3ZvaWQgMCE9PXQmJih0aGlzLnN0YWNrPXRoaXMudG9TdHJpbmcoKSsiXG4iK3QucmVwbGFjZSgvXkVycm9yKDpbXlxuXSopP1xuLywiIikpfSkpO3JldHVybiB0LnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGUucHJvdG90eXBlKSx0LnByb3RvdHlwZS5jb25zdHJ1Y3Rvcj10LHQucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIHZvaWQgMD09PXRoaXMubWVzc2FnZT90aGlzLm5hbWU6dGhpcy5uYW1lKyI6ICIrdGhpcy5tZXNzYWdlfSx0fXZhciB5ZT12b2lkIDA7ZnVuY3Rpb24gd2UoZSl7dGhyb3cgbmV3IHllKGUpfWZ1bmN0aW9uIGdlKGUscix0KXtmdW5jdGlvbiBuKHIpe3ZhciBuPXQocik7bi5sZW5ndGghPT1lLmxlbmd0aCYmd2UoIk1pc21hdGNoZWQgdHlwZSBjb252ZXJ0ZXIgY291bnQiKTtmb3IodmFyIG89MDtvPGUubGVuZ3RoOysrbylUZShlW29dLG5bb10pfWUuZm9yRWFjaCgoZnVuY3Rpb24oZSl7cGVbZV09cn0pKTt2YXIgbz1uZXcgQXJyYXkoci5sZW5ndGgpLGE9W10saT0wO3IuZm9yRWFjaCgoKGUscik9PntmZS5oYXNPd25Qcm9wZXJ0eShlKT9vW3JdPWZlW2VdOihhLnB1c2goZSksZGUuaGFzT3duUHJvcGVydHkoZSl8fChkZVtlXT1bXSksZGVbZV0ucHVzaCgoKCk9PntvW3JdPWZlW2VdLCsraT09PWEubGVuZ3RoJiZuKG8pfSkpKX0pKSwwPT09YS5sZW5ndGgmJm4obyl9ZnVuY3Rpb24gRWUoZSl7c3dpdGNoKGUpe2Nhc2UgMTpyZXR1cm4gMDtjYXNlIDI6cmV0dXJuIDE7Y2FzZSA0OnJldHVybiAyO2Nhc2UgODpyZXR1cm4gMztkZWZhdWx0OnRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gdHlwZSBzaXplOiAiK2UpfX12YXIgX2U9dm9pZCAwO2Z1bmN0aW9uIGJlKGUpe2Zvcih2YXIgcj0iIix0PWU7VFt0XTspcis9X2VbVFt0KytdXTtyZXR1cm4gcn12YXIga2U9dm9pZCAwO2Z1bmN0aW9uIFBlKGUpe3Rocm93IG5ldyBrZShlKX1mdW5jdGlvbiBUZShlLHIsdD17fSl7aWYoISgiYXJnUGFja0FkdmFuY2UiaW4gcikpdGhyb3cgbmV3IFR5cGVFcnJvcigicmVnaXN0ZXJUeXBlIHJlZ2lzdGVyZWRJbnN0YW5jZSByZXF1aXJlcyBhcmdQYWNrQWR2YW5jZSIpO3ZhciBuPXIubmFtZTtpZihlfHxQZSgndHlwZSAiJytuKyciIG11c3QgaGF2ZSBhIHBvc2l0aXZlIGludGVnZXIgdHlwZWlkIHBvaW50ZXInKSxmZS5oYXNPd25Qcm9wZXJ0eShlKSl7aWYodC5pZ25vcmVEdXBsaWNhdGVSZWdpc3RyYXRpb25zKXJldHVybjtQZSgiQ2Fubm90IHJlZ2lzdGVyIHR5cGUgJyIrbisiJyB0d2ljZSIpfWlmKGZlW2VdPXIsZGVsZXRlIHBlW2VdLGRlLmhhc093blByb3BlcnR5KGUpKXt2YXIgbz1kZVtlXTtkZWxldGUgZGVbZV0sby5mb3JFYWNoKChlPT5lKCkpKX19ZnVuY3Rpb24gU2UoZSl7UGUoZS4kJC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzcy5uYW1lKyIgaW5zdGFuY2UgYWxyZWFkeSBkZWxldGVkIil9dmFyIENlPSExO2Z1bmN0aW9uIERlKGUpe31mdW5jdGlvbiBGZShlKXtlLmNvdW50LnZhbHVlLT0xLDA9PT1lLmNvdW50LnZhbHVlJiZmdW5jdGlvbihlKXtlLnNtYXJ0UHRyP2Uuc21hcnRQdHJUeXBlLnJhd0Rlc3RydWN0b3IoZS5zbWFydFB0cik6ZS5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzcy5yYXdEZXN0cnVjdG9yKGUucHRyKX0oZSl9ZnVuY3Rpb24gQWUoZSxyLHQpe2lmKHI9PT10KXJldHVybiBlO2lmKHZvaWQgMD09PXQuYmFzZUNsYXNzKXJldHVybiBudWxsO3ZhciBuPUFlKGUscix0LmJhc2VDbGFzcyk7cmV0dXJuIG51bGw9PT1uP251bGw6dC5kb3duY2FzdChuKX12YXIgTWU9e307dmFyICRlPVtdO2Z1bmN0aW9uIHhlKCl7Zm9yKDskZS5sZW5ndGg7KXt2YXIgZT0kZS5wb3AoKTtlLiQkLmRlbGV0ZVNjaGVkdWxlZD0hMSxlLmRlbGV0ZSgpfX12YXIgT2U9dm9pZCAwO3ZhciBSZT17fTtmdW5jdGlvbiBqZShlLHIpe3JldHVybiByLnB0clR5cGUmJnIucHRyfHx3ZSgibWFrZUNsYXNzSGFuZGxlIHJlcXVpcmVzIHB0ciBhbmQgcHRyVHlwZSIpLCEhci5zbWFydFB0clR5cGUhPSEhci5zbWFydFB0ciYmd2UoIkJvdGggc21hcnRQdHJUeXBlIGFuZCBzbWFydFB0ciBtdXN0IGJlIHNwZWNpZmllZCIpLHIuY291bnQ9e3ZhbHVlOjF9LEllKE9iamVjdC5jcmVhdGUoZSx7JCQ6e3ZhbHVlOnJ9fSkpfWZ1bmN0aW9uIEllKGUpe3JldHVybiJ1bmRlZmluZWQiPT10eXBlb2YgRmluYWxpemF0aW9uUmVnaXN0cnk/KEllPWU9PmUsZSk6KENlPW5ldyBGaW5hbGl6YXRpb25SZWdpc3RyeSgoZT0+e0ZlKGUuJCQpfSkpLEllPWU9Pnt2YXIgcj1lLiQkO2lmKHIuc21hcnRQdHIpe3ZhciB0PXskJDpyfTtDZS5yZWdpc3RlcihlLHQsZSl9cmV0dXJuIGV9LERlPWU9PkNlLnVucmVnaXN0ZXIoZSksSWUoZSkpfWZ1bmN0aW9uIHplKCl7fWZ1bmN0aW9uIEJlKGUscix0KXtpZih2b2lkIDA9PT1lW3JdLm92ZXJsb2FkVGFibGUpe3ZhciBuPWVbcl07ZVtyXT1mdW5jdGlvbigpe3JldHVybiBlW3JdLm92ZXJsb2FkVGFibGUuaGFzT3duUHJvcGVydHkoYXJndW1lbnRzLmxlbmd0aCl8fFBlKCJGdW5jdGlvbiAnIit0KyInIGNhbGxlZCB3aXRoIGFuIGludmFsaWQgbnVtYmVyIG9mIGFyZ3VtZW50cyAoIithcmd1bWVudHMubGVuZ3RoKyIpIC0gZXhwZWN0cyBvbmUgb2YgKCIrZVtyXS5vdmVybG9hZFRhYmxlKyIpISIpLGVbcl0ub3ZlcmxvYWRUYWJsZVthcmd1bWVudHMubGVuZ3RoXS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LGVbcl0ub3ZlcmxvYWRUYWJsZT1bXSxlW3JdLm92ZXJsb2FkVGFibGVbbi5hcmdDb3VudF09bn19ZnVuY3Rpb24gV2Uocix0LG4pe2UuaGFzT3duUHJvcGVydHkocik/KCh2b2lkIDA9PT1ufHx2b2lkIDAhPT1lW3JdLm92ZXJsb2FkVGFibGUmJnZvaWQgMCE9PWVbcl0ub3ZlcmxvYWRUYWJsZVtuXSkmJlBlKCJDYW5ub3QgcmVnaXN0ZXIgcHVibGljIG5hbWUgJyIrcisiJyB0d2ljZSIpLEJlKGUscixyKSxlLmhhc093blByb3BlcnR5KG4pJiZQZSgiQ2Fubm90IHJlZ2lzdGVyIG11bHRpcGxlIG92ZXJsb2FkcyBvZiBhIGZ1bmN0aW9uIHdpdGggdGhlIHNhbWUgbnVtYmVyIG9mIGFyZ3VtZW50cyAoIituKyIpISIpLGVbcl0ub3ZlcmxvYWRUYWJsZVtuXT10KTooZVtyXT10LHZvaWQgMCE9PW4mJihlW3JdLm51bUFyZ3VtZW50cz1uKSl9ZnVuY3Rpb24gTmUoZSxyLHQsbixvLGEsaSxzKXt0aGlzLm5hbWU9ZSx0aGlzLmNvbnN0cnVjdG9yPXIsdGhpcy5pbnN0YW5jZVByb3RvdHlwZT10LHRoaXMucmF3RGVzdHJ1Y3Rvcj1uLHRoaXMuYmFzZUNsYXNzPW8sdGhpcy5nZXRBY3R1YWxUeXBlPWEsdGhpcy51cGNhc3Q9aSx0aGlzLmRvd25jYXN0PXMsdGhpcy5wdXJlVmlydHVhbEZ1bmN0aW9ucz1bXX1mdW5jdGlvbiBMZShlLHIsdCl7Zm9yKDtyIT09dDspci51cGNhc3R8fFBlKCJFeHBlY3RlZCBudWxsIG9yIGluc3RhbmNlIG9mICIrdC5uYW1lKyIsIGdvdCBhbiBpbnN0YW5jZSBvZiAiK3IubmFtZSksZT1yLnVwY2FzdChlKSxyPXIuYmFzZUNsYXNzO3JldHVybiBlfWZ1bmN0aW9uIFVlKGUscil7aWYobnVsbD09PXIpcmV0dXJuIHRoaXMuaXNSZWZlcmVuY2UmJlBlKCJudWxsIGlzIG5vdCBhIHZhbGlkICIrdGhpcy5uYW1lKSwwO3IuJCR8fFBlKCdDYW5ub3QgcGFzcyAiJyt1cihyKSsnIiBhcyBhICcrdGhpcy5uYW1lKSxyLiQkLnB0cnx8UGUoIkNhbm5vdCBwYXNzIGRlbGV0ZWQgb2JqZWN0IGFzIGEgcG9pbnRlciBvZiB0eXBlICIrdGhpcy5uYW1lKTt2YXIgdD1yLiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzO3JldHVybiBMZShyLiQkLnB0cix0LHRoaXMucmVnaXN0ZXJlZENsYXNzKX1mdW5jdGlvbiBIZShlLHIpe3ZhciB0O2lmKG51bGw9PT1yKXJldHVybiB0aGlzLmlzUmVmZXJlbmNlJiZQZSgibnVsbCBpcyBub3QgYSB2YWxpZCAiK3RoaXMubmFtZSksdGhpcy5pc1NtYXJ0UG9pbnRlcj8odD10aGlzLnJhd0NvbnN0cnVjdG9yKCksbnVsbCE9PWUmJmUucHVzaCh0aGlzLnJhd0Rlc3RydWN0b3IsdCksdCk6MDtyLiQkfHxQZSgnQ2Fubm90IHBhc3MgIicrdXIocikrJyIgYXMgYSAnK3RoaXMubmFtZSksci4kJC5wdHJ8fFBlKCJDYW5ub3QgcGFzcyBkZWxldGVkIG9iamVjdCBhcyBhIHBvaW50ZXIgb2YgdHlwZSAiK3RoaXMubmFtZSksIXRoaXMuaXNDb25zdCYmci4kJC5wdHJUeXBlLmlzQ29uc3QmJlBlKCJDYW5ub3QgY29udmVydCBhcmd1bWVudCBvZiB0eXBlICIrKHIuJCQuc21hcnRQdHJUeXBlP3IuJCQuc21hcnRQdHJUeXBlLm5hbWU6ci4kJC5wdHJUeXBlLm5hbWUpKyIgdG8gcGFyYW1ldGVyIHR5cGUgIit0aGlzLm5hbWUpO3ZhciBuPXIuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3M7aWYodD1MZShyLiQkLnB0cixuLHRoaXMucmVnaXN0ZXJlZENsYXNzKSx0aGlzLmlzU21hcnRQb2ludGVyKXN3aXRjaCh2b2lkIDA9PT1yLiQkLnNtYXJ0UHRyJiZQZSgiUGFzc2luZyByYXcgcG9pbnRlciB0byBzbWFydCBwb2ludGVyIGlzIGlsbGVnYWwiKSx0aGlzLnNoYXJpbmdQb2xpY3kpe2Nhc2UgMDpyLiQkLnNtYXJ0UHRyVHlwZT09PXRoaXM/dD1yLiQkLnNtYXJ0UHRyOlBlKCJDYW5ub3QgY29udmVydCBhcmd1bWVudCBvZiB0eXBlICIrKHIuJCQuc21hcnRQdHJUeXBlP3IuJCQuc21hcnRQdHJUeXBlLm5hbWU6ci4kJC5wdHJUeXBlLm5hbWUpKyIgdG8gcGFyYW1ldGVyIHR5cGUgIit0aGlzLm5hbWUpO2JyZWFrO2Nhc2UgMTp0PXIuJCQuc21hcnRQdHI7YnJlYWs7Y2FzZSAyOmlmKHIuJCQuc21hcnRQdHJUeXBlPT09dGhpcyl0PXIuJCQuc21hcnRQdHI7ZWxzZXt2YXIgbz1yLmNsb25lKCk7dD10aGlzLnJhd1NoYXJlKHQsYXIudG9IYW5kbGUoKGZ1bmN0aW9uKCl7by5kZWxldGUoKX0pKSksbnVsbCE9PWUmJmUucHVzaCh0aGlzLnJhd0Rlc3RydWN0b3IsdCl9YnJlYWs7ZGVmYXVsdDpQZSgiVW5zdXBwb3J0aW5nIHNoYXJpbmcgcG9saWN5Iil9cmV0dXJuIHR9ZnVuY3Rpb24gVmUoZSxyKXtpZihudWxsPT09cilyZXR1cm4gdGhpcy5pc1JlZmVyZW5jZSYmUGUoIm51bGwgaXMgbm90IGEgdmFsaWQgIit0aGlzLm5hbWUpLDA7ci4kJHx8UGUoJ0Nhbm5vdCBwYXNzICInK3VyKHIpKyciIGFzIGEgJyt0aGlzLm5hbWUpLHIuJCQucHRyfHxQZSgiQ2Fubm90IHBhc3MgZGVsZXRlZCBvYmplY3QgYXMgYSBwb2ludGVyIG9mIHR5cGUgIit0aGlzLm5hbWUpLHIuJCQucHRyVHlwZS5pc0NvbnN0JiZQZSgiQ2Fubm90IGNvbnZlcnQgYXJndW1lbnQgb2YgdHlwZSAiK3IuJCQucHRyVHlwZS5uYW1lKyIgdG8gcGFyYW1ldGVyIHR5cGUgIit0aGlzLm5hbWUpO3ZhciB0PXIuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3M7cmV0dXJuIExlKHIuJCQucHRyLHQsdGhpcy5yZWdpc3RlcmVkQ2xhc3MpfWZ1bmN0aW9uIFllKGUscix0LG4sbyxhLGkscyx1LGMsbCl7dGhpcy5uYW1lPWUsdGhpcy5yZWdpc3RlcmVkQ2xhc3M9cix0aGlzLmlzUmVmZXJlbmNlPXQsdGhpcy5pc0NvbnN0PW4sdGhpcy5pc1NtYXJ0UG9pbnRlcj1vLHRoaXMucG9pbnRlZVR5cGU9YSx0aGlzLnNoYXJpbmdQb2xpY3k9aSx0aGlzLnJhd0dldFBvaW50ZWU9cyx0aGlzLnJhd0NvbnN0cnVjdG9yPXUsdGhpcy5yYXdTaGFyZT1jLHRoaXMucmF3RGVzdHJ1Y3Rvcj1sLG98fHZvaWQgMCE9PXIuYmFzZUNsYXNzP3RoaXMudG9XaXJlVHlwZT1IZTpuPyh0aGlzLnRvV2lyZVR5cGU9VWUsdGhpcy5kZXN0cnVjdG9yRnVuY3Rpb249bnVsbCk6KHRoaXMudG9XaXJlVHlwZT1WZSx0aGlzLmRlc3RydWN0b3JGdW5jdGlvbj1udWxsKX1mdW5jdGlvbiBxZShyLHQsbil7ZS5oYXNPd25Qcm9wZXJ0eShyKXx8d2UoIlJlcGxhY2luZyBub25leGlzdGFudCBwdWJsaWMgc3ltYm9sIiksdm9pZCAwIT09ZVtyXS5vdmVybG9hZFRhYmxlJiZ2b2lkIDAhPT1uP2Vbcl0ub3ZlcmxvYWRUYWJsZVtuXT10OihlW3JdPXQsZVtyXS5hcmdDb3VudD1uKX1mdW5jdGlvbiBHZShyLHQsbil7cmV0dXJuIHIuaW5jbHVkZXMoImoiKT9mdW5jdGlvbihyLHQsbil7dmFyIG89ZVsiZHluQ2FsbF8iK3JdO3JldHVybiBuJiZuLmxlbmd0aD9vLmFwcGx5KG51bGwsW3RdLmNvbmNhdChuKSk6by5jYWxsKG51bGwsdCl9KHIsdCxuKTpyZSh0KS5hcHBseShudWxsLG4pfWZ1bmN0aW9uIFhlKGUscil7dmFyIHQsbixvLGE9KGU9YmUoZSkpLmluY2x1ZGVzKCJqIik/KHQ9ZSxuPXIsbz1bXSxmdW5jdGlvbigpe3JldHVybiBvLmxlbmd0aD0wLE9iamVjdC5hc3NpZ24obyxhcmd1bWVudHMpLEdlKHQsbixvKX0pOnJlKHIpO3JldHVybiJmdW5jdGlvbiIhPXR5cGVvZiBhJiZQZSgidW5rbm93biBmdW5jdGlvbiBwb2ludGVyIHdpdGggc2lnbmF0dXJlICIrZSsiOiAiK3IpLGF9dmFyIEplPXZvaWQgMDtmdW5jdGlvbiBRZShlKXt2YXIgcj1PcihlKSx0PWJlKHIpO3JldHVybiB4cihyKSx0fWZ1bmN0aW9uIEtlKGUscil7dmFyIHQ9W10sbj17fTt0aHJvdyByLmZvckVhY2goKGZ1bmN0aW9uIGUocil7bltyXXx8ZmVbcl18fChwZVtyXT9wZVtyXS5mb3JFYWNoKGUpOih0LnB1c2gociksbltyXT0hMCkpfSkpLG5ldyBKZShlKyI6ICIrdC5tYXAoUWUpLmpvaW4oWyIsICJdKSl9ZnVuY3Rpb24gWmUoZSxyKXtpZighKGUgaW5zdGFuY2VvZiBGdW5jdGlvbikpdGhyb3cgbmV3IFR5cGVFcnJvcigibmV3XyBjYWxsZWQgd2l0aCBjb25zdHJ1Y3RvciB0eXBlICIrdHlwZW9mIGUrIiB3aGljaCBpcyBub3QgYSBmdW5jdGlvbiIpO3ZhciB0PW1lKGUubmFtZXx8InVua25vd25GdW5jdGlvbk5hbWUiLChmdW5jdGlvbigpe30pKTt0LnByb3RvdHlwZT1lLnByb3RvdHlwZTt2YXIgbj1uZXcgdCxvPWUuYXBwbHkobixyKTtyZXR1cm4gbyBpbnN0YW5jZW9mIE9iamVjdD9vOm59ZnVuY3Rpb24gZXIoZSxyLHQsbixvKXt2YXIgYT1yLmxlbmd0aDthPDImJlBlKCJhcmdUeXBlcyBhcnJheSBzaXplIG1pc21hdGNoISBNdXN0IGF0IGxlYXN0IGdldCByZXR1cm4gdmFsdWUgYW5kICd0aGlzJyB0eXBlcyEiKTtmb3IodmFyIGk9bnVsbCE9PXJbMV0mJm51bGwhPT10LHM9ITEsdT0xO3U8ci5sZW5ndGg7Kyt1KWlmKG51bGwhPT1yW3VdJiZ2b2lkIDA9PT1yW3VdLmRlc3RydWN0b3JGdW5jdGlvbil7cz0hMDticmVha312YXIgYz0idm9pZCIhPT1yWzBdLm5hbWUsbD0iIixkPSIiO2Zvcih1PTA7dTxhLTI7Kyt1KWwrPSgwIT09dT8iLCAiOiIiKSsiYXJnIit1LGQrPSgwIT09dT8iLCAiOiIiKSsiYXJnIit1KyJXaXJlZCI7dmFyIGY9InJldHVybiBmdW5jdGlvbiAiK2hlKGUpKyIoIitsKyIpIHtcbmlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAiKyhhLTIpKyIpIHtcbnRocm93QmluZGluZ0Vycm9yKCdmdW5jdGlvbiAiK2UrIiBjYWxsZWQgd2l0aCAnICsgYXJndW1lbnRzLmxlbmd0aCArICcgYXJndW1lbnRzLCBleHBlY3RlZCAiKyhhLTIpKyIgYXJncyEnKTtcbn1cbiI7cyYmKGYrPSJ2YXIgZGVzdHJ1Y3RvcnMgPSBbXTtcbiIpO3ZhciBwPXM/ImRlc3RydWN0b3JzIjoibnVsbCIsaD1bInRocm93QmluZGluZ0Vycm9yIiwiaW52b2tlciIsImZuIiwicnVuRGVzdHJ1Y3RvcnMiLCJyZXRUeXBlIiwiY2xhc3NQYXJhbSJdLG09W1BlLG4sbyxjZSxyWzBdLHJbMV1dO2ZvcihpJiYoZis9InZhciB0aGlzV2lyZWQgPSBjbGFzc1BhcmFtLnRvV2lyZVR5cGUoIitwKyIsIHRoaXMpO1xuIiksdT0wO3U8YS0yOysrdSlmKz0idmFyIGFyZyIrdSsiV2lyZWQgPSBhcmdUeXBlIit1KyIudG9XaXJlVHlwZSgiK3ArIiwgYXJnIit1KyIpOyAvLyAiK3JbdSsyXS5uYW1lKyJcbiIsaC5wdXNoKCJhcmdUeXBlIit1KSxtLnB1c2goclt1KzJdKTtpZihpJiYoZD0idGhpc1dpcmVkIisoZC5sZW5ndGg+MD8iLCAiOiIiKStkKSxmKz0oYz8idmFyIHJ2ID0gIjoiIikrImludm9rZXIoZm4iKyhkLmxlbmd0aD4wPyIsICI6IiIpK2QrIik7XG4iLHMpZis9InJ1bkRlc3RydWN0b3JzKGRlc3RydWN0b3JzKTtcbiI7ZWxzZSBmb3IodT1pPzE6Mjt1PHIubGVuZ3RoOysrdSl7dmFyIHY9MT09PXU/InRoaXNXaXJlZCI6ImFyZyIrKHUtMikrIldpcmVkIjtudWxsIT09clt1XS5kZXN0cnVjdG9yRnVuY3Rpb24mJihmKz12KyJfZHRvcigiK3YrIik7IC8vICIrclt1XS5uYW1lKyJcbiIsaC5wdXNoKHYrIl9kdG9yIiksbS5wdXNoKHJbdV0uZGVzdHJ1Y3RvckZ1bmN0aW9uKSl9cmV0dXJuIGMmJihmKz0idmFyIHJldCA9IHJldFR5cGUuZnJvbVdpcmVUeXBlKHJ2KTtcbnJldHVybiByZXQ7XG4iKSxmKz0ifVxuIixoLnB1c2goZiksWmUoRnVuY3Rpb24saCkuYXBwbHkobnVsbCxtKX1mdW5jdGlvbiBycihlLHIpe2Zvcih2YXIgdD1bXSxuPTA7bjxlO24rKyl0LnB1c2goRFsocj4+Mikrbl0pO3JldHVybiB0fXZhciB0cj1bXSxucj1be30se3ZhbHVlOnZvaWQgMH0se3ZhbHVlOm51bGx9LHt2YWx1ZTohMH0se3ZhbHVlOiExfV07ZnVuY3Rpb24gb3IoZSl7ZT40JiYwPT0tLW5yW2VdLnJlZmNvdW50JiYobnJbZV09dm9pZCAwLHRyLnB1c2goZSkpfXZhciBhcj17dG9WYWx1ZTplPT4oZXx8UGUoIkNhbm5vdCB1c2UgZGVsZXRlZCB2YWwuIGhhbmRsZSA9ICIrZSksbnJbZV0udmFsdWUpLHRvSGFuZGxlOmU9Pntzd2l0Y2goZSl7Y2FzZSB2b2lkIDA6cmV0dXJuIDE7Y2FzZSBudWxsOnJldHVybiAyO2Nhc2UhMDpyZXR1cm4gMztjYXNlITE6cmV0dXJuIDQ7ZGVmYXVsdDp2YXIgcj10ci5sZW5ndGg/dHIucG9wKCk6bnIubGVuZ3RoO3JldHVybiBucltyXT17cmVmY291bnQ6MSx2YWx1ZTplfSxyfX19O2Z1bmN0aW9uIGlyKGUscix0KXtzd2l0Y2gocil7Y2FzZSAwOnJldHVybiBmdW5jdGlvbihlKXt2YXIgcj10P1A6VDtyZXR1cm4gdGhpcy5mcm9tV2lyZVR5cGUocltlXSl9O2Nhc2UgMTpyZXR1cm4gZnVuY3Rpb24oZSl7dmFyIHI9dD9TOkM7cmV0dXJuIHRoaXMuZnJvbVdpcmVUeXBlKHJbZT4+MV0pfTtjYXNlIDI6cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciByPXQ/RDpGO3JldHVybiB0aGlzLmZyb21XaXJlVHlwZShyW2U+PjJdKX07ZGVmYXVsdDp0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIGludGVnZXIgdHlwZTogIitlKX19ZnVuY3Rpb24gc3IoZSxyKXt2YXIgdD1mZVtlXTtyZXR1cm4gdm9pZCAwPT09dCYmUGUocisiIGhhcyB1bmtub3duIHR5cGUgIitRZShlKSksdH1mdW5jdGlvbiB1cihlKXtpZihudWxsPT09ZSlyZXR1cm4ibnVsbCI7dmFyIHI9dHlwZW9mIGU7cmV0dXJuIm9iamVjdCI9PT1yfHwiYXJyYXkiPT09cnx8ImZ1bmN0aW9uIj09PXI/ZS50b1N0cmluZygpOiIiK2V9ZnVuY3Rpb24gY3IoZSxyKXtzd2l0Y2gocil7Y2FzZSAyOnJldHVybiBmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5mcm9tV2lyZVR5cGUoQVtlPj4yXSl9O2Nhc2UgMzpyZXR1cm4gZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZnJvbVdpcmVUeXBlKE1bZT4+M10pfTtkZWZhdWx0OnRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gZmxvYXQgdHlwZTogIitlKX19ZnVuY3Rpb24gbHIoZSxyLHQpe3N3aXRjaChyKXtjYXNlIDA6cmV0dXJuIHQ/ZnVuY3Rpb24oZSl7cmV0dXJuIFBbZV19OmZ1bmN0aW9uKGUpe3JldHVybiBUW2VdfTtjYXNlIDE6cmV0dXJuIHQ/ZnVuY3Rpb24oZSl7cmV0dXJuIFNbZT4+MV19OmZ1bmN0aW9uKGUpe3JldHVybiBDW2U+PjFdfTtjYXNlIDI6cmV0dXJuIHQ/ZnVuY3Rpb24oZSl7cmV0dXJuIERbZT4+Ml19OmZ1bmN0aW9uKGUpe3JldHVybiBGW2U+PjJdfTtkZWZhdWx0OnRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gaW50ZWdlciB0eXBlOiAiK2UpfX12YXIgZHI9e307ZnVuY3Rpb24gZnIoZSl7dmFyIHI9ZHJbZV07cmV0dXJuIHZvaWQgMD09PXI/YmUoZSk6cn12YXIgcHIsaHI9W10sbXI9W107cHI9KCk9PnBlcmZvcm1hbmNlLm5vdygpO3ZhciB2cj17fTtmdW5jdGlvbiB5cigpe2lmKCF5ci5zdHJpbmdzKXt2YXIgZT17VVNFUjoid2ViX3VzZXIiLExPR05BTUU6IndlYl91c2VyIixQQVRIOiIvIixQV0Q6Ii8iLEhPTUU6Ii9ob21lL3dlYl91c2VyIixMQU5HOigib2JqZWN0Ij09dHlwZW9mIG5hdmlnYXRvciYmbmF2aWdhdG9yLmxhbmd1YWdlcyYmbmF2aWdhdG9yLmxhbmd1YWdlc1swXXx8IkMiKS5yZXBsYWNlKCItIiwiXyIpKyIuVVRGLTgiLF86dXx8Ii4vdGhpcy5wcm9ncmFtIn07Zm9yKHZhciByIGluIHZyKXZvaWQgMD09PXZyW3JdP2RlbGV0ZSBlW3JdOmVbcl09dnJbcl07dmFyIHQ9W107Zm9yKHZhciByIGluIGUpdC5wdXNoKHIrIj0iK2Vbcl0pO3lyLnN0cmluZ3M9dH1yZXR1cm4geXIuc3RyaW5nc312YXIgd3I9e2lzQWJzOmU9PiIvIj09PWUuY2hhckF0KDApLHNwbGl0UGF0aDplPT4vXihcLz98KShbXHNcU10qPykoKD86XC57MSwyfXxbXlwvXSs/fCkoXC5bXi5cL10qfCkpKD86W1wvXSopJC8uZXhlYyhlKS5zbGljZSgxKSxub3JtYWxpemVBcnJheTooZSxyKT0+e2Zvcih2YXIgdD0wLG49ZS5sZW5ndGgtMTtuPj0wO24tLSl7dmFyIG89ZVtuXTsiLiI9PT1vP2Uuc3BsaWNlKG4sMSk6Ii4uIj09PW8/KGUuc3BsaWNlKG4sMSksdCsrKTp0JiYoZS5zcGxpY2UobiwxKSx0LS0pfWlmKHIpZm9yKDt0O3QtLSllLnVuc2hpZnQoIi4uIik7cmV0dXJuIGV9LG5vcm1hbGl6ZTplPT57dmFyIHI9d3IuaXNBYnMoZSksdD0iLyI9PT1lLnN1YnN0cigtMSk7cmV0dXJuKGU9d3Iubm9ybWFsaXplQXJyYXkoZS5zcGxpdCgiLyIpLmZpbHRlcigoZT0+ISFlKSksIXIpLmpvaW4oIi8iKSl8fHJ8fChlPSIuIiksZSYmdCYmKGUrPSIvIiksKHI/Ii8iOiIiKStlfSxkaXJuYW1lOmU9Pnt2YXIgcj13ci5zcGxpdFBhdGgoZSksdD1yWzBdLG49clsxXTtyZXR1cm4gdHx8bj8obiYmKG49bi5zdWJzdHIoMCxuLmxlbmd0aC0xKSksdCtuKToiLiJ9LGJhc2VuYW1lOmU9PntpZigiLyI9PT1lKXJldHVybiIvIjt2YXIgcj0oZT0oZT13ci5ub3JtYWxpemUoZSkpLnJlcGxhY2UoL1wvJC8sIiIpKS5sYXN0SW5kZXhPZigiLyIpO3JldHVybi0xPT09cj9lOmUuc3Vic3RyKHIrMSl9LGpvaW46ZnVuY3Rpb24oKXt2YXIgZT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMCk7cmV0dXJuIHdyLm5vcm1hbGl6ZShlLmpvaW4oIi8iKSl9LGpvaW4yOihlLHIpPT53ci5ub3JtYWxpemUoZSsiLyIrcil9LGdyPXtyZXNvbHZlOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPSIiLHI9ITEsdD1hcmd1bWVudHMubGVuZ3RoLTE7dD49LTEmJiFyO3QtLSl7dmFyIG49dD49MD9hcmd1bWVudHNbdF06YnIuY3dkKCk7aWYoInN0cmluZyIhPXR5cGVvZiBuKXRocm93IG5ldyBUeXBlRXJyb3IoIkFyZ3VtZW50cyB0byBwYXRoLnJlc29sdmUgbXVzdCBiZSBzdHJpbmdzIik7aWYoIW4pcmV0dXJuIiI7ZT1uKyIvIitlLHI9d3IuaXNBYnMobil9cmV0dXJuKHI/Ii8iOiIiKSsoZT13ci5ub3JtYWxpemVBcnJheShlLnNwbGl0KCIvIikuZmlsdGVyKChlPT4hIWUpKSwhcikuam9pbigiLyIpKXx8Ii4ifSxyZWxhdGl2ZTooZSxyKT0+e2Z1bmN0aW9uIHQoZSl7Zm9yKHZhciByPTA7cjxlLmxlbmd0aCYmIiI9PT1lW3JdO3IrKyk7Zm9yKHZhciB0PWUubGVuZ3RoLTE7dD49MCYmIiI9PT1lW3RdO3QtLSk7cmV0dXJuIHI+dD9bXTplLnNsaWNlKHIsdC1yKzEpfWU9Z3IucmVzb2x2ZShlKS5zdWJzdHIoMSkscj1nci5yZXNvbHZlKHIpLnN1YnN0cigxKTtmb3IodmFyIG49dChlLnNwbGl0KCIvIikpLG89dChyLnNwbGl0KCIvIikpLGE9TWF0aC5taW4obi5sZW5ndGgsby5sZW5ndGgpLGk9YSxzPTA7czxhO3MrKylpZihuW3NdIT09b1tzXSl7aT1zO2JyZWFrfXZhciB1PVtdO2ZvcihzPWk7czxuLmxlbmd0aDtzKyspdS5wdXNoKCIuLiIpO3JldHVybih1PXUuY29uY2F0KG8uc2xpY2UoaSkpKS5qb2luKCIvIil9fSxFcj17dHR5czpbXSxpbml0OmZ1bmN0aW9uKCl7fSxzaHV0ZG93bjpmdW5jdGlvbigpe30scmVnaXN0ZXI6ZnVuY3Rpb24oZSxyKXtFci50dHlzW2VdPXtpbnB1dDpbXSxvdXRwdXQ6W10sb3BzOnJ9LGJyLnJlZ2lzdGVyRGV2aWNlKGUsRXIuc3RyZWFtX29wcyl9LHN0cmVhbV9vcHM6e29wZW46ZnVuY3Rpb24oZSl7dmFyIHI9RXIudHR5c1tlLm5vZGUucmRldl07aWYoIXIpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoNDMpO2UudHR5PXIsZS5zZWVrYWJsZT0hMX0sY2xvc2U6ZnVuY3Rpb24oZSl7ZS50dHkub3BzLmZsdXNoKGUudHR5KX0sZmx1c2g6ZnVuY3Rpb24oZSl7ZS50dHkub3BzLmZsdXNoKGUudHR5KX0scmVhZDpmdW5jdGlvbihlLHIsdCxuLG8pe2lmKCFlLnR0eXx8IWUudHR5Lm9wcy5nZXRfY2hhcil0aHJvdyBuZXcgYnIuRXJybm9FcnJvcig2MCk7Zm9yKHZhciBhPTAsaT0wO2k8bjtpKyspe3ZhciBzO3RyeXtzPWUudHR5Lm9wcy5nZXRfY2hhcihlLnR0eSl9Y2F0Y2goZSl7dGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoMjkpfWlmKHZvaWQgMD09PXMmJjA9PT1hKXRocm93IG5ldyBici5FcnJub0Vycm9yKDYpO2lmKG51bGw9PXMpYnJlYWs7YSsrLHJbdCtpXT1zfXJldHVybiBhJiYoZS5ub2RlLnRpbWVzdGFtcD1EYXRlLm5vdygpKSxhfSx3cml0ZTpmdW5jdGlvbihlLHIsdCxuLG8pe2lmKCFlLnR0eXx8IWUudHR5Lm9wcy5wdXRfY2hhcil0aHJvdyBuZXcgYnIuRXJybm9FcnJvcig2MCk7dHJ5e2Zvcih2YXIgYT0wO2E8bjthKyspZS50dHkub3BzLnB1dF9jaGFyKGUudHR5LHJbdCthXSl9Y2F0Y2goZSl7dGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoMjkpfXJldHVybiBuJiYoZS5ub2RlLnRpbWVzdGFtcD1EYXRlLm5vdygpKSxhfX0sZGVmYXVsdF90dHlfb3BzOntnZXRfY2hhcjpmdW5jdGlvbihlKXtpZighZS5pbnB1dC5sZW5ndGgpe3ZhciByPW51bGw7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJiJmdW5jdGlvbiI9PXR5cGVvZiB3aW5kb3cucHJvbXB0P251bGwhPT0ocj13aW5kb3cucHJvbXB0KCJJbnB1dDogIikpJiYocis9IlxuIik6ImZ1bmN0aW9uIj09dHlwZW9mIHJlYWRsaW5lJiZudWxsIT09KHI9cmVhZGxpbmUoKSkmJihyKz0iXG4iKSwhcilyZXR1cm4gbnVsbDtlLmlucHV0PURyKHIsITApfXJldHVybiBlLmlucHV0LnNoaWZ0KCl9LHB1dF9jaGFyOmZ1bmN0aW9uKGUscil7bnVsbD09PXJ8fDEwPT09cj8obCh3KGUub3V0cHV0LDApKSxlLm91dHB1dD1bXSk6MCE9ciYmZS5vdXRwdXQucHVzaChyKX0sZmx1c2g6ZnVuY3Rpb24oZSl7ZS5vdXRwdXQmJmUub3V0cHV0Lmxlbmd0aD4wJiYobCh3KGUub3V0cHV0LDApKSxlLm91dHB1dD1bXSl9fSxkZWZhdWx0X3R0eTFfb3BzOntwdXRfY2hhcjpmdW5jdGlvbihlLHIpe251bGw9PT1yfHwxMD09PXI/KGQodyhlLm91dHB1dCwwKSksZS5vdXRwdXQ9W10pOjAhPXImJmUub3V0cHV0LnB1c2gocil9LGZsdXNoOmZ1bmN0aW9uKGUpe2Uub3V0cHV0JiZlLm91dHB1dC5sZW5ndGg+MCYmKGQodyhlLm91dHB1dCwwKSksZS5vdXRwdXQ9W10pfX19O3ZhciBfcj17b3BzX3RhYmxlOm51bGwsbW91bnQ6ZnVuY3Rpb24oZSl7cmV0dXJuIF9yLmNyZWF0ZU5vZGUobnVsbCwiLyIsMTY4OTUsMCl9LGNyZWF0ZU5vZGU6ZnVuY3Rpb24oZSxyLHQsbil7aWYoYnIuaXNCbGtkZXYodCl8fGJyLmlzRklGTyh0KSl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcig2Myk7X3Iub3BzX3RhYmxlfHwoX3Iub3BzX3RhYmxlPXtkaXI6e25vZGU6e2dldGF0dHI6X3Iubm9kZV9vcHMuZ2V0YXR0cixzZXRhdHRyOl9yLm5vZGVfb3BzLnNldGF0dHIsbG9va3VwOl9yLm5vZGVfb3BzLmxvb2t1cCxta25vZDpfci5ub2RlX29wcy5ta25vZCxyZW5hbWU6X3Iubm9kZV9vcHMucmVuYW1lLHVubGluazpfci5ub2RlX29wcy51bmxpbmsscm1kaXI6X3Iubm9kZV9vcHMucm1kaXIscmVhZGRpcjpfci5ub2RlX29wcy5yZWFkZGlyLHN5bWxpbms6X3Iubm9kZV9vcHMuc3ltbGlua30sc3RyZWFtOntsbHNlZWs6X3Iuc3RyZWFtX29wcy5sbHNlZWt9fSxmaWxlOntub2RlOntnZXRhdHRyOl9yLm5vZGVfb3BzLmdldGF0dHIsc2V0YXR0cjpfci5ub2RlX29wcy5zZXRhdHRyfSxzdHJlYW06e2xsc2Vlazpfci5zdHJlYW1fb3BzLmxsc2VlayxyZWFkOl9yLnN0cmVhbV9vcHMucmVhZCx3cml0ZTpfci5zdHJlYW1fb3BzLndyaXRlLGFsbG9jYXRlOl9yLnN0cmVhbV9vcHMuYWxsb2NhdGUsbW1hcDpfci5zdHJlYW1fb3BzLm1tYXAsbXN5bmM6X3Iuc3RyZWFtX29wcy5tc3luY319LGxpbms6e25vZGU6e2dldGF0dHI6X3Iubm9kZV9vcHMuZ2V0YXR0cixzZXRhdHRyOl9yLm5vZGVfb3BzLnNldGF0dHIscmVhZGxpbms6X3Iubm9kZV9vcHMucmVhZGxpbmt9LHN0cmVhbTp7fX0sY2hyZGV2Ontub2RlOntnZXRhdHRyOl9yLm5vZGVfb3BzLmdldGF0dHIsc2V0YXR0cjpfci5ub2RlX29wcy5zZXRhdHRyfSxzdHJlYW06YnIuY2hyZGV2X3N0cmVhbV9vcHN9fSk7dmFyIG89YnIuY3JlYXRlTm9kZShlLHIsdCxuKTtyZXR1cm4gYnIuaXNEaXIoby5tb2RlKT8oby5ub2RlX29wcz1fci5vcHNfdGFibGUuZGlyLm5vZGUsby5zdHJlYW1fb3BzPV9yLm9wc190YWJsZS5kaXIuc3RyZWFtLG8uY29udGVudHM9e30pOmJyLmlzRmlsZShvLm1vZGUpPyhvLm5vZGVfb3BzPV9yLm9wc190YWJsZS5maWxlLm5vZGUsby5zdHJlYW1fb3BzPV9yLm9wc190YWJsZS5maWxlLnN0cmVhbSxvLnVzZWRCeXRlcz0wLG8uY29udGVudHM9bnVsbCk6YnIuaXNMaW5rKG8ubW9kZSk/KG8ubm9kZV9vcHM9X3Iub3BzX3RhYmxlLmxpbmsubm9kZSxvLnN0cmVhbV9vcHM9X3Iub3BzX3RhYmxlLmxpbmsuc3RyZWFtKTpici5pc0NocmRldihvLm1vZGUpJiYoby5ub2RlX29wcz1fci5vcHNfdGFibGUuY2hyZGV2Lm5vZGUsby5zdHJlYW1fb3BzPV9yLm9wc190YWJsZS5jaHJkZXYuc3RyZWFtKSxvLnRpbWVzdGFtcD1EYXRlLm5vdygpLGUmJihlLmNvbnRlbnRzW3JdPW8sZS50aW1lc3RhbXA9by50aW1lc3RhbXApLG99LGdldEZpbGVEYXRhQXNUeXBlZEFycmF5OmZ1bmN0aW9uKGUpe3JldHVybiBlLmNvbnRlbnRzP2UuY29udGVudHMuc3ViYXJyYXk/ZS5jb250ZW50cy5zdWJhcnJheSgwLGUudXNlZEJ5dGVzKTpuZXcgVWludDhBcnJheShlLmNvbnRlbnRzKTpuZXcgVWludDhBcnJheSgwKX0sZXhwYW5kRmlsZVN0b3JhZ2U6ZnVuY3Rpb24oZSxyKXt2YXIgdD1lLmNvbnRlbnRzP2UuY29udGVudHMubGVuZ3RoOjA7aWYoISh0Pj1yKSl7cj1NYXRoLm1heChyLHQqKHQ8MTA0ODU3Nj8yOjEuMTI1KT4+PjApLDAhPXQmJihyPU1hdGgubWF4KHIsMjU2KSk7dmFyIG49ZS5jb250ZW50cztlLmNvbnRlbnRzPW5ldyBVaW50OEFycmF5KHIpLGUudXNlZEJ5dGVzPjAmJmUuY29udGVudHMuc2V0KG4uc3ViYXJyYXkoMCxlLnVzZWRCeXRlcyksMCl9fSxyZXNpemVGaWxlU3RvcmFnZTpmdW5jdGlvbihlLHIpe2lmKGUudXNlZEJ5dGVzIT1yKWlmKDA9PXIpZS5jb250ZW50cz1udWxsLGUudXNlZEJ5dGVzPTA7ZWxzZXt2YXIgdD1lLmNvbnRlbnRzO2UuY29udGVudHM9bmV3IFVpbnQ4QXJyYXkociksdCYmZS5jb250ZW50cy5zZXQodC5zdWJhcnJheSgwLE1hdGgubWluKHIsZS51c2VkQnl0ZXMpKSksZS51c2VkQnl0ZXM9cn19LG5vZGVfb3BzOntnZXRhdHRyOmZ1bmN0aW9uKGUpe3ZhciByPXt9O3JldHVybiByLmRldj1ici5pc0NocmRldihlLm1vZGUpP2UuaWQ6MSxyLmlubz1lLmlkLHIubW9kZT1lLm1vZGUsci5ubGluaz0xLHIudWlkPTAsci5naWQ9MCxyLnJkZXY9ZS5yZGV2LGJyLmlzRGlyKGUubW9kZSk/ci5zaXplPTQwOTY6YnIuaXNGaWxlKGUubW9kZSk/ci5zaXplPWUudXNlZEJ5dGVzOmJyLmlzTGluayhlLm1vZGUpP3Iuc2l6ZT1lLmxpbmsubGVuZ3RoOnIuc2l6ZT0wLHIuYXRpbWU9bmV3IERhdGUoZS50aW1lc3RhbXApLHIubXRpbWU9bmV3IERhdGUoZS50aW1lc3RhbXApLHIuY3RpbWU9bmV3IERhdGUoZS50aW1lc3RhbXApLHIuYmxrc2l6ZT00MDk2LHIuYmxvY2tzPU1hdGguY2VpbChyLnNpemUvci5ibGtzaXplKSxyfSxzZXRhdHRyOmZ1bmN0aW9uKGUscil7dm9pZCAwIT09ci5tb2RlJiYoZS5tb2RlPXIubW9kZSksdm9pZCAwIT09ci50aW1lc3RhbXAmJihlLnRpbWVzdGFtcD1yLnRpbWVzdGFtcCksdm9pZCAwIT09ci5zaXplJiZfci5yZXNpemVGaWxlU3RvcmFnZShlLHIuc2l6ZSl9LGxvb2t1cDpmdW5jdGlvbihlLHIpe3Rocm93IGJyLmdlbmVyaWNFcnJvcnNbNDRdfSxta25vZDpmdW5jdGlvbihlLHIsdCxuKXtyZXR1cm4gX3IuY3JlYXRlTm9kZShlLHIsdCxuKX0scmVuYW1lOmZ1bmN0aW9uKGUscix0KXtpZihici5pc0RpcihlLm1vZGUpKXt2YXIgbjt0cnl7bj1ici5sb29rdXBOb2RlKHIsdCl9Y2F0Y2goZSl7fWlmKG4pZm9yKHZhciBvIGluIG4uY29udGVudHMpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoNTUpfWRlbGV0ZSBlLnBhcmVudC5jb250ZW50c1tlLm5hbWVdLGUucGFyZW50LnRpbWVzdGFtcD1EYXRlLm5vdygpLGUubmFtZT10LHIuY29udGVudHNbdF09ZSxyLnRpbWVzdGFtcD1lLnBhcmVudC50aW1lc3RhbXAsZS5wYXJlbnQ9cn0sdW5saW5rOmZ1bmN0aW9uKGUscil7ZGVsZXRlIGUuY29udGVudHNbcl0sZS50aW1lc3RhbXA9RGF0ZS5ub3coKX0scm1kaXI6ZnVuY3Rpb24oZSxyKXt2YXIgdD1ici5sb29rdXBOb2RlKGUscik7Zm9yKHZhciBuIGluIHQuY29udGVudHMpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoNTUpO2RlbGV0ZSBlLmNvbnRlbnRzW3JdLGUudGltZXN0YW1wPURhdGUubm93KCl9LHJlYWRkaXI6ZnVuY3Rpb24oZSl7dmFyIHI9WyIuIiwiLi4iXTtmb3IodmFyIHQgaW4gZS5jb250ZW50cyllLmNvbnRlbnRzLmhhc093blByb3BlcnR5KHQpJiZyLnB1c2godCk7cmV0dXJuIHJ9LHN5bWxpbms6ZnVuY3Rpb24oZSxyLHQpe3ZhciBuPV9yLmNyZWF0ZU5vZGUoZSxyLDQxNDcxLDApO3JldHVybiBuLmxpbms9dCxufSxyZWFkbGluazpmdW5jdGlvbihlKXtpZighYnIuaXNMaW5rKGUubW9kZSkpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoMjgpO3JldHVybiBlLmxpbmt9fSxzdHJlYW1fb3BzOntyZWFkOmZ1bmN0aW9uKGUscix0LG4sbyl7dmFyIGE9ZS5ub2RlLmNvbnRlbnRzO2lmKG8+PWUubm9kZS51c2VkQnl0ZXMpcmV0dXJuIDA7dmFyIGk9TWF0aC5taW4oZS5ub2RlLnVzZWRCeXRlcy1vLG4pO2lmKGk+OCYmYS5zdWJhcnJheSlyLnNldChhLnN1YmFycmF5KG8sbytpKSx0KTtlbHNlIGZvcih2YXIgcz0wO3M8aTtzKyspclt0K3NdPWFbbytzXTtyZXR1cm4gaX0sd3JpdGU6ZnVuY3Rpb24oZSxyLHQsbixvLGEpe2lmKCFuKXJldHVybiAwO3ZhciBpPWUubm9kZTtpZihpLnRpbWVzdGFtcD1EYXRlLm5vdygpLHIuc3ViYXJyYXkmJighaS5jb250ZW50c3x8aS5jb250ZW50cy5zdWJhcnJheSkpe2lmKGEpcmV0dXJuIGkuY29udGVudHM9ci5zdWJhcnJheSh0LHQrbiksaS51c2VkQnl0ZXM9bixuO2lmKDA9PT1pLnVzZWRCeXRlcyYmMD09PW8pcmV0dXJuIGkuY29udGVudHM9ci5zbGljZSh0LHQrbiksaS51c2VkQnl0ZXM9bixuO2lmKG8rbjw9aS51c2VkQnl0ZXMpcmV0dXJuIGkuY29udGVudHMuc2V0KHIuc3ViYXJyYXkodCx0K24pLG8pLG59aWYoX3IuZXhwYW5kRmlsZVN0b3JhZ2UoaSxvK24pLGkuY29udGVudHMuc3ViYXJyYXkmJnIuc3ViYXJyYXkpaS5jb250ZW50cy5zZXQoci5zdWJhcnJheSh0LHQrbiksbyk7ZWxzZSBmb3IodmFyIHM9MDtzPG47cysrKWkuY29udGVudHNbbytzXT1yW3Qrc107cmV0dXJuIGkudXNlZEJ5dGVzPU1hdGgubWF4KGkudXNlZEJ5dGVzLG8rbiksbn0sbGxzZWVrOmZ1bmN0aW9uKGUscix0KXt2YXIgbj1yO2lmKDE9PT10P24rPWUucG9zaXRpb246Mj09PXQmJmJyLmlzRmlsZShlLm5vZGUubW9kZSkmJihuKz1lLm5vZGUudXNlZEJ5dGVzKSxuPDApdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoMjgpO3JldHVybiBufSxhbGxvY2F0ZTpmdW5jdGlvbihlLHIsdCl7X3IuZXhwYW5kRmlsZVN0b3JhZ2UoZS5ub2RlLHIrdCksZS5ub2RlLnVzZWRCeXRlcz1NYXRoLm1heChlLm5vZGUudXNlZEJ5dGVzLHIrdCl9LG1tYXA6ZnVuY3Rpb24oZSxyLHQsbixvLGEpe2lmKDAhPT1yKXRocm93IG5ldyBici5FcnJub0Vycm9yKDI4KTtpZighYnIuaXNGaWxlKGUubm9kZS5tb2RlKSl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcig0Myk7dmFyIGkscyx1PWUubm9kZS5jb250ZW50cztpZigyJmF8fHUuYnVmZmVyIT09ayl7aWYoKG4+MHx8bit0PHUubGVuZ3RoKSYmKHU9dS5zdWJhcnJheT91LnN1YmFycmF5KG4sbit0KTpBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCh1LG4sbit0KSkscz0hMCwhKGk9ZnVuY3Rpb24oZSl7ZT1mdW5jdGlvbihlLHIpe3JldHVybiA2NTUzNipNYXRoLmNlaWwoZS82NTUzNil9KGUpO3ZhciByPVJyKDY1NTM2LGUpO3JldHVybiByPyhmdW5jdGlvbihlLHIpe1QuZmlsbCgwLGUsZStyKX0ocixlKSxyKTowfSh0KSkpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoNDgpO1Auc2V0KHUsaSl9ZWxzZSBzPSExLGk9dS5ieXRlT2Zmc2V0O3JldHVybntwdHI6aSxhbGxvY2F0ZWQ6c319LG1zeW5jOmZ1bmN0aW9uKGUscix0LG4sbyl7aWYoIWJyLmlzRmlsZShlLm5vZGUubW9kZSkpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoNDMpO3JldHVybiAyJm98fF9yLnN0cmVhbV9vcHMud3JpdGUoZSxyLDAsbix0LCExKSwwfX19LGJyPXtyb290Om51bGwsbW91bnRzOltdLGRldmljZXM6e30sc3RyZWFtczpbXSxuZXh0SW5vZGU6MSxuYW1lVGFibGU6bnVsbCxjdXJyZW50UGF0aDoiLyIsaW5pdGlhbGl6ZWQ6ITEsaWdub3JlUGVybWlzc2lvbnM6ITAsRXJybm9FcnJvcjpudWxsLGdlbmVyaWNFcnJvcnM6e30sZmlsZXN5c3RlbXM6bnVsbCxzeW5jRlNSZXF1ZXN0czowLGxvb2t1cFBhdGg6KGUscj17fSk9PntpZighKGU9Z3IucmVzb2x2ZShici5jd2QoKSxlKSkpcmV0dXJue3BhdGg6IiIsbm9kZTpudWxsfTtpZigocj1PYmplY3QuYXNzaWduKHtmb2xsb3dfbW91bnQ6ITAscmVjdXJzZV9jb3VudDowfSxyKSkucmVjdXJzZV9jb3VudD44KXRocm93IG5ldyBici5FcnJub0Vycm9yKDMyKTtmb3IodmFyIHQ9d3Iubm9ybWFsaXplQXJyYXkoZS5zcGxpdCgiLyIpLmZpbHRlcigoZT0+ISFlKSksITEpLG49YnIucm9vdCxvPSIvIixhPTA7YTx0Lmxlbmd0aDthKyspe3ZhciBpPWE9PT10Lmxlbmd0aC0xO2lmKGkmJnIucGFyZW50KWJyZWFrO2lmKG49YnIubG9va3VwTm9kZShuLHRbYV0pLG89d3Iuam9pbjIobyx0W2FdKSxici5pc01vdW50cG9pbnQobikmJighaXx8aSYmci5mb2xsb3dfbW91bnQpJiYobj1uLm1vdW50ZWQucm9vdCksIWl8fHIuZm9sbG93KWZvcih2YXIgcz0wO2JyLmlzTGluayhuLm1vZGUpOyl7dmFyIHU9YnIucmVhZGxpbmsobyk7aWYobz1nci5yZXNvbHZlKHdyLmRpcm5hbWUobyksdSksbj1ici5sb29rdXBQYXRoKG8se3JlY3Vyc2VfY291bnQ6ci5yZWN1cnNlX2NvdW50KzF9KS5ub2RlLHMrKz40MCl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcigzMil9fXJldHVybntwYXRoOm8sbm9kZTpufX0sZ2V0UGF0aDplPT57Zm9yKHZhciByOzspe2lmKGJyLmlzUm9vdChlKSl7dmFyIHQ9ZS5tb3VudC5tb3VudHBvaW50O3JldHVybiByPyIvIiE9PXRbdC5sZW5ndGgtMV0/dCsiLyIrcjp0K3I6dH1yPXI/ZS5uYW1lKyIvIityOmUubmFtZSxlPWUucGFyZW50fX0saGFzaE5hbWU6KGUscik9Pntmb3IodmFyIHQ9MCxuPTA7bjxyLmxlbmd0aDtuKyspdD0odDw8NSktdCtyLmNoYXJDb2RlQXQobil8MDtyZXR1cm4oZSt0Pj4+MCklYnIubmFtZVRhYmxlLmxlbmd0aH0saGFzaEFkZE5vZGU6ZT0+e3ZhciByPWJyLmhhc2hOYW1lKGUucGFyZW50LmlkLGUubmFtZSk7ZS5uYW1lX25leHQ9YnIubmFtZVRhYmxlW3JdLGJyLm5hbWVUYWJsZVtyXT1lfSxoYXNoUmVtb3ZlTm9kZTplPT57dmFyIHI9YnIuaGFzaE5hbWUoZS5wYXJlbnQuaWQsZS5uYW1lKTtpZihici5uYW1lVGFibGVbcl09PT1lKWJyLm5hbWVUYWJsZVtyXT1lLm5hbWVfbmV4dDtlbHNlIGZvcih2YXIgdD1ici5uYW1lVGFibGVbcl07dDspe2lmKHQubmFtZV9uZXh0PT09ZSl7dC5uYW1lX25leHQ9ZS5uYW1lX25leHQ7YnJlYWt9dD10Lm5hbWVfbmV4dH19LGxvb2t1cE5vZGU6KGUscik9Pnt2YXIgdD1ici5tYXlMb29rdXAoZSk7aWYodCl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcih0LGUpO2Zvcih2YXIgbj1ici5oYXNoTmFtZShlLmlkLHIpLG89YnIubmFtZVRhYmxlW25dO287bz1vLm5hbWVfbmV4dCl7dmFyIGE9by5uYW1lO2lmKG8ucGFyZW50LmlkPT09ZS5pZCYmYT09PXIpcmV0dXJuIG99cmV0dXJuIGJyLmxvb2t1cChlLHIpfSxjcmVhdGVOb2RlOihlLHIsdCxuKT0+e3ZhciBvPW5ldyBici5GU05vZGUoZSxyLHQsbik7cmV0dXJuIGJyLmhhc2hBZGROb2RlKG8pLG99LGRlc3Ryb3lOb2RlOmU9Pntici5oYXNoUmVtb3ZlTm9kZShlKX0saXNSb290OmU9PmU9PT1lLnBhcmVudCxpc01vdW50cG9pbnQ6ZT0+ISFlLm1vdW50ZWQsaXNGaWxlOmU9PjMyNzY4PT0oNjE0NDAmZSksaXNEaXI6ZT0+MTYzODQ9PSg2MTQ0MCZlKSxpc0xpbms6ZT0+NDA5NjA9PSg2MTQ0MCZlKSxpc0NocmRldjplPT44MTkyPT0oNjE0NDAmZSksaXNCbGtkZXY6ZT0+MjQ1NzY9PSg2MTQ0MCZlKSxpc0ZJRk86ZT0+NDA5Nj09KDYxNDQwJmUpLGlzU29ja2V0OmU9PjQ5MTUyPT0oNDkxNTImZSksZmxhZ01vZGVzOntyOjAsInIrIjoyLHc6NTc3LCJ3KyI6NTc4LGE6MTA4OSwiYSsiOjEwOTB9LG1vZGVTdHJpbmdUb0ZsYWdzOmU9Pnt2YXIgcj1ici5mbGFnTW9kZXNbZV07aWYodm9pZCAwPT09cil0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gZmlsZSBvcGVuIG1vZGU6ICIrZSk7cmV0dXJuIHJ9LGZsYWdzVG9QZXJtaXNzaW9uU3RyaW5nOmU9Pnt2YXIgcj1bInIiLCJ3IiwicnciXVszJmVdO3JldHVybiA1MTImZSYmKHIrPSJ3Iikscn0sbm9kZVBlcm1pc3Npb25zOihlLHIpPT5ici5pZ25vcmVQZXJtaXNzaW9uc3x8KCFyLmluY2x1ZGVzKCJyIil8fDI5MiZlLm1vZGUpJiYoIXIuaW5jbHVkZXMoInciKXx8MTQ2JmUubW9kZSkmJighci5pbmNsdWRlcygieCIpfHw3MyZlLm1vZGUpPzA6MixtYXlMb29rdXA6ZT0+YnIubm9kZVBlcm1pc3Npb25zKGUsIngiKXx8KGUubm9kZV9vcHMubG9va3VwPzA6MiksbWF5Q3JlYXRlOihlLHIpPT57dHJ5e3JldHVybiBici5sb29rdXBOb2RlKGUsciksMjB9Y2F0Y2goZSl7fXJldHVybiBici5ub2RlUGVybWlzc2lvbnMoZSwid3giKX0sbWF5RGVsZXRlOihlLHIsdCk9Pnt2YXIgbjt0cnl7bj1ici5sb29rdXBOb2RlKGUscil9Y2F0Y2goZSl7cmV0dXJuIGUuZXJybm99dmFyIG89YnIubm9kZVBlcm1pc3Npb25zKGUsInd4Iik7aWYobylyZXR1cm4gbztpZih0KXtpZighYnIuaXNEaXIobi5tb2RlKSlyZXR1cm4gNTQ7aWYoYnIuaXNSb290KG4pfHxici5nZXRQYXRoKG4pPT09YnIuY3dkKCkpcmV0dXJuIDEwfWVsc2UgaWYoYnIuaXNEaXIobi5tb2RlKSlyZXR1cm4gMzE7cmV0dXJuIDB9LG1heU9wZW46KGUscik9PmU/YnIuaXNMaW5rKGUubW9kZSk/MzI6YnIuaXNEaXIoZS5tb2RlKSYmKCJyIiE9PWJyLmZsYWdzVG9QZXJtaXNzaW9uU3RyaW5nKHIpfHw1MTImcik/MzE6YnIubm9kZVBlcm1pc3Npb25zKGUsYnIuZmxhZ3NUb1Blcm1pc3Npb25TdHJpbmcocikpOjQ0LE1BWF9PUEVOX0ZEUzo0MDk2LG5leHRmZDooZT0wLHI9YnIuTUFYX09QRU5fRkRTKT0+e2Zvcih2YXIgdD1lO3Q8PXI7dCsrKWlmKCFici5zdHJlYW1zW3RdKXJldHVybiB0O3Rocm93IG5ldyBici5FcnJub0Vycm9yKDMzKX0sZ2V0U3RyZWFtOmU9PmJyLnN0cmVhbXNbZV0sY3JlYXRlU3RyZWFtOihlLHIsdCk9Pntici5GU1N0cmVhbXx8KGJyLkZTU3RyZWFtPWZ1bmN0aW9uKCl7dGhpcy5zaGFyZWQ9e319LGJyLkZTU3RyZWFtLnByb3RvdHlwZT17b2JqZWN0OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5ub2RlfSxzZXQ6ZnVuY3Rpb24oZSl7dGhpcy5ub2RlPWV9fSxpc1JlYWQ6e2dldDpmdW5jdGlvbigpe3JldHVybiAxIT0oMjA5NzE1NSZ0aGlzLmZsYWdzKX19LGlzV3JpdGU6e2dldDpmdW5jdGlvbigpe3JldHVybiAwIT0oMjA5NzE1NSZ0aGlzLmZsYWdzKX19LGlzQXBwZW5kOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gMTAyNCZ0aGlzLmZsYWdzfX0sZmxhZ3M6e2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnNoYXJlZC5mbGFnc30sc2V0OmZ1bmN0aW9uKGUpe3RoaXMuc2hhcmVkLmZsYWdzPWV9fSxwb3NpdGlvbjp7Z2V0IGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2hhcmVkLnBvc2l0aW9ufSxzZXQ6ZnVuY3Rpb24oZSl7dGhpcy5zaGFyZWQucG9zaXRpb249ZX19fSksZT1PYmplY3QuYXNzaWduKG5ldyBici5GU1N0cmVhbSxlKTt2YXIgbj1ici5uZXh0ZmQocix0KTtyZXR1cm4gZS5mZD1uLGJyLnN0cmVhbXNbbl09ZSxlfSxjbG9zZVN0cmVhbTplPT57YnIuc3RyZWFtc1tlXT1udWxsfSxjaHJkZXZfc3RyZWFtX29wczp7b3BlbjplPT57dmFyIHI9YnIuZ2V0RGV2aWNlKGUubm9kZS5yZGV2KTtlLnN0cmVhbV9vcHM9ci5zdHJlYW1fb3BzLGUuc3RyZWFtX29wcy5vcGVuJiZlLnN0cmVhbV9vcHMub3BlbihlKX0sbGxzZWVrOigpPT57dGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoNzApfX0sbWFqb3I6ZT0+ZT4+OCxtaW5vcjplPT4yNTUmZSxtYWtlZGV2OihlLHIpPT5lPDw4fHIscmVnaXN0ZXJEZXZpY2U6KGUscik9Pntici5kZXZpY2VzW2VdPXtzdHJlYW1fb3BzOnJ9fSxnZXREZXZpY2U6ZT0+YnIuZGV2aWNlc1tlXSxnZXRNb3VudHM6ZT0+e2Zvcih2YXIgcj1bXSx0PVtlXTt0Lmxlbmd0aDspe3ZhciBuPXQucG9wKCk7ci5wdXNoKG4pLHQucHVzaC5hcHBseSh0LG4ubW91bnRzKX1yZXR1cm4gcn0sc3luY2ZzOihlLHIpPT57ImZ1bmN0aW9uIj09dHlwZW9mIGUmJihyPWUsZT0hMSksYnIuc3luY0ZTUmVxdWVzdHMrKyxici5zeW5jRlNSZXF1ZXN0cz4xJiZkKCJ3YXJuaW5nOiAiK2JyLnN5bmNGU1JlcXVlc3RzKyIgRlMuc3luY2ZzIG9wZXJhdGlvbnMgaW4gZmxpZ2h0IGF0IG9uY2UsIHByb2JhYmx5IGp1c3QgZG9pbmcgZXh0cmEgd29yayIpO3ZhciB0PWJyLmdldE1vdW50cyhici5yb290Lm1vdW50KSxuPTA7ZnVuY3Rpb24gbyhlKXtyZXR1cm4gYnIuc3luY0ZTUmVxdWVzdHMtLSxyKGUpfWZ1bmN0aW9uIGEoZSl7aWYoZSlyZXR1cm4gYS5lcnJvcmVkP3ZvaWQgMDooYS5lcnJvcmVkPSEwLG8oZSkpOysrbj49dC5sZW5ndGgmJm8obnVsbCl9dC5mb3JFYWNoKChyPT57aWYoIXIudHlwZS5zeW5jZnMpcmV0dXJuIGEobnVsbCk7ci50eXBlLnN5bmNmcyhyLGUsYSl9KSl9LG1vdW50OihlLHIsdCk9Pnt2YXIgbixvPSIvIj09PXQsYT0hdDtpZihvJiZici5yb290KXRocm93IG5ldyBici5FcnJub0Vycm9yKDEwKTtpZighbyYmIWEpe3ZhciBpPWJyLmxvb2t1cFBhdGgodCx7Zm9sbG93X21vdW50OiExfSk7aWYodD1pLnBhdGgsbj1pLm5vZGUsYnIuaXNNb3VudHBvaW50KG4pKXRocm93IG5ldyBici5FcnJub0Vycm9yKDEwKTtpZighYnIuaXNEaXIobi5tb2RlKSl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcig1NCl9dmFyIHM9e3R5cGU6ZSxvcHRzOnIsbW91bnRwb2ludDp0LG1vdW50czpbXX0sdT1lLm1vdW50KHMpO3JldHVybiB1Lm1vdW50PXMscy5yb290PXUsbz9ici5yb290PXU6biYmKG4ubW91bnRlZD1zLG4ubW91bnQmJm4ubW91bnQubW91bnRzLnB1c2gocykpLHV9LHVubW91bnQ6ZT0+e3ZhciByPWJyLmxvb2t1cFBhdGgoZSx7Zm9sbG93X21vdW50OiExfSk7aWYoIWJyLmlzTW91bnRwb2ludChyLm5vZGUpKXRocm93IG5ldyBici5FcnJub0Vycm9yKDI4KTt2YXIgdD1yLm5vZGUsbj10Lm1vdW50ZWQsbz1ici5nZXRNb3VudHMobik7T2JqZWN0LmtleXMoYnIubmFtZVRhYmxlKS5mb3JFYWNoKChlPT57Zm9yKHZhciByPWJyLm5hbWVUYWJsZVtlXTtyOyl7dmFyIHQ9ci5uYW1lX25leHQ7by5pbmNsdWRlcyhyLm1vdW50KSYmYnIuZGVzdHJveU5vZGUocikscj10fX0pKSx0Lm1vdW50ZWQ9bnVsbDt2YXIgYT10Lm1vdW50Lm1vdW50cy5pbmRleE9mKG4pO3QubW91bnQubW91bnRzLnNwbGljZShhLDEpfSxsb29rdXA6KGUscik9PmUubm9kZV9vcHMubG9va3VwKGUsciksbWtub2Q6KGUscix0KT0+e3ZhciBuPWJyLmxvb2t1cFBhdGgoZSx7cGFyZW50OiEwfSkubm9kZSxvPXdyLmJhc2VuYW1lKGUpO2lmKCFvfHwiLiI9PT1vfHwiLi4iPT09byl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcigyOCk7dmFyIGE9YnIubWF5Q3JlYXRlKG4sbyk7aWYoYSl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcihhKTtpZighbi5ub2RlX29wcy5ta25vZCl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcig2Myk7cmV0dXJuIG4ubm9kZV9vcHMubWtub2QobixvLHIsdCl9LGNyZWF0ZTooZSxyKT0+KHI9dm9pZCAwIT09cj9yOjQzOCxyJj00MDk1LHJ8PTMyNzY4LGJyLm1rbm9kKGUsciwwKSksbWtkaXI6KGUscik9PihyPXZvaWQgMCE9PXI/cjo1MTEsciY9MTAyMyxyfD0xNjM4NCxici5ta25vZChlLHIsMCkpLG1rZGlyVHJlZTooZSxyKT0+e2Zvcih2YXIgdD1lLnNwbGl0KCIvIiksbj0iIixvPTA7bzx0Lmxlbmd0aDsrK28paWYodFtvXSl7bis9Ii8iK3Rbb107dHJ5e2JyLm1rZGlyKG4scil9Y2F0Y2goZSl7aWYoMjAhPWUuZXJybm8pdGhyb3cgZX19fSxta2RldjooZSxyLHQpPT4odm9pZCAwPT09dCYmKHQ9cixyPTQzOCkscnw9ODE5Mixici5ta25vZChlLHIsdCkpLHN5bWxpbms6KGUscik9PntpZighZ3IucmVzb2x2ZShlKSl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcig0NCk7dmFyIHQ9YnIubG9va3VwUGF0aChyLHtwYXJlbnQ6ITB9KS5ub2RlO2lmKCF0KXRocm93IG5ldyBici5FcnJub0Vycm9yKDQ0KTt2YXIgbj13ci5iYXNlbmFtZShyKSxvPWJyLm1heUNyZWF0ZSh0LG4pO2lmKG8pdGhyb3cgbmV3IGJyLkVycm5vRXJyb3Iobyk7aWYoIXQubm9kZV9vcHMuc3ltbGluayl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcig2Myk7cmV0dXJuIHQubm9kZV9vcHMuc3ltbGluayh0LG4sZSl9LHJlbmFtZTooZSxyKT0+e3ZhciB0LG4sbz13ci5kaXJuYW1lKGUpLGE9d3IuZGlybmFtZShyKSxpPXdyLmJhc2VuYW1lKGUpLHM9d3IuYmFzZW5hbWUocik7aWYodD1ici5sb29rdXBQYXRoKGUse3BhcmVudDohMH0pLm5vZGUsbj1ici5sb29rdXBQYXRoKHIse3BhcmVudDohMH0pLm5vZGUsIXR8fCFuKXRocm93IG5ldyBici5FcnJub0Vycm9yKDQ0KTtpZih0Lm1vdW50IT09bi5tb3VudCl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcig3NSk7dmFyIHUsYz1ici5sb29rdXBOb2RlKHQsaSksbD1nci5yZWxhdGl2ZShlLGEpO2lmKCIuIiE9PWwuY2hhckF0KDApKXRocm93IG5ldyBici5FcnJub0Vycm9yKDI4KTtpZigiLiIhPT0obD1nci5yZWxhdGl2ZShyLG8pKS5jaGFyQXQoMCkpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoNTUpO3RyeXt1PWJyLmxvb2t1cE5vZGUobixzKX1jYXRjaChlKXt9aWYoYyE9PXUpe3ZhciBkPWJyLmlzRGlyKGMubW9kZSksZj1ici5tYXlEZWxldGUodCxpLGQpO2lmKGYpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoZik7aWYoZj11P2JyLm1heURlbGV0ZShuLHMsZCk6YnIubWF5Q3JlYXRlKG4scykpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoZik7aWYoIXQubm9kZV9vcHMucmVuYW1lKXRocm93IG5ldyBici5FcnJub0Vycm9yKDYzKTtpZihici5pc01vdW50cG9pbnQoYyl8fHUmJmJyLmlzTW91bnRwb2ludCh1KSl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcigxMCk7aWYobiE9PXQmJihmPWJyLm5vZGVQZXJtaXNzaW9ucyh0LCJ3IikpKXRocm93IG5ldyBici5FcnJub0Vycm9yKGYpO2JyLmhhc2hSZW1vdmVOb2RlKGMpO3RyeXt0Lm5vZGVfb3BzLnJlbmFtZShjLG4scyl9Y2F0Y2goZSl7dGhyb3cgZX1maW5hbGx5e2JyLmhhc2hBZGROb2RlKGMpfX19LHJtZGlyOmU9Pnt2YXIgcj1ici5sb29rdXBQYXRoKGUse3BhcmVudDohMH0pLm5vZGUsdD13ci5iYXNlbmFtZShlKSxuPWJyLmxvb2t1cE5vZGUocix0KSxvPWJyLm1heURlbGV0ZShyLHQsITApO2lmKG8pdGhyb3cgbmV3IGJyLkVycm5vRXJyb3Iobyk7aWYoIXIubm9kZV9vcHMucm1kaXIpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoNjMpO2lmKGJyLmlzTW91bnRwb2ludChuKSl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcigxMCk7ci5ub2RlX29wcy5ybWRpcihyLHQpLGJyLmRlc3Ryb3lOb2RlKG4pfSxyZWFkZGlyOmU9Pnt2YXIgcj1ici5sb29rdXBQYXRoKGUse2ZvbGxvdzohMH0pLm5vZGU7aWYoIXIubm9kZV9vcHMucmVhZGRpcil0aHJvdyBuZXcgYnIuRXJybm9FcnJvcig1NCk7cmV0dXJuIHIubm9kZV9vcHMucmVhZGRpcihyKX0sdW5saW5rOmU9Pnt2YXIgcj1ici5sb29rdXBQYXRoKGUse3BhcmVudDohMH0pLm5vZGU7aWYoIXIpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoNDQpO3ZhciB0PXdyLmJhc2VuYW1lKGUpLG49YnIubG9va3VwTm9kZShyLHQpLG89YnIubWF5RGVsZXRlKHIsdCwhMSk7aWYobyl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcihvKTtpZighci5ub2RlX29wcy51bmxpbmspdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoNjMpO2lmKGJyLmlzTW91bnRwb2ludChuKSl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcigxMCk7ci5ub2RlX29wcy51bmxpbmsocix0KSxici5kZXN0cm95Tm9kZShuKX0scmVhZGxpbms6ZT0+e3ZhciByPWJyLmxvb2t1cFBhdGgoZSkubm9kZTtpZighcil0aHJvdyBuZXcgYnIuRXJybm9FcnJvcig0NCk7aWYoIXIubm9kZV9vcHMucmVhZGxpbmspdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoMjgpO3JldHVybiBnci5yZXNvbHZlKGJyLmdldFBhdGgoci5wYXJlbnQpLHIubm9kZV9vcHMucmVhZGxpbmsocikpfSxzdGF0OihlLHIpPT57dmFyIHQ9YnIubG9va3VwUGF0aChlLHtmb2xsb3c6IXJ9KS5ub2RlO2lmKCF0KXRocm93IG5ldyBici5FcnJub0Vycm9yKDQ0KTtpZighdC5ub2RlX29wcy5nZXRhdHRyKXRocm93IG5ldyBici5FcnJub0Vycm9yKDYzKTtyZXR1cm4gdC5ub2RlX29wcy5nZXRhdHRyKHQpfSxsc3RhdDplPT5ici5zdGF0KGUsITApLGNobW9kOihlLHIsdCk9Pnt2YXIgbjtpZighKG49InN0cmluZyI9PXR5cGVvZiBlP2JyLmxvb2t1cFBhdGgoZSx7Zm9sbG93OiF0fSkubm9kZTplKS5ub2RlX29wcy5zZXRhdHRyKXRocm93IG5ldyBici5FcnJub0Vycm9yKDYzKTtuLm5vZGVfb3BzLnNldGF0dHIobix7bW9kZTo0MDk1JnJ8LTQwOTYmbi5tb2RlLHRpbWVzdGFtcDpEYXRlLm5vdygpfSl9LGxjaG1vZDooZSxyKT0+e2JyLmNobW9kKGUsciwhMCl9LGZjaG1vZDooZSxyKT0+e3ZhciB0PWJyLmdldFN0cmVhbShlKTtpZighdCl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcig4KTtici5jaG1vZCh0Lm5vZGUscil9LGNob3duOihlLHIsdCxuKT0+e3ZhciBvO2lmKCEobz0ic3RyaW5nIj09dHlwZW9mIGU/YnIubG9va3VwUGF0aChlLHtmb2xsb3c6IW59KS5ub2RlOmUpLm5vZGVfb3BzLnNldGF0dHIpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoNjMpO28ubm9kZV9vcHMuc2V0YXR0cihvLHt0aW1lc3RhbXA6RGF0ZS5ub3coKX0pfSxsY2hvd246KGUscix0KT0+e2JyLmNob3duKGUscix0LCEwKX0sZmNob3duOihlLHIsdCk9Pnt2YXIgbj1ici5nZXRTdHJlYW0oZSk7aWYoIW4pdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoOCk7YnIuY2hvd24obi5ub2RlLHIsdCl9LHRydW5jYXRlOihlLHIpPT57aWYocjwwKXRocm93IG5ldyBici5FcnJub0Vycm9yKDI4KTt2YXIgdDtpZighKHQ9InN0cmluZyI9PXR5cGVvZiBlP2JyLmxvb2t1cFBhdGgoZSx7Zm9sbG93OiEwfSkubm9kZTplKS5ub2RlX29wcy5zZXRhdHRyKXRocm93IG5ldyBici5FcnJub0Vycm9yKDYzKTtpZihici5pc0Rpcih0Lm1vZGUpKXRocm93IG5ldyBici5FcnJub0Vycm9yKDMxKTtpZighYnIuaXNGaWxlKHQubW9kZSkpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoMjgpO3ZhciBuPWJyLm5vZGVQZXJtaXNzaW9ucyh0LCJ3Iik7aWYobil0aHJvdyBuZXcgYnIuRXJybm9FcnJvcihuKTt0Lm5vZGVfb3BzLnNldGF0dHIodCx7c2l6ZTpyLHRpbWVzdGFtcDpEYXRlLm5vdygpfSl9LGZ0cnVuY2F0ZTooZSxyKT0+e3ZhciB0PWJyLmdldFN0cmVhbShlKTtpZighdCl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcig4KTtpZigwPT0oMjA5NzE1NSZ0LmZsYWdzKSl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcigyOCk7YnIudHJ1bmNhdGUodC5ub2RlLHIpfSx1dGltZTooZSxyLHQpPT57dmFyIG49YnIubG9va3VwUGF0aChlLHtmb2xsb3c6ITB9KS5ub2RlO24ubm9kZV9vcHMuc2V0YXR0cihuLHt0aW1lc3RhbXA6TWF0aC5tYXgocix0KX0pfSxvcGVuOihyLHQsbixvLGEpPT57aWYoIiI9PT1yKXRocm93IG5ldyBici5FcnJub0Vycm9yKDQ0KTt2YXIgaTtpZihuPXZvaWQgMD09PW4/NDM4Om4sbj02NCYodD0ic3RyaW5nIj09dHlwZW9mIHQ/YnIubW9kZVN0cmluZ1RvRmxhZ3ModCk6dCk/NDA5NSZufDMyNzY4OjAsIm9iamVjdCI9PXR5cGVvZiByKWk9cjtlbHNle3I9d3Iubm9ybWFsaXplKHIpO3RyeXtpPWJyLmxvb2t1cFBhdGgocix7Zm9sbG93OiEoMTMxMDcyJnQpfSkubm9kZX1jYXRjaChlKXt9fXZhciBzPSExO2lmKDY0JnQpaWYoaSl7aWYoMTI4JnQpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoMjApfWVsc2UgaT1ici5ta25vZChyLG4sMCkscz0hMDtpZighaSl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcig0NCk7aWYoYnIuaXNDaHJkZXYoaS5tb2RlKSYmKHQmPS01MTMpLDY1NTM2JnQmJiFici5pc0RpcihpLm1vZGUpKXRocm93IG5ldyBici5FcnJub0Vycm9yKDU0KTtpZighcyl7dmFyIHU9YnIubWF5T3BlbihpLHQpO2lmKHUpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IodSl9NTEyJnQmJmJyLnRydW5jYXRlKGksMCksdCY9LTEzMTcxMzt2YXIgYz1ici5jcmVhdGVTdHJlYW0oe25vZGU6aSxwYXRoOmJyLmdldFBhdGgoaSksZmxhZ3M6dCxzZWVrYWJsZTohMCxwb3NpdGlvbjowLHN0cmVhbV9vcHM6aS5zdHJlYW1fb3BzLHVuZ290dGVuOltdLGVycm9yOiExfSxvLGEpO3JldHVybiBjLnN0cmVhbV9vcHMub3BlbiYmYy5zdHJlYW1fb3BzLm9wZW4oYyksIWUubG9nUmVhZEZpbGVzfHwxJnR8fChici5yZWFkRmlsZXN8fChici5yZWFkRmlsZXM9e30pLHIgaW4gYnIucmVhZEZpbGVzfHwoYnIucmVhZEZpbGVzW3JdPTEpKSxjfSxjbG9zZTplPT57aWYoYnIuaXNDbG9zZWQoZSkpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoOCk7ZS5nZXRkZW50cyYmKGUuZ2V0ZGVudHM9bnVsbCk7dHJ5e2Uuc3RyZWFtX29wcy5jbG9zZSYmZS5zdHJlYW1fb3BzLmNsb3NlKGUpfWNhdGNoKGUpe3Rocm93IGV9ZmluYWxseXtici5jbG9zZVN0cmVhbShlLmZkKX1lLmZkPW51bGx9LGlzQ2xvc2VkOmU9Pm51bGw9PT1lLmZkLGxsc2VlazooZSxyLHQpPT57aWYoYnIuaXNDbG9zZWQoZSkpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoOCk7aWYoIWUuc2Vla2FibGV8fCFlLnN0cmVhbV9vcHMubGxzZWVrKXRocm93IG5ldyBici5FcnJub0Vycm9yKDcwKTtpZigwIT10JiYxIT10JiYyIT10KXRocm93IG5ldyBici5FcnJub0Vycm9yKDI4KTtyZXR1cm4gZS5wb3NpdGlvbj1lLnN0cmVhbV9vcHMubGxzZWVrKGUscix0KSxlLnVuZ290dGVuPVtdLGUucG9zaXRpb259LHJlYWQ6KGUscix0LG4sbyk9PntpZihuPDB8fG88MCl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcigyOCk7aWYoYnIuaXNDbG9zZWQoZSkpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoOCk7aWYoMT09KDIwOTcxNTUmZS5mbGFncykpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoOCk7aWYoYnIuaXNEaXIoZS5ub2RlLm1vZGUpKXRocm93IG5ldyBici5FcnJub0Vycm9yKDMxKTtpZighZS5zdHJlYW1fb3BzLnJlYWQpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoMjgpO3ZhciBhPXZvaWQgMCE9PW87aWYoYSl7aWYoIWUuc2Vla2FibGUpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoNzApfWVsc2Ugbz1lLnBvc2l0aW9uO3ZhciBpPWUuc3RyZWFtX29wcy5yZWFkKGUscix0LG4sbyk7cmV0dXJuIGF8fChlLnBvc2l0aW9uKz1pKSxpfSx3cml0ZTooZSxyLHQsbixvLGEpPT57aWYobjwwfHxvPDApdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoMjgpO2lmKGJyLmlzQ2xvc2VkKGUpKXRocm93IG5ldyBici5FcnJub0Vycm9yKDgpO2lmKDA9PSgyMDk3MTU1JmUuZmxhZ3MpKXRocm93IG5ldyBici5FcnJub0Vycm9yKDgpO2lmKGJyLmlzRGlyKGUubm9kZS5tb2RlKSl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcigzMSk7aWYoIWUuc3RyZWFtX29wcy53cml0ZSl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcigyOCk7ZS5zZWVrYWJsZSYmMTAyNCZlLmZsYWdzJiZici5sbHNlZWsoZSwwLDIpO3ZhciBpPXZvaWQgMCE9PW87aWYoaSl7aWYoIWUuc2Vla2FibGUpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoNzApfWVsc2Ugbz1lLnBvc2l0aW9uO3ZhciBzPWUuc3RyZWFtX29wcy53cml0ZShlLHIsdCxuLG8sYSk7cmV0dXJuIGl8fChlLnBvc2l0aW9uKz1zKSxzfSxhbGxvY2F0ZTooZSxyLHQpPT57aWYoYnIuaXNDbG9zZWQoZSkpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoOCk7aWYocjwwfHx0PD0wKXRocm93IG5ldyBici5FcnJub0Vycm9yKDI4KTtpZigwPT0oMjA5NzE1NSZlLmZsYWdzKSl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcig4KTtpZighYnIuaXNGaWxlKGUubm9kZS5tb2RlKSYmIWJyLmlzRGlyKGUubm9kZS5tb2RlKSl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcig0Myk7aWYoIWUuc3RyZWFtX29wcy5hbGxvY2F0ZSl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcigxMzgpO2Uuc3RyZWFtX29wcy5hbGxvY2F0ZShlLHIsdCl9LG1tYXA6KGUscix0LG4sbyxhKT0+e2lmKDAhPSgyJm8pJiYwPT0oMiZhKSYmMiE9KDIwOTcxNTUmZS5mbGFncykpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoMik7aWYoMT09KDIwOTcxNTUmZS5mbGFncykpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoMik7aWYoIWUuc3RyZWFtX29wcy5tbWFwKXRocm93IG5ldyBici5FcnJub0Vycm9yKDQzKTtyZXR1cm4gZS5zdHJlYW1fb3BzLm1tYXAoZSxyLHQsbixvLGEpfSxtc3luYzooZSxyLHQsbixvKT0+ZSYmZS5zdHJlYW1fb3BzLm1zeW5jP2Uuc3RyZWFtX29wcy5tc3luYyhlLHIsdCxuLG8pOjAsbXVubWFwOmU9PjAsaW9jdGw6KGUscix0KT0+e2lmKCFlLnN0cmVhbV9vcHMuaW9jdGwpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoNTkpO3JldHVybiBlLnN0cmVhbV9vcHMuaW9jdGwoZSxyLHQpfSxyZWFkRmlsZTooZSxyPXt9KT0+e2lmKHIuZmxhZ3M9ci5mbGFnc3x8MCxyLmVuY29kaW5nPXIuZW5jb2Rpbmd8fCJiaW5hcnkiLCJ1dGY4IiE9PXIuZW5jb2RpbmcmJiJiaW5hcnkiIT09ci5lbmNvZGluZyl0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZW5jb2RpbmcgdHlwZSAiJytyLmVuY29kaW5nKyciJyk7dmFyIHQsbj1ici5vcGVuKGUsci5mbGFncyksbz1ici5zdGF0KGUpLnNpemUsYT1uZXcgVWludDhBcnJheShvKTtyZXR1cm4gYnIucmVhZChuLGEsMCxvLDApLCJ1dGY4Ij09PXIuZW5jb2Rpbmc/dD13KGEsMCk6ImJpbmFyeSI9PT1yLmVuY29kaW5nJiYodD1hKSxici5jbG9zZShuKSx0fSx3cml0ZUZpbGU6KGUscix0PXt9KT0+e3QuZmxhZ3M9dC5mbGFnc3x8NTc3O3ZhciBuPWJyLm9wZW4oZSx0LmZsYWdzLHQubW9kZSk7aWYoInN0cmluZyI9PXR5cGVvZiByKXt2YXIgbz1uZXcgVWludDhBcnJheShiKHIpKzEpLGE9RShyLG8sMCxvLmxlbmd0aCk7YnIud3JpdGUobixvLDAsYSx2b2lkIDAsdC5jYW5Pd24pfWVsc2V7aWYoIUFycmF5QnVmZmVyLmlzVmlldyhyKSl0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIGRhdGEgdHlwZSIpO2JyLndyaXRlKG4sciwwLHIuYnl0ZUxlbmd0aCx2b2lkIDAsdC5jYW5Pd24pfWJyLmNsb3NlKG4pfSxjd2Q6KCk9PmJyLmN1cnJlbnRQYXRoLGNoZGlyOmU9Pnt2YXIgcj1ici5sb29rdXBQYXRoKGUse2ZvbGxvdzohMH0pO2lmKG51bGw9PT1yLm5vZGUpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoNDQpO2lmKCFici5pc0RpcihyLm5vZGUubW9kZSkpdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoNTQpO3ZhciB0PWJyLm5vZGVQZXJtaXNzaW9ucyhyLm5vZGUsIngiKTtpZih0KXRocm93IG5ldyBici5FcnJub0Vycm9yKHQpO2JyLmN1cnJlbnRQYXRoPXIucGF0aH0sY3JlYXRlRGVmYXVsdERpcmVjdG9yaWVzOigpPT57YnIubWtkaXIoIi90bXAiKSxici5ta2RpcigiL2hvbWUiKSxici5ta2RpcigiL2hvbWUvd2ViX3VzZXIiKX0sY3JlYXRlRGVmYXVsdERldmljZXM6KCk9Pntici5ta2RpcigiL2RldiIpLGJyLnJlZ2lzdGVyRGV2aWNlKGJyLm1ha2VkZXYoMSwzKSx7cmVhZDooKT0+MCx3cml0ZTooZSxyLHQsbixvKT0+bn0pLGJyLm1rZGV2KCIvZGV2L251bGwiLGJyLm1ha2VkZXYoMSwzKSksRXIucmVnaXN0ZXIoYnIubWFrZWRldig1LDApLEVyLmRlZmF1bHRfdHR5X29wcyksRXIucmVnaXN0ZXIoYnIubWFrZWRldig2LDApLEVyLmRlZmF1bHRfdHR5MV9vcHMpLGJyLm1rZGV2KCIvZGV2L3R0eSIsYnIubWFrZWRldig1LDApKSxici5ta2RldigiL2Rldi90dHkxIixici5tYWtlZGV2KDYsMCkpO3ZhciBlPWZ1bmN0aW9uKCl7aWYoIm9iamVjdCI9PXR5cGVvZiBjcnlwdG8mJiJmdW5jdGlvbiI9PXR5cGVvZiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKXt2YXIgZT1uZXcgVWludDhBcnJheSgxKTtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhlKSxlWzBdfX1yZXR1cm4gZnVuY3Rpb24oKXtLKCJyYW5kb21EZXZpY2UiKX19KCk7YnIuY3JlYXRlRGV2aWNlKCIvZGV2IiwicmFuZG9tIixlKSxici5jcmVhdGVEZXZpY2UoIi9kZXYiLCJ1cmFuZG9tIixlKSxici5ta2RpcigiL2Rldi9zaG0iKSxici5ta2RpcigiL2Rldi9zaG0vdG1wIil9LGNyZWF0ZVNwZWNpYWxEaXJlY3RvcmllczooKT0+e2JyLm1rZGlyKCIvcHJvYyIpO3ZhciBlPWJyLm1rZGlyKCIvcHJvYy9zZWxmIik7YnIubWtkaXIoIi9wcm9jL3NlbGYvZmQiKSxici5tb3VudCh7bW91bnQ6KCk9Pnt2YXIgcj1ici5jcmVhdGVOb2RlKGUsImZkIiwxNjg5NSw3Myk7cmV0dXJuIHIubm9kZV9vcHM9e2xvb2t1cDooZSxyKT0+e3ZhciB0PStyLG49YnIuZ2V0U3RyZWFtKHQpO2lmKCFuKXRocm93IG5ldyBici5FcnJub0Vycm9yKDgpO3ZhciBvPXtwYXJlbnQ6bnVsbCxtb3VudDp7bW91bnRwb2ludDoiZmFrZSJ9LG5vZGVfb3BzOntyZWFkbGluazooKT0+bi5wYXRofX07cmV0dXJuIG8ucGFyZW50PW8sb319LHJ9fSx7fSwiL3Byb2Mvc2VsZi9mZCIpfSxjcmVhdGVTdGFuZGFyZFN0cmVhbXM6KCk9PntlLnN0ZGluP2JyLmNyZWF0ZURldmljZSgiL2RldiIsInN0ZGluIixlLnN0ZGluKTpici5zeW1saW5rKCIvZGV2L3R0eSIsIi9kZXYvc3RkaW4iKSxlLnN0ZG91dD9ici5jcmVhdGVEZXZpY2UoIi9kZXYiLCJzdGRvdXQiLG51bGwsZS5zdGRvdXQpOmJyLnN5bWxpbmsoIi9kZXYvdHR5IiwiL2Rldi9zdGRvdXQiKSxlLnN0ZGVycj9ici5jcmVhdGVEZXZpY2UoIi9kZXYiLCJzdGRlcnIiLG51bGwsZS5zdGRlcnIpOmJyLnN5bWxpbmsoIi9kZXYvdHR5MSIsIi9kZXYvc3RkZXJyIiksYnIub3BlbigiL2Rldi9zdGRpbiIsMCksYnIub3BlbigiL2Rldi9zdGRvdXQiLDEpLGJyLm9wZW4oIi9kZXYvc3RkZXJyIiwxKX0sZW5zdXJlRXJybm9FcnJvcjooKT0+e2JyLkVycm5vRXJyb3J8fChici5FcnJub0Vycm9yPWZ1bmN0aW9uKGUscil7dGhpcy5ub2RlPXIsdGhpcy5zZXRFcnJubz1mdW5jdGlvbihlKXt0aGlzLmVycm5vPWV9LHRoaXMuc2V0RXJybm8oZSksdGhpcy5tZXNzYWdlPSJGUyBlcnJvciJ9LGJyLkVycm5vRXJyb3IucHJvdG90eXBlPW5ldyBFcnJvcixici5FcnJub0Vycm9yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvcj1ici5FcnJub0Vycm9yLFs0NF0uZm9yRWFjaCgoZT0+e2JyLmdlbmVyaWNFcnJvcnNbZV09bmV3IGJyLkVycm5vRXJyb3IoZSksYnIuZ2VuZXJpY0Vycm9yc1tlXS5zdGFjaz0iPGdlbmVyaWMgZXJyb3IsIG5vIHN0YWNrPiJ9KSkpfSxzdGF0aWNJbml0OigpPT57YnIuZW5zdXJlRXJybm9FcnJvcigpLGJyLm5hbWVUYWJsZT1uZXcgQXJyYXkoNDA5NiksYnIubW91bnQoX3Ise30sIi8iKSxici5jcmVhdGVEZWZhdWx0RGlyZWN0b3JpZXMoKSxici5jcmVhdGVEZWZhdWx0RGV2aWNlcygpLGJyLmNyZWF0ZVNwZWNpYWxEaXJlY3RvcmllcygpLGJyLmZpbGVzeXN0ZW1zPXtNRU1GUzpfcn19LGluaXQ6KHIsdCxuKT0+e2JyLmluaXQuaW5pdGlhbGl6ZWQ9ITAsYnIuZW5zdXJlRXJybm9FcnJvcigpLGUuc3RkaW49cnx8ZS5zdGRpbixlLnN0ZG91dD10fHxlLnN0ZG91dCxlLnN0ZGVycj1ufHxlLnN0ZGVycixici5jcmVhdGVTdGFuZGFyZFN0cmVhbXMoKX0scXVpdDooKT0+e2JyLmluaXQuaW5pdGlhbGl6ZWQ9ITE7Zm9yKHZhciBlPTA7ZTxici5zdHJlYW1zLmxlbmd0aDtlKyspe3ZhciByPWJyLnN0cmVhbXNbZV07ciYmYnIuY2xvc2Uocil9fSxnZXRNb2RlOihlLHIpPT57dmFyIHQ9MDtyZXR1cm4gZSYmKHR8PTM2NSksciYmKHR8PTE0NiksdH0sZmluZE9iamVjdDooZSxyKT0+e3ZhciB0PWJyLmFuYWx5emVQYXRoKGUscik7cmV0dXJuIHQuZXhpc3RzP3Qub2JqZWN0Om51bGx9LGFuYWx5emVQYXRoOihlLHIpPT57dHJ5e2U9KG49YnIubG9va3VwUGF0aChlLHtmb2xsb3c6IXJ9KSkucGF0aH1jYXRjaChlKXt9dmFyIHQ9e2lzUm9vdDohMSxleGlzdHM6ITEsZXJyb3I6MCxuYW1lOm51bGwscGF0aDpudWxsLG9iamVjdDpudWxsLHBhcmVudEV4aXN0czohMSxwYXJlbnRQYXRoOm51bGwscGFyZW50T2JqZWN0Om51bGx9O3RyeXt2YXIgbj1ici5sb29rdXBQYXRoKGUse3BhcmVudDohMH0pO3QucGFyZW50RXhpc3RzPSEwLHQucGFyZW50UGF0aD1uLnBhdGgsdC5wYXJlbnRPYmplY3Q9bi5ub2RlLHQubmFtZT13ci5iYXNlbmFtZShlKSxuPWJyLmxvb2t1cFBhdGgoZSx7Zm9sbG93OiFyfSksdC5leGlzdHM9ITAsdC5wYXRoPW4ucGF0aCx0Lm9iamVjdD1uLm5vZGUsdC5uYW1lPW4ubm9kZS5uYW1lLHQuaXNSb290PSIvIj09PW4ucGF0aH1jYXRjaChlKXt0LmVycm9yPWUuZXJybm99cmV0dXJuIHR9LGNyZWF0ZVBhdGg6KGUscix0LG4pPT57ZT0ic3RyaW5nIj09dHlwZW9mIGU/ZTpici5nZXRQYXRoKGUpO2Zvcih2YXIgbz1yLnNwbGl0KCIvIikucmV2ZXJzZSgpO28ubGVuZ3RoOyl7dmFyIGE9by5wb3AoKTtpZihhKXt2YXIgaT13ci5qb2luMihlLGEpO3RyeXtici5ta2RpcihpKX1jYXRjaChlKXt9ZT1pfX1yZXR1cm4gaX0sY3JlYXRlRmlsZTooZSxyLHQsbixvKT0+e3ZhciBhPXdyLmpvaW4yKCJzdHJpbmciPT10eXBlb2YgZT9lOmJyLmdldFBhdGgoZSksciksaT1ici5nZXRNb2RlKG4sbyk7cmV0dXJuIGJyLmNyZWF0ZShhLGkpfSxjcmVhdGVEYXRhRmlsZTooZSxyLHQsbixvLGEpPT57dmFyIGk9cjtlJiYoZT0ic3RyaW5nIj09dHlwZW9mIGU/ZTpici5nZXRQYXRoKGUpLGk9cj93ci5qb2luMihlLHIpOmUpO3ZhciBzPWJyLmdldE1vZGUobixvKSx1PWJyLmNyZWF0ZShpLHMpO2lmKHQpe2lmKCJzdHJpbmciPT10eXBlb2YgdCl7Zm9yKHZhciBjPW5ldyBBcnJheSh0Lmxlbmd0aCksbD0wLGQ9dC5sZW5ndGg7bDxkOysrbCljW2xdPXQuY2hhckNvZGVBdChsKTt0PWN9YnIuY2htb2QodSwxNDZ8cyk7dmFyIGY9YnIub3Blbih1LDU3Nyk7YnIud3JpdGUoZix0LDAsdC5sZW5ndGgsMCxhKSxici5jbG9zZShmKSxici5jaG1vZCh1LHMpfXJldHVybiB1fSxjcmVhdGVEZXZpY2U6KGUscix0LG4pPT57dmFyIG89d3Iuam9pbjIoInN0cmluZyI9PXR5cGVvZiBlP2U6YnIuZ2V0UGF0aChlKSxyKSxhPWJyLmdldE1vZGUoISF0LCEhbik7YnIuY3JlYXRlRGV2aWNlLm1ham9yfHwoYnIuY3JlYXRlRGV2aWNlLm1ham9yPTY0KTt2YXIgaT1ici5tYWtlZGV2KGJyLmNyZWF0ZURldmljZS5tYWpvcisrLDApO3JldHVybiBici5yZWdpc3RlckRldmljZShpLHtvcGVuOmU9PntlLnNlZWthYmxlPSExfSxjbG9zZTplPT57biYmbi5idWZmZXImJm4uYnVmZmVyLmxlbmd0aCYmbigxMCl9LHJlYWQ6KGUscixuLG8sYSk9Pntmb3IodmFyIGk9MCxzPTA7czxvO3MrKyl7dmFyIHU7dHJ5e3U9dCgpfWNhdGNoKGUpe3Rocm93IG5ldyBici5FcnJub0Vycm9yKDI5KX1pZih2b2lkIDA9PT11JiYwPT09aSl0aHJvdyBuZXcgYnIuRXJybm9FcnJvcig2KTtpZihudWxsPT11KWJyZWFrO2krKyxyW24rc109dX1yZXR1cm4gaSYmKGUubm9kZS50aW1lc3RhbXA9RGF0ZS5ub3coKSksaX0sd3JpdGU6KGUscix0LG8sYSk9Pntmb3IodmFyIGk9MDtpPG87aSsrKXRyeXtuKHJbdCtpXSl9Y2F0Y2goZSl7dGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoMjkpfXJldHVybiBvJiYoZS5ub2RlLnRpbWVzdGFtcD1EYXRlLm5vdygpKSxpfX0pLGJyLm1rZGV2KG8sYSxpKX0sZm9yY2VMb2FkRmlsZTplPT57aWYoZS5pc0RldmljZXx8ZS5pc0ZvbGRlcnx8ZS5saW5rfHxlLmNvbnRlbnRzKXJldHVybiEwO2lmKCJ1bmRlZmluZWQiIT10eXBlb2YgWE1MSHR0cFJlcXVlc3QpdGhyb3cgbmV3IEVycm9yKCJMYXp5IGxvYWRpbmcgc2hvdWxkIGhhdmUgYmVlbiBwZXJmb3JtZWQgKGNvbnRlbnRzIHNldCkgaW4gY3JlYXRlTGF6eUZpbGUsIGJ1dCBpdCB3YXMgbm90LiBMYXp5IGxvYWRpbmcgb25seSB3b3JrcyBpbiB3ZWIgd29ya2Vycy4gVXNlIC0tZW1iZWQtZmlsZSBvciAtLXByZWxvYWQtZmlsZSBpbiBlbWNjIG9uIHRoZSBtYWluIHRocmVhZC4iKTtpZighbil0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBsb2FkIHdpdGhvdXQgcmVhZCgpIG9yIFhNTEh0dHBSZXF1ZXN0LiIpO3RyeXtlLmNvbnRlbnRzPURyKG4oZS51cmwpLCEwKSxlLnVzZWRCeXRlcz1lLmNvbnRlbnRzLmxlbmd0aH1jYXRjaChlKXt0aHJvdyBuZXcgYnIuRXJybm9FcnJvcigyOSl9fSxjcmVhdGVMYXp5RmlsZTooZSxyLHQsbixvKT0+e2Z1bmN0aW9uIGEoKXt0aGlzLmxlbmd0aEtub3duPSExLHRoaXMuY2h1bmtzPVtdfWlmKGEucHJvdG90eXBlLmdldD1mdW5jdGlvbihlKXtpZighKGU+dGhpcy5sZW5ndGgtMXx8ZTwwKSl7dmFyIHI9ZSV0aGlzLmNodW5rU2l6ZSx0PWUvdGhpcy5jaHVua1NpemV8MDtyZXR1cm4gdGhpcy5nZXR0ZXIodClbcl19fSxhLnByb3RvdHlwZS5zZXREYXRhR2V0dGVyPWZ1bmN0aW9uKGUpe3RoaXMuZ2V0dGVyPWV9LGEucHJvdG90eXBlLmNhY2hlTGVuZ3RoPWZ1bmN0aW9uKCl7dmFyIGU9bmV3IFhNTEh0dHBSZXF1ZXN0O2lmKGUub3BlbigiSEVBRCIsdCwhMSksZS5zZW5kKG51bGwpLCEoZS5zdGF0dXM+PTIwMCYmZS5zdGF0dXM8MzAwfHwzMDQ9PT1lLnN0YXR1cykpdGhyb3cgbmV3IEVycm9yKCJDb3VsZG4ndCBsb2FkICIrdCsiLiBTdGF0dXM6ICIrZS5zdGF0dXMpO3ZhciByLG49TnVtYmVyKGUuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtbGVuZ3RoIikpLG89KHI9ZS5nZXRSZXNwb25zZUhlYWRlcigiQWNjZXB0LVJhbmdlcyIpKSYmImJ5dGVzIj09PXIsYT0ocj1lLmdldFJlc3BvbnNlSGVhZGVyKCJDb250ZW50LUVuY29kaW5nIikpJiYiZ3ppcCI9PT1yLGk9MTA0ODU3NjtvfHwoaT1uKTt2YXIgcz10aGlzO3Muc2V0RGF0YUdldHRlcigoZT0+e3ZhciByPWUqaSxvPShlKzEpKmktMTtpZihvPU1hdGgubWluKG8sbi0xKSx2b2lkIDA9PT1zLmNodW5rc1tlXSYmKHMuY2h1bmtzW2VdPSgoZSxyKT0+e2lmKGU+cil0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgcmFuZ2UgKCIrZSsiLCAiK3IrIikgb3Igbm8gYnl0ZXMgcmVxdWVzdGVkISIpO2lmKHI+bi0xKXRocm93IG5ldyBFcnJvcigib25seSAiK24rIiBieXRlcyBhdmFpbGFibGUhIHByb2dyYW1tZXIgZXJyb3IhIik7dmFyIG89bmV3IFhNTEh0dHBSZXF1ZXN0O2lmKG8ub3BlbigiR0VUIix0LCExKSxuIT09aSYmby5zZXRSZXF1ZXN0SGVhZGVyKCJSYW5nZSIsImJ5dGVzPSIrZSsiLSIrciksby5yZXNwb25zZVR5cGU9ImFycmF5YnVmZmVyIixvLm92ZXJyaWRlTWltZVR5cGUmJm8ub3ZlcnJpZGVNaW1lVHlwZSgidGV4dC9wbGFpbjsgY2hhcnNldD14LXVzZXItZGVmaW5lZCIpLG8uc2VuZChudWxsKSwhKG8uc3RhdHVzPj0yMDAmJm8uc3RhdHVzPDMwMHx8MzA0PT09by5zdGF0dXMpKXRocm93IG5ldyBFcnJvcigiQ291bGRuJ3QgbG9hZCAiK3QrIi4gU3RhdHVzOiAiK28uc3RhdHVzKTtyZXR1cm4gdm9pZCAwIT09by5yZXNwb25zZT9uZXcgVWludDhBcnJheShvLnJlc3BvbnNlfHxbXSk6RHIoby5yZXNwb25zZVRleHR8fCIiLCEwKX0pKHIsbykpLHZvaWQgMD09PXMuY2h1bmtzW2VdKXRocm93IG5ldyBFcnJvcigiZG9YSFIgZmFpbGVkISIpO3JldHVybiBzLmNodW5rc1tlXX0pKSwhYSYmbnx8KGk9bj0xLG49dGhpcy5nZXR0ZXIoMCkubGVuZ3RoLGk9bixsKCJMYXp5RmlsZXMgb24gZ3ppcCBmb3JjZXMgZG93bmxvYWQgb2YgdGhlIHdob2xlIGZpbGUgd2hlbiBsZW5ndGggaXMgYWNjZXNzZWQiKSksdGhpcy5fbGVuZ3RoPW4sdGhpcy5fY2h1bmtTaXplPWksdGhpcy5sZW5ndGhLbm93bj0hMH0sInVuZGVmaW5lZCIhPXR5cGVvZiBYTUxIdHRwUmVxdWVzdCl0aHJvdyJDYW5ub3QgZG8gc3luY2hyb25vdXMgYmluYXJ5IFhIUnMgb3V0c2lkZSB3ZWJ3b3JrZXJzIGluIG1vZGVybiBicm93c2Vycy4gVXNlIC0tZW1iZWQtZmlsZSBvciAtLXByZWxvYWQtZmlsZSBpbiBlbWNjIjt2YXIgaT17aXNEZXZpY2U6ITEsdXJsOnR9LHM9YnIuY3JlYXRlRmlsZShlLHIsaSxuLG8pO2kuY29udGVudHM/cy5jb250ZW50cz1pLmNvbnRlbnRzOmkudXJsJiYocy5jb250ZW50cz1udWxsLHMudXJsPWkudXJsKSxPYmplY3QuZGVmaW5lUHJvcGVydGllcyhzLHt1c2VkQnl0ZXM6e2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbnRlbnRzLmxlbmd0aH19fSk7dmFyIHU9e307cmV0dXJuIE9iamVjdC5rZXlzKHMuc3RyZWFtX29wcykuZm9yRWFjaCgoZT0+e3ZhciByPXMuc3RyZWFtX29wc1tlXTt1W2VdPWZ1bmN0aW9uKCl7cmV0dXJuIGJyLmZvcmNlTG9hZEZpbGUocyksci5hcHBseShudWxsLGFyZ3VtZW50cyl9fSkpLHUucmVhZD0oZSxyLHQsbixvKT0+e2JyLmZvcmNlTG9hZEZpbGUocyk7dmFyIGE9ZS5ub2RlLmNvbnRlbnRzO2lmKG8+PWEubGVuZ3RoKXJldHVybiAwO3ZhciBpPU1hdGgubWluKGEubGVuZ3RoLW8sbik7aWYoYS5zbGljZSlmb3IodmFyIHU9MDt1PGk7dSsrKXJbdCt1XT1hW28rdV07ZWxzZSBmb3IodT0wO3U8aTt1Kyspclt0K3VdPWEuZ2V0KG8rdSk7cmV0dXJuIGl9LHMuc3RyZWFtX29wcz11LHN9LGNyZWF0ZVByZWxvYWRlZEZpbGU6KGUscix0LG4sbyxpLHMsdSxjLGwpPT57dmFyIGQ9cj9nci5yZXNvbHZlKHdyLmpvaW4yKGUscikpOmU7ZnVuY3Rpb24gZih0KXtmdW5jdGlvbiBhKHQpe2wmJmwoKSx1fHxici5jcmVhdGVEYXRhRmlsZShlLHIsdCxuLG8sYyksaSYmaSgpLFEoKX1Ccm93c2VyLmhhbmRsZWRCeVByZWxvYWRQbHVnaW4odCxkLGEsKCgpPT57cyYmcygpLFEoKX0pKXx8YSh0KX1KKCksInN0cmluZyI9PXR5cGVvZiB0P2Z1bmN0aW9uKGUscix0LG4pe3ZhciBvPSJhbCAiK2U7YShlLChmdW5jdGlvbihyKXt2KHIsJ0xvYWRpbmcgZGF0YSBmaWxlICInK2UrJyIgZmFpbGVkIChubyBhcnJheUJ1ZmZlcikuJyksZihuZXcgVWludDhBcnJheShyKSksbyYmUSgpfSksKGZ1bmN0aW9uKHIpe2lmKCF0KXRocm93J0xvYWRpbmcgZGF0YSBmaWxlICInK2UrJyIgZmFpbGVkLic7dCgpfSkpLG8mJkooKX0odCwwLHMpOmYodCl9LGluZGV4ZWREQjooKT0+d2luZG93LmluZGV4ZWREQnx8d2luZG93Lm1vekluZGV4ZWREQnx8d2luZG93LndlYmtpdEluZGV4ZWREQnx8d2luZG93Lm1zSW5kZXhlZERCLERCX05BTUU6KCk9PiJFTV9GU18iK3dpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSxEQl9WRVJTSU9OOjIwLERCX1NUT1JFX05BTUU6IkZJTEVfREFUQSIsc2F2ZUZpbGVzVG9EQjooZSxyLHQpPT57cj1yfHwoKCk9Pnt9KSx0PXR8fCgoKT0+e30pO3ZhciBuPWJyLmluZGV4ZWREQigpO3RyeXt2YXIgbz1uLm9wZW4oYnIuREJfTkFNRSgpLGJyLkRCX1ZFUlNJT04pfWNhdGNoKGUpe3JldHVybiB0KGUpfW8ub251cGdyYWRlbmVlZGVkPSgpPT57bCgiY3JlYXRpbmcgZGIiKSxvLnJlc3VsdC5jcmVhdGVPYmplY3RTdG9yZShici5EQl9TVE9SRV9OQU1FKX0sby5vbnN1Y2Nlc3M9KCk9Pnt2YXIgbj1vLnJlc3VsdC50cmFuc2FjdGlvbihbYnIuREJfU1RPUkVfTkFNRV0sInJlYWR3cml0ZSIpLGE9bi5vYmplY3RTdG9yZShici5EQl9TVE9SRV9OQU1FKSxpPTAscz0wLHU9ZS5sZW5ndGg7ZnVuY3Rpb24gYygpezA9PXM/cigpOnQoKX1lLmZvckVhY2goKGU9Pnt2YXIgcj1hLnB1dChici5hbmFseXplUGF0aChlKS5vYmplY3QuY29udGVudHMsZSk7ci5vbnN1Y2Nlc3M9KCk9PnsrK2krcz09dSYmYygpfSxyLm9uZXJyb3I9KCk9PntzKyssaStzPT11JiZjKCl9fSkpLG4ub25lcnJvcj10fSxvLm9uZXJyb3I9dH0sbG9hZEZpbGVzRnJvbURCOihlLHIsdCk9PntyPXJ8fCgoKT0+e30pLHQ9dHx8KCgpPT57fSk7dmFyIG49YnIuaW5kZXhlZERCKCk7dHJ5e3ZhciBvPW4ub3Blbihici5EQl9OQU1FKCksYnIuREJfVkVSU0lPTil9Y2F0Y2goZSl7cmV0dXJuIHQoZSl9by5vbnVwZ3JhZGVuZWVkZWQ9dCxvLm9uc3VjY2Vzcz0oKT0+e3ZhciBuPW8ucmVzdWx0O3RyeXt2YXIgYT1uLnRyYW5zYWN0aW9uKFtici5EQl9TVE9SRV9OQU1FXSwicmVhZG9ubHkiKX1jYXRjaChlKXtyZXR1cm4gdm9pZCB0KGUpfXZhciBpPWEub2JqZWN0U3RvcmUoYnIuREJfU1RPUkVfTkFNRSkscz0wLHU9MCxjPWUubGVuZ3RoO2Z1bmN0aW9uIGwoKXswPT11P3IoKTp0KCl9ZS5mb3JFYWNoKChlPT57dmFyIHI9aS5nZXQoZSk7ci5vbnN1Y2Nlc3M9KCk9Pntici5hbmFseXplUGF0aChlKS5leGlzdHMmJmJyLnVubGluayhlKSxici5jcmVhdGVEYXRhRmlsZSh3ci5kaXJuYW1lKGUpLHdyLmJhc2VuYW1lKGUpLHIucmVzdWx0LCEwLCEwLCEwKSwrK3MrdT09YyYmbCgpfSxyLm9uZXJyb3I9KCk9Pnt1Kysscyt1PT1jJiZsKCl9fSkpLGEub25lcnJvcj10fSxvLm9uZXJyb3I9dH19LGtyPXtERUZBVUxUX1BPTExNQVNLOjUsY2FsY3VsYXRlQXQ6ZnVuY3Rpb24oZSxyLHQpe2lmKHdyLmlzQWJzKHIpKXJldHVybiByO3ZhciBuO2lmKC0xMDA9PT1lKW49YnIuY3dkKCk7ZWxzZXt2YXIgbz1ici5nZXRTdHJlYW0oZSk7aWYoIW8pdGhyb3cgbmV3IGJyLkVycm5vRXJyb3IoOCk7bj1vLnBhdGh9aWYoMD09ci5sZW5ndGgpe2lmKCF0KXRocm93IG5ldyBici5FcnJub0Vycm9yKDQ0KTtyZXR1cm4gbn1yZXR1cm4gd3Iuam9pbjIobixyKX0sZG9TdGF0OmZ1bmN0aW9uKGUscix0KXt0cnl7dmFyIG49ZShyKX1jYXRjaChlKXtpZihlJiZlLm5vZGUmJndyLm5vcm1hbGl6ZShyKSE9PXdyLm5vcm1hbGl6ZShici5nZXRQYXRoKGUubm9kZSkpKXJldHVybi01NDt0aHJvdyBlfXJldHVybiBEW3Q+PjJdPW4uZGV2LERbdCs0Pj4yXT0wLERbdCs4Pj4yXT1uLmlubyxEW3QrMTI+PjJdPW4ubW9kZSxEW3QrMTY+PjJdPW4ubmxpbmssRFt0KzIwPj4yXT1uLnVpZCxEW3QrMjQ+PjJdPW4uZ2lkLERbdCsyOD4+Ml09bi5yZGV2LERbdCszMj4+Ml09MCxVPVtuLnNpemU+Pj4wLChMPW4uc2l6ZSwrTWF0aC5hYnMoTCk+PTE/TD4wPygwfE1hdGgubWluKCtNYXRoLmZsb29yKEwvNDI5NDk2NzI5NiksNDI5NDk2NzI5NSkpPj4+MDp+fitNYXRoLmNlaWwoKEwtKyh+fkw+Pj4wKSkvNDI5NDk2NzI5Nik+Pj4wOjApXSxEW3QrNDA+PjJdPVVbMF0sRFt0KzQ0Pj4yXT1VWzFdLERbdCs0OD4+Ml09NDA5NixEW3QrNTI+PjJdPW4uYmxvY2tzLERbdCs1Nj4+Ml09bi5hdGltZS5nZXRUaW1lKCkvMWUzfDAsRFt0KzYwPj4yXT0wLERbdCs2ND4+Ml09bi5tdGltZS5nZXRUaW1lKCkvMWUzfDAsRFt0KzY4Pj4yXT0wLERbdCs3Mj4+Ml09bi5jdGltZS5nZXRUaW1lKCkvMWUzfDAsRFt0Kzc2Pj4yXT0wLFU9W24uaW5vPj4+MCwoTD1uLmlubywrTWF0aC5hYnMoTCk+PTE/TD4wPygwfE1hdGgubWluKCtNYXRoLmZsb29yKEwvNDI5NDk2NzI5NiksNDI5NDk2NzI5NSkpPj4+MDp+fitNYXRoLmNlaWwoKEwtKyh+fkw+Pj4wKSkvNDI5NDk2NzI5Nik+Pj4wOjApXSxEW3QrODA+PjJdPVVbMF0sRFt0Kzg0Pj4yXT1VWzFdLDB9LGRvTXN5bmM6ZnVuY3Rpb24oZSxyLHQsbixvKXt2YXIgYT1ULnNsaWNlKGUsZSt0KTtici5tc3luYyhyLGEsbyx0LG4pfSxkb01rbm9kOmZ1bmN0aW9uKGUscix0KXtzd2l0Y2goNjE0NDAmcil7Y2FzZSAzMjc2ODpjYXNlIDgxOTI6Y2FzZSAyNDU3NjpjYXNlIDQwOTY6Y2FzZSA0OTE1MjpicmVhaztkZWZhdWx0OnJldHVybi0yOH1yZXR1cm4gYnIubWtub2QoZSxyLHQpLDB9LGRvUmVhZGxpbms6ZnVuY3Rpb24oZSxyLHQpe2lmKHQ8PTApcmV0dXJuLTI4O3ZhciBuPWJyLnJlYWRsaW5rKGUpLG89TWF0aC5taW4odCxiKG4pKSxhPVBbcitvXTtyZXR1cm4gXyhuLHIsdCsxKSxQW3Irb109YSxvfSxkb0FjY2VzczpmdW5jdGlvbihlLHIpe2lmKC04JnIpcmV0dXJuLTI4O3ZhciB0PWJyLmxvb2t1cFBhdGgoZSx7Zm9sbG93OiEwfSkubm9kZTtpZighdClyZXR1cm4tNDQ7dmFyIG49IiI7cmV0dXJuIDQmciYmKG4rPSJyIiksMiZyJiYobis9InciKSwxJnImJihuKz0ieCIpLG4mJmJyLm5vZGVQZXJtaXNzaW9ucyh0LG4pPy0yOjB9LGRvUmVhZHY6ZnVuY3Rpb24oZSxyLHQsbil7Zm9yKHZhciBvPTAsYT0wO2E8dDthKyspe3ZhciBpPURbcj4+Ml0scz1EW3IrND4+Ml07cis9ODt2YXIgdT1ici5yZWFkKGUsUCxpLHMsbik7aWYodTwwKXJldHVybi0xO2lmKG8rPXUsdTxzKWJyZWFrfXJldHVybiBvfSxkb1dyaXRldjpmdW5jdGlvbihlLHIsdCxuKXtmb3IodmFyIG89MCxhPTA7YTx0O2ErKyl7dmFyIGk9RFtyPj4yXSxzPURbcis0Pj4yXTtyKz04O3ZhciB1PWJyLndyaXRlKGUsUCxpLHMsbik7aWYodTwwKXJldHVybi0xO28rPXV9cmV0dXJuIG99LHZhcmFyZ3M6dm9pZCAwLGdldDpmdW5jdGlvbigpe3JldHVybiBrci52YXJhcmdzKz00LERba3IudmFyYXJncy00Pj4yXX0sZ2V0U3RyOmZ1bmN0aW9uKGUpe3JldHVybiBnKGUpfSxnZXRTdHJlYW1Gcm9tRkQ6ZnVuY3Rpb24oZSl7dmFyIHI9YnIuZ2V0U3RyZWFtKGUpO2lmKCFyKXRocm93IG5ldyBici5FcnJub0Vycm9yKDgpO3JldHVybiByfX07ZnVuY3Rpb24gUHIoZSl7cmV0dXJuIGUlND09MCYmKGUlMTAwIT0wfHxlJTQwMD09MCl9dmFyIFRyPVszMSwyOSwzMSwzMCwzMSwzMCwzMSwzMSwzMCwzMSwzMCwzMV0sU3I9WzMxLDI4LDMxLDMwLDMxLDMwLDMxLDMxLDMwLDMxLDMwLDMxXTt5ZT1lLkludGVybmFsRXJyb3I9dmUoRXJyb3IsIkludGVybmFsRXJyb3IiKSxmdW5jdGlvbigpe2Zvcih2YXIgZT1uZXcgQXJyYXkoMjU2KSxyPTA7cjwyNTY7KytyKWVbcl09U3RyaW5nLmZyb21DaGFyQ29kZShyKTtfZT1lfSgpLGtlPWUuQmluZGluZ0Vycm9yPXZlKEVycm9yLCJCaW5kaW5nRXJyb3IiKSx6ZS5wcm90b3R5cGUuaXNBbGlhc09mPWZ1bmN0aW9uKGUpe2lmKCEodGhpcyBpbnN0YW5jZW9mIHplKSlyZXR1cm4hMTtpZighKGUgaW5zdGFuY2VvZiB6ZSkpcmV0dXJuITE7Zm9yKHZhciByPXRoaXMuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3MsdD10aGlzLiQkLnB0cixuPWUuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3Msbz1lLiQkLnB0cjtyLmJhc2VDbGFzczspdD1yLnVwY2FzdCh0KSxyPXIuYmFzZUNsYXNzO2Zvcig7bi5iYXNlQ2xhc3M7KW89bi51cGNhc3Qobyksbj1uLmJhc2VDbGFzcztyZXR1cm4gcj09PW4mJnQ9PT1vfSx6ZS5wcm90b3R5cGUuY2xvbmU9ZnVuY3Rpb24oKXtpZih0aGlzLiQkLnB0cnx8U2UodGhpcyksdGhpcy4kJC5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSlyZXR1cm4gdGhpcy4kJC5jb3VudC52YWx1ZSs9MSx0aGlzO3ZhciBlLHI9SWUoT2JqZWN0LmNyZWF0ZShPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcykseyQkOnt2YWx1ZTooZT10aGlzLiQkLHtjb3VudDplLmNvdW50LGRlbGV0ZVNjaGVkdWxlZDplLmRlbGV0ZVNjaGVkdWxlZCxwcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZTplLnByZXNlcnZlUG9pbnRlck9uRGVsZXRlLHB0cjplLnB0cixwdHJUeXBlOmUucHRyVHlwZSxzbWFydFB0cjplLnNtYXJ0UHRyLHNtYXJ0UHRyVHlwZTplLnNtYXJ0UHRyVHlwZX0pfX0pKTtyZXR1cm4gci4kJC5jb3VudC52YWx1ZSs9MSxyLiQkLmRlbGV0ZVNjaGVkdWxlZD0hMSxyfSx6ZS5wcm90b3R5cGUuZGVsZXRlPWZ1bmN0aW9uKCl7dGhpcy4kJC5wdHJ8fFNlKHRoaXMpLHRoaXMuJCQuZGVsZXRlU2NoZWR1bGVkJiYhdGhpcy4kJC5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSYmUGUoIk9iamVjdCBhbHJlYWR5IHNjaGVkdWxlZCBmb3IgZGVsZXRpb24iKSxEZSh0aGlzKSxGZSh0aGlzLiQkKSx0aGlzLiQkLnByZXNlcnZlUG9pbnRlck9uRGVsZXRlfHwodGhpcy4kJC5zbWFydFB0cj12b2lkIDAsdGhpcy4kJC5wdHI9dm9pZCAwKX0semUucHJvdG90eXBlLmlzRGVsZXRlZD1mdW5jdGlvbigpe3JldHVybiF0aGlzLiQkLnB0cn0semUucHJvdG90eXBlLmRlbGV0ZUxhdGVyPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuJCQucHRyfHxTZSh0aGlzKSx0aGlzLiQkLmRlbGV0ZVNjaGVkdWxlZCYmIXRoaXMuJCQucHJlc2VydmVQb2ludGVyT25EZWxldGUmJlBlKCJPYmplY3QgYWxyZWFkeSBzY2hlZHVsZWQgZm9yIGRlbGV0aW9uIiksJGUucHVzaCh0aGlzKSwxPT09JGUubGVuZ3RoJiZPZSYmT2UoeGUpLHRoaXMuJCQuZGVsZXRlU2NoZWR1bGVkPSEwLHRoaXN9LGUuZ2V0SW5oZXJpdGVkSW5zdGFuY2VDb3VudD1mdW5jdGlvbigpe3JldHVybiBPYmplY3Qua2V5cyhSZSkubGVuZ3RofSxlLmdldExpdmVJbmhlcml0ZWRJbnN0YW5jZXM9ZnVuY3Rpb24oKXt2YXIgZT1bXTtmb3IodmFyIHIgaW4gUmUpUmUuaGFzT3duUHJvcGVydHkocikmJmUucHVzaChSZVtyXSk7cmV0dXJuIGV9LGUuZmx1c2hQZW5kaW5nRGVsZXRlcz14ZSxlLnNldERlbGF5RnVuY3Rpb249ZnVuY3Rpb24oZSl7T2U9ZSwkZS5sZW5ndGgmJk9lJiZPZSh4ZSl9LFllLnByb3RvdHlwZS5nZXRQb2ludGVlPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnJhd0dldFBvaW50ZWUmJihlPXRoaXMucmF3R2V0UG9pbnRlZShlKSksZX0sWWUucHJvdG90eXBlLmRlc3RydWN0b3I9ZnVuY3Rpb24oZSl7dGhpcy5yYXdEZXN0cnVjdG9yJiZ0aGlzLnJhd0Rlc3RydWN0b3IoZSl9LFllLnByb3RvdHlwZS5hcmdQYWNrQWR2YW5jZT04LFllLnByb3RvdHlwZS5yZWFkVmFsdWVGcm9tUG9pbnRlcj1sZSxZZS5wcm90b3R5cGUuZGVsZXRlT2JqZWN0PWZ1bmN0aW9uKGUpe251bGwhPT1lJiZlLmRlbGV0ZSgpfSxZZS5wcm90b3R5cGUuZnJvbVdpcmVUeXBlPWZ1bmN0aW9uKGUpe3ZhciByPXRoaXMuZ2V0UG9pbnRlZShlKTtpZighcilyZXR1cm4gdGhpcy5kZXN0cnVjdG9yKGUpLG51bGw7dmFyIHQ9ZnVuY3Rpb24oZSxyKXtyZXR1cm4gcj1mdW5jdGlvbihlLHIpe2Zvcih2b2lkIDA9PT1yJiZQZSgicHRyIHNob3VsZCBub3QgYmUgdW5kZWZpbmVkIik7ZS5iYXNlQ2xhc3M7KXI9ZS51cGNhc3QociksZT1lLmJhc2VDbGFzcztyZXR1cm4gcn0oZSxyKSxSZVtyXX0odGhpcy5yZWdpc3RlcmVkQ2xhc3Mscik7aWYodm9pZCAwIT09dCl7aWYoMD09PXQuJCQuY291bnQudmFsdWUpcmV0dXJuIHQuJCQucHRyPXIsdC4kJC5zbWFydFB0cj1lLHQuY2xvbmUoKTt2YXIgbj10LmNsb25lKCk7cmV0dXJuIHRoaXMuZGVzdHJ1Y3RvcihlKSxufWZ1bmN0aW9uIG8oKXtyZXR1cm4gdGhpcy5pc1NtYXJ0UG9pbnRlcj9qZSh0aGlzLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZSx7cHRyVHlwZTp0aGlzLnBvaW50ZWVUeXBlLHB0cjpyLHNtYXJ0UHRyVHlwZTp0aGlzLHNtYXJ0UHRyOmV9KTpqZSh0aGlzLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZSx7cHRyVHlwZTp0aGlzLHB0cjplfSl9dmFyIGEsaT10aGlzLnJlZ2lzdGVyZWRDbGFzcy5nZXRBY3R1YWxUeXBlKHIpLHM9TWVbaV07aWYoIXMpcmV0dXJuIG8uY2FsbCh0aGlzKTthPXRoaXMuaXNDb25zdD9zLmNvbnN0UG9pbnRlclR5cGU6cy5wb2ludGVyVHlwZTt2YXIgdT1BZShyLHRoaXMucmVnaXN0ZXJlZENsYXNzLGEucmVnaXN0ZXJlZENsYXNzKTtyZXR1cm4gbnVsbD09PXU/by5jYWxsKHRoaXMpOnRoaXMuaXNTbWFydFBvaW50ZXI/amUoYS5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUse3B0clR5cGU6YSxwdHI6dSxzbWFydFB0clR5cGU6dGhpcyxzbWFydFB0cjplfSk6amUoYS5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUse3B0clR5cGU6YSxwdHI6dX0pfSxKZT1lLlVuYm91bmRUeXBlRXJyb3I9dmUoRXJyb3IsIlVuYm91bmRUeXBlRXJyb3IiKSxlLmNvdW50X2VtdmFsX2hhbmRsZXM9ZnVuY3Rpb24oKXtmb3IodmFyIGU9MCxyPTU7cjxuci5sZW5ndGg7KytyKXZvaWQgMCE9PW5yW3JdJiYrK2U7cmV0dXJuIGV9LGUuZ2V0X2ZpcnN0X2VtdmFsPWZ1bmN0aW9uKCl7Zm9yKHZhciBlPTU7ZTxuci5sZW5ndGg7KytlKWlmKHZvaWQgMCE9PW5yW2VdKXJldHVybiBucltlXTtyZXR1cm4gbnVsbH07dmFyIENyPWZ1bmN0aW9uKGUscix0LG4pe2V8fChlPXRoaXMpLHRoaXMucGFyZW50PWUsdGhpcy5tb3VudD1lLm1vdW50LHRoaXMubW91bnRlZD1udWxsLHRoaXMuaWQ9YnIubmV4dElub2RlKyssdGhpcy5uYW1lPXIsdGhpcy5tb2RlPXQsdGhpcy5ub2RlX29wcz17fSx0aGlzLnN0cmVhbV9vcHM9e30sdGhpcy5yZGV2PW59O2Z1bmN0aW9uIERyKGUscix0KXt2YXIgbj10PjA/dDpiKGUpKzEsbz1uZXcgQXJyYXkobiksYT1FKGUsbywwLG8ubGVuZ3RoKTtyZXR1cm4gciYmKG8ubGVuZ3RoPWEpLG99T2JqZWN0LmRlZmluZVByb3BlcnRpZXMoQ3IucHJvdG90eXBlLHtyZWFkOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gMzY1PT0oMzY1JnRoaXMubW9kZSl9LHNldDpmdW5jdGlvbihlKXtlP3RoaXMubW9kZXw9MzY1OnRoaXMubW9kZSY9LTM2Nn19LHdyaXRlOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gMTQ2PT0oMTQ2JnRoaXMubW9kZSl9LHNldDpmdW5jdGlvbihlKXtlP3RoaXMubW9kZXw9MTQ2OnRoaXMubW9kZSY9LTE0N319LGlzRm9sZGVyOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYnIuaXNEaXIodGhpcy5tb2RlKX19LGlzRGV2aWNlOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYnIuaXNDaHJkZXYodGhpcy5tb2RlKX19fSksYnIuRlNOb2RlPUNyLGJyLnN0YXRpY0luaXQoKTt2YXIgRnIsQXI9e2E6ZnVuY3Rpb24oZSxyLHQsbil7SygiQXNzZXJ0aW9uIGZhaWxlZDogIitnKGUpKyIsIGF0OiAiK1tyP2cocik6InVua25vd24gZmlsZW5hbWUiLHQsbj9nKG4pOiJ1bmtub3duIGZ1bmN0aW9uIl0pfSxnOmZ1bmN0aW9uKGUpe3JldHVybiAkcihlKzI0KSsyNH0sdzpmdW5jdGlvbihlKXt2YXIgcj1uZXcgYWUoZSk7cmV0dXJuIHIuZ2V0X2NhdWdodCgpfHwoci5zZXRfY2F1Z2h0KCEwKSxuZS0tKSxyLnNldF9yZXRocm93bighMSksdGUucHVzaChyKSxmdW5jdGlvbihlKXtlLmFkZF9yZWYoKX0ociksci5nZXRfZXhjZXB0aW9uX3B0cigpfSx6OmZ1bmN0aW9uKCl7anIoMCksZnVuY3Rpb24oZSl7aWYoZS5yZWxlYXNlX3JlZigpJiYhZS5nZXRfcmV0aHJvd24oKSl7dmFyIHI9ZS5nZXRfZGVzdHJ1Y3RvcigpO3ImJnJlKHIpKGUuZXhjUHRyKSxpZShlLmV4Y1B0cil9fSh0ZS5wb3AoKSksb2U9MH0sZDpmdW5jdGlvbigpe3ZhciBlPW9lO2lmKCFlKXJldHVybiBoKDApLDA7dmFyIHI9bmV3IGFlKGUpO3Iuc2V0X2FkanVzdGVkX3B0cihlKTt2YXIgdD1yLmdldF90eXBlKCk7aWYoIXQpcmV0dXJuIGgoMCksMHxlO2Zvcih2YXIgbj1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpLG89MDtvPG4ubGVuZ3RoO28rKyl7dmFyIGE9bltvXTtpZigwPT09YXx8YT09PXQpYnJlYWs7dmFyIGk9ci5wdHIrMTY7aWYoQnIoYSx0LGkpKXJldHVybiBoKGEpLDB8ZX1yZXR1cm4gaCh0KSwwfGV9LGw6ZnVuY3Rpb24oKXt2YXIgZT1vZTtpZighZSlyZXR1cm4gaCgwKSwwO3ZhciByPW5ldyBhZShlKTtyLnNldF9hZGp1c3RlZF9wdHIoZSk7dmFyIHQ9ci5nZXRfdHlwZSgpO2lmKCF0KXJldHVybiBoKDApLDB8ZTtmb3IodmFyIG49QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSxvPTA7bzxuLmxlbmd0aDtvKyspe3ZhciBhPW5bb107aWYoMD09PWF8fGE9PT10KWJyZWFrO3ZhciBpPXIucHRyKzE2O2lmKEJyKGEsdCxpKSlyZXR1cm4gaChhKSwwfGV9cmV0dXJuIGgodCksMHxlfSxDOmllLFg6ZnVuY3Rpb24oKXt2YXIgZT10ZS5wb3AoKTtlfHxLKCJubyBleGNlcHRpb24gdG8gdGhyb3ciKTt2YXIgcj1lLmV4Y1B0cjt0aHJvdyBlLmdldF9yZXRocm93bigpfHwodGUucHVzaChlKSxlLnNldF9yZXRocm93bighMCksZS5zZXRfY2F1Z2h0KCExKSxuZSsrKSxvZT1yLHJ9LGY6ZnVuY3Rpb24oZSxyLHQpe3Rocm93IG5ldyBhZShlKS5pbml0KHIsdCksb2U9ZSxuZSsrLGV9LGdhOmZ1bmN0aW9uKCl7cmV0dXJuIG5lfSxpOmZ1bmN0aW9uKGUpe3Rocm93IG9lfHwob2U9ZSksZX0scWE6ZnVuY3Rpb24oZSl7fSxzYTpmdW5jdGlvbihlLHIpe0soc2UpfSxyYTpmdW5jdGlvbihlLHIpe0soc2UpfSxZOmZ1bmN0aW9uKGUpe3ZhciByPXVlW2VdO2RlbGV0ZSB1ZVtlXTt2YXIgdD1yLnJhd0NvbnN0cnVjdG9yLG49ci5yYXdEZXN0cnVjdG9yLG89ci5maWVsZHM7Z2UoW2VdLG8ubWFwKChlPT5lLmdldHRlclJldHVyblR5cGUpKS5jb25jYXQoby5tYXAoKGU9PmUuc2V0dGVyQXJndW1lbnRUeXBlKSkpLChlPT57dmFyIGE9e307cmV0dXJuIG8uZm9yRWFjaCgoKHIsdCk9Pnt2YXIgbj1yLmZpZWxkTmFtZSxpPWVbdF0scz1yLmdldHRlcix1PXIuZ2V0dGVyQ29udGV4dCxjPWVbdCtvLmxlbmd0aF0sbD1yLnNldHRlcixkPXIuc2V0dGVyQ29udGV4dDthW25dPXtyZWFkOmU9PmkuZnJvbVdpcmVUeXBlKHModSxlKSksd3JpdGU6KGUscik9Pnt2YXIgdD1bXTtsKGQsZSxjLnRvV2lyZVR5cGUodCxyKSksY2UodCl9fX0pKSxbe25hbWU6ci5uYW1lLGZyb21XaXJlVHlwZTpmdW5jdGlvbihlKXt2YXIgcj17fTtmb3IodmFyIHQgaW4gYSlyW3RdPWFbdF0ucmVhZChlKTtyZXR1cm4gbihlKSxyfSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUscil7Zm9yKHZhciBvIGluIGEpaWYoIShvIGluIHIpKXRocm93IG5ldyBUeXBlRXJyb3IoJ01pc3NpbmcgZmllbGQ6ICAiJytvKyciJyk7dmFyIGk9dCgpO2ZvcihvIGluIGEpYVtvXS53cml0ZShpLHJbb10pO3JldHVybiBudWxsIT09ZSYmZS5wdXNoKG4saSksaX0sYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpsZSxkZXN0cnVjdG9yRnVuY3Rpb246bn1dfSkpfSxjYTpmdW5jdGlvbihlLHIsdCxuLG8pe30sd2E6ZnVuY3Rpb24oZSxyLHQsbixvKXt2YXIgYT1FZSh0KTtUZShlLHtuYW1lOnI9YmUociksZnJvbVdpcmVUeXBlOmZ1bmN0aW9uKGUpe3JldHVybiEhZX0sdG9XaXJlVHlwZTpmdW5jdGlvbihlLHIpe3JldHVybiByP246b30sYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpmdW5jdGlvbihlKXt2YXIgbjtpZigxPT09dCluPVA7ZWxzZSBpZigyPT09dCluPVM7ZWxzZXtpZig0IT09dCl0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIGJvb2xlYW4gdHlwZSBzaXplOiAiK3IpO249RH1yZXR1cm4gdGhpcy5mcm9tV2lyZVR5cGUobltlPj5hXSl9LGRlc3RydWN0b3JGdW5jdGlvbjpudWxsfSl9LHg6ZnVuY3Rpb24oZSxyLHQsbixvLGEsaSxzLHUsYyxsLGQsZil7bD1iZShsKSxhPVhlKG8sYSkscyYmKHM9WGUoaSxzKSksYyYmKGM9WGUodSxjKSksZj1YZShkLGYpO3ZhciBwPWhlKGwpO1dlKHAsKGZ1bmN0aW9uKCl7S2UoIkNhbm5vdCBjb25zdHJ1Y3QgIitsKyIgZHVlIHRvIHVuYm91bmQgdHlwZXMiLFtuXSl9KSksZ2UoW2Uscix0XSxuP1tuXTpbXSwoZnVuY3Rpb24ocil7dmFyIHQsbztyPXJbMF0sbz1uPyh0PXIucmVnaXN0ZXJlZENsYXNzKS5pbnN0YW5jZVByb3RvdHlwZTp6ZS5wcm90b3R5cGU7dmFyIGk9bWUocCwoZnVuY3Rpb24oKXtpZihPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcykhPT11KXRocm93IG5ldyBrZSgiVXNlICduZXcnIHRvIGNvbnN0cnVjdCAiK2wpO2lmKHZvaWQgMD09PWQuY29uc3RydWN0b3JfYm9keSl0aHJvdyBuZXcga2UobCsiIGhhcyBubyBhY2Nlc3NpYmxlIGNvbnN0cnVjdG9yIik7dmFyIGU9ZC5jb25zdHJ1Y3Rvcl9ib2R5W2FyZ3VtZW50cy5sZW5ndGhdO2lmKHZvaWQgMD09PWUpdGhyb3cgbmV3IGtlKCJUcmllZCB0byBpbnZva2UgY3RvciBvZiAiK2wrIiB3aXRoIGludmFsaWQgbnVtYmVyIG9mIHBhcmFtZXRlcnMgKCIrYXJndW1lbnRzLmxlbmd0aCsiKSAtIGV4cGVjdGVkICgiK09iamVjdC5rZXlzKGQuY29uc3RydWN0b3JfYm9keSkudG9TdHJpbmcoKSsiKSBwYXJhbWV0ZXJzIGluc3RlYWQhIik7cmV0dXJuIGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfSkpLHU9T2JqZWN0LmNyZWF0ZShvLHtjb25zdHJ1Y3Rvcjp7dmFsdWU6aX19KTtpLnByb3RvdHlwZT11O3ZhciBkPW5ldyBOZShsLGksdSxmLHQsYSxzLGMpLGg9bmV3IFllKGwsZCwhMCwhMSwhMSksbT1uZXcgWWUobCsiKiIsZCwhMSwhMSwhMSksdj1uZXcgWWUobCsiIGNvbnN0KiIsZCwhMSwhMCwhMSk7cmV0dXJuIE1lW2VdPXtwb2ludGVyVHlwZTptLGNvbnN0UG9pbnRlclR5cGU6dn0scWUocCxpKSxbaCxtLHZdfSkpfSxPOmZ1bmN0aW9uKGUscix0LG4sbyxhLGkpe3ZhciBzPXJyKHQsbik7cj1iZShyKSxhPVhlKG8sYSksZ2UoW10sW2VdLChmdW5jdGlvbihlKXt2YXIgbj0oZT1lWzBdKS5uYW1lKyIuIityO2Z1bmN0aW9uIG8oKXtLZSgiQ2Fubm90IGNhbGwgIituKyIgZHVlIHRvIHVuYm91bmQgdHlwZXMiLHMpfXIuc3RhcnRzV2l0aCgiQEAiKSYmKHI9U3ltYm9sW3Iuc3Vic3RyaW5nKDIpXSk7dmFyIHU9ZS5yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3I7cmV0dXJuIHZvaWQgMD09PXVbcl0/KG8uYXJnQ291bnQ9dC0xLHVbcl09byk6KEJlKHUscixuKSx1W3JdLm92ZXJsb2FkVGFibGVbdC0xXT1vKSxnZShbXSxzLChmdW5jdGlvbihlKXt2YXIgbz1bZVswXSxudWxsXS5jb25jYXQoZS5zbGljZSgxKSkscz1lcihuLG8sbnVsbCxhLGkpO3JldHVybiB2b2lkIDA9PT11W3JdLm92ZXJsb2FkVGFibGU/KHMuYXJnQ291bnQ9dC0xLHVbcl09cyk6dVtyXS5vdmVybG9hZFRhYmxlW3QtMV09cyxbXX0pKSxbXX0pKX0sdTpmdW5jdGlvbihlLHIsdCxuLG8sYSl7dihyPjApO3ZhciBpPXJyKHIsdCk7bz1YZShuLG8pLGdlKFtdLFtlXSwoZnVuY3Rpb24oZSl7dmFyIHQ9ImNvbnN0cnVjdG9yICIrKGU9ZVswXSkubmFtZTtpZih2b2lkIDA9PT1lLnJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcl9ib2R5JiYoZS5yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keT1bXSksdm9pZCAwIT09ZS5yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keVtyLTFdKXRocm93IG5ldyBrZSgiQ2Fubm90IHJlZ2lzdGVyIG11bHRpcGxlIGNvbnN0cnVjdG9ycyB3aXRoIGlkZW50aWNhbCBudW1iZXIgb2YgcGFyYW1ldGVycyAoIisoci0xKSsiKSBmb3IgY2xhc3MgJyIrZS5uYW1lKyInISBPdmVybG9hZCByZXNvbHV0aW9uIGlzIGN1cnJlbnRseSBvbmx5IHBlcmZvcm1lZCB1c2luZyB0aGUgcGFyYW1ldGVyIGNvdW50LCBub3QgYWN0dWFsIHR5cGUgaW5mbyEiKTtyZXR1cm4gZS5yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keVtyLTFdPSgpPT57S2UoIkNhbm5vdCBjb25zdHJ1Y3QgIitlLm5hbWUrIiBkdWUgdG8gdW5ib3VuZCB0eXBlcyIsaSl9LGdlKFtdLGksKGZ1bmN0aW9uKG4pe3JldHVybiBuLnNwbGljZSgxLDAsbnVsbCksZS5yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keVtyLTFdPWVyKHQsbixudWxsLG8sYSksW119KSksW119KSl9LGo6ZnVuY3Rpb24oZSxyLHQsbixvLGEsaSxzKXt2YXIgdT1ycih0LG4pO3I9YmUociksYT1YZShvLGEpLGdlKFtdLFtlXSwoZnVuY3Rpb24oZSl7dmFyIG49KGU9ZVswXSkubmFtZSsiLiIrcjtmdW5jdGlvbiBvKCl7S2UoIkNhbm5vdCBjYWxsICIrbisiIGR1ZSB0byB1bmJvdW5kIHR5cGVzIix1KX1yLnN0YXJ0c1dpdGgoIkBAIikmJihyPVN5bWJvbFtyLnN1YnN0cmluZygyKV0pLHMmJmUucmVnaXN0ZXJlZENsYXNzLnB1cmVWaXJ0dWFsRnVuY3Rpb25zLnB1c2gocik7dmFyIGM9ZS5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUsbD1jW3JdO3JldHVybiB2b2lkIDA9PT1sfHx2b2lkIDA9PT1sLm92ZXJsb2FkVGFibGUmJmwuY2xhc3NOYW1lIT09ZS5uYW1lJiZsLmFyZ0NvdW50PT09dC0yPyhvLmFyZ0NvdW50PXQtMixvLmNsYXNzTmFtZT1lLm5hbWUsY1tyXT1vKTooQmUoYyxyLG4pLGNbcl0ub3ZlcmxvYWRUYWJsZVt0LTJdPW8pLGdlKFtdLHUsKGZ1bmN0aW9uKG8pe3ZhciBzPWVyKG4sbyxlLGEsaSk7cmV0dXJuIHZvaWQgMD09PWNbcl0ub3ZlcmxvYWRUYWJsZT8ocy5hcmdDb3VudD10LTIsY1tyXT1zKTpjW3JdLm92ZXJsb2FkVGFibGVbdC0yXT1zLFtdfSkpLFtdfSkpfSx1YTpmdW5jdGlvbihlLHIpe1RlKGUse25hbWU6cj1iZShyKSxmcm9tV2lyZVR5cGU6ZnVuY3Rpb24oZSl7dmFyIHI9YXIudG9WYWx1ZShlKTtyZXR1cm4gb3IoZSkscn0sdG9XaXJlVHlwZTpmdW5jdGlvbihlLHIpe3JldHVybiBhci50b0hhbmRsZShyKX0sYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpsZSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfSx5OmZ1bmN0aW9uKGUscix0LG4pe3ZhciBvPUVlKHQpO2Z1bmN0aW9uIGEoKXt9cj1iZShyKSxhLnZhbHVlcz17fSxUZShlLHtuYW1lOnIsY29uc3RydWN0b3I6YSxmcm9tV2lyZVR5cGU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuY29uc3RydWN0b3IudmFsdWVzW2VdfSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUscil7cmV0dXJuIHIudmFsdWV9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6aXIocixvLG4pLGRlc3RydWN0b3JGdW5jdGlvbjpudWxsfSksV2UocixhKX0sbTpmdW5jdGlvbihlLHIsdCl7dmFyIG49c3IoZSwiZW51bSIpO3I9YmUocik7dmFyIG89bi5jb25zdHJ1Y3RvcixhPU9iamVjdC5jcmVhdGUobi5jb25zdHJ1Y3Rvci5wcm90b3R5cGUse3ZhbHVlOnt2YWx1ZTp0fSxjb25zdHJ1Y3Rvcjp7dmFsdWU6bWUobi5uYW1lKyJfIityLChmdW5jdGlvbigpe30pKX19KTtvLnZhbHVlc1t0XT1hLG9bcl09YX0sVzpmdW5jdGlvbihlLHIsdCl7dmFyIG49RWUodCk7VGUoZSx7bmFtZTpyPWJlKHIpLGZyb21XaXJlVHlwZTpmdW5jdGlvbihlKXtyZXR1cm4gZX0sdG9XaXJlVHlwZTpmdW5jdGlvbihlLHIpe3JldHVybiByfSxhcmdQYWNrQWR2YW5jZTo4LHJlYWRWYWx1ZUZyb21Qb2ludGVyOmNyKHIsbiksZGVzdHJ1Y3RvckZ1bmN0aW9uOm51bGx9KX0seWE6ZnVuY3Rpb24oZSxyLHQsbixvLGEpe3ZhciBpPXJyKHIsdCk7ZT1iZShlKSxvPVhlKG4sbyksV2UoZSwoZnVuY3Rpb24oKXtLZSgiQ2Fubm90IGNhbGwgIitlKyIgZHVlIHRvIHVuYm91bmQgdHlwZXMiLGkpfSksci0xKSxnZShbXSxpLChmdW5jdGlvbih0KXt2YXIgbj1bdFswXSxudWxsXS5jb25jYXQodC5zbGljZSgxKSk7cmV0dXJuIHFlKGUsZXIoZSxuLG51bGwsbyxhKSxyLTEpLFtdfSkpfSxBOmZ1bmN0aW9uKGUscix0LG4sbyl7cj1iZShyKSwtMT09PW8mJihvPTQyOTQ5NjcyOTUpO3ZhciBhPUVlKHQpLGk9ZT0+ZTtpZigwPT09bil7dmFyIHM9MzItOCp0O2k9ZT0+ZTw8cz4+PnN9dmFyIHU9ci5pbmNsdWRlcygidW5zaWduZWQiKTtUZShlLHtuYW1lOnIsZnJvbVdpcmVUeXBlOmksdG9XaXJlVHlwZTp1P2Z1bmN0aW9uKGUscil7cmV0dXJuIHRoaXMubmFtZSxyPj4+MH06ZnVuY3Rpb24oZSxyKXtyZXR1cm4gdGhpcy5uYW1lLHJ9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6bHIocixhLDAhPT1uKSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfSxxOmZ1bmN0aW9uKGUscix0KXt2YXIgbj1bSW50OEFycmF5LFVpbnQ4QXJyYXksSW50MTZBcnJheSxVaW50MTZBcnJheSxJbnQzMkFycmF5LFVpbnQzMkFycmF5LEZsb2F0MzJBcnJheSxGbG9hdDY0QXJyYXldW3JdO2Z1bmN0aW9uIG8oZSl7dmFyIHI9Rix0PXJbZT4+PTJdLG89cltlKzFdO3JldHVybiBuZXcgbihrLG8sdCl9VGUoZSx7bmFtZTp0PWJlKHQpLGZyb21XaXJlVHlwZTpvLGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6b30se2lnbm9yZUR1cGxpY2F0ZVJlZ2lzdHJhdGlvbnM6ITB9KX0sVjpmdW5jdGlvbihlLHIpe3ZhciB0PSJzdGQ6OnN0cmluZyI9PT0ocj1iZShyKSk7VGUoZSx7bmFtZTpyLGZyb21XaXJlVHlwZTpmdW5jdGlvbihlKXt2YXIgcixuPUZbZT4+Ml07aWYodClmb3IodmFyIG89ZSs0LGE9MDthPD1uOysrYSl7dmFyIGk9ZSs0K2E7aWYoYT09bnx8MD09VFtpXSl7dmFyIHM9ZyhvLGktbyk7dm9pZCAwPT09cj9yPXM6KHIrPVN0cmluZy5mcm9tQ2hhckNvZGUoMCkscis9cyksbz1pKzF9fWVsc2V7dmFyIHU9bmV3IEFycmF5KG4pO2ZvcihhPTA7YTxuOysrYSl1W2FdPVN0cmluZy5mcm9tQ2hhckNvZGUoVFtlKzQrYV0pO3I9dS5qb2luKCIiKX1yZXR1cm4geHIoZSkscn0sdG9XaXJlVHlwZTpmdW5jdGlvbihlLHIpe3IgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciYmKHI9bmV3IFVpbnQ4QXJyYXkocikpO3ZhciBuPSJzdHJpbmciPT10eXBlb2YgcjtufHxyIGluc3RhbmNlb2YgVWludDhBcnJheXx8ciBpbnN0YW5jZW9mIFVpbnQ4Q2xhbXBlZEFycmF5fHxyIGluc3RhbmNlb2YgSW50OEFycmF5fHxQZSgiQ2Fubm90IHBhc3Mgbm9uLXN0cmluZyB0byBzdGQ6OnN0cmluZyIpO3ZhciBvPSh0JiZuPygpPT5iKHIpOigpPT5yLmxlbmd0aCkoKSxhPSRyKDQrbysxKTtpZihGW2E+PjJdPW8sdCYmbilfKHIsYSs0LG8rMSk7ZWxzZSBpZihuKWZvcih2YXIgaT0wO2k8bzsrK2kpe3ZhciBzPXIuY2hhckNvZGVBdChpKTtzPjI1NSYmKHhyKGEpLFBlKCJTdHJpbmcgaGFzIFVURi0xNiBjb2RlIHVuaXRzIHRoYXQgZG8gbm90IGZpdCBpbiA4IGJpdHMiKSksVFthKzQraV09c31lbHNlIGZvcihpPTA7aTxvOysraSlUW2ErNCtpXT1yW2ldO3JldHVybiBudWxsIT09ZSYmZS5wdXNoKHhyLGEpLGF9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6bGUsZGVzdHJ1Y3RvckZ1bmN0aW9uOmZ1bmN0aW9uKGUpe3hyKGUpfX0pfSxOOmZ1bmN0aW9uKGUscix0KXt2YXIgbixvLGEsaSxzO3Q9YmUodCksMj09PXI/KG49eCxvPU8saT1SLGE9KCk9PkMscz0xKTo0PT09ciYmKG49aixvPUksaT16LGE9KCk9PkYscz0yKSxUZShlLHtuYW1lOnQsZnJvbVdpcmVUeXBlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdCxvPUZbZT4+Ml0saT1hKCksdT1lKzQsYz0wO2M8PW87KytjKXt2YXIgbD1lKzQrYypyO2lmKGM9PW98fDA9PWlbbD4+c10pe3ZhciBkPW4odSxsLXUpO3ZvaWQgMD09PXQ/dD1kOih0Kz1TdHJpbmcuZnJvbUNoYXJDb2RlKDApLHQrPWQpLHU9bCtyfX1yZXR1cm4geHIoZSksdH0sdG9XaXJlVHlwZTpmdW5jdGlvbihlLG4peyJzdHJpbmciIT10eXBlb2YgbiYmUGUoIkNhbm5vdCBwYXNzIG5vbi1zdHJpbmcgdG8gQysrIHN0cmluZyB0eXBlICIrdCk7dmFyIGE9aShuKSx1PSRyKDQrYStyKTtyZXR1cm4gRlt1Pj4yXT1hPj5zLG8obix1KzQsYStyKSxudWxsIT09ZSYmZS5wdXNoKHhyLHUpLHV9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6bGUsZGVzdHJ1Y3RvckZ1bmN0aW9uOmZ1bmN0aW9uKGUpe3hyKGUpfX0pfSxaOmZ1bmN0aW9uKGUscix0LG4sbyxhKXt1ZVtlXT17bmFtZTpiZShyKSxyYXdDb25zdHJ1Y3RvcjpYZSh0LG4pLHJhd0Rlc3RydWN0b3I6WGUobyxhKSxmaWVsZHM6W119fSxHOmZ1bmN0aW9uKGUscix0LG4sbyxhLGkscyx1LGMpe3VlW2VdLmZpZWxkcy5wdXNoKHtmaWVsZE5hbWU6YmUociksZ2V0dGVyUmV0dXJuVHlwZTp0LGdldHRlcjpYZShuLG8pLGdldHRlckNvbnRleHQ6YSxzZXR0ZXJBcmd1bWVudFR5cGU6aSxzZXR0ZXI6WGUocyx1KSxzZXR0ZXJDb250ZXh0OmN9KX0seGE6ZnVuY3Rpb24oZSxyKXtUZShlLHtpc1ZvaWQ6ITAsbmFtZTpyPWJlKHIpLGFyZ1BhY2tBZHZhbmNlOjAsZnJvbVdpcmVUeXBlOmZ1bmN0aW9uKCl7fSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUscil7fX0pfSxVOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUubm93KCl9LG9hOmZ1bmN0aW9uKCl7cmV0dXJuITB9LGhhOmZ1bmN0aW9uKGUscix0KXtlPWFyLnRvVmFsdWUoZSkscj1zcihyLCJlbXZhbDo6YXMiKTt2YXIgbj1bXSxvPWFyLnRvSGFuZGxlKG4pO3JldHVybiBEW3Q+PjJdPW8sci50b1dpcmVUeXBlKG4sZSl9LHphOmZ1bmN0aW9uKGUscix0LG4peyhlPWhyW2VdKShyPWFyLnRvVmFsdWUociksdD1mcih0KSxudWxsLG4pfSxGOm9yLF86ZnVuY3Rpb24oZSxyKXt2YXIgdD1mdW5jdGlvbihlLHIpe2Zvcih2YXIgdD1uZXcgQXJyYXkoZSksbj0wO248ZTsrK24pdFtuXT1zcihEWyhyPj4yKStuXSwicGFyYW1ldGVyICIrbik7cmV0dXJuIHR9KGUsciksbj10WzBdLG89bi5uYW1lKyJfJCIrdC5zbGljZSgxKS5tYXAoKGZ1bmN0aW9uKGUpe3JldHVybiBlLm5hbWV9KSkuam9pbigiXyIpKyIkIixhPW1yW29dO2lmKHZvaWQgMCE9PWEpcmV0dXJuIGE7Zm9yKHZhciBpPVsicmV0VHlwZSJdLHM9W25dLHU9IiIsYz0wO2M8ZS0xOysrYyl1Kz0oMCE9PWM/IiwgIjoiIikrImFyZyIrYyxpLnB1c2goImFyZ1R5cGUiK2MpLHMucHVzaCh0WzErY10pO3ZhciBsLGQsZj0icmV0dXJuIGZ1bmN0aW9uICIraGUoIm1ldGhvZENhbGxlcl8iK28pKyIoaGFuZGxlLCBuYW1lLCBkZXN0cnVjdG9ycywgYXJncykge1xuIixwPTA7Zm9yKGM9MDtjPGUtMTsrK2MpZis9IiAgICB2YXIgYXJnIitjKyIgPSBhcmdUeXBlIitjKyIucmVhZFZhbHVlRnJvbVBvaW50ZXIoYXJncyIrKHA/IisiK3A6IiIpKyIpO1xuIixwKz10W2MrMV0uYXJnUGFja0FkdmFuY2U7Zm9yKGYrPSIgICAgdmFyIHJ2ID0gaGFuZGxlW25hbWVdKCIrdSsiKTtcbiIsYz0wO2M8ZS0xOysrYyl0W2MrMV0uZGVsZXRlT2JqZWN0JiYoZis9IiAgICBhcmdUeXBlIitjKyIuZGVsZXRlT2JqZWN0KGFyZyIrYysiKTtcbiIpO3JldHVybiBuLmlzVm9pZHx8KGYrPSIgICAgcmV0dXJuIHJldFR5cGUudG9XaXJlVHlwZShkZXN0cnVjdG9ycywgcnYpO1xuIiksZis9In07XG4iLGkucHVzaChmKSxsPVplKEZ1bmN0aW9uLGkpLmFwcGx5KG51bGwscyksZD1oci5sZW5ndGgsaHIucHVzaChsKSxhPWQsbXJbb109YSxhfSxuYTpmdW5jdGlvbihlLHIpe3JldHVybiBlPWFyLnRvVmFsdWUoZSkscj1hci50b1ZhbHVlKHIpLGFyLnRvSGFuZGxlKGVbcl0pfSxQOmZ1bmN0aW9uKGUpe2U+NCYmKG5yW2VdLnJlZmNvdW50Kz0xKX0sdmE6ZnVuY3Rpb24oZSl7cmV0dXJuIGFyLnRvSGFuZGxlKGZyKGUpKX0sZWE6ZnVuY3Rpb24oZSl7Y2UoYXIudG9WYWx1ZShlKSksb3IoZSl9LEQ6ZnVuY3Rpb24oZSxyKXt2YXIgdD0oZT1zcihlLCJfZW12YWxfdGFrZV92YWx1ZSIpKS5yZWFkVmFsdWVGcm9tUG9pbnRlcihyKTtyZXR1cm4gYXIudG9IYW5kbGUodCl9LGI6ZnVuY3Rpb24oKXtLKCIiKX0samE6ZnVuY3Rpb24oKXtyZXR1cm4gVC5sZW5ndGh9LE06cHIscGE6ZnVuY3Rpb24oZSxyLHQpe1QuY29weVdpdGhpbihlLHIscit0KX0saWE6ZnVuY3Rpb24oZSl7VC5sZW5ndGgsSygiT09NIil9LGthOmZ1bmN0aW9uKGUscil7dmFyIHQ9MDtyZXR1cm4geXIoKS5mb3JFYWNoKChmdW5jdGlvbihuLG8pe3ZhciBhPXIrdDtEW2UrNCpvPj4yXT1hLGZ1bmN0aW9uKGUscix0KXtmb3IodmFyIG49MDtuPGUubGVuZ3RoOysrbilQW3IrKz4+MF09ZS5jaGFyQ29kZUF0KG4pO1Bbcj4+MF09MH0obixhKSx0Kz1uLmxlbmd0aCsxfSkpLDB9LGxhOmZ1bmN0aW9uKGUscil7dmFyIHQ9eXIoKTtEW2U+PjJdPXQubGVuZ3RoO3ZhciBuPTA7cmV0dXJuIHQuZm9yRWFjaCgoZnVuY3Rpb24oZSl7bis9ZS5sZW5ndGgrMX0pKSxEW3I+PjJdPW4sMH0sdGE6ZnVuY3Rpb24oZSl7dHJ5e3ZhciByPWtyLmdldFN0cmVhbUZyb21GRChlKTtyZXR1cm4gYnIuY2xvc2UociksMH1jYXRjaChlKXtpZih2b2lkIDA9PT1icnx8IShlIGluc3RhbmNlb2YgYnIuRXJybm9FcnJvcikpdGhyb3cgZTtyZXR1cm4gZS5lcnJub319LG1hOmZ1bmN0aW9uKGUscix0LG4pe3RyeXt2YXIgbz1rci5nZXRTdHJlYW1Gcm9tRkQoZSksYT1rci5kb1JlYWR2KG8scix0KTtyZXR1cm4gRFtuPj4yXT1hLDB9Y2F0Y2goZSl7aWYodm9pZCAwPT09YnJ8fCEoZSBpbnN0YW5jZW9mIGJyLkVycm5vRXJyb3IpKXRocm93IGU7cmV0dXJuIGUuZXJybm99fSxiYTpmdW5jdGlvbihlLHIsdCxuLG8pe3RyeXt2YXIgYT1rci5nZXRTdHJlYW1Gcm9tRkQoZSksaT00Mjk0OTY3Mjk2KnQrKHI+Pj4wKSxzPTkwMDcxOTkyNTQ3NDA5OTI7cmV0dXJuIGk8PS1zfHxpPj1zPy02MTooYnIubGxzZWVrKGEsaSxuKSxVPVthLnBvc2l0aW9uPj4+MCwoTD1hLnBvc2l0aW9uLCtNYXRoLmFicyhMKT49MT9MPjA/KDB8TWF0aC5taW4oK01hdGguZmxvb3IoTC80Mjk0OTY3Mjk2KSw0Mjk0OTY3Mjk1KSk+Pj4wOn5+K01hdGguY2VpbCgoTC0rKH5+TD4+PjApKS80Mjk0OTY3Mjk2KT4+PjA6MCldLERbbz4+Ml09VVswXSxEW28rND4+Ml09VVsxXSxhLmdldGRlbnRzJiYwPT09aSYmMD09PW4mJihhLmdldGRlbnRzPW51bGwpLDApfWNhdGNoKGUpe2lmKHZvaWQgMD09PWJyfHwhKGUgaW5zdGFuY2VvZiBici5FcnJub0Vycm9yKSl0aHJvdyBlO3JldHVybiBlLmVycm5vfX0sVDpmdW5jdGlvbihlLHIsdCxuKXt0cnl7dmFyIG89a3IuZ2V0U3RyZWFtRnJvbUZEKGUpLGE9a3IuZG9Xcml0ZXYobyxyLHQpO3JldHVybiBEW24+PjJdPWEsMH1jYXRjaChlKXtpZih2b2lkIDA9PT1icnx8IShlIGluc3RhbmNlb2YgYnIuRXJybm9FcnJvcikpdGhyb3cgZTtyZXR1cm4gZS5lcnJub319LGM6ZnVuY3Rpb24oKXtyZXR1cm4gcH0sUTpmdW5jdGlvbihlLHIsdCxuKXt2YXIgbz1JcigpO3RyeXtyZXR1cm4gcmUoZSkocix0LG4pfWNhdGNoKGUpe2lmKHpyKG8pLGUhPT1lKzApdGhyb3cgZTtqcigxLDApfX0sUjpmdW5jdGlvbihlLHIsdCxuKXt2YXIgbz1JcigpO3RyeXtyZXR1cm4gcmUoZSkocix0LG4pfWNhdGNoKGUpe2lmKHpyKG8pLGUhPT1lKzApdGhyb3cgZTtqcigxLDApfX0scDpmdW5jdGlvbihlKXt2YXIgcj1JcigpO3RyeXtyZXR1cm4gcmUoZSkoKX1jYXRjaChlKXtpZih6cihyKSxlIT09ZSswKXRocm93IGU7anIoMSwwKX19LGU6ZnVuY3Rpb24oZSxyKXt2YXIgdD1JcigpO3RyeXtyZXR1cm4gcmUoZSkocil9Y2F0Y2goZSl7aWYoenIodCksZSE9PWUrMCl0aHJvdyBlO2pyKDEsMCl9fSxrOmZ1bmN0aW9uKGUscix0KXt2YXIgbj1JcigpO3RyeXtyZXR1cm4gcmUoZSkocix0KX1jYXRjaChlKXtpZih6cihuKSxlIT09ZSswKXRocm93IGU7anIoMSwwKX19LHI6ZnVuY3Rpb24oZSxyLHQsbil7dmFyIG89SXIoKTt0cnl7cmV0dXJuIHJlKGUpKHIsdCxuKX1jYXRjaChlKXtpZih6cihvKSxlIT09ZSswKXRocm93IGU7anIoMSwwKX19LG46ZnVuY3Rpb24oZSxyLHQsbixvKXt2YXIgYT1JcigpO3RyeXtyZXR1cm4gcmUoZSkocix0LG4sbyl9Y2F0Y2goZSl7aWYoenIoYSksZSE9PWUrMCl0aHJvdyBlO2pyKDEsMCl9fSxmYTpmdW5jdGlvbihlLHIsdCxuLG8sYSl7dmFyIGk9SXIoKTt0cnl7cmV0dXJuIHJlKGUpKHIsdCxuLG8sYSl9Y2F0Y2goZSl7aWYoenIoaSksZSE9PWUrMCl0aHJvdyBlO2pyKDEsMCl9fSxLOmZ1bmN0aW9uKGUscix0LG4sbyxhKXt2YXIgaT1JcigpO3RyeXtyZXR1cm4gcmUoZSkocix0LG4sbyxhKX1jYXRjaChlKXtpZih6cihpKSxlIT09ZSswKXRocm93IGU7anIoMSwwKX19LEI6ZnVuY3Rpb24oZSxyLHQsbixvLGEsaSl7dmFyIHM9SXIoKTt0cnl7cmV0dXJuIHJlKGUpKHIsdCxuLG8sYSxpKX1jYXRjaChlKXtpZih6cihzKSxlIT09ZSswKXRocm93IGU7anIoMSwwKX19LFM6ZnVuY3Rpb24oZSxyLHQsbixvLGEsaSxzKXt2YXIgdT1JcigpO3RyeXtyZXR1cm4gcmUoZSkocix0LG4sbyxhLGkscyl9Y2F0Y2goZSl7aWYoenIodSksZSE9PWUrMCl0aHJvdyBlO2pyKDEsMCl9fSxKOmZ1bmN0aW9uKGUscix0LG4sbyxhLGkscyx1LGMsbCxkKXt2YXIgZj1JcigpO3RyeXtyZXR1cm4gcmUoZSkocix0LG4sbyxhLGkscyx1LGMsbCxkKX1jYXRjaChlKXtpZih6cihmKSxlIT09ZSswKXRocm93IGU7anIoMSwwKX19LGFhOmZ1bmN0aW9uKGUpe3ZhciByPUlyKCk7dHJ5e3JldHVybiBOcihlKX1jYXRjaChlKXtpZih6cihyKSxlIT09ZSswKXRocm93IGU7anIoMSwwKX19LCQ6ZnVuY3Rpb24oZSxyLHQsbixvKXt2YXIgYT1JcigpO3RyeXtyZXR1cm4gTHIoZSxyLHQsbixvKX1jYXRjaChlKXtpZih6cihhKSxlIT09ZSswKXRocm93IGU7anIoMSwwKX19LG86ZnVuY3Rpb24oZSl7dmFyIHI9SXIoKTt0cnl7cmUoZSkoKX1jYXRjaChlKXtpZih6cihyKSxlIT09ZSswKXRocm93IGU7anIoMSwwKX19LHQ6ZnVuY3Rpb24oZSxyKXt2YXIgdD1JcigpO3RyeXtyZShlKShyKX1jYXRjaChlKXtpZih6cih0KSxlIT09ZSswKXRocm93IGU7anIoMSwwKX19LGg6ZnVuY3Rpb24oZSxyLHQpe3ZhciBuPUlyKCk7dHJ5e3JlKGUpKHIsdCl9Y2F0Y2goZSl7aWYoenIobiksZSE9PWUrMCl0aHJvdyBlO2pyKDEsMCl9fSxzOmZ1bmN0aW9uKGUscix0LG4pe3ZhciBvPUlyKCk7dHJ5e3JlKGUpKHIsdCxuKX1jYXRjaChlKXtpZih6cihvKSxlIT09ZSswKXRocm93IGU7anIoMSwwKX19LEw6ZnVuY3Rpb24oZSxyLHQsbixvKXt2YXIgYT1JcigpO3RyeXtyZShlKShyLHQsbixvKX1jYXRjaChlKXtpZih6cihhKSxlIT09ZSswKXRocm93IGU7anIoMSwwKX19LHY6ZnVuY3Rpb24oZSxyLHQsbixvLGEsaSxzKXt2YXIgdT1JcigpO3RyeXtyZShlKShyLHQsbixvLGEsaSxzKX1jYXRjaChlKXtpZih6cih1KSxlIT09ZSswKXRocm93IGU7anIoMSwwKX19LEU6ZnVuY3Rpb24oZSxyLHQsbixvLGEsaSxzLHUsYyxsKXt2YXIgZD1JcigpO3RyeXtyZShlKShyLHQsbixvLGEsaSxzLHUsYyxsKX1jYXRjaChlKXtpZih6cihkKSxlIT09ZSswKXRocm93IGU7anIoMSwwKX19LEk6ZnVuY3Rpb24oZSxyLHQsbixvLGEsaSxzLHUsYyxsLGQsZixwLGgsbSl7dmFyIHY9SXIoKTt0cnl7cmUoZSkocix0LG4sbyxhLGkscyx1LGMsbCxkLGYscCxoLG0pfWNhdGNoKGUpe2lmKHpyKHYpLGUhPT1lKzApdGhyb3cgZTtqcigxLDApfX0sSDpmdW5jdGlvbihlKXtoKGUpfSxkYTpmdW5jdGlvbihlLHIsdCxuKXtyZXR1cm4gZnVuY3Rpb24oZSxyLHQsbil7dmFyIG89RFtuKzQwPj4yXSxhPXt0bV9zZWM6RFtuPj4yXSx0bV9taW46RFtuKzQ+PjJdLHRtX2hvdXI6RFtuKzg+PjJdLHRtX21kYXk6RFtuKzEyPj4yXSx0bV9tb246RFtuKzE2Pj4yXSx0bV95ZWFyOkRbbisyMD4+Ml0sdG1fd2RheTpEW24rMjQ+PjJdLHRtX3lkYXk6RFtuKzI4Pj4yXSx0bV9pc2RzdDpEW24rMzI+PjJdLHRtX2dtdG9mZjpEW24rMzY+PjJdLHRtX3pvbmU6bz9nKG8pOiIifSxpPWcodCkscz17IiVjIjoiJWEgJWIgJWQgJUg6JU06JVMgJVkiLCIlRCI6IiVtLyVkLyV5IiwiJUYiOiIlWS0lbS0lZCIsIiVoIjoiJWIiLCIlciI6IiVJOiVNOiVTICVwIiwiJVIiOiIlSDolTSIsIiVUIjoiJUg6JU06JVMiLCIleCI6IiVtLyVkLyV5IiwiJVgiOiIlSDolTTolUyIsIiVFYyI6IiVjIiwiJUVDIjoiJUMiLCIlRXgiOiIlbS8lZC8leSIsIiVFWCI6IiVIOiVNOiVTIiwiJUV5IjoiJXkiLCIlRVkiOiIlWSIsIiVPZCI6IiVkIiwiJU9lIjoiJWUiLCIlT0giOiIlSCIsIiVPSSI6IiVJIiwiJU9tIjoiJW0iLCIlT00iOiIlTSIsIiVPUyI6IiVTIiwiJU91IjoiJXUiLCIlT1UiOiIlVSIsIiVPViI6IiVWIiwiJU93IjoiJXciLCIlT1ciOiIlVyIsIiVPeSI6IiV5In07Zm9yKHZhciB1IGluIHMpaT1pLnJlcGxhY2UobmV3IFJlZ0V4cCh1LCJnIiksc1t1XSk7dmFyIGM9WyJTdW5kYXkiLCJNb25kYXkiLCJUdWVzZGF5IiwiV2VkbmVzZGF5IiwiVGh1cnNkYXkiLCJGcmlkYXkiLCJTYXR1cmRheSJdLGw9WyJKYW51YXJ5IiwiRmVicnVhcnkiLCJNYXJjaCIsIkFwcmlsIiwiTWF5IiwiSnVuZSIsIkp1bHkiLCJBdWd1c3QiLCJTZXB0ZW1iZXIiLCJPY3RvYmVyIiwiTm92ZW1iZXIiLCJEZWNlbWJlciJdO2Z1bmN0aW9uIGQoZSxyLHQpe2Zvcih2YXIgbj0ibnVtYmVyIj09dHlwZW9mIGU/ZS50b1N0cmluZygpOmV8fCIiO24ubGVuZ3RoPHI7KW49dFswXStuO3JldHVybiBufWZ1bmN0aW9uIGYoZSxyKXtyZXR1cm4gZChlLHIsIjAiKX1mdW5jdGlvbiBwKGUscil7ZnVuY3Rpb24gdChlKXtyZXR1cm4gZTwwPy0xOmU+MD8xOjB9dmFyIG47cmV0dXJuIDA9PT0obj10KGUuZ2V0RnVsbFllYXIoKS1yLmdldEZ1bGxZZWFyKCkpKSYmMD09PShuPXQoZS5nZXRNb250aCgpLXIuZ2V0TW9udGgoKSkpJiYobj10KGUuZ2V0RGF0ZSgpLXIuZ2V0RGF0ZSgpKSksbn1mdW5jdGlvbiBoKGUpe3N3aXRjaChlLmdldERheSgpKXtjYXNlIDA6cmV0dXJuIG5ldyBEYXRlKGUuZ2V0RnVsbFllYXIoKS0xLDExLDI5KTtjYXNlIDE6cmV0dXJuIGU7Y2FzZSAyOnJldHVybiBuZXcgRGF0ZShlLmdldEZ1bGxZZWFyKCksMCwzKTtjYXNlIDM6cmV0dXJuIG5ldyBEYXRlKGUuZ2V0RnVsbFllYXIoKSwwLDIpO2Nhc2UgNDpyZXR1cm4gbmV3IERhdGUoZS5nZXRGdWxsWWVhcigpLDAsMSk7Y2FzZSA1OnJldHVybiBuZXcgRGF0ZShlLmdldEZ1bGxZZWFyKCktMSwxMSwzMSk7Y2FzZSA2OnJldHVybiBuZXcgRGF0ZShlLmdldEZ1bGxZZWFyKCktMSwxMSwzMCl9fWZ1bmN0aW9uIG0oZSl7dmFyIHI9ZnVuY3Rpb24oZSxyKXtmb3IodmFyIHQ9bmV3IERhdGUoZS5nZXRUaW1lKCkpO3I+MDspe3ZhciBuPVByKHQuZ2V0RnVsbFllYXIoKSksbz10LmdldE1vbnRoKCksYT0obj9UcjpTcilbb107aWYoIShyPmEtdC5nZXREYXRlKCkpKXJldHVybiB0LnNldERhdGUodC5nZXREYXRlKCkrciksdDtyLT1hLXQuZ2V0RGF0ZSgpKzEsdC5zZXREYXRlKDEpLG88MTE/dC5zZXRNb250aChvKzEpOih0LnNldE1vbnRoKDApLHQuc2V0RnVsbFllYXIodC5nZXRGdWxsWWVhcigpKzEpKX1yZXR1cm4gdH0obmV3IERhdGUoZS50bV95ZWFyKzE5MDAsMCwxKSxlLnRtX3lkYXkpLHQ9bmV3IERhdGUoci5nZXRGdWxsWWVhcigpLDAsNCksbj1uZXcgRGF0ZShyLmdldEZ1bGxZZWFyKCkrMSwwLDQpLG89aCh0KSxhPWgobik7cmV0dXJuIHAobyxyKTw9MD9wKGEscik8PTA/ci5nZXRGdWxsWWVhcigpKzE6ci5nZXRGdWxsWWVhcigpOnIuZ2V0RnVsbFllYXIoKS0xfXZhciB2PXsiJWEiOmZ1bmN0aW9uKGUpe3JldHVybiBjW2UudG1fd2RheV0uc3Vic3RyaW5nKDAsMyl9LCIlQSI6ZnVuY3Rpb24oZSl7cmV0dXJuIGNbZS50bV93ZGF5XX0sIiViIjpmdW5jdGlvbihlKXtyZXR1cm4gbFtlLnRtX21vbl0uc3Vic3RyaW5nKDAsMyl9LCIlQiI6ZnVuY3Rpb24oZSl7cmV0dXJuIGxbZS50bV9tb25dfSwiJUMiOmZ1bmN0aW9uKGUpe3JldHVybiBmKChlLnRtX3llYXIrMTkwMCkvMTAwfDAsMil9LCIlZCI6ZnVuY3Rpb24oZSl7cmV0dXJuIGYoZS50bV9tZGF5LDIpfSwiJWUiOmZ1bmN0aW9uKGUpe3JldHVybiBkKGUudG1fbWRheSwyLCIgIil9LCIlZyI6ZnVuY3Rpb24oZSl7cmV0dXJuIG0oZSkudG9TdHJpbmcoKS5zdWJzdHJpbmcoMil9LCIlRyI6ZnVuY3Rpb24oZSl7cmV0dXJuIG0oZSl9LCIlSCI6ZnVuY3Rpb24oZSl7cmV0dXJuIGYoZS50bV9ob3VyLDIpfSwiJUkiOmZ1bmN0aW9uKGUpe3ZhciByPWUudG1faG91cjtyZXR1cm4gMD09cj9yPTEyOnI+MTImJihyLT0xMiksZihyLDIpfSwiJWoiOmZ1bmN0aW9uKGUpe3JldHVybiBmKGUudG1fbWRheStmdW5jdGlvbihlLHIpe2Zvcih2YXIgdD0wLG49MDtuPD1yO3QrPWVbbisrXSk7cmV0dXJuIHR9KFByKGUudG1feWVhcisxOTAwKT9UcjpTcixlLnRtX21vbi0xKSwzKX0sIiVtIjpmdW5jdGlvbihlKXtyZXR1cm4gZihlLnRtX21vbisxLDIpfSwiJU0iOmZ1bmN0aW9uKGUpe3JldHVybiBmKGUudG1fbWluLDIpfSwiJW4iOmZ1bmN0aW9uKCl7cmV0dXJuIlxuIn0sIiVwIjpmdW5jdGlvbihlKXtyZXR1cm4gZS50bV9ob3VyPj0wJiZlLnRtX2hvdXI8MTI/IkFNIjoiUE0ifSwiJVMiOmZ1bmN0aW9uKGUpe3JldHVybiBmKGUudG1fc2VjLDIpfSwiJXQiOmZ1bmN0aW9uKCl7cmV0dXJuIlx0In0sIiV1IjpmdW5jdGlvbihlKXtyZXR1cm4gZS50bV93ZGF5fHw3fSwiJVUiOmZ1bmN0aW9uKGUpe3ZhciByPWUudG1feWRheSs3LWUudG1fd2RheTtyZXR1cm4gZihNYXRoLmZsb29yKHIvNyksMil9LCIlViI6ZnVuY3Rpb24oZSl7dmFyIHI9TWF0aC5mbG9vcigoZS50bV95ZGF5KzctKGUudG1fd2RheSs2KSU3KS83KTtpZigoZS50bV93ZGF5KzM3MS1lLnRtX3lkYXktMiklNzw9MiYmcisrLHIpe2lmKDUzPT1yKXt2YXIgdD0oZS50bV93ZGF5KzM3MS1lLnRtX3lkYXkpJTc7ND09dHx8Mz09dCYmUHIoZS50bV95ZWFyKXx8KHI9MSl9fWVsc2V7cj01Mjt2YXIgbj0oZS50bV93ZGF5KzctZS50bV95ZGF5LTEpJTc7KDQ9PW58fDU9PW4mJlByKGUudG1feWVhciU0MDAtMSkpJiZyKyt9cmV0dXJuIGYociwyKX0sIiV3IjpmdW5jdGlvbihlKXtyZXR1cm4gZS50bV93ZGF5fSwiJVciOmZ1bmN0aW9uKGUpe3ZhciByPWUudG1feWRheSs3LShlLnRtX3dkYXkrNiklNztyZXR1cm4gZihNYXRoLmZsb29yKHIvNyksMil9LCIleSI6ZnVuY3Rpb24oZSl7cmV0dXJuKGUudG1feWVhcisxOTAwKS50b1N0cmluZygpLnN1YnN0cmluZygyKX0sIiVZIjpmdW5jdGlvbihlKXtyZXR1cm4gZS50bV95ZWFyKzE5MDB9LCIleiI6ZnVuY3Rpb24oZSl7dmFyIHI9ZS50bV9nbXRvZmYsdD1yPj0wO3JldHVybiByPShyPU1hdGguYWJzKHIpLzYwKS82MCoxMDArciU2MCwodD8iKyI6Ii0iKStTdHJpbmcoIjAwMDAiK3IpLnNsaWNlKC00KX0sIiVaIjpmdW5jdGlvbihlKXtyZXR1cm4gZS50bV96b25lfSwiJSUiOmZ1bmN0aW9uKCl7cmV0dXJuIiUifX07Zm9yKHZhciB1IGluIGk9aS5yZXBsYWNlKC8lJS9nLCJcMFwwIiksdilpLmluY2x1ZGVzKHUpJiYoaT1pLnJlcGxhY2UobmV3IFJlZ0V4cCh1LCJnIiksdlt1XShhKSkpO3ZhciB5PURyKGk9aS5yZXBsYWNlKC9cMFwwL2csIiUiKSwhMSk7cmV0dXJuIHkubGVuZ3RoPnI/MDooZnVuY3Rpb24oZSxyKXtQLnNldChlLHIpfSh5LGUpLHkubGVuZ3RoLTEpfShlLHIsdCxuKX19LE1yPWZ1bmN0aW9uKCl7dmFyIHI9e2E6QXJ9O2Z1bmN0aW9uIHQocix0KXt2YXIgbixvLGE9ci5leHBvcnRzO2UuYXNtPWEsbj1lLmFzbS5BYS5idWZmZXIsaz1uLGUuSEVBUDg9UD1uZXcgSW50OEFycmF5KG4pLGUuSEVBUDE2PVM9bmV3IEludDE2QXJyYXkobiksZS5IRUFQMzI9RD1uZXcgSW50MzJBcnJheShuKSxlLkhFQVBVOD1UPW5ldyBVaW50OEFycmF5KG4pLGUuSEVBUFUxNj1DPW5ldyBVaW50MTZBcnJheShuKSxlLkhFQVBVMzI9Rj1uZXcgVWludDMyQXJyYXkobiksZS5IRUFQRjMyPUE9bmV3IEZsb2F0MzJBcnJheShuKSxlLkhFQVBGNjQ9TT1uZXcgRmxvYXQ2NEFycmF5KG4pLEI9ZS5hc20uQ2Esbz1lLmFzbS5CYSxWLnVuc2hpZnQobyksUSgpfWlmKEooKSxlLmluc3RhbnRpYXRlV2FzbSl0cnl7cmV0dXJuIGUuaW5zdGFudGlhdGVXYXNtKHIsdCl9Y2F0Y2goZSl7cmV0dXJuIGQoIk1vZHVsZS5pbnN0YW50aWF0ZVdhc20gY2FsbGJhY2sgZmFpbGVkIHdpdGggZXJyb3I6ICIrZSksITF9cmV0dXJuIHQoZnVuY3Rpb24oZSxyKXt2YXIgdCxuLG87dHJ5e289ZnVuY3Rpb24oZSl7dHJ5e2lmKGU9PVcmJmYpcmV0dXJuIG5ldyBVaW50OEFycmF5KGYpO3Rocm93InN5bmMgZmV0Y2hpbmcgb2YgdGhlIHdhc20gZmFpbGVkOiB5b3UgY2FuIHByZWxvYWQgaXQgdG8gTW9kdWxlWyd3YXNtQmluYXJ5J10gbWFudWFsbHksIG9yIGVtY2MucHkgd2lsbCBkbyB0aGF0IGZvciB5b3Ugd2hlbiBnZW5lcmF0aW5nIEhUTUwgKGJ1dCBub3QgSlMpIn1jYXRjaChlKXtLKGUpfX0oZSksbj1uZXcgV2ViQXNzZW1ibHkuTW9kdWxlKG8pLHQ9bmV3IFdlYkFzc2VtYmx5Lkluc3RhbmNlKG4scil9Y2F0Y2goZSl7dmFyIGE9ZS50b1N0cmluZygpO3Rocm93IGQoImZhaWxlZCB0byBjb21waWxlIHdhc20gbW9kdWxlOiAiK2EpLChhLmluY2x1ZGVzKCJpbXBvcnRlZCBNZW1vcnkiKXx8YS5pbmNsdWRlcygibWVtb3J5IGltcG9ydCIpKSYmZCgiTWVtb3J5IHNpemUgaW5jb21wYXRpYmlsaXR5IGlzc3VlcyBtYXkgYmUgZHVlIHRvIGNoYW5naW5nIElOSVRJQUxfTUVNT1JZIGF0IHJ1bnRpbWUgdG8gc29tZXRoaW5nIHRvbyBsYXJnZS4gVXNlIEFMTE9XX01FTU9SWV9HUk9XVEggdG8gYWxsb3cgYW55IHNpemUgbWVtb3J5IChhbmQgYWxzbyBtYWtlIHN1cmUgbm90IHRvIHNldCBJTklUSUFMX01FTU9SWSBhdCBydW50aW1lIHRvIHNvbWV0aGluZyBzbWFsbGVyIHRoYW4gaXQgd2FzIGF0IGNvbXBpbGUgdGltZSkuIiksZX1yZXR1cm5bdCxuXX0oVyxyKVswXSksZS5hc219KCksJHI9KGUuX19fd2FzbV9jYWxsX2N0b3JzPU1yLkJhLGUuX21hbGxvYz1Nci5EYSkseHI9ZS5fZnJlZT1Nci5FYSxPcj1lLl9fX2dldFR5cGVOYW1lPU1yLkZhLFJyPShlLl9fX2VtYmluZF9yZWdpc3Rlcl9uYXRpdmVfYW5kX2J1aWx0aW5fdHlwZXM9TXIuR2EsZS5fZW1zY3JpcHRlbl9idWlsdGluX21lbWFsaWduPU1yLkhhKSxqcj1lLl9zZXRUaHJldz1Nci5JYSxJcj1lLnN0YWNrU2F2ZT1Nci5KYSx6cj1lLnN0YWNrUmVzdG9yZT1Nci5LYSxCcj1lLl9fX2N4YV9jYW5fY2F0Y2g9TXIuTGEsV3I9ZS5fX19jeGFfaXNfcG9pbnRlcl90eXBlPU1yLk1hLE5yPShlLmR5bkNhbGxfampqPU1yLk5hLGUuZHluQ2FsbF9qaWppPU1yLk9hLGUuZHluQ2FsbF9qPU1yLlBhKSxMcj0oZS5keW5DYWxsX3ZpaWppaT1Nci5RYSxlLmR5bkNhbGxfamlpaWk9TXIuUmEpO2Z1bmN0aW9uIFVyKHQpe2Z1bmN0aW9uIG4oKXtGcnx8KEZyPSEwLGUuY2FsbGVkUnVuPSEwLG18fChlLm5vRlNJbml0fHxici5pbml0LmluaXRpYWxpemVkfHxici5pbml0KCksYnIuaWdub3JlUGVybWlzc2lvbnM9ITEsRXIuaW5pdCgpLFooVikscihlKSxlLm9uUnVudGltZUluaXRpYWxpemVkJiZlLm9uUnVudGltZUluaXRpYWxpemVkKCksZnVuY3Rpb24oKXtpZihlLnBvc3RSdW4pZm9yKCJmdW5jdGlvbiI9PXR5cGVvZiBlLnBvc3RSdW4mJihlLnBvc3RSdW49W2UucG9zdFJ1bl0pO2UucG9zdFJ1bi5sZW5ndGg7KXI9ZS5wb3N0UnVuLnNoaWZ0KCksWS51bnNoaWZ0KHIpO3ZhciByO1ooWSl9KCkpKX10PXR8fHMscT4wfHwoZnVuY3Rpb24oKXtpZihlLnByZVJ1bilmb3IoImZ1bmN0aW9uIj09dHlwZW9mIGUucHJlUnVuJiYoZS5wcmVSdW49W2UucHJlUnVuXSk7ZS5wcmVSdW4ubGVuZ3RoOylyPWUucHJlUnVuLnNoaWZ0KCksSC51bnNoaWZ0KHIpO3ZhciByO1ooSCl9KCkscT4wfHwoZS5zZXRTdGF0dXM/KGUuc2V0U3RhdHVzKCJSdW5uaW5nLi4uIiksc2V0VGltZW91dCgoZnVuY3Rpb24oKXtzZXRUaW1lb3V0KChmdW5jdGlvbigpe2Uuc2V0U3RhdHVzKCIiKX0pLDEpLG4oKX0pLDEpKTpuKCkpKX1pZihlLmR5bkNhbGxfaWlpaWlqPU1yLlNhLGUuZHluQ2FsbF9paWlpaWpqPU1yLlRhLGUuZHluQ2FsbF9paWlpaWlqaj1Nci5VYSxYPWZ1bmN0aW9uIGUoKXtGcnx8VXIoKSxGcnx8KFg9ZSl9LGUucnVuPVVyLGUucHJlSW5pdClmb3IoImZ1bmN0aW9uIj09dHlwZW9mIGUucHJlSW5pdCYmKGUucHJlSW5pdD1bZS5wcmVJbml0XSk7ZS5wcmVJbml0Lmxlbmd0aD4wOyllLnByZUluaXQucG9wKCkoKTtyZXR1cm4gVXIoKSxlfSk7Y29uc3QgaT1hO3ZhciBzPW51bGwsdT1udWxsLGM9bnVsbCxsPSIiO2NvbnN0IGQ9YXN5bmMoKT0+e2UodSxjLG51bGwscyksY2xvc2UoKX07c2VsZi5vbm1lc3NhZ2U9bz0+e3N3aXRjaChvLmRhdGEuY21kKXtjYXNlInByZUluaXQiOihhc3luYyBlPT57dCgpLGw9ZS5idW5kbGVQYXRoO3RyeXtsZXQgZT1hd2FpdChhd2FpdCBmZXRjaChsKyIvRlBoaUV4dHJhY3Rvci53YXNtIikpLmFycmF5QnVmZmVyKCk7cz1hd2FpdCBpKHt3YXNtQmluYXJ5OmUsb25SdW50aW1lSW5pdGlhbGl6ZWQ6KCk9PnNlbGYucG9zdE1lc3NhZ2Uoe2NtZDoicmVhZHkifSl9KSx0KCl9Y2F0Y2goZSl7bigpfX0pKG8uZGF0YSk7YnJlYWs7Y2FzZSJpbml0IjooYXN5bmMgcj0+e2xldCBvPXIubWluSU9EO3RyeXtsZXQgcj1uZXcgcy5FeHRyYWN0b3JDb25maWd1cmF0aW9uTWFuYWdlcjtyLnNldE1pbmltdW1EaXN0YW5jZUJldHdlZW5FeWVzQWxsb3dlZChvKSxyLnNldEltYWdlUXVhbGl0eUZpbHRlcihzLkltYWdlUXVhbGl0eUZpbHRlci5NZWRpdW0pLHIuc2V0UGF0dGVyblF1YWxpdHlGaWx0ZXIocy5QYXR0ZXJuUXVhbGl0eUZpbHRlci5NZWRpdW0pLHU9bmV3IHMuRXh0cmFjdG9yKHIpLGUociksdCgpLHNlbGYucG9zdE1lc3NhZ2Uoe2NtZDoiaW5pdCJ9KX1jYXRjaChlKXtuKCl9fSkoby5kYXRhKTticmVhaztjYXNlInRva2VuaXplIjooYXN5bmMgcj0+e2xldCBuPXtjbWQ6InRva2VuaXplIn07dCgpO2xldCBvPXIuZGF0YSxhPXIuZGF0YS5sZW5ndGgsaT1uZXcgcy5FeHRyYWN0b3IsdT1uZXcgcy5WZWN0b3JVY2hhcjtmb3IobGV0IGU9MDtlPGE7ZSsrKXUucHVzaF9iYWNrKG8uY2hhckNvZGVBdChlKSk7bGV0IGM9aS50b2tlbml6ZSh1KTtuLmRhdGE9YnRvYSgoZT0+e2xldCByPVtdO2ZvcihsZXQgdD0wO3Q8ZS5sZW5ndGg7dCs9MzI3Njgpci5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCxlLnN1YmFycmF5KHQsdCszMjc2OCkpKTtyZXR1cm4gci5qb2luKCIiKX0pKHMuZ2V0Qnl0ZXMoYykpKSxlKHUsaSksdCgpLHNlbGYucG9zdE1lc3NhZ2UobiksYXdhaXQgZCgpfSkoby5kYXRhKTticmVhaztjYXNlImRldGVjdCI6KGFzeW5jIG49PntsZXQgbz17Y21kOiJkZXRlY3QifTt0KCk7bGV0IGE9cy5JbWFnZS5nZXRGUGhpSW1hZ2Uobi5kYXRhLG4uaGVpZ2h0LG4ud2lkdGgscy5JbWFnZUZvcm1hdC5SR0JBXzMyYnBwKSxpPXUuZGV0ZWN0KGEpLGM9bnVsbDtpJiYoYz1pLmdldCgwKSxvPXIocyxvLGMpKSxlKGMsYSxpKSx0KCksc2VsZi5wb3N0TWVzc2FnZShvKX0pKG8uZGF0YSk7YnJlYWs7Y2FzZSJpbml0U3RyZWFtRXh0cmFjdGlvbiI6KGFzeW5jIHI9Pnt1LnN0b3BTdHJlYW1FeHRyYWN0aW9uKCksdCgpO2xldCBuPW51bGwsbz1uZXcgcy5FeHRyYWN0aW9uT3B0aW9uczsxPT09ci5leHRyYWN0aW9uTW9kZT9uPXMuRXh0cmFjdGlvbk1vZGUuUmVnaXN0ZXI6KG49cy5FeHRyYWN0aW9uTW9kZS5BdXRoZW50aWNhdGUsMD09PXIubGl2ZW5lc3NNb2RlP28uc2V0TGl2ZW5lc3NUYWcoMCk6by5zZXRMaXZlbmVzc1RhZygxKSksby5zZXRFeHRyYWN0aW9uTW9kZShuKSxvLnNldFJhd1RlbXBsYXRlcygxKSx1LmluaXRTdHJlYW1FeHRyYWN0aW9uU21hcnRXaXRoRXh0cmFjdGlvbk9wdGlvbnMobyksZShvKSx0KCksc2VsZi5wb3N0TWVzc2FnZSh7Y21kOiJpbml0U3RyZWFtRXh0cmFjdGlvbiJ9KX0pKG8uZGF0YSk7YnJlYWs7Y2FzZSJleHRyYWN0TmV4dFNtYXJ0IjooYXN5bmMgbj0+e2xldCBvPXtjbWQ6ImV4dHJhY3ROZXh0U21hcnQifTt0KCk7bGV0IGE9cy5JbWFnZS5nZXRGUGhpSW1hZ2Uobi5kYXRhLG4uaGVpZ2h0LG4ud2lkdGgscy5JbWFnZUZvcm1hdC5SR0JBXzMyYnBwKSxpPXUuZXh0cmFjdE5leHRTbWFydChhKTtudWxsIT09YyYmYy5kZWxldGUoKSxjPWksbz1yKHMsbyxpKSxlKGEpLHQoKSxzZWxmLnBvc3RNZXNzYWdlKG8pfSkoby5kYXRhKTticmVhaztjYXNlImluaXRMaXZlbmVzc01vdmVTdGFiaWxpemF0aW9uIjooYXN5bmMoKT0+e3QoKSx1LmluaXRMaXZlbmVzc0hNQ0NTdGFiaWxpemF0aW9uKCksdCgpLHNlbGYucG9zdE1lc3NhZ2Uoe2NtZDoiaW5pdExpdmVuZXNzTW92ZVN0YWJpbGl6YXRpb24ifSl9KShvLmRhdGEpO2JyZWFrO2Nhc2UibmV4dExpdmVuZXNzTW92ZVN0YWJpbGl6YXRpb24iOihhc3luYyBuPT57bGV0IG89e2NtZDoibmV4dExpdmVuZXNzTW92ZVN0YWJpbGl6YXRpb24ifTt0KCk7bGV0IGE9cy5JbWFnZS5nZXRGUGhpSW1hZ2Uobi5kYXRhLG4uaGVpZ2h0LG4ud2lkdGgscy5JbWFnZUZvcm1hdC5SR0JBXzMyYnBwKSxpPXUubmV4dExpdmVuZXNzSE1DQ1N0YWJpbGl6YXRpb24oYSxwZXJmb3JtYW5jZS5ub3coKSk7bnVsbCE9PWMmJmMuZGVsZXRlKCksYz1pLG8uZmFjZVN0YWJpbGl6ZWQ9aS5nZXRGYWNlU3RhYmlsaXplZFN0YXR1cygpLG89cihzLG8saSksZShhKSx0KCksc2VsZi5wb3N0TWVzc2FnZShvKX0pKG8uZGF0YSk7YnJlYWs7Y2FzZSJ2ZXJzaW9uIjooYXN5bmMoKT0+e2xldCBlPXtjbWQ6InZlcnNpb24ifTtlLnZlcnNpb249cy5FeHRyYWN0b3IuZ2V0VmVyc2lvbigpLHNlbGYucG9zdE1lc3NhZ2UoZSl9KShvLmRhdGEpO2JyZWFrO2Nhc2UiZGVzdHJveSI6ZChvLmRhdGEpO2JyZWFrO2RlZmF1bHQ6dCgpfX07")],{type:"text/javascript"}))),u)),this.worker.onmessage=this.handleExtractorMessage.bind(this),this.worker.postMessage({cmd:"preInit",bundlePath:this.bundlePath,debugMode:this.showLog}),this.queuedCommands=0,this.resourceParent=null,this.language=this.cm.getLanguage(),this.cameraWidth=this.cm.getCameraWidth(),this.cameraHeight=this.cm.getCameraHeight(),this.cameraType=this.cm.getCameraType(),this.cameraRotation=this.cm.getCameraRotation(),this.canvasWidth=500,this.canvasHeight=500,this.detectionTimeout=this.cm.getTimeout(),this.extractionTimeout=this.cm.getTimeout(),this.fontSizeFactor=this.canvasHeight/500,this.canvasSizeFactor=this.canvasHeight/500,this.baseURL=this.isPathAbsolute(this.cm.getResourcesPath())?this.cm.getResourcesPath():this.getScriptPath()+this.cm.getResourcesPath(),this.dpiList=this.cm.getDpiList(),this.livenessMode===b.Selphi.LivenessMode.Passive&&(this.livenessMode=b.Selphi.LivenessMode.None,this.cameraWidth=1280,this.cameraHeight=720,this.cropImage=!1),this.rmReady=!1,this.graphReady=!1,this.rm=new a(this.baseURL,this.language,this,this.OnResourceManagerStatus,this.dpiList,window.devicePixelRatio,this.canvasSizeFactor),this.graph=new t.k(this.graphPath,this.OnGraphReady.bind(this),this.OnGraphNewState.bind(this)),this.drawer=new n({livenessMode:this.cm.getLivenessMode(),stabilizationStage:this.cm.getStabilizationStage(),canvasSizeFactor:this.canvasSizeFactor,fontSizeFactor:this.fontSizeFactor}),this.divContainer.addEventListener("FPhi.UserControl.Finish.event",this.onExtractionFinish,!0),this.divContainer.addEventListener("FPhi.UserControl.UserCancel.event",this.onUserCancel,!0),this.divContainer.addEventListener("FPhi.UserControl.ExtractionTimeout.event",this.onExtractionTimeout,!0),this.divContainer.addEventListener("FPhi.UserControl.LivenessError.event",this.onLivenessError,!0),this.divContainer.addEventListener("FPhi.UserControl.LivenessErrorButtonClick.event",this.onLivenessErrorButtonClick,!0),this.divContainer.addEventListener("FPhi.UserControl.TimeoutErrorButtonClick.event",this.onTimeoutErrorButtonClick,!0),this.divContainer.addEventListener("FPhi.UserControl.ModuleLoaded.event",this.onModuleLoaded,!0),this.divContainer.addEventListener("FPhi.UserControl.ExceptionCaptured.event",this.onExceptionCaptured,!0),this.divContainer.addEventListener("FPhi.UserControl.Stabilizing.event",this.onStabilizing,!0),this.divContainer.addEventListener("FPhi.UserControl.TrackStatus.event",this.onTrackStatus,!0)},b.Selphi.Widget.prototype={constructor:b.Selphi.Widget,language:"es",userTags:null,privateCanvas:null,extractor:null,extractorLiveness:null,extractorVersion:"",lastDetectResult:null,lastExtractionResult:null,lastExtractionResultWizard:null,faceAvailable:!0,faceDataRect:null,faceAvailableDelayed:!1,faceTooFar:!1,bestScore:0,actualTime:0,actualTimePrev:0,clockWaitingFace:null,clockWaitingStart:null,clockExtraction:null,clockExtractionPure:null,clockCycleTip:null,clockWizardCompleted:null,clockShowResults:null,clockImprove:null,clockLiveness1:null,clockLiveness2:null,clockLiveness3:null,clockLiveness3_finish:null,clockFinish:null,clockNewScenario:null,clockWarningIn:null,clockWarningOut:null,clockEyeDetection:null,clockEyeDetectionDetected:null,waitingTimeStart:3,extractionTime:5,extractionTimePartial:0,extractionSmartMinScore:.5,face_mo:function(){return"MO"},face_o:function(){return"O"},face_sn:function(){return"SN"},face_spl:function(){return"SPL"},liveness1Time:.5,liveness3Time:.25,livenessActualRetrain:0,livenessCalculating:!1,livenessErrorString:"",livenessErrorImage:null,livenessMoveDirection:-1,livenessMoveActualSuccessfulAttempts:0,livenessMoveActualFailedAttempts:0,livenessMoveNextIndex:0,livenessMoveGlassesFail:0,livenessMoveInit:!1,livenessMoveFailReason:0,livenessMoveInfoTime:3,livenessMoveLastStabilizedStatus:0,livenessMoveStabilizedStatusHistory:[],livenessMoveHistory:[],livenessPrecision:0,showImproveButton:!1,face_alpha:function(){return String.fromCharCode(89,52,77)},maxResults:15,graphicalScoreMax:0,privateLastImage:null,privateImages:[],logImages:!1,privateLivenessImages:[],privateLivenessImageTemp:null,privateLivenessTimerDiagnostic:null,privateLivenessResults:[],privateEyesYLevel:0,idContainer:null,divContainer:null,extractorContainer:null,videoSelectId:null,cameraContainer:null,cameraWidth:null,cameraHeight:null,cameraRotation:0,canvasWidth:null,canvasHeight:null,cameraStream:null,selectedSource:null,samplePeriod:0,face_defa:function(){return"DEFA"},face_ke:function(){return"KE"},face_ck:function(){return"CK"},face_ap:function(){return"AP"},buttonHeight:50,debug:!1,interactible:!0,imageFormat:"image/jpeg",forceMoveDirection:-1,registerTime:7,authenticateTime:1,globalTimeout:30,fps:0,fpse:0,fpsframes:0,fpseFrames:0,fpsTime:null,fontSizeFactor:1,canvasSizeFactor:1,imageTips1:null,imageTips2:null,imageFaceMoving:[],imageCheck:null,imageError:null,imageArrow:null,face_cam:function(){return"CAM"},face_t:function(){return"TUAL"},face_ult:function(){return"ULT"},face_b:function(){return"B"},imageCamera:null,cropImage:!0,cropFactor:1,warningInTime:.8,warningOutTime:0,detectionTimeout:0,extractionTimeout:0,sceneTimeout:0,secondsWidget:0,secondsState:0,sendingTimeout:2,cameraList:[],graphPath:"graph.xml",testedResolutions:[],facePositions:[],face_v:function(){return"VIR"},face_it:function(){return"IT"},face_s:function(){return"S"},face_fa:function(){return"FA"},tokenizerEvent:null,GenerateTemplateRawFromByteArrayComplete:function(e,t,i){e.tokenizerEvent=i;let s=document.createElement("canvas");s.width=t.naturalWidth,s.height=t.naturalHeight,s.getContext("2d").drawImage(t,0,0);let a=s.toDataURL("image/jpeg");a=a.split(",")[1];let l=window.atob(a);e.postMessage(e,{cmd:"tokenize",data:l})},GenerateTemplateRawFromByteArray:function(e,t){if(!0===this.wasmReady)if(e.complete)this.GenerateTemplateRawFromByteArrayComplete(this,e,t);else{let i=this;e.onload=()=>{i.GenerateTemplateRawFromByteArrayComplete(i,e,t)}}else setTimeout((()=>{this.GenerateTemplateRawFromByteArray(e,t)}),1e3)},Start:function(){this.qualityCheckFailed=!1,this.Start_()},Start_:function(){if(this.fpsTime=performance.now(),this.cameraContainer=document.createElement("div"),this.cameraContainer.id="cameraContainer",this.cameraContainer.style.overflow="hidden",this.cameraContainer.style.position="relative",this.cameraContainer.style.width=this.divContainer.offsetWidth+"px",this.cameraContainer.style.height=this.divContainer.offsetHeight+"px",this.divContainer.appendChild(this.cameraContainer),this.cropFactor<=0){let e=new CustomEvent("FPhi.UserControl.ExceptionCaptured.event",{detail:{message:"Invalid value of CropFactor. Must be greather than 0.",exceptionType:3}});this.divContainer.dispatchEvent(e),this.cropFactor=1}this.sceneTimeout<=0&&(this.sceneTimeout=0);let e=this;this.gifWait=document.createElement("img"),this.gifWait.style.display="none",this.gifWait.addEventListener("load",this.onWaitingLoaded),this.gifWait.onload=()=>{let t=e.canvas.height/2-e.gifWait.height/2,i=e.canvas.width/2-e.gifWait.width/2;e.gifWait.style="position:absolute; top:"+t+"px; left:"+i+"px;"},this.gifWait.src=this.baseURL+"resources/163dpi/2_loading_selphi.gif",document.featurePolicy&&!1===document.featurePolicy.allowsFeature("camera")&&(this.printLog("Selphi: Feature Policy issue: Camera feature is restricted in the actual environment. Check your server HTTP Headers."),this.printLog("https://developers.google.com/web/updates/2018/06/feature-policy#js")),window.location!==window.parent.location&&this.printLog("Selphi: widget running inside iframe."),this.selectedSource=null;let t=document.createElement("canvas");t.id="display",t.style="position:absolute; top:-1px; left:-1px; zIndex:1;",this.cameraContainer.appendChild(t),t.width=this.cameraContainer.offsetWidth+2,t.height=this.cameraContainer.offsetHeight+2,this.canvas=t,this.onCanvasResizeContext=this.onCanvasResize.bind(this),window.addEventListener("resize",this.onCanvasResizeContext,!1),this.initCamera(this.cameraContainer,this.cameraWidth,this.cameraHeight),this.setVideoInput(this),this.widgetTime=performance.now(),this.stateTime=this.widgetTime,this.cameraContainer.appendChild(this.gifWait),this.printLog("Selphi: Hardware concurrency: "+window.navigator.hardwareConcurrency)},Finalize:function(){null!=this.worker&&(this.postMessage(this,{cmd:"destroy"}),this.worker=null),null!=this.drawer&&(this.drawer=null)},Stop:function(){if(null!=this.divContainer){this.onCanvasResizeContext&&(window.removeEventListener("resize",this.onCanvasResizeContext,!1),this.onCanvasResizeContext=void 0),this.onVideoResizeContext&&(this.video.removeEventListener("resize",this.onVideoResizeContext,!1),this.onVideoResizeContext=void 0),this.divContainer.removeEventListener("FPhi.UserControl.Finish.event",this.onExtractionFinish,!0),this.divContainer.removeEventListener("FPhi.UserControl.UserCancel.event",this.onUserCancel,!0),this.divContainer.removeEventListener("FPhi.UserControl.ExtractionTimeout.event",this.onExtractionTimeout,!0),this.divContainer.removeEventListener("FPhi.UserControl.LivenessError.event",this.onLivenessError,!0),this.divContainer.removeEventListener("FPhi.UserControl.LivenessErrorButtonClick.event",this.onLivenessErrorButtonClick,!0),this.divContainer.removeEventListener("FPhi.UserControl.TimeoutErrorButtonClick.event",this.onTimeoutErrorButtonClick,!0),this.divContainer.removeEventListener("FPhi.UserControl.ModuleLoaded.event",this.onModuleLoaded,!0),this.divContainer.removeEventListener("FPhi.UserControl.ExceptionCaptured.event",this.onExceptionCaptured,!0),this.divContainer.removeEventListener("FPhi.UserControl.Stabilizing.event",this.onStabilizing,!0),this.divContainer.removeEventListener("FPhi.UserControl.TrackStatus.event",this.onTrackStatus,!0),this.video.onloadedmetadata=null;let e=this.canvas;e.onmousemove=null,e.onclick=null,this.gifWait.onload=null,this.divContainer.removeChild(this.cameraContainer),this.divContainer=null,this.cameraContainer=null}null!=this.cameraStream&&this.cameraStream.getVideoTracks()[0].stop(),null!=this.rm&&(this.rm.caller=null,this.rm=null),null!=this.graph&&(this.graph=null),null!=this.rmScript&&(this.rmScript.onreadystatechange=null,this.rmScript.onload=null,this.rmScript=null),null!=this.graphScript&&(this.graphScript.onreadystatechange=null,this.graphScript.onload=null,this.graphScript=null),null!=this.drawerScript&&(this.drawerScript.onload=null,this.drawerScript=null),this.Finalize()},reconfigureWidget:function(e){this.imageFormat=e.getImageFormat(),this.imageQuality=e.getImageQuality(),this.cropFactor=e.getCropFactor(),this.cropImage=e.getCropImage(),this.printLog("FPhi.Selphi.Widget.reconfigureWidget fired"),this.printLog("  imageFormat: "+this.imageFormat),this.printLog("  imageQuality: "+this.imageQuality),this.printLog("  cropFactor: "+this.cropFactor),this.printLog("  cropImage: "+this.cropImage)},printLog:function(e){this.showLog&&console.log(e)},onVideoResize:function(){this.cameraWidth=this.video.videoWidth,this.cameraHeight=this.video.videoHeight;let e=this.canvas.getContext("2d",{alpha:!0});this.setCameraPosition(e,this.video)},onCanvasResize:function(){let e=this.canvas,t=e.getContext("2d",{alpha:!0}),i=this.video;if(this.cameraWidth=i.videoWidth,this.cameraHeight=i.videoHeight,0===this.cameraRotation||2===this.cameraRotation?(this.privateCanvas.width=this.cameraWidth,this.privateCanvas.height=this.cameraHeight):(this.privateCanvas.width=this.cameraHeight,this.privateCanvas.height=this.cameraWidth),this.cameraContainer.style.width=this.divContainer.offsetWidth+"px",this.cameraContainer.style.height=this.divContainer.offsetHeight+"px",e.width=this.cameraContainer.offsetWidth+2,e.height=this.cameraContainer.offsetHeight+2,this.drawer.setCanvasSize(e.clientWidth,e.clientHeight),null!=this.elements)for(let e=0;e<this.elements.length;e++)null!=this.elements[e].videoPlayer&&(this.elements[e].videoPlayer.pause(),this.elements[e].videoPlayer.removeAttribute("src"),this.elements[e].videoPlayer.removeEventListener("ended",this.videoplayerEnded.bind(self),!1),this.elements[e].videoPlayer.load(),this.elements[e].videoPlayer=null);this.elements=this.rm.getElements(this.resourceParent,this.drawer.landscape),this.startVideos(this),this.setCameraPosition(t,this.video)},GetAvailableCameras:function(){return navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then(this.gotDevices).catch(this.handleCameraError):null},postMessage:function(e,t){e.queuedCommands++,e.worker.postMessage(t)},setLastExtractionResult:function(e,t){null!=e.lastExtractionResult&&e.lastExtractionResult.delete(),e.lastExtractionResult=t},setCameraPosition:function(e,t){this.cameraVisibleRegion=this.drawer.getCameraRect(e,this.cameraWidth,this.cameraHeight,this.resourceParent);let i="";this.cameraType===b.Selphi.CameraType.Front&&(i="rotateY(180deg) "),1===this.cameraRotation?i+="rotateZ(90deg) ":2===this.cameraRotation?i+="rotateZ(180deg) ":3===this.cameraRotation&&(i+="rotateZ(270deg) "),this.cameraVisibleRegion.visible?(t.style.position="absolute",t.style.top=this.cameraVisibleRegion.y+"px",t.style.left=this.cameraVisibleRegion.x+"px",t.style.width=this.cameraVisibleRegion.width+"px",t.style.height=this.cameraVisibleRegion.height+"px",t.style.transform=i,t.style.zIndex=0):(t.style.position="absolute",t.style.top="-10000px",t.style.left="0px",t.style.width=this.cameraVisibleRegion.width+"px",t.style.height=this.cameraVisibleRegion.height+"px",t.style.transform=i,t.style.zIndex=0),t.style.position="sticky",t.style.position="absolute"},OnGraphNewState:function(e){this.stateTime=performance.now();let t=this.canvas;"UCNothing"!==this.state&&void 0!==this.state||(this.actualTime=this.stateTime,this.widgetTime=this.stateTime),this.secondsWidget=(this.actualTime-this.widgetTime)/1e3,this.secondsState=(this.actualTime-this.stateTime)/1e3,this.state=e,this.resourceParent=this.drawer.getResourceIdForState(e);let i=this.video;if(this.setCameraPosition(t.getContext("2d",{alpha:!0}),i),this.printLog("Selphi: state: "+e),null!=this.elements)for(let e=0;e<this.elements.length;e++)null!=this.elements[e].videoPlayer&&(this.elements[e].videoPlayer.pause(),this.elements[e].videoPlayer.removeAttribute("src"),this.elements[e].videoPlayer.removeEventListener("ended",this.videoplayerEnded.bind(self),!1),this.elements[e].videoPlayer.load(),this.elements[e].videoPlayer=null);if(this.elements=null,null!=this.resourceParent&&(this.elements=this.rm.getElements(this.resourceParent,this.drawer.landscape),this.startVideos(this)),"UCNothing"===e)this.clockNewScenario=performance.now(),this.lastExtractionResult=null,this.bestScore=0,this.faceAvailable=!1,this.clockWaitingStart=null,this.clockExtraction=null,this.clockExtractionPure=null,this.clockLiveness=null,this.extractionTime=this.authenticateTime,this.livenessCalculating=!1,this.privateLastImage=null,this.privateImages=[],this.privateLivenessImages=[],this.privateLivenessResults=[],this.livenessActualRetrain=0,this.livenessErrorString=null;else if("UCTutorialRegister2"===e)this.clockNewScenario=performance.now();else if("UCWaitingFaceStart"===e)this.clockNewScenario=performance.now(),!1===this.interactible&&this.graph.sendMessage("Click//button_start");else if("UCSelectTutorial"===e)this.graph.sendMessage("SetMode//"+self.livenessMode+","+(self.tutorial?1:0));else if("UCExtracting"===e)this.clockNewScenario=performance.now(),this.clockExtraction=performance.now(),this.clockExtractionPure=this.clockExtraction,this.extractionTimePartial=0,this.postMessage(this,{cmd:"initStreamExtraction",mode:this.mode,livenessMode:this.livenessMode,userTags:this.userTags});else if("UCShowResults"===e)this.clockNewScenario=performance.now(),this.clockShowResults=performance.now(),null!=this.lastExtractionResultWizard&&(this.setLastExtractionResult(this.lastExtractionResultWizard),this.lastExtractionResultWizard=null);else if("UCCancelByUser"===e){this.clockNewScenario=performance.now();let e=new CustomEvent("FPhi.UserControl.UserCancel.event");this.divContainer.dispatchEvent(e),this.Stop()}else if("UCLivenessDetectionStep1"===e)this.clockNewScenario=performance.now(),this.clockLiveness1=performance.now();else if("UCLivenessDetectionStep2"===e)this.clockLiveness2=performance.now(),this.privateLivenessImages=[],this.privateLivenessResults=[],this.postMessage(this,{cmd:"livenessTimerReset"});else if("UCLivenessDetectionStep3"===e)this.clockLiveness3_finish=null,this.clockLiveness3=performance.now(),this.postMessage(this,{cmd:"evaluateLiveness",images:this.privateLivenessImages,template:this.lastExtractionResult.Template});else if("UCWaitingEyeDetection"===e)this.clockNewScenario=performance.now(),this.clockEyeDetection=performance.now(),this.clockEyeDetectionDetected=null;else if("UCFinish"===e){this.clockNewScenario=performance.now(),this.clockFinish=performance.now();let e=Array.from(this.privateImages);this.sortImagesByFacialScore(this,e);let t,i=this.getImgTag(e[0],!1,this.cropFactor,this.imageFormat,this.imageQuality),s=this.getImgTag(e[0],!0,this.cropFactor,this.imageFormat,this.imageQuality),a=[];if(this.logImages)for(let e=0;e<this.privateImages.length;e++)void 0!==this.privateImages[e]&&a.push(this.getImgTag(this.privateImages[e],this.cropImage,this.cropFactor,"image/jpeg",this.imageQuality));void 0!==this.lastExtractionResult.templateRaw&&(t=this.lastExtractionResult.templateRaw,this.cm.getTemplateFormat()===b.Selphi.TemplateFormat.Base64&&(t=p(t)));let l=this.lastExtractionResult.template;this.cm.getTemplateFormat()===b.Selphi.TemplateFormat.Base64&&(l=p(l));let n={template:l,bestImage:i,bestImageCropped:s,images:a,timeStamp:this.privateLivenessResults,templateRaw:t,livenessMoveFails:this.livenessMoveActualFailedAttempts,sunGlassesScore:this.lastExtractionResult.sunGlassesScore,livenessMoveHistory:this.livenessMoveHistory,livenessMoveStabilizedHistory:this.livenessMoveStabilizedStatusHistory,livenessMoveStabilizedStatus:this.livenessMoveLastStabilizedStatus};this.cm.getVideoRecord()&&(this.recordedVideo?(n.video=this.recordedVideo,n.videoStatus=b.Selphi.RecorderStatus.Ok):n.videoStatus=b.Selphi.RecorderStatus.SocketError),this.GenerateTemplateRawFromByteArray(i,(e=>{n.bestImageTokenized=e;let t=new CustomEvent("FPhi.UserControl.Finish.event",{detail:n});this.divContainer.dispatchEvent(t),this.Stop()}))}else if("UCErrors"===e){let e={livenessMoveFails:this.livenessMoveActualFailedAttempts,livenessMoveHistory:this.livenessMoveHistory,livenessMoveStabilizedHistory:this.livenessMoveStabilizedStatusHistory,livenessMoveStabilizedStatus:this.livenessMoveLastStabilizedStatus};if(null!=this.lastExtractionResult&&null!=this.lastExtractionResult.sunGlassesScore&&(e.sunGlassesScore=this.lastExtractionResult.sunGlassesScore),this.logImages){let t=[];for(let e=0;e<this.privateImages.length;e++)void 0!==this.privateImages[e]&&t.push(this.getImgTag(this.privateImages[e],this.cropImage,this.cropFactor,this.imageFormat,this.imageQuality));e.images=t,e.timeStamp=this.privateLivenessResults}if(this.clockNewScenario=performance.now(),this.livenessDiagnostic<0)this.divContainer.dispatchEvent(new CustomEvent("FPhi.UserControl.ExtractionTimeout.event",{detail:e}));else{e.livenessErrorType=this.livenessDiagnostic;let t=new CustomEvent("FPhi.UserControl.LivenessError.event",{detail:e});this.divContainer.dispatchEvent(t)}}else if("UCErrorFinish"===e){let e;-1===this.livenessDiagnostic?(e=new CustomEvent("FPhi.UserControl.TimeoutErrorButtonClick.event"),this.divContainer.dispatchEvent(e)):(e=new CustomEvent("FPhi.UserControl.LivenessErrorButtonClick.event"),this.divContainer.dispatchEvent(e)),this.Stop()}else if("UCLivenessMoveStabilizing"===e)this.postMessage(this,{cmd:"initLivenessMoveStabilization"});else if("UCLivenessMoveStabilized"===e)this.livenessMode===b.Selphi.LivenessMode.Move?(!1===this.livenessMoveInit&&(this.postMessage(this,{cmd:"initLivenessMoveSequence",livenessPrecision:this.livenessPrecision}),this.livenessMoveInit=!0),this.postMessage(this,{cmd:"nextLivenessMoveSequence"}),this.livenessMoveNextIndex=0,this.graph.sendMessage("Move")):this.graph.sendMessage("NoMove");else if("UCLivenessMoveDetecting"===e)this.privateLivenessImages=[];else if("UCLivenessMoveProcessing"===e)this.processingIndexBase=this.livenessMoveNextIndex;else if("UCWaitRecording"===e&&this.cm.getVideoRecord()){this.printLog("Selphi: generating movie"),this.agProcessing=!0;let e=this;this.agProcessingFirst=performance.now(),this.recorder.generateVideo().then((function(t){e.recorderFinish=!0,e.recordedVideo=t}),(function(t){e.recorderFinish=!0}))}if(this.divContainer){let t=new CustomEvent("FPhi.UserControl.TrackStatus.event",{detail:{code:b.Selphi.TrackStatus.ChangeState,timeStamp:this.secondsWidget,data:e}});if(this.divContainer.dispatchEvent(t),this.cm.getAccessibility()&&void 0!==this.elements){let e=this.canvas.getContext("2d",{alpha:!0});this.canvas.width<this.canvas.height&&this.cm.forceLandscape&&(e=this.canvasRotated.getContext("2d",{alpha:!0}));let t=e.canvas.width,i=e.canvas.height,s={};s.state=this.state;let a=[];null===this.elements&&(this.elements=[]);for(let e=0;e<this.elements.length;e++)if(this.cm.getAccessibleElements().includes(this.elements[e].type)){let l=this.drawer.getLayout(this.resourceParent,this.elements[e].id,this.elements[e].type,this.secondsWidget,this.secondsState,"Normal",s);null!=l&&(l=this.getLayoutFromXML(this.resourceParent,this.elements[e].id,l,t,i)),null!=l&&a.push({id:this.elements[e].id,type:this.elements[e].type,x:l.x,y:l.y,width:l.width,height:l.height})}let l=new CustomEvent("FPhi.UserControl.TrackStatus.event",{detail:{code:b.Selphi.TrackStatus.AccessibilityData,timeStamp:this.secondsWidget,data:a}});this.divContainer.dispatchEvent(l)}}null!=this.graph&&this.graph.sendMessage("SetStatusFinished")},getImageData:function(e){let t=e.getContext("2d"),i=e.height,s=e.width;return{width:s,height:i,pixels:t.getImageData(0,0,s,i),time:performance.now()}},getImgTag:function(e,t,i,s,a){let l=document.createElement("canvas");l.width=e.width,l.height=e.height,l.getContext("2d").putImageData(e.pixels,0,0);let n=document.createElement("canvas");if(t&&void 0!==e.extractionResult&&void 0!==e.extractionResult.face){let t=e.extractionResult.face.width*i,s=e.extractionResult.face.height*i,a=e.extractionResult.face.x-(i-1)*e.extractionResult.face.width/2,c=e.extractionResult.face.y-(i-1)*e.extractionResult.face.height/2;a<0&&(t+=a,a=0),c<0&&(s+=c,c=0),a+t>=e.width&&(t=e.width-a),c+s>=e.height&&(s=e.height-c),n.width=t,n.height=s,n.getContext("2d").drawImage(l,a,c,t,s,0,0,n.width,n.height)}else n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(l,0,0,n.width,n.height);let c=document.createElement("img");return c.src=n.toDataURL(s,a),c},handleExtractorMessage:function(e){if(null!=this.worker&&null!=this.drawer)if("crticalMessage"===e.data.cmd)console.error(e.data.message);else if("debugMessage"===e.data.cmd)console.debug(e.data.message);else if("infoMessage"===e.data.cmd)console.info(e.data.message);else if("warningMessage"===e.data.cmd)console.warn(e.data.message);else{this.fpseframes++;let t=this.faceAvailable;if(this.queuedCommands--,"tokenize"===e.data.cmd)this.tokenizerEvent&&this.tokenizerEvent(e.data.data);else if("ready"===e.data.cmd)this.queuedCommands++,this.wasmReady=!0,this.CheckDependencies(this);else if("detect"===e.data.cmd){this.lastDetectResult=e.data,this.faceAvailable=!1;let t=this.lastDetectResult;if(t.sampleDiagnostic===b.Selphi.SampleDiagnostic.Ok){if(t.face){let e=this.fromCameraToScreenDetection(this,t.face);this.drawer.faceInsideCircle(e)&&(this.faceAvailable=!0,this.faceDataRect=e)}if(t.leftEye){let e=this.fromCameraToScreenDetection(this,{x:t.leftEye.x,y:t.leftEye.y,width:1,height:1});this.privateEyesYLevel=e.y,this.leftEyeData=e}if(t.rightEye){let e=this.fromCameraToScreenDetection(this,{x:t.rightEye.x,y:t.rightEye.y,width:1,height:1});this.rightEyeData=e}}if(this.faceTooFar=t.sampleDiagnostic===b.Selphi.SampleDiagnostic.FaceTooFar,t.face){let e=this.fromCameraToScreenDetection(this,t.face);(this.drawer.faceInsideCircle(e)||this.cm.getFaceTracking())&&(this.faceAvailable=!0,this.faceDataRect=e)}let i=t.sampleDiagnostic===b.Selphi.SampleDiagnostic.NotRated;if(!1===this.qualityCheckFailed&&!0===i&&this.printLog("Selphi: timeout by phi_code_3"),this.qualityCheckFailed=this.qualityCheckFailed||i,t.leftEye){let e=this.fromCameraToScreenDetection(this,{x:t.leftEye.x,y:t.leftEye.y,width:1,height:1});this.privateEyesYLevel=e.y,this.leftEyeData=e}if(t.rightEye){let e=this.fromCameraToScreenDetection(this,{x:t.rightEye.x,y:t.rightEye.y,width:1,height:1});this.privateEyesYLevel=e.y,this.rightEyeData=e}this.lastExtractionResult&&this.lastExtractionResult.face?this.facePositions.push(this.lastExtractionResult.SampleDiagnostic===b.Selphi.SampleDiagnostic.NotRated):this.facePositions.push(!0),"UCExtracting"===this.state&&(this.qualityCheckFailed&&(t.sampleDiagnostic=b.Selphi.SampleDiagnostic.NotRated),this.privateLastImage.extractionResult=t,t.sampleDiagnostic===b.Selphi.SampleDiagnostic.Ok&&!0===this.faceAvailable&&(this.privateImages.length<5?this.privateImages.push(this.privateLastImage):this.betterSustitution(this,this.privateImages,this.privateLastImage)))}else if("evaluateLiveness"===e.data.cmd)e.data.livenessDiagnostic===b.Selphi.LivenessDiagnostic.LivenessDetected?this.graph.sendMessage("AuthenticationFinished"):(this.livenessActualRetrain+=e.data.penalty,this.livenessActualRetrain>=3?(this.livenessDiagnostic=e.data.livenessDiagnostic,this.graph.sendMessage("Errors")):this.clockLiveness3_finish=this.actualTime);else if("livenessTimerReset"===e.data.cmd);else if("livenessTimerSetValues"===e.data.cmd);else if("livenessTimerAdd"===e.data.cmd)!0===e.data.status&&this.privateLivenessImages.push(this.privateLivenessImageTemp),!0===e.data.isFull&&(this.privateLivenessTimerDiagnostic=e.data.livenessTimerDiagnostic,this.graph.sendMessage("LivenessTimerFull"));else if("nextLivenessMoveSequence"===e.data.cmd)this.livenessMoveDirection=e.data.direction,-1!==this.forceMoveDirection&&(this.livenessMoveDirection=this.forceMoveDirection);else if("nextLivenessMoveStabilization"===e.data.cmd){let t=e.data;if(this.livenessMoveLastStabilizedStatus=t.faceStabilized,this.faceTooFar=3===t.faceStabilized,this.faceAvailable=!1,t.sampleDiagnostic===b.Selphi.SampleDiagnostic.Ok&&(this.lastExtractionResult=e.data),t.face){let e=this.fromCameraToScreenDetection(this,t.face);(this.drawer.faceInsideCircle(e)||this.cm.getFaceTracking())&&(this.faceAvailable=!0,this.faceDataRect=e)}if(t.leftEye){let e=this.fromCameraToScreenDetection(this,{x:t.leftEye.x,y:t.leftEye.y,width:1,height:1});this.privateEyesYLevel=e.y,this.leftEyeData=e}if(t.rightEye){let e=this.fromCameraToScreenDetection(this,{x:t.rightEye.x,y:t.rightEye.y,width:1,height:1});this.privateEyesYLevel=e.y,this.rightEyeData=e}if(this.privateLastImage.extractionResult=t,1!==t.faceStabilized&&17!==t.faceStabilized||(this.livenessMoveStabilizedStatusHistory.push(t.faceStabilized),this.graph.sendMessage("FaceStabilized")),4===t.faceStabilized&&(this.livenessMoveGlassesFail++,this.livenessMoveFailReason=0,this.livenessMoveStabilizedStatusHistory.push(t.faceStabilized),this.graph.sendMessage("GlassesFound//"+this.livenessMoveGlassesFail)),null!=t.faceStabilized){let e=new CustomEvent("FPhi.UserControl.Stabilizing.event",{detail:t.faceStabilized});this.divContainer.dispatchEvent(e)}}else if("nextLivenessMoveImage"===e.data.cmd){this.livenessCalculating=!1;let t=e.data;this.privateImages[this.livenessMoveNextIndex].extractionResult=t,this.privateLivenessImages[this.livenessMoveNextIndex]=null,this.livenessMoveNextIndex++}else if("evaluateLivenessMove"===e.data.cmd){this.livenessCalculating=!1;let t=e.data;this.lastExtractionResult=e.data,this.livenessMoveHistory.push(t.livenessDiagnostic),t.livenessDiagnostic===b.Selphi.LivenessDiagnostic.LivenessDetected?(this.livenessMoveActualSuccessfulAttempts++,this.livenessMoveLastAttempSuccessful=!0,this.graph.sendMessage("LivenessMoveRetry//"+this.livenessMoveActualSuccessfulAttempts+","+this.livenessMoveActualFailedAttempts)):(this.livenessMoveFailReason=1,this.livenessDiagnostic=t.livenessDiagnostic,this.livenessMoveActualFailedAttempts++,this.livenessMoveLastAttempSuccessful=!1,this.graph.sendMessage("LivenessMoveRetry//"+this.livenessMoveActualSuccessfulAttempts+","+this.livenessMoveActualFailedAttempts))}else if("extractNextSmart"===e.data.cmd){let t=e.data;if(this.faceTooFar=e.data.sampleDiagnostic===b.Selphi.SampleDiagnostic.FaceTooFar,this.faceAvailable=!1,t.sampleDiagnostic===b.Selphi.SampleDiagnostic.Ok){this.lastExtractionResult=e.data;let t=this.fromCameraToScreenDetection(this,this.lastExtractionResult.face);this.drawer.faceInsideCircle(t)&&(this.faceAvailable=!0,this.faceDataRect=t)}let i=t.sampleDiagnostic===b.Selphi.SampleDiagnostic.NotRated;if(!1===this.qualityCheckFailed&&!0===i&&this.printLog("Selphi: timeout by phi_code_3"),this.qualityCheckFailed=this.qualityCheckFailed||i,t.leftEye){let e=this.fromCameraToScreenDetection(this,{x:t.leftEye.x,y:t.leftEye.y,width:1,height:1});this.privateEyesYLevel=e.y,this.leftEyeData=e}if(t.rightEye){let e=this.fromCameraToScreenDetection(this,{x:t.rightEye.x,y:t.rightEye.y,width:1,height:1});this.privateEyesYLevel=e.y,this.rightEyeData=e}this.lastExtractionResult&&this.lastExtractionResult.face?this.facePositions.push(this.lastExtractionResult.SampleDiagnostic===b.Selphi.SampleDiagnostic.NotRated):this.facePositions.push(!0),"UCExtracting"===this.state&&(this.qualityCheckFailed&&(t.sampleDiagnostic=b.Selphi.SampleDiagnostic.NotRated),this.privateLastImage.extractionResult=t,t.sampleDiagnostic===b.Selphi.SampleDiagnostic.Ok&&!0===this.faceAvailable&&(this.privateImages.length<5?this.privateImages.push(this.privateLastImage):this.betterSustitution(this,this.privateImages,this.privateLastImage)))}if(this.faceTooFar&&(this.faceAvailable=!1),this.oldFaceAvailableDelayed=this.faceAvailableDelayed,!0===t&&!1===this.faceAvailable?this.clockWarningIn=this.actualTime:!1===t&&!0===this.faceAvailable?this.clockWarningOut=this.actualTime:(this.faceAvailable&&this.actualTime-this.clockWarningOut>1e3*this.warningOutTime||!this.faceAvailable&&this.actualTime-this.clockWarningIn>1e3*this.warningInTime)&&(this.faceAvailableDelayed=this.faceAvailable),this.oldFaceAvailableDelayed!==this.faceAvailableDelayed&&this.divContainer){let e=new CustomEvent("FPhi.UserControl.TrackStatus.event",{detail:{code:b.Selphi.TrackStatus.FaceState,timeStamp:this.secondsWidget,data:this.faceAvailableDelayed}});this.divContainer.dispatchEvent(e)}}},faceTrack:function(){if(null!=this.faceDataRect){let e=Math.round(this.drawer.circleX-(this.faceDataRect.x+this.faceDataRect.width/2)),t=Math.round(this.drawer.circleY-(this.faceDataRect.y+this.faceDataRect.height/2));e>this.drawer.circleX-this.drawer.circleRadius&&(e=this.drawer.circleX-this.drawer.circleRadius),t>this.drawer.circleY-this.drawer.circleRadius&&(t=this.drawer.circleY-this.drawer.circleRadius),e+this.cameraVisibleRegion.width<this.drawer.circleX+this.drawer.circleRadius&&(e=this.drawer.circleX+this.drawer.circleRadius-this.cameraVisibleRegion.width),t+this.cameraVisibleRegion.height<this.drawer.circleY+this.drawer.circleRadius&&(t=this.drawer.circleY+this.drawer.circleRadius-this.cameraVisibleRegion.height),null==this.faceTrackingOffset&&(this.faceTrackingOffset={x:this.cameraVisibleRegion.x,y:this.cameraVisibleRegion.y}),this.faceTrackingOffset.x+=1.5*(e-this.faceTrackingOffset.x)/this.fps,this.faceTrackingOffset.y+=1.5*(t-this.faceTrackingOffset.y)/this.fps,this.video.style.left=this.faceTrackingOffset.x+"px",this.video.style.top=this.faceTrackingOffset.y+"px"}},startVideos:function(e){if(null!=e.elements)for(let t=0;t<e.elements.length;t++)if("video"===e.elements[t].type){let i=document.createElement("video");i.hidden=!0,i.playsinline=!0,i.loop=!1,i.muted=!0,i.autoplay=!0,i.controls=!0,i.src=e.rm.getResourceUrlBase(e.rm.getSetupResourceId(e.resourceParent,e.elements[t].id,e.drawer.landscape,"value")),i.addEventListener("ended",e.videoplayerEnded.bind(e),!1),i.setAttribute("playsinline",""),i.setAttribute("webkit-playsinline",""),i.play(),e.elements[t].videoPlayer=i}},canvasOnMove:function(e){if(void 0!==this.elements&&null!=this.elements)for(let t=this.elements.length-1;t>=0;t--)if(void 0!==this.elements[t].layout&&e.offsetX>=this.elements[t].layout.x&&e.offsetX<this.elements[t].layout.x+this.elements[t].layout.width&&e.offsetY>=this.elements[t].layout.y&&e.offsetY<this.elements[t].layout.y+this.elements[t].layout.height){if("button_info"===this.elements[t].id)break;this.drawer.onMouseMove(e.target,this.elements[t].layout,this.resourceParent,this.elements[t].id,this.elements[t].type);break}},routeClick:function(e,t){this.canvasOnClick({offsetX:e,offsetY:t})},canvasOnClick:function(e){if("UCErrors"===this.state){e.offsetX;let t=e.offsetY,i=this.canvasHeight-this.buttonHeight;this.printLog("Selphi: canvasOnClick",this.canvasHeight,i,t),t>i&&this.graph.sendMessage("Click//button_error")}else{if(void 0===this.elements)return;let t=null;for(let i=this.elements.length-1;i>=0;i--)if(null!=this.elements[i].layout&&e.offsetX>=this.elements[i].layout.x&&e.offsetX<this.elements[i].layout.x+this.elements[i].layout.width&&e.offsetY>=this.elements[i].layout.y&&e.offsetY<this.elements[i].layout.y+this.elements[i].layout.height){t=this.elements[i].id;let e="Click//"+this.elements[i].id;this.graph.sendMessage(e);break}if(this.divContainer){let e=new CustomEvent("FPhi.UserControl.TrackStatus.event",{detail:{code:b.Selphi.TrackStatus.Tap,timeStamp:this.secondsWidget,data:t}});this.divContainer.dispatchEvent(e)}}},initCamera:function(e,t,i){let s=this.canvas;if(!this.video){let t=document.createElement("video");t.id="live",t.setAttribute("playsinline",""),t.setAttribute("webkit-playsinline",""),t.setAttribute("autoplay",""),t.setAttribute("muted",""),t.style.display="none",e.insertBefore(t,e.firstChild),this.video=t,this.onVideoResizeContext=this.onVideoResize.bind(this),t.addEventListener("resize",this.onVideoResizeContext,!1)}s.imageSmoothingEnabled=!0,s.clientWidth,s.clientHeight,s&&(s.style.display="none",s.onclick=this.canvasOnClick.bind(this),s.onmousemove=this.canvasOnMove.bind(this),this.privateCanvas=document.createElement("canvas"),0===this.cameraRotation||2===this.cameraRotation?(this.privateCanvas.width=t,this.privateCanvas.height=i):(this.privateCanvas.width=i,this.privateCanvas.height=t))},userMedia:function(){return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||null},setVideoInput:function(e){e.canvas&&e.playDevice(e)},playDevice:function(e){let t,i=e.video,s=e.canvas.getContext("2d",{alpha:!0}),a=null;"undefined"!=typeof facePhiUserControl&&null!==facePhiUserControl.config.videoSelectId&&(a=facePhiUserControl.config.videoSelectId),window.stream&&window.stream.getTracks().forEach((e=>{e.stop()})),t={video:{deviceId:a?{exact:a}:void 0,width:e.cameraWidth,height:e.cameraHeight,facingMode:e.cameraType===b.Selphi.CameraType.Front?"user":"environment"},audio:!1},navigator.mediaDevices.getUserMedia(t).then((function(t){e.cameraStream=t,i.srcObject=t;const s=t.getVideoTracks()[0];e.cameraName=s.label,e.printLog("Selphi: Camera selected for widget: "+s.label),i.onloadedmetadata=e.videoLoaded.bind(e),i.play()})).catch((function(t){e.draw(e,e.imageCamera,s);let i=new CustomEvent("FPhi.UserControl.ExceptionCaptured.event",{detail:{message:"Camera not found.",exceptionType:0}});e.divContainer.dispatchEvent(i)}))},addCameraResolution:function(e,t,i){for(let s=0;s<e.length;s++)if(e[s].width===t&&e[s].height===i)return;e.push({width:t,height:i})},checkCameraResolutions:async function(e,t,i){let s=document.createElement("video");const a=await navigator.mediaDevices.enumerateDevices();for(let e=0;e<a.length;e++)i.printLog("Selphi: "+a[e]);let l={video:{width:i.cameraWidth,height:i.cameraHeight,facingMode:i.cameraType===b.Selphi.CameraType.Front?"user":"environment"},audio:!1};try{const t=await navigator.mediaDevices.getUserMedia(l);s.srcObject=t,s.onloadedmetadata=async function(s){t.getVideoTracks()[0];for(let s=0;s<e.length;s++){let a={width:{exact:e[s].width},height:{exact:e[s].height}};try{const l=t.getVideoTracks()[0];await l.applyConstraints(a);let n=l.getSettings();n.resizeMode?"none"===n.resizeMode&&i.addCameraResolution(i.testedResolutions,e[s].width,e[s].height):i.addCameraResolution(i.testedResolutions,e[s].width,e[s].height)}catch(e){}}let a="Camera resolutions: ";for(let e=0;e<i.testedResolutions.length;e++)a=a+"["+i.testedResolutions[e].width+"x"+i.testedResolutions[e].height+"]";i.printLog("Selphi: "+a),t.getTracks().forEach((function(e){e.stop()})),i.Start_()},s.play()}catch(e){self_Start_()}},handleRecorderDataAvailable:function(e){e.data&&e.data.size>0&&this.recordedBlobs.push(e.data)},handleRecorderOnStop:function(e){this.recorderFinish=!0},mobileCheck:function(){let e=!1;var t;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e},isIpadOS:function(){return navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)},gotDevices:function(e){let t=0;for(let i=0;i!==e.length;++i)"videoinput"===e[i].kind&&t++;this.cameraList=new Array(t);let i=0;for(let t=0;t!==e.length;++t){let s=e[t];if("videoinput"===s.kind){let e=document.createElement("option");e.value=s.deviceId,e.text=s.label,this.cameraList[i]=e,i++}}let s=new CustomEvent("FPhi.UserControl.Cameras.event",{detail:{cameras:this.cameraList}});this.divContainer.dispatchEvent(s)},handleCameraError:function(e){},fromCameraToScreen:function(e,t){let i=e.cameraWidth,s=e.cameraHeight;1!==e.cameraRotation&&3!==e.cameraRotation||(i=e.cameraHeight,s=e.cameraWidth);let a=e.canvas.getContext("2d",{alpha:!0}),l=e.drawer.getCameraRect(a,i,s),n=l.width/i,c=l.height/s,h={x:t.x*n,y:t.y*c,width:t.width*n,height:t.height*c},o=e.reflectedX(l.width,h.x+h.width);return h.x=o,h.x+=l.x,h.y+=l.y,h},fromCameraToScreenDetection:function(e,t){let i=e.cameraWidth,s=e.cameraHeight;1!==e.cameraRotation&&3!==e.cameraRotation||(i=e.cameraHeight,s=e.cameraWidth);let a=e.canvas.getContext("2d",{alpha:!0}),l=e.drawer.getCameraRect(a,i,s),n=l.width/i,c=l.height/s,h={x:t.x*n,y:t.y*c,width:t.width*n,height:t.height*c},o=e.reflectedX(l.width,h.x+h.width);return h.x=o,h.x+=l.x,h.y+=l.y,h},scaleRect:function(e,t,i){let s=t.x+t.width/2,a=t.y+t.height/2,l=t.width/e.width,n=t.height/e.height,c=e.width*l,h=e.height*l;return void 0===i?h<t.height&&(c=e.width*n,h=e.height*n):h>=t.height&&(c=e.width*n,h=e.height*n),{x:s-c/2,y:a-h/2,width:c,height:h}},scaleRectByFactor(e,t,i){let s=e.x+.5*e.width,a=e.y+.5*e.height,l={x:0,y:0,width:0,height:0};l.width=e.width*=t,l.height=e.height*=i,l.x=e.x,l.y=e.y;let n=e.x+.5*e.width-s,c=e.y+.5*e.height-a;return l.x-=n,l.y-=c,l},getGraphicalScore:function(e){let t=100*e/90*(100*e/90)*.9+.1;return t>1&&(t=1),t},saveImageToCanvas:function(e,t){let i=e.privateCanvas.getContext("2d");switch(e.cameraRotation){case 0:i.drawImage(t,0,0,e.cameraWidth,e.cameraHeight);break;case 1:case 3:i.save(),i.translate(e.cameraHeight/2,e.cameraWidth/2),i.rotate(Math.PI/2*e.cameraRotation),i.drawImage(t,-e.cameraWidth/2,-e.cameraHeight/2),i.restore();break;case 2:i.save(),i.translate(e.cameraWidth/2,e.cameraHeight/2),i.rotate(Math.PI/2*e.cameraRotation),i.drawImage(t,-e.cameraWidth/2,-e.cameraHeight/2),i.restore()}},getLayoutFromXML:function(e,t,i,s,a){let l="LEFT",n="TOP",c=i,h=!1;if(this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"width")){null==c&&(c={});let i=this.rm.getSetupFloat(e,t,this.drawer.landscape,"width");c.width=i<=1?i*s:i,h=!0}if(this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"height")){null==c&&(c={});let i=this.rm.getSetupFloat(e,t,this.drawer.landscape,"height");c.height=i<=1?i*a:i,h=!0}if(this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"xAnchor")&&(l=this.rm.getSetupAlign(e,t,this.drawer.landscape,"xAnchor")),this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"yAnchor")&&(n=this.rm.getSetupAlign(e,t,this.drawer.landscape,"yAnchor")),this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"x")){null==c&&(c={});let i=this.rm.getSetupFloat(e,t,this.drawer.landscape,"x");c.x=i<=1&&i>=-1?i*s:i,"CENTER"===l?c.x=s/2-c.width/2+c.x:"RIGHT"===l&&(c.x=s-c.width+c.x),h=!0}if(this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"y")){null==c&&(c={});let i=this.rm.getSetupFloat(e,t,this.drawer.landscape,"y");c.y=i<=1&&i>=-1?i*a:i,"CENTER"===n?c.y=a/2-c.height/2+c.y:"BOTTOM"===n&&(c.y=a-c.height+c.y),h=!0}return c},draw:function(e){if(null==this.drawer)return;if(null==this.divContainer)return;this.cm.getFaceTracking()&&this.faceTrack();let t=this,i=t.video,s=t.canvas.getContext("2d",{alpha:!0}),a=s.canvas.clientWidth,l=s.canvas.clientHeight;t.canvasWidth=a,t.canvasHeight=l,s.clearRect(0,0,a,l),t.fpsframes++,t.actualTimePrev=t.actualTime,t.actualTime=performance.now();let n=(t.actualTime-t.fpsTime)/1e3;n>1&&(t.fps=t.fpsframes/n,t.fpseframes>0?t.fpse=t.fpseframes/n:t.fpse=0,t.fpsTime=t.actualTime,t.fpsframes=0,t.fpseframes=0);let c="Normal";if(t.actualTime-t.widgetTime>500&&("UCWaitingFaceStart"!==t.state&&"UCExtracting"!==t.state||t.faceAvailableDelayed||(c="Warning"),"UCLivenessMoveStabilizing"===t.state&&1!==t.livenessMoveLastStabilizedStatus&&2!==t.livenessMoveLastStabilizedStatus&&17!==t.livenessMoveLastStabilizedStatus&&(c="Warning")),t.iterateAutomata(t,i,s),t.secondsWidget=(t.actualTime-t.widgetTime)/1e3,t.secondsState=(t.actualTime-t.stateTime)/1e3,void 0!==t.elements&&null!==t.elements){let e={progress:0};e.faceDataRect=t.faceDataRect,e.leftEyeData=t.leftEyeData,e.rightEyeData=t.rightEyeData,e.state=t.state,e.livenessMoveLastStabilizedStatus=t.livenessMoveLastStabilizedStatus,e.interactible=t.interactible,"UCExtracting"===t.state?0!==t.extractionTime?e.progress=t.extractionTimePartial/(1e3*t.extractionTime):e.progress=0:"UCShowResults"===t.state?e.progress=t.getGraphicalScore(t.lastExtractionResult.templateScore):"UCLivenessMoveDetecting"===t.state?e.livenessMoveDirection=t.livenessMoveDirection:"UCWaitingFaceStart"===t.state||"UCWaitingFaceStartDecision"===t.state?e.progress=1:"UCErrors"!==t.state&&"UCErrorFinish"!==t.state||(e.livenessDiagnostic=t.livenessDiagnostic),e.livenessMoveFailReason=t.livenessMoveFailReason;for(let i=0;i<t.elements.length;i++){if(("button"===t.elements[i].type||"buttonImage"===t.elements[i].type)&&!1===t.interactible)continue;let n=null;if(null!==t.rm&&(n=t.drawer.getLayout(t.resourceParent,t.elements[i].id,t.elements[i].type,t.secondsWidget,t.secondsState,c,e)),null!==n&&(n=t.getLayoutFromXML(t.resourceParent,t.elements[i].id,n,a,l)),null!==n){t.elements[i].layout=n;let a=t.elements[i].mode,l=!1;if(null!=a){let e=a.split("|");for(let t=0;t<e.length;t++)if(e[t]===c){l=!0;break}}else l=!0;if(!0===l){if("video"===t.elements[i].type)e.player=t.elements[i].videoPlayer;else if("camera"===t.elements[i].type)if(e.eyesYLevel=t.privateEyesYLevel,e.blindText="","UCLivenessDetectionStep1"===t.state){let i=t.actualTime-t.clockLiveness1;i/=1e3*t.liveness1Time,i>1&&(i=1),i=(i-1)*(i-1)*(i-1)+1,e.blind=.8*i}else if("UCLivenessDetectionStep2"===t.state)e.blind=.8,e.blindText=t.rm.translate("message_blink");else if("UCLivenessDetectionStep3"===t.state){let i=0;i=t.actualTime-t.clockLiveness3,i=i/(1e3*t.liveness3Time)*.2,i>.2&&(i=.2),e.blind=.8+i}else if("UCWaitingEyeDetection"===t.state)if(null==t.clockEyeDetectionDetected){let i=t.actualTime-t.clockEyeDetection,s=0;i<1e3?s=1:(s=(i-1e3)/(1e3*t.liveness1Time),s<0?s=0:s>1&&(s=1),s=1-s),e.blind=s}else{let i=(t.actualTime-t.clockEyeDetectionDetected)/(1e3*t.liveness3Time)*.2;i<0?i=0:i>.2&&(i=.2),e.blind=1-i}else e.blind=0;"button_info"===t.elements[i].id||t.cm.getAccessibility()&&t.cm.getAccessibleElements().includes(t.elements[i].type)||t.drawer.draw(s,n,t.resourceParent,t.elements[i].id,t.elements[i].type,t.secondsWidget,t.secondsState,c,e)}}}}else if("UCErrors"===t.state){s.fillStyle="white",s.fillRect(0,0,a,l);let e=t.livenessErrorString,i=15*t.fontSizeFactor,n=t.rm.getSetupResourceId("facephi-widget-conf","",t.drawer.landscape,"font_warning_message");s.font=i+"px '"+n+"'",s.fillStyle="black";let c=e.split("\n");for(let e=0;e<c.length;e++){let l=s.measureText(c[e]),n=330*t.canvasSizeFactor+i*e;s.fillText(c[e],a/2-l.width/2,n)}let h=t.livenessErrorImage,o=t.scaleRect({width:h.width,height:h.height},{x:.03*a,y:.378*l,width:.94*a,height:.1*l},!0);s.drawImage(h,o.x,o.y,o.width,o.height),t.drawButton(t,s,{x:0,y:l-t.buttonHeight,width:a,height:t.buttonHeight},"Results","button_finish"),t.secondsState}if(t.debug&&null!=t.worker){let e=1;s.font="12px Verdana",s.fillStyle="gray",s.fillText("Version: "+t.extractorVersion,0,20*e),e++,s.fillText("State: "+t.state,0,20*e),e++,s.fillText("FPS: "+t.fps.toFixed(2),0,20*e),e++,s.fillText("FPS Extractor: "+t.fpse.toFixed(2),0,20*e),e++,s.fillText("Camera size: "+t.cameraWidth+"x"+t.cameraHeight+"px",0,20*e),e++,s.fillText("Canvas size: "+a+"x"+l+"px",0,20*e),e++,s.fillText("Camera rotation: "+t.cameraRotation,0,20*e),e++,s.fillText("WidgetTime: "+t.secondsWidget,0,20*e),e++,s.fillText("StateTime: "+t.secondsState,0,20*e),e++,s.fillText("Mode: "+c,0,20*e),e++,s.fillText("Images: "+t.privateImages.length,0,20*e),e++,s.fillText("Face available: "+t.faceAvailable,0,20*e),e++,s.fillText("EyesYLevel: "+Math.round(t.privateEyesYLevel),0,20*e),e++;let i=t.lastDetectResult;if(null!=i){if(void 0!==i.face){s.fillText("Face: ["+i.face.x+","+i.face.y+","+i.face.width+","+i.face.height+"]",0,20*e),e++,s.beginPath(),s.lineWidth="3",s.strokeStyle="red";let a=t.fromCameraToScreen(t,{x:i.face.x,y:i.face.y,width:i.face.width,height:i.face.height});s.rect(a.x,a.y,a.width,a.height),s.stroke()}if(void 0!==i.leftEye){s.beginPath(),s.lineWidth="6",s.strokeStyle="red";let e=t.fromCameraToScreen(t,{x:i.leftEye.x,y:i.leftEye.y,width:1,height:1});s.rect(e.x,e.y,e.width,e.height),s.stroke()}if(void 0!==i.rightEye){s.beginPath(),s.lineWidth="6",s.strokeStyle="red";let e=t.fromCameraToScreen(t,{x:i.rightEye.x,y:i.rightEye.y,width:1,height:1});s.rect(e.x,e.y,e.width,e.height),s.stroke()}}}null!=t.worker&&setTimeout(t.draw.bind(this),t.samplePeriod)},reduceRect:function(e,t){let i=e.width*(1-t),s=e.height*(1-t);return e.x=e.x+(e.width-i)/2,e.y=e.y+(e.height-s)/2,e.width=i,e.height=s,e},drawStringMultiline:function(e,t,i,s,a,l,n){let c=i.split("\n");t.imageSmoothingEnabled=!1,n=Math.round(n*e.fontSizeFactor),t.font="normal "+n+"px '"+l+"'",t.fillStyle=a;for(let i=0;i<c.length;i++){let a=t.measureText(c[i]);t.fillText(c[i],e.canvasWidth/2-a.width/2,s+i*(n+1))}},setOffInterface:function(e,t,i){e.beginPath(),e.lineWidth="5",e.fillStyle="gray",e.fillRect(0,0,i,i),e.stroke()},adaptText:function(e,t,i,s){if(t.font=s,t.measureText(i).width>e){let a=s.indexOf("px"),l=s.substring(0,a);return l--,s=l+s.substring(a,s.length),t.font=s,this.adaptText(e,t,i,s)}return!0},reflectedX:function(e,t){return e-t},iterateAutomata:function(e,t,i){if(!1!==e.cameraReady){if(!1===e.wasmInitiated){e.wasmInitiated=!0;let t=e.privateCanvas.width;t>e.privateCanvas.height&&(t=e.privateCanvas.height),e.postMessage(e,{cmd:"init",livenessMode:e.livenessMode,stabilizationStage:e.stabilizationStage,minIOD:.125*t,maxIOD:.27*t,cameraWidth:e.privateCanvas.width,cameraHeight:e.privateCanvas.height})}if("UCNothing"===e.state){let t=e.canvas;null!=t&&(t.style.display="inline-block");let i="SetMode//"+e.livenessMode+","+(e.tutorial?1:0);e.printLog(i),e.graph.sendMessage(i)}else if("UCErrors"===e.state)!1===e.interactible&&e.secondsState>2&&e.graph.sendMessage("Click//button_error");else if("UCTutorialRegister1"===e.state)e.evaluateScenarioTimeout(e);else if("UCTutorialRegister2"===e.state)e.evaluateScenarioTimeout(e);else if("UCWaitingFaceStart"===e.state)0===e.queuedCommands&&e.wasmReady&&(e.saveImageToCanvas(e,t),e.privateLastImage=e.getImageData(e.privateCanvas),e.postMessage(e,{cmd:"detect",data:e.privateLastImage.pixels.data,width:e.privateLastImage.width,height:e.privateLastImage.height,format:b.Selphi.ImageFormat.RGBA_32bpp}),e.evaluateScenarioTimeout(e));else if("UCWaitingFaceStartDecision"===e.state)!0===e.stabilizationStage?e.graph.sendMessage("Stabilize"):e.graph.sendMessage("Extract");else if("UCExtracting"===e.state){let i=!1,s=!1;navigator.userAgent&&(navigator.userAgent.includes("Macintosh")&&(i=!0),navigator.userAgent.includes("Chrome")&&(s=!0)),e.cameraName.toUpperCase().includes(e.face_v()+e.face_t())||e.cameraName.toUpperCase().includes(e.face_o()+e.face_b()+e.face_s())||e.cameraName.toUpperCase().includes(e.face_spl()+e.face_it()+e.face_cam())||e.cameraName.toUpperCase().includes(e.face_fa()+e.face_ke())||e.cameraName.toUpperCase().includes(e.face_sn()+e.face_ap())||e.cameraName.toUpperCase().includes(e.face_defa()+e.face_ult())||e.cameraName.toUpperCase().includes(e.face_mo()+e.face_ck())||e.cameraName.toUpperCase().includes(e.face_alpha())?e.actualTime-e.clockExtractionPure>e.extractionTimeout&&(e.livenessDiagnostic=-1,e.graph.sendMessage("Timeout"),e.printLog("Selphi: timeout by phi_code_2")):e.faceAvailableDelayed&&(e.extractionTimePartial+=e.actualTime-e.actualTimePrev),0===e.queuedCommands&&(e.actualTime-e.clockExtractionPure>e.detectionTimeout&&0===e.privateImages.length?(e.livenessDiagnostic=-1,e.graph.sendMessage("Timeout")):e.extractionTime>0&&(e.extractionTimePartial<1e3*e.extractionTime||0===e.privateImages.length)?e.actualTime-e.clockExtractionPure>e.extractionTimeout?(e.livenessDiagnostic=-1,e.graph.sendMessage("Timeout")):(e.saveImageToCanvas(e,t),e.privateLastImage=e.getImageData(e.privateCanvas),e.postMessage(e,{cmd:"extractNextSmart",data:e.privateLastImage.pixels.data,width:e.privateLastImage.width,height:e.privateLastImage.height,format:b.Selphi.ImageFormat.RGBA_32bpp})):17==e.livenessMoveLastStabilizedStatus?(e.livenessMoveFailReason=2,e.livenessMoveActualFailedGlassesAttempts++,e.livenessMoveActualFailedAttempts++,e.graph.sendMessage("LivenessMoveGlasses//"+e.livenessMoveActualFailedAttempts)):e.graph.sendMessage("AuthenticationFinished"))}else if("UCShowResults"===e.state)e.evaluateScenarioTimeout(e);else if("UCWaitingEyeDetection"===e.state){if(performance.now()-e.clockEyeDetection>e.detectionTimeout)return e.livenessDiagnostic=-1,void e.graph.sendMessage("Timeout");let i=performance.now()-e.clockEyeDetection;if(i>1e3&&null==e.clockEyeDetectionDetected&&i<1e3+1e3*e.liveness1Time)return;if(i>1e3+1e3*e.liveness1Time&&null!=e.clockEyeDetectionDetected)return void e.graph.sendMessage("ResetLivenessBlink");null!=e.clockEyeDetectionDetected&&performance.now()-e.clockEyeDetectionDetected>1e3*e.liveness3Time&&e.graph.sendMessage("Timer"),null==e.clockEyeDetectionDetected&&0===e.queuedCommands&&e.wasmReady&&(e.saveImageToCanvas(e,t),e.privateLastImage=e.getImageData(e.privateCanvas),e.postMessage(e,{cmd:"detect",data:e.privateLastImage.pixels.data,width:e.privateLastImage.width,height:e.privateLastImage.height,format:b.Selphi.ImageFormat.RGBA_32bpp}),e.evaluateScenarioTimeout(e))}else if("UCLivenessDetectionStep1"===e.state)performance.now()-e.clockLiveness1>1e3*e.liveness1Time&&e.graph.sendMessage("Timer");else if("UCLivenessDetectionStep2"===e.state)0===e.queuedCommands&&e.wasmReady&&(e.saveImageToCanvas(e,t),e.privateLivenessImageTemp=e.getImageData(e.privateCanvas),e.postMessage(e,{cmd:"livenessTimerAdd",milliseconds:performance.now()-e.clockLiveness2}));else if("UCLivenessDetectionStep3"===e.state)null!=e.clockLiveness3_finish&&performance.now()-e.clockLiveness3_finish>1e3*e.liveness3Time&&e.graph.sendMessage("EyeDetectionNeeded");else if("UCLivenessMoveStabilizing"===e.state)if(e.secondsState>=10){e.livenessDiagnostic=-1,e.livenessMoveStabilizedStatusHistory.push(-1),e.graph.sendMessage("Timeout");let t=new CustomEvent("FPhi.UserControl.Stabilizing.event",{detail:-1});this.divContainer.dispatchEvent(t)}else 0===e.queuedCommands&&e.wasmReady&&(e.saveImageToCanvas(e,t),e.privateLastImage=e.getImageData(e.privateCanvas),e.postMessage(e,{cmd:"nextLivenessMoveStabilization",data:e.privateLastImage.pixels.data,width:e.privateLastImage.width,height:e.privateLastImage.height,format:b.Selphi.ImageFormat.RGBA_32bpp}));else if("UCLivenessMoveDetecting"===e.state){if(e.secondsState>.5){let i=Math.round(1e3*e.secondsState);if(e.livenessMoveTimer.Add(i)){e.saveImageToCanvas(e,t);let i=e.getImageData(e.privateCanvas);e.privateLivenessImages.push(i),this.privateImages.push(i),this.privateLivenessResults.push(this.secondsWidget),0===e.queuedCommands&&e.wasmReady&&!e.livenessCalculating&&e.livenessMoveNextIndex<e.privateLivenessImages.length&&e.privateLivenessImages.length>0&&(e.livenessCalculating=!0,i=e.privateLivenessImages[e.livenessMoveNextIndex],e.printLog({"Selphi: image":e.getImgTag(i,!1,1,"image/jpeg",e.imageQuality)}),e.postMessage(e,{cmd:"nextLivenessMoveImage",data:i.pixels.data,width:i.width,height:i.height,format:b.Selphi.ImageFormat.RGBA_32bpp}))}e.livenessMoveTimer.IsFull()&&e.graph.sendMessage("LivenessTimerFull")}}else if("UCLivenessMoveProcessing"===e.state){if(0===e.queuedCommands&&e.wasmReady)if(!e.livenessCalculating&&e.livenessMoveNextIndex>=e.privateLivenessImages.length)e.livenessCalculating=!0,e.postMessage(e,{cmd:"evaluateLivenessMove",timer:e.livenessMoveTimer});else if(!e.livenessCalculating&&e.livenessMoveNextIndex<e.privateLivenessImages.length&&e.privateLivenessImages.length>0){e.livenessCalculating=!0;let t=e.privateLivenessImages[e.livenessMoveNextIndex];e.printLog({"Selphi: image":e.getImgTag(t,!1,1,"image/jpeg",e.imageQuality)}),e.postMessage(e,{cmd:"nextLivenessMoveImage",data:t.pixels.data,width:t.width,height:t.height,format:b.Selphi.ImageFormat.RGBA_32bpp})}}else"UCLivenessMoveInfo"===e.state?e.secondsState>e.livenessMoveInfoTime&&(e.livenessDiagnostic=-1,e.graph.sendMessage("Timeout")):"UCWaitRecording"===e.state&&(e.cm.getVideoRecord()?e.recorderFinish&&e.graph.sendMessage("Finish"):e.graph.sendMessage("Finish"));if(e.cm.getVideoRecord()&&e.recorder.isReady()){e.privateRecordCanvasContext.drawImage(t,0,0,e.privateRecordCanvas.width,e.privateRecordCanvas.height);let i=e.privateRecordCanvasContext.getImageData(0,0,e.privateRecordCanvas.width,e.privateRecordCanvas.height);e.recorder.addFrame(i)}}},evaluateScenarioTimeout:function(e){e.sceneTimeout>0&&performance.now()-e.clockNewScenario>1e3*e.sceneTimeout&&(e.livenessDiagnostic=-1,e.graph.sendMessage("Timeout"))},getVideoSources:function(e){if(navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then((function(t){t.filter((function(e){return"video"===e.kind})).map((function(e,t){return e.id}))[0],e.setVideoInput(e)})):MediaStreamTrack.getSources((function(t){t.filter((function(e){return"video"===e.kind})).map((function(e,t){return e.id}))[0],e.setVideoInput(e)})),null==selectedSource){FacePhiDisplayErrorImage(facePhiUserControl.config.width,folderPath+commonPath+"/Images/errorNoCamsEs.png",folderPath+commonPath+"/Images/errorNoCamsEn.png","FacePhiWidgetWeb",e.divContainer,0,"","",0,Verdana,"Bold","black",0);let t=new CustomEvent("FPhi.UserControl.ExceptionCaptured.event",{detail:{message:"Camera not found.",exceptionType:0}});e.divContainer.dispatchEvent(t)}},isPathAbsolute:function(e){return/^(?:\/|.+:\/\/|http)/.test(e)},getScriptPath:function(){return String((new Error).stack).replace(/^Error.*\n/,"").split("\n")[1].match(/http.*\.js/)[0].split("/").slice(0,-1).join("/")+"/"},distAlgSustitution:function(e,t,i){let s,a=Number.MAX_VALUE;for(let l=1;l<t.length;l++){let n=t.slice();n[l]=i,n.sort((function(e,t){return e.time-t.time}));let c=e.desviacionTipica(e,n);c<a&&(a=c,s=n)}return s},betterSustitution:function(e,t,i){let s=Number.MAX_VALUE,a=0;for(let e=0;e<t.length;e++){let i=t[e].extractionResult.facialScore;i<s&&(s=i,a=e)}i.extractionResult.facialScore>s&&(t[a]=i)},sortImagesByFacialScore:function(e,t){t.sort((function(e,t){let i=void 0!==e.extractionResult?e.extractionResult.facialScore:0;return(void 0!==t.extractionResult?t.extractionResult.facialScore:0)-i}))},desviacionTipica:function(e,t){let i=e.media(e,t),s=0;for(let e=1;e<t.length;e++){let a=t[e].time-t[e-1].time;s+=(a-i)*(a-i)}return s=Math.sqrt(s/(t.length-2)),s},media:function(e,t){let i=0;for(let e=1;e<t.length;e++)i+=t[e].time-t[e-1].time;return i/(t.length-1)},OnResourceManagerLoaded:function(e){this.rm=new b.ResourceManager(this.baseURL,this.language,this,this.OnResourceManagerStatus,this.dpiList,window.devicePixelRatio,this.canvasSizeFactor)},OnResourceManagerStatus:function(e,t){t&&(e.rmReady=!0,e.CheckDependencies(e))},OnGraphLoaded:function(e){this.graph=new b.Graph(this.path+this.graphPath,this.OnGraphReady.bind(this),this.OnGraphNewState.bind(this))},OnGraphReady:function(e){this.graphReady=!0,this.CheckDependencies(this)},OnDrawerLoaded:function(e){this.drawer=new b.Drawer(this.mode,this.livenessMode,this.stabilizationStage,this.canvasSizeFactor,this.fontSizeFactor),this.CheckDependencies(this)},CheckDependencies:function(e){if(!0===e.rmReady&&void 0!==e.drawer&&!0!==e.resourcesCached&&(e.drawer.rm=e.rm,e.drawer.cacheResources(),e.resourcesCached=!0),!0===e.rmReady&&void 0!==e.drawer&&!0===e.graphReady&&!0===e.wasmReady&&!0===e.cameraReady&&"UCNothing"!==e.graph.state){let t=e.canvas;null!=t&&(t.style.display="none"),e.video.style.display="inline-block",e.drawer.setCanvasSize(t.clientWidth,t.clientHeight),e.graph.setInitialState("UCNothing");let i=new CustomEvent("FPhi.UserControl.ModuleLoaded.event",{detail:{cameraWidth:e.cameraWidth,cameraHeight:e.cameraHeight,instance:e}});e.divContainer.dispatchEvent(i),setTimeout(e.draw.bind(e),e.samplePeriod),e.cameraContainer.contains(e.gifWait)&&e.cameraContainer.removeChild(e.gifWait)}},videoLoaded:function(e){if(this.cameraWidth=e.target.videoWidth,this.cameraHeight=e.target.videoHeight,0===this.cameraRotation||2===this.cameraRotation?(this.privateCanvas.width=this.cameraWidth,this.privateCanvas.height=this.cameraHeight):(this.privateCanvas.width=this.cameraHeight,this.privateCanvas.height=this.cameraWidth),this.cameraReady=!0,this.printLog("Selphi: Timing-Camera-ready: "+performance.now()),this.video,this.canvas.getContext("2d",{alpha:!0}),this.cm.getVideoRecord()){switch(this.printLog("Selphi: Video recording enabled..."),this.videoRecordWidth=this.cameraWidth*this.cm.getVideoRecordScale(),this.videoRecordHeight=this.cameraHeight*this.cm.getVideoRecordScale(),this.cm.getVideoRecordType()){case b.Selphi.RecorderType.Local:this.recorder=new h(this.cameraWidth*this.cm.getVideoRecordScale(),this.cameraHeight*this.cm.getVideoRecordScale(),this.cm.getVideoRecordRate(),this.bundlePath);break;case b.Selphi.RecorderType.Remote:this.recorder=new d(this.cameraWidth*this.cm.getVideoRecordScale(),this.cameraHeight*this.cm.getVideoRecordScale(),this.cm.getVideoRecordRate(),this.bundlePath)}this.privateRecordCanvas=document.createElement("canvas"),this.privateRecordCanvas.width=this.videoRecordWidth,this.privateRecordCanvas.height=this.videoRecordHeight,this.privateRecordCanvasContext=this.privateRecordCanvas.getContext("2d")}this.CheckDependencies(this)},videoFrame:function(e){this.canvasVideoPlayer.getContext("2d").drawImage(e.target,0,0)},videoplayerEnded:function(e){"UCWizardCompleted"===this.state?this.graph.sendMessage("VideoFinished"):e.target.play()}},b.Selphi.CheckCapabilities=async function(){let e={};return e.video_devices=await(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"==e.kind)).length>0,e.wasm=(()=>{try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch(e){}return!1})(),e.wasm_pthreads=!1,!0===e.wasm&&"function"==typeof SharedArrayBuffer&&(e.wasm_pthreads=!0),e},b.Selphi.Component=m,customElements.define("facephi-selphi",b.Selphi.Component)})();var a=s.l;export{a as FPhi};