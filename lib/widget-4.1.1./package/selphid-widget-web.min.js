/*! For license information please see selphid-widget-web.min.js.LICENSE.txt */
var e={871:(e,t,i)=>{i.d(t,{k:()=>l}),e=i.hmd(e);class l{constructor(e,t,i){this.graphUrl=e,this.graphReadyEvent=t,this.graphNewStateEvent=i,this.xmlHttpWidget=new XMLHttpRequest,this.xmlHttpWidget.onreadystatechange=this.readyEvent.bind(this),this.xmlHttpWidget.open("GET",this.graphUrl),this.xmlHttpWidget.send(null)}readyEvent(e){if(4==e.target.readyState&&200==e.target.status){var t=new DOMParser;this.xmlDoc=t.parseFromString(e.target.responseText,"text/xml"),this.graphReadyEvent()}}setInitialState(e){null!=this.xmlDoc.querySelector("[name='"+e+"']")&&(this.state=e,this.graphNewStateEvent(this.state))}sendMessage(e){var t=this.xmlDoc.querySelector("[name='"+this.state+"']");if(null!=t){var i=t.querySelector("[message='"+e+"']");if(null!=i||(e=e.split("//")[0],null!=(i=t.querySelector("[message='"+e+"']")))){var l=i.getAttribute("to");this.state=l,this.graphNewStateEvent(this.state)}}}}!function(t){"object"==typeof exports?e.exports=t():"function"==typeof define&&i.amdO?define([],t):("undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:this).Animated_GIF=t()}((function(){return function e(t,i,l){function a(s,d){if(!i[s]){if(!t[s]){if(n)return n(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=i[s]={exports:{}};t[s][0].call(h.exports,(function(e){return a(t[s][1][e]||e)}),h,h.exports,e,t,i,l)}return i[s].exports}for(var n=void 0,s=0;s<l.length;s++)a(l[s]);return a}({1:[function(e,t,i){function l(e,t,i,l){for(var a=e[t++],n=1<<a,s=n+1,d=s+1,c=a+1,h=(1<<c)-1,o=0,r=0,m=0,I=e[t++],Z=new Int32Array(4096),b=null;;){for(;o<16&&0!==I;)r|=e[t++]<<o,o+=8,1===I?I=e[t++]:--I;if(o<c)break;var R=r&h;if(r>>=c,o-=c,R!==n){if(R===s)break;for(var u=R<d?R:b,g=0,W=u;W>n;)W=Z[W]>>8,++g;var V=W;if(m+g+(u!==R?1:0)>l)return void console.log("Warning, gif stream longer than expected.");i[m++]=V;var p=m+=g;for(u!==R&&(i[m++]=V),W=u;g--;)W=Z[W],i[--p]=255&W,W>>=8;null!==b&&d<4096&&(Z[d++]=b<<8|V,d>=h+1&&c<12&&(++c,h=h<<1|1)),b=R}else d=s+1,h=(1<<(c=a+1))-1,b=null}return m!==l&&console.log("Warning, gif stream shorter than expected."),i}try{i.GifWriter=function(e,t,i,l){function a(e){var t=e.length;if(t<2||t>256||t&t-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return t}var n=0,s=void 0===(l=void 0===l?{}:l).loop?null:l.loop,d=void 0===l.palette?null:l.palette;if(t<=0||i<=0||t>65535||i>65535)throw"Width/Height invalid.";e[n++]=71,e[n++]=73,e[n++]=70,e[n++]=56,e[n++]=57,e[n++]=97;var c=0,h=0;if(null!==d){for(var o=a(d);o>>=1;)++c;if(o=1<<c,--c,void 0!==l.background){if((h=l.background)>=o)throw"Background index out of range.";if(0===h)throw"Background index explicitly passed as 0."}}if(e[n++]=255&t,e[n++]=t>>8&255,e[n++]=255&i,e[n++]=i>>8&255,e[n++]=(null!==d?128:0)|c,e[n++]=h,e[n++]=0,null!==d)for(var r=0,m=d.length;r<m;++r){var I=d[r];e[n++]=I>>16&255,e[n++]=I>>8&255,e[n++]=255&I}if(null!==s){if(s<0||s>65535)throw"Loop count invalid.";e[n++]=33,e[n++]=255,e[n++]=11,e[n++]=78,e[n++]=69,e[n++]=84,e[n++]=83,e[n++]=67,e[n++]=65,e[n++]=80,e[n++]=69,e[n++]=50,e[n++]=46,e[n++]=48,e[n++]=3,e[n++]=1,e[n++]=255&s,e[n++]=s>>8&255,e[n++]=0}var Z=!1;this.addFrame=function(t,i,l,s,c,h){if(!0===Z&&(--n,Z=!1),h=void 0===h?{}:h,t<0||i<0||t>65535||i>65535)throw"x/y invalid.";if(l<=0||s<=0||l>65535||s>65535)throw"Width/Height invalid.";if(c.length<l*s)throw"Not enough pixels for the frame size.";var o=!0,r=h.palette;if(null!=r||(o=!1,r=d),null==r)throw"Must supply either a local or global palette.";for(var m=a(r),I=0;m>>=1;)++I;m=1<<I;var b=void 0===h.delay?0:h.delay,R=void 0===h.disposal?0:h.disposal;if(R<0||R>3)throw"Disposal out of range.";var u=!1,g=0;if(void 0!==h.transparent&&null!==h.transparent&&(u=!0,(g=h.transparent)<0||g>=m))throw"Transparent color index.";if((0!==R||u||0!==b)&&(e[n++]=33,e[n++]=249,e[n++]=4,e[n++]=R<<2|(!0===u?1:0),e[n++]=255&b,e[n++]=b>>8&255,e[n++]=g,e[n++]=0),e[n++]=44,e[n++]=255&t,e[n++]=t>>8&255,e[n++]=255&i,e[n++]=i>>8&255,e[n++]=255&l,e[n++]=l>>8&255,e[n++]=255&s,e[n++]=s>>8&255,e[n++]=!0===o?128|I-1:0,!0===o)for(var W=0,V=r.length;W<V;++W){var p=r[W];e[n++]=p>>16&255,e[n++]=p>>8&255,e[n++]=255&p}n=function(e,t,i,l){function a(i){for(;m>=i;)e[t++]=255&I,I>>=8,m-=8,t===s+256&&(e[s]=255,s=t++)}function n(e){I|=e<<m,m+=r,a(8)}e[t++]=i;var s=t++,d=1<<i,c=d-1,h=d+1,o=h+1,r=i+1,m=0,I=0,Z=l[0]&c,b={};n(d);for(var R=1,u=l.length;R<u;++R){var g=l[R]&c,W=Z<<8|g,V=b[W];if(void 0===V){for(I|=Z<<m,m+=r;m>=8;)e[t++]=255&I,I>>=8,m-=8,t===s+256&&(e[s]=255,s=t++);4096===o?(n(d),o=h+1,r=i+1,b={}):(o>=1<<r&&++r,b[W]=o++),Z=g}else Z=V}return n(Z),n(h),a(1),s+1===t?e[s]=0:(e[s]=t-s-1,e[t++]=0),t}(e,n,I<2?2:I,c)},this.end=function(){return!1===Z&&(e[n++]=59,Z=!0),n}},i.GifReader=function(e){var t=0;if(71!==e[t++]||73!==e[t++]||70!==e[t++]||56!==e[t++]||56!=(e[t++]+1&253)||97!==e[t++])throw"Invalid GIF 87a/89a header.";var i=e[t++]|e[t++]<<8,a=e[t++]|e[t++]<<8,n=e[t++],s=n>>7,d=1<<1+(7&n);e[t++],e[t++];var c=null;s&&(c=t,t+=3*d);var h=!0,o=[],r=0,m=null,I=0,Z=null;for(this.width=i,this.height=a;h&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(11!==e[t]||78==e[t+1]&&69==e[t+2]&&84==e[t+3]&&83==e[t+4]&&67==e[t+5]&&65==e[t+6]&&80==e[t+7]&&69==e[t+8]&&50==e[t+9]&&46==e[t+10]&&48==e[t+11]&&3==e[t+12]&&1==e[t+13]&&0==e[t+16])t+=14,Z=e[t++]|e[t++]<<8,t++;else for(t+=12;0!==(C=e[t++]);)t+=C;break;case 249:if(4!==e[t++]||0!==e[t+4])throw"Invalid graphics extension block.";var b=e[t++];r=e[t++]|e[t++]<<8,m=e[t++],0==(1&b)&&(m=null),I=b>>2&7,t++;break;case 254:for(;0!==(C=e[t++]);)t+=C;break;default:throw"Unknown graphic control label: 0x"+e[t-1].toString(16)}break;case 44:var R=e[t++]|e[t++]<<8,u=e[t++]|e[t++]<<8,g=e[t++]|e[t++]<<8,W=e[t++]|e[t++]<<8,V=e[t++],p=V>>6&1,G=c,X=!1;V>>7&&(X=!0,G=t,t+=3*(1<<1+(7&V)));var y=t;for(t++;;){var C;if(0===(C=e[t++]))break;t+=C}o.push({x:R,y:u,width:g,height:W,has_local_palette:X,palette_offset:G,data_offset:y,data_length:t-y,transparent_index:m,interlaced:!!p,delay:r,disposal:I});break;case 59:h=!1;break;default:throw"Unknown gif block: 0x"+e[t-1].toString(16)}this.numFrames=function(){return o.length},this.loopCount=function(){return Z},this.frameInfo=function(e){if(e<0||e>=o.length)throw"Frame index out of range.";return o[e]},this.decodeAndBlitFrameBGRA=function(t,a){var n=this.frameInfo(t),s=n.width*n.height,d=new Uint8Array(s);l(e,n.data_offset,d,s);var c=n.palette_offset,h=n.transparent_index;null===h&&(h=256);var o=n.width,r=i-o,m=o,I=4*(n.y*i+n.x),Z=4*((n.y+n.height)*i+n.x),b=I,R=4*r;!0===n.interlaced&&(R+=4*i*7);for(var u=8,g=0,W=d.length;g<W;++g){var V=d[g];if(0===m&&(m=o,(b+=R)>=Z&&(R=4*r+4*i*(u-1),b=I+(o+r)*(u<<1),u>>=1)),V===h)b+=4;else{var p=e[c+3*V],G=e[c+3*V+1],X=e[c+3*V+2];a[b++]=X,a[b++]=G,a[b++]=p,a[b++]=255}--m}},this.decodeAndBlitFrameRGBA=function(t,a){var n=this.frameInfo(t),s=n.width*n.height,d=new Uint8Array(s);l(e,n.data_offset,d,s);var c=n.palette_offset,h=n.transparent_index;null===h&&(h=256);var o=n.width,r=i-o,m=o,I=4*(n.y*i+n.x),Z=4*((n.y+n.height)*i+n.x),b=I,R=4*r;!0===n.interlaced&&(R+=4*i*7);for(var u=8,g=0,W=d.length;g<W;++g){var V=d[g];if(0===m&&(m=o,(b+=R)>=Z&&(R=4*r+4*i*(u-1),b=I+(o+r)*(u<<1),u>>=1)),V===h)b+=4;else{var p=e[c+3*V],G=e[c+3*V+1],X=e[c+3*V+2];a[b++]=p,a[b++]=G,a[b++]=X,a[b++]=255}--m}}}}catch(e){}},{}],2:[function(e,t,i){t.exports=function(t){function i(e){g.length,V=e;for(var t=0;t<c&&t<g.length;t++)l(t)}function l(e){var t,i;return(t=g[e]).beingProcessed||t.done?(console.error("Frame already being processed or done!",t.position),void n()):(t.sampleInterval=d,t.beingProcessed=!0,(i=function(){if(0===X.length)throw"No workers left!";return X.pop()}()).onmessage=function(e){var l=e.data;delete t.data,t.pixels=Array.prototype.slice.call(l.pixels),t.palette=Array.prototype.slice.call(l.palette),t.done=!0,t.beingProcessed=!1,function(e){X.push(e)}(i),n()},void i.postMessage(t))}function a(){for(var e=-1,t=0;t<g.length;t++){var i=g[t];if(!i.done&&!i.beingProcessed){e=t;break}}e>=0&&l(e)}function n(){var e=g.every((function(e){return!e.beingProcessed&&e.done}));W++,p(.75*W/g.length),e?y||function(e,t){var i,l=[],a={loop:R};null!==m&&null!==I&&(i=I,a.palette=i);var n=new h(l,o,r,a);y=!0,e.forEach((function(t,l){var a;i||(a=t.palette),p(.75+.25*t.position*1/e.length),n.addFrame(0,0,o,r,t.pixels,{palette:a,delay:u})})),n.end(),p(1),e=[],y=!1,t(l)}(g,V):setTimeout(a,1)}function s(e){return 0!==e&&0==(e&e-1)}t=t||{};var d,c,h=e("omggif").GifWriter,o=t.width||160,r=t.height||120,m=t.dithering||null,I=t.palette||null,Z=null,b=null,R=0,u=250,g=[],W=0,V=function(){},p=function(){},G=[],X=[],y=!1;if(I){if(!(I instanceof Array))throw I;if(I.length<2||I.length>256){for(console.error("Palette must hold only between 2 and 256 colours");I.length<2;)I.push(0);I.length>256&&(I=I.slice(0,256))}if(!s(I.length))for(console.error("Palette must have a power of two number of colours");!s(I.length);)I.splice(I.length-1,1)}d=(t=t||{}).sampleInterval||10,c=t.numWorkers||2;for(var C=0;C<c;C++){var N=new Worker(window.URL.createObjectURL(new Blob(['(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module \'"+o+"\'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\nfunction colorClamp(value) {\n\tif(value < 0) return 0;\n\telse if(value > 255) return 255;\n\n\treturn value;\n}\n\nvar bayerMatrix8x8 = [\n\t[  1, 49, 13, 61,  4, 52, 16, 64 ],\n\t[ 33, 17, 45, 29, 36, 20, 48, 32 ],\n\t[  9, 57,  5, 53, 12, 60,  8, 56 ],\n\t[ 41, 25, 37, 21, 44, 28, 40, 24 ],\n\t[  3, 51, 15, 63,  2, 50, 14, 62 ],\n\t[ 35, 19, 47, 31, 34, 18, 46, 30 ],\n\t[ 11, 59,  7, 55, 10, 58,  6, 54 ],\n\t[ 43, 27, 39, 23, 42, 26, 38, 22 ]\n\t];\n\n\t// int r, int g, int b, int[][] palette, int paletteLength\n\tfunction getClosestPaletteColorIndex(r, g, b, palette, paletteLength) {\n\t\tvar minDistance = 195076;\n\t\tvar diffR, diffG, diffB;\n\t\tvar distanceSquared;\n\t\tvar bestIndex = 0;\n\t\tvar paletteChannels;\n\n\t\tfor(var i = 0; i < paletteLength; i++) {\n\n\t\t\tpaletteChannels = palette[i];\n\t\t\tdiffR = r - paletteChannels[0];\n\t\t\tdiffG = g - paletteChannels[1];\n\t\t\tdiffB = b - paletteChannels[2];\n\n\t\t\tdistanceSquared = diffR*diffR + diffG*diffG + diffB*diffB;\n\n\t\t\tif(distanceSquared < minDistance) {\n\t\t\t\tbestIndex = i;\n\t\t\t\tminDistance = distanceSquared;\n\t\t\t}\n\n\t\t}\n\n\t\treturn bestIndex;\n\t}\n\n// TODO: inPixels -> inComponents or inColors or something more accurate\nfunction BayerDithering(inPixels, width, height, palette) {\n\tvar offset = 0;\n\tvar indexedOffset = 0;\n\tvar r, g, b;\n\tvar pixel, threshold, index;\n\tvar paletteLength = palette.length;\n\tvar matrix = bayerMatrix8x8;\n\tvar indexedPixels = new Uint8Array( width * height );\n\n\tvar modI = 8;\n\tvar modJ = 8;\n\n\tfor(var j = 0; j < height; j++) {\n\t\tvar modj = j % modJ;\n\n\t\tfor(var i = 0; i < width; i++) {\n\n\t\t\tthreshold = matrix[i % modI][modj];\n\n\t\t\tr = colorClamp( inPixels[offset++] + threshold );\n\t\t\tg = colorClamp( inPixels[offset++] + threshold );\n\t\t\tb = colorClamp( inPixels[offset++] + threshold );\n\n\t\t\tindex = getClosestPaletteColorIndex(r, g, b, palette, paletteLength);\n\t\t\tindexedPixels[indexedOffset++] = index;\n\n\t\t}\n\t}\n\n\treturn indexedPixels;\n}\n\n\nfunction ClosestDithering(inPixels, width, height, palette) {\n\n\tvar offset = 0;\n\tvar indexedOffset = 0;\n\tvar r, g, b;\n\tvar index;\n\tvar paletteLength = palette.length;\n\tvar matrix = bayerMatrix8x8;\n\tvar numPixels = width * height;\n\tvar indexedPixels = new Uint8Array( numPixels );\n\n\tfor(var i = 0; i < numPixels; i++) {\n\n\t\tr = inPixels[offset++];\n\t\tg = inPixels[offset++];\n\t\tb = inPixels[offset++];\n\n\t\tindexedPixels[i] = getClosestPaletteColorIndex(r, g, b, palette, paletteLength);\n\n\t}\n\n\treturn indexedPixels;\n\n}\n\n\nfunction FloydSteinberg(inPixels, width, height, palette) {\n\tvar paletteLength = palette.length;\n\tvar offset = 0;\n\tvar indexedOffset = 0;\n\tvar r, g, b;\n\tvar widthLimit = width - 1;\n\tvar heightLimit = height - 1;\n\tvar offsetNextI, offsetNextJ;\n\tvar offsetPrevINextJ;\n\tvar channels, nextChannels;\n\tvar indexedPixels = new Uint8Array( width * height );\n\n\tfor(var j = 0; j < height; j++) {\n\t\tfor(var i = 0; i < width; i++) {\n\n\t\t\tr = colorClamp(inPixels[offset++]);\n\t\t\tg = colorClamp(inPixels[offset++]);\n\t\t\tb = colorClamp(inPixels[offset++]);\n\n\t\t\tvar colorIndex = getClosestPaletteColorIndex(r, g, b, palette, paletteLength);\n\t\t\tvar paletteColor = palette[colorIndex];\n\t\t\tvar closestColor = paletteColor[3];\n\n\t\t\t// We are done with finding the best value for this pixel\n\t\t\tindexedPixels[indexedOffset] = colorIndex;\n\n\t\t\t// Now find difference between assigned value and original color\n\t\t\t// and propagate that error forward\n\t\t\tvar errorR = r - paletteColor[0];\n\t\t\tvar errorG = g - paletteColor[1];\n\t\t\tvar errorB = b - paletteColor[2];\n\n\t\t\tif(i < widthLimit) {\n\n\t\t\t\toffsetNextI = offset + 1;\n\n\t\t\t\tinPixels[offsetNextI++] += (errorR * 7) >> 4;\n\t\t\t\tinPixels[offsetNextI++] += (errorG * 7) >> 4;\n\t\t\t\tinPixels[offsetNextI++] += (errorB * 7) >> 4;\n\n\t\t\t}\n\n\n\t\t\tif(j < heightLimit) {\n\n\t\t\t\tif(i > 0) {\n\n\t\t\t\t\toffsetPrevINextJ = offset - 1 + width;\n\n\t\t\t\t\tinPixels[offsetPrevINextJ++] += (errorR * 3) >> 4;\n\t\t\t\t\tinPixels[offsetPrevINextJ++] += (errorG * 3) >> 4;\n\t\t\t\t\tinPixels[offsetPrevINextJ++] += (errorB * 3) >> 4;\n\n\t\t\t\t}\n\n\t\t\t\toffsetNextJ = offset + width;\n\n\t\t\t\tinPixels[offsetNextJ++] += (errorR * 5) >> 4;\n\t\t\t\tinPixels[offsetNextJ++] += (errorG * 5) >> 4;\n\t\t\t\tinPixels[offsetNextJ++] += (errorB * 5) >> 4;\n\n\n\t\t\t\tif(i < widthLimit) {\n\n\t\t\t\t\tinPixels[offsetNextJ++] += errorR >> 4;\n\t\t\t\t\tinPixels[offsetNextJ++] += errorG >> 4;\n\t\t\t\t\tinPixels[offsetNextJ++] += errorB >> 4;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tindexedOffset++;\n\t\t}\n\t}\n\n\treturn indexedPixels;\n}\n\nmodule.exports = {\n\tBayer: BayerDithering,\n\tClosest: ClosestDithering,\n\tFloydSteinberg: FloydSteinberg\n};\n\n\n},{}],2:[function(require,module,exports){\nvar NeuQuant = require(\'./lib/NeuQuant\');\nvar Dithering = require(\'node-dithering\');\n\nfunction channelizePalette( palette ) {\n    var channelizedPalette = [];\n\n    for(var i = 0; i < palette.length; i++) {\n        var color = palette[i];\n\n        var r = (color & 0xFF0000) >> 16;\n        var g = (color & 0x00FF00) >>  8;\n        var b = (color & 0x0000FF);\n\n        channelizedPalette.push([ r, g, b, color ]);\n    }\n\n    return channelizedPalette;\n\n}\n\n\nfunction dataToRGB( data, width, height ) {\n    var i = 0;\n    var length = width * height * 4;\n    var rgb = [];\n\n    while(i < length) {\n        rgb.push( data[i++] );\n        rgb.push( data[i++] );\n        rgb.push( data[i++] );\n        i++; // for the alpha channel which we don\'t care about\n    }\n\n    return rgb;\n}\n\n\nfunction componentizedPaletteToArray(paletteRGB) {\n\n    var paletteArray = [];\n\n    for(var i = 0; i < paletteRGB.length; i += 3) {\n        var r = paletteRGB[ i ];\n        var g = paletteRGB[ i + 1 ];\n        var b = paletteRGB[ i + 2 ];\n        paletteArray.push(r << 16 | g << 8 | b);\n    }\n\n    return paletteArray;\n}\n\n\n// This is the "traditional" Animated_GIF style of going from RGBA to indexed color frames\nfunction processFrameWithQuantizer(imageData, width, height, sampleInterval) {\n\n    var rgbComponents = dataToRGB( imageData, width, height );\n    var nq = new NeuQuant(rgbComponents, rgbComponents.length, sampleInterval);\n    var paletteRGB = nq.process();\n    var paletteArray = new Uint32Array(componentizedPaletteToArray(paletteRGB));\n\n    var numberPixels = width * height;\n    var indexedPixels = new Uint8Array(numberPixels);\n\n    var k = 0;\n    for(var i = 0; i < numberPixels; i++) {\n        r = rgbComponents[k++];\n        g = rgbComponents[k++];\n        b = rgbComponents[k++];\n        indexedPixels[i] = nq.map(r, g, b);\n    }\n\n    return {\n        pixels: indexedPixels,\n        palette: paletteArray\n    };\n\n}\n\n\n// And this is a version that uses dithering against of quantizing\n// It can also use a custom palette if provided, or will build one otherwise\nfunction processFrameWithDithering(imageData, width, height, ditheringType, palette) {\n\n    // Extract component values from data\n    var rgbComponents = dataToRGB( imageData, width, height );\n\n\n    // Build palette if none provided\n    if(palette === null) {\n\n        var nq = new NeuQuant(rgbComponents, rgbComponents.length, 16);\n        var paletteRGB = nq.process();\n        palette = componentizedPaletteToArray(paletteRGB);\n\n    }\n\n    var paletteArray = new Uint32Array( palette );\n    var paletteChannels = channelizePalette( palette );\n\n    // Convert RGB image to indexed image\n    var ditheringFunction;\n\n    if(ditheringType === \'closest\') {\n        ditheringFunction = Dithering.Closest;\n    } else if(ditheringType === \'floyd\') {\n        ditheringFunction = Dithering.FloydSteinberg;\n    } else {\n        ditheringFunction = Dithering.Bayer;\n    }\n\n    pixels = ditheringFunction(rgbComponents, width, height, paletteChannels);\n\n    return ({\n        pixels: pixels,\n        palette: paletteArray\n    });\n\n}\n\n\n// ~~~\n\nfunction run(frame) {\n    var width = frame.width;\n    var height = frame.height;\n    var imageData = frame.data;\n    var dithering = frame.dithering;\n    var palette = frame.palette;\n    var sampleInterval = frame.sampleInterval;\n\n    if(dithering) {\n        return processFrameWithDithering(imageData, width, height, dithering, palette);\n    } else {\n        return processFrameWithQuantizer(imageData, width, height, sampleInterval);\n    }\n\n}\n\n\nself.onmessage = function(ev) {\n    var data = ev.data;\n    var response = run(data);\n    postMessage(response);\n};\n\n},{"./lib/NeuQuant":3,"node-dithering":1}],3:[function(require,module,exports){\n/*\n* NeuQuant Neural-Net Quantization Algorithm\n* ------------------------------------------\n*\n* Copyright (c) 1994 Anthony Dekker\n*\n* NEUQUANT Neural-Net quantization algorithm by Anthony Dekker, 1994. See\n* "Kohonen neural networks for optimal colour quantization" in "Network:\n* Computation in Neural Systems" Vol. 5 (1994) pp 351-367. for a discussion of\n* the algorithm.\n*\n* Any party obtaining a copy of these files from the author, directly or\n* indirectly, is granted, free of charge, a full and unrestricted irrevocable,\n* world-wide, paid up, royalty-free, nonexclusive right and license to deal in\n* this software and documentation files (the "Software"), including without\n* limitation the rights to use, copy, modify, merge, publish, distribute,\n* sublicense, and/or sell copies of the Software, and to permit persons who\n* receive copies from any such party to do so, with the only requirement being\n* that this copyright notice remain intact.\n*/\n\n/*\n* This class handles Neural-Net quantization algorithm\n* @author Kevin Weiner (original Java version - kweiner@fmsware.com)\n* @author Thibault Imbert (AS3 version - bytearray.org)\n* @version 0.1 AS3 implementation\n* @version 0.2 JS->AS3 "translation" by antimatter15\n* @version 0.3 JS clean up + using modern JS idioms by sole - http://soledadpenades.com\n* Also implement fix in color conversion described at http://stackoverflow.com/questions/16371712/neuquant-js-javascript-color-quantization-hidden-bug-in-js-conversion\n*/\n\nmodule.exports = function NeuQuant() {\n\n    var netsize = 256; // number of colours used\n\n    // four primes near 500 - assume no image has a length so large\n    // that it is divisible by all four primes\n    var prime1 = 499;\n    var prime2 = 491;\n    var prime3 = 487;\n    var prime4 = 503;\n\n    // minimum size for input image\n    var minpicturebytes = (3 * prime4);\n\n    // Network Definitions\n\n    var maxnetpos = (netsize - 1);\n    var netbiasshift = 4; // bias for colour values\n    var ncycles = 100; // no. of learning cycles\n\n    // defs for freq and bias\n    var intbiasshift = 16; // bias for fractions\n    var intbias = (1 << intbiasshift);\n    var gammashift = 10; // gamma = 1024\n    var gamma = (1 << gammashift);\n    var betashift = 10;\n    var beta = (intbias >> betashift); // beta = 1/1024\n    var betagamma = (intbias << (gammashift - betashift));\n\n    // defs for decreasing radius factor\n    // For 256 colors, radius starts at 32.0 biased by 6 bits\n    // and decreases by a factor of 1/30 each cycle\n    var initrad = (netsize >> 3);\n    var radiusbiasshift = 6;\n    var radiusbias = (1 << radiusbiasshift);\n    var initradius = (initrad * radiusbias);\n    var radiusdec = 30;\n\n    // defs for decreasing alpha factor\n    // Alpha starts at 1.0 biased by 10 bits\n    var alphabiasshift = 10;\n    var initalpha = (1 << alphabiasshift);\n    var alphadec;\n\n    // radbias and alpharadbias used for radpower calculation\n    var radbiasshift = 8;\n    var radbias = (1 << radbiasshift);\n    var alpharadbshift = (alphabiasshift + radbiasshift);\n    var alpharadbias = (1 << alpharadbshift);\n\n\n    // Input image\n    var thepicture;\n    // Height * Width * 3\n    var lengthcount;\n    // Sampling factor 1..30\n    var samplefac;\n\n    // The network itself\n    var network;\n    var netindex = [];\n\n    // for network lookup - really 256\n    var bias = [];\n\n    // bias and freq arrays for learning\n    var freq = [];\n    var radpower = [];\n\n    function NeuQuantConstructor(thepic, len, sample) {\n\n        var i;\n        var p;\n\n        thepicture = thepic;\n        lengthcount = len;\n        samplefac = sample;\n\n        network = new Array(netsize);\n\n        for (i = 0; i < netsize; i++) {\n            network[i] = new Array(4);\n            p = network[i];\n            p[0] = p[1] = p[2] = ((i << (netbiasshift + 8)) / netsize) | 0;\n            freq[i] = (intbias / netsize) | 0; // 1 / netsize\n            bias[i] = 0;\n        }\n\n    }\n\n    function colorMap() {\n        var map = [];\n        var index = new Array(netsize);\n        for (var i = 0; i < netsize; i++)\n            index[network[i][3]] = i;\n        var k = 0;\n        for (var l = 0; l < netsize; l++) {\n            var j = index[l];\n            map[k++] = (network[j][0]);\n            map[k++] = (network[j][1]);\n            map[k++] = (network[j][2]);\n        }\n        return map;\n    }\n\n    // Insertion sort of network and building of netindex[0..255]\n    // (to do after unbias)\n    function inxbuild() {\n        var i;\n        var j;\n        var smallpos;\n        var smallval;\n        var p;\n        var q;\n        var previouscol;\n        var startpos;\n\n        previouscol = 0;\n        startpos = 0;\n\n        for (i = 0; i < netsize; i++)\n        {\n\n            p = network[i];\n            smallpos = i;\n            smallval = p[1]; // index on g\n            // find smallest in i..netsize-1\n            for (j = i + 1; j < netsize; j++) {\n\n                q = network[j];\n\n                if (q[1] < smallval) { // index on g\n                    smallpos = j;\n                    smallval = q[1]; // index on g\n                }\n            }\n\n            q = network[smallpos];\n\n            // swap p (i) and q (smallpos) entries\n            if (i != smallpos) {\n                j = q[0];\n                q[0] = p[0];\n                p[0] = j;\n                j = q[1];\n                q[1] = p[1];\n                p[1] = j;\n                j = q[2];\n                q[2] = p[2];\n                p[2] = j;\n                j = q[3];\n                q[3] = p[3];\n                p[3] = j;\n            }\n\n            // smallval entry is now in position i\n            if (smallval != previouscol) {\n\n                netindex[previouscol] = (startpos + i) >> 1;\n\n                for (j = previouscol + 1; j < smallval; j++) {\n                    netindex[j] = i;\n                }\n\n                previouscol = smallval;\n                startpos = i;\n\n            }\n\n        }\n\n        netindex[previouscol] = (startpos + maxnetpos) >> 1;\n        for (j = previouscol + 1; j < 256; j++) {\n            netindex[j] = maxnetpos; // really 256\n        }\n\n    }\n\n\n    // Main Learning Loop\n\n    function learn() {\n        var i;\n        var j;\n        var b;\n        var g;\n        var r;\n        var radius;\n        var rad;\n        var alpha;\n        var step;\n        var delta;\n        var samplepixels;\n        var p;\n        var pix;\n        var lim;\n\n        if (lengthcount < minpicturebytes) {\n            samplefac = 1;\n        }\n\n        alphadec = 30 + ((samplefac - 1) / 3);\n        p = thepicture;\n        pix = 0;\n        lim = lengthcount;\n        samplepixels = lengthcount / (3 * samplefac);\n        delta = (samplepixels / ncycles) | 0;\n        alpha = initalpha;\n        radius = initradius;\n\n        rad = radius >> radiusbiasshift;\n        if (rad <= 1) {\n            rad = 0;\n        }\n\n        for (i = 0; i < rad; i++) {\n            radpower[i] = alpha * (((rad * rad - i * i) * radbias) / (rad * rad));\n        }\n\n\n        if (lengthcount < minpicturebytes) {\n            step = 3;\n        } else if ((lengthcount % prime1) !== 0) {\n            step = 3 * prime1;\n        } else {\n\n            if ((lengthcount % prime2) !== 0) {\n                step = 3 * prime2;\n            } else {\n                if ((lengthcount % prime3) !== 0) {\n                    step = 3 * prime3;\n                } else {\n                    step = 3 * prime4;\n                }\n            }\n\n        }\n\n        i = 0;\n\n        while (i < samplepixels) {\n\n            b = (p[pix + 0] & 0xff) << netbiasshift;\n            g = (p[pix + 1] & 0xff) << netbiasshift;\n            r = (p[pix + 2] & 0xff) << netbiasshift;\n            j = contest(b, g, r);\n\n            altersingle(alpha, j, b, g, r);\n\n            if (rad !== 0) {\n                // Alter neighbours\n                alterneigh(rad, j, b, g, r);\n            }\n\n            pix += step;\n\n            if (pix >= lim) {\n                pix -= lengthcount;\n            }\n\n            i++;\n\n            if (delta === 0) {\n                delta = 1;\n            }\n\n            if (i % delta === 0) {\n                alpha -= alpha / alphadec;\n                radius -= radius / radiusdec;\n                rad = radius >> radiusbiasshift;\n\n                if (rad <= 1) {\n                    rad = 0;\n                }\n\n                for (j = 0; j < rad; j++) {\n                    radpower[j] = alpha * (((rad * rad - j * j) * radbias) / (rad * rad));\n                }\n\n            }\n\n        }\n\n    }\n\n    // Search for BGR values 0..255 (after net is unbiased) and return colour index\n    function map(b, g, r) {\n        var i;\n        var j;\n        var dist;\n        var a;\n        var bestd;\n        var p;\n        var best;\n\n        // Biggest possible distance is 256 * 3\n        bestd = 1000;\n        best = -1;\n        i = netindex[g]; // index on g\n        j = i - 1; // start at netindex[g] and work outwards\n\n        while ((i < netsize) || (j >= 0)) {\n\n            if (i < netsize) {\n\n                p = network[i];\n\n                dist = p[1] - g; // inx key\n\n                if (dist >= bestd) {\n                    i = netsize; // stop iter\n                } else {\n\n                    i++;\n\n                    if (dist < 0) {\n                        dist = -dist;\n                    }\n\n                    a = p[0] - b;\n\n                    if (a < 0) {\n                        a = -a;\n                    }\n\n                    dist += a;\n\n                    if (dist < bestd) {\n                        a = p[2] - r;\n\n                        if (a < 0) {\n                            a = -a;\n                        }\n\n                        dist += a;\n\n                        if (dist < bestd) {\n                            bestd = dist;\n                            best = p[3];\n                        }\n                    }\n\n                }\n\n            }\n\n            if (j >= 0) {\n\n                p = network[j];\n\n                dist = g - p[1]; // inx key - reverse dif\n\n                if (dist >= bestd) {\n                    j = -1; // stop iter\n                } else {\n\n                    j--;\n                    if (dist < 0) {\n                        dist = -dist;\n                    }\n                    a = p[0] - b;\n                    if (a < 0) {\n                        a = -a;\n                    }\n                    dist += a;\n\n                    if (dist < bestd) {\n                        a = p[2] - r;\n                        if (a < 0) {\n                            a = -a;\n                        }\n                        dist += a;\n                        if (dist < bestd) {\n                            bestd = dist;\n                            best = p[3];\n                        }\n                    }\n\n                }\n\n            }\n\n        }\n\n        return (best);\n\n    }\n\n    function process() {\n        learn();\n        unbiasnet();\n        inxbuild();\n        return colorMap();\n    }\n\n    // Unbias network to give byte values 0..255 and record position i\n    // to prepare for sort\n    function unbiasnet() {\n        var i;\n        var j;\n\n        for (i = 0; i < netsize; i++) {\n            network[i][0] >>= netbiasshift;\n            network[i][1] >>= netbiasshift;\n            network[i][2] >>= netbiasshift;\n            network[i][3] = i; // record colour no\n        }\n    }\n\n    // Move adjacent neurons by precomputed alpha*(1-((i-j)^2/[r]^2))\n    // in radpower[|i-j|]\n    function alterneigh(rad, i, b, g, r) {\n\n        var j;\n        var k;\n        var lo;\n        var hi;\n        var a;\n        var m;\n\n        var p;\n\n        lo = i - rad;\n        if (lo < -1) {\n            lo = -1;\n        }\n\n        hi = i + rad;\n\n        if (hi > netsize) {\n            hi = netsize;\n        }\n\n        j = i + 1;\n        k = i - 1;\n        m = 1;\n\n        while ((j < hi) || (k > lo)) {\n\n            a = radpower[m++];\n\n            if (j < hi) {\n\n                p = network[j++];\n\n                try {\n\n                    p[0] -= ((a * (p[0] - b)) / alpharadbias) | 0;\n                    p[1] -= ((a * (p[1] - g)) / alpharadbias) | 0;\n                    p[2] -= ((a * (p[2] - r)) / alpharadbias) | 0;\n\n                } catch (e) {}\n\n            }\n\n            if (k > lo) {\n\n                p = network[k--];\n\n                try {\n\n                    p[0] -= ((a * (p[0] - b)) / alpharadbias) | 0;\n                    p[1] -= ((a * (p[1] - g)) / alpharadbias) | 0;\n                    p[2] -= ((a * (p[2] - r)) / alpharadbias) | 0;\n\n                } catch (e) {}\n\n            }\n\n        }\n\n    }\n\n\n    // Move neuron i towards biased (b,g,r) by factor alpha\n    function altersingle(alpha, i, b, g, r) {\n\n        // alter hit neuron\n        var n = network[i];\n        var alphaMult = alpha / initalpha;\n        n[0] -= ((alphaMult * (n[0] - b))) | 0;\n        n[1] -= ((alphaMult * (n[1] - g))) | 0;\n        n[2] -= ((alphaMult * (n[2] - r))) | 0;\n\n    }\n\n    // Search for biased BGR values\n    function contest(b, g, r) {\n\n        // finds closest neuron (min dist) and updates freq\n        // finds best neuron (min dist-bias) and returns position\n        // for frequently chosen neurons, freq[i] is high and bias[i] is negative\n        // bias[i] = gamma*((1/netsize)-freq[i])\n\n        var i;\n        var dist;\n        var a;\n        var biasdist;\n        var betafreq;\n        var bestpos;\n        var bestbiaspos;\n        var bestd;\n        var bestbiasd;\n        var n;\n\n        bestd = ~(1 << 31);\n        bestbiasd = bestd;\n        bestpos = -1;\n        bestbiaspos = bestpos;\n\n        for (i = 0; i < netsize; i++) {\n\n            n = network[i];\n            dist = n[0] - b;\n\n            if (dist < 0) {\n                dist = -dist;\n            }\n\n            a = n[1] - g;\n\n            if (a < 0) {\n                a = -a;\n            }\n\n            dist += a;\n\n            a = n[2] - r;\n\n            if (a < 0) {\n                a = -a;\n            }\n\n            dist += a;\n\n            if (dist < bestd) {\n                bestd = dist;\n                bestpos = i;\n            }\n\n            biasdist = dist - ((bias[i]) >> (intbiasshift - netbiasshift));\n\n            if (biasdist < bestbiasd) {\n                bestbiasd = biasdist;\n                bestbiaspos = i;\n            }\n\n            betafreq = (freq[i] >> betashift);\n            freq[i] -= betafreq;\n            bias[i] += (betafreq << gammashift);\n\n        }\n\n        freq[bestpos] += beta;\n        bias[bestpos] -= betagamma;\n        return (bestbiaspos);\n\n    }\n\n    NeuQuantConstructor.apply(this, arguments);\n\n    var exports = {};\n    exports.map = map;\n    exports.process = process;\n\n    return exports;\n}\n\n},{}]},{},[2])'],{type:"text/javascript"})));G.push(N),X.push(N)}var S=function(){for(var e=[],t=0;t<256;t++)e[t]=String.fromCharCode(t);return function(t){for(var i=t.length,l="",a=0;a<i;a++)l+=e[t[a]];return l}}();this.setSize=function(e,t){o=e,r=t,(Z=document.createElement("canvas")).width=e,Z.height=t,b=Z.getContext("2d")},this.setDelay=function(e){u=.1*e},this.setRepeat=function(e){R=e},this.addFrame=function(e){null===b&&this.setSize(o,r),b.drawImage(e,0,0,o,r);var t=b.getImageData(0,0,o,r);this.addFrameImageData(t)},this.addFrameImageData=function(e){var t=(e.length,new Uint8Array(e.data));g.push({data:t,width:e.width,height:e.height,palette:I,dithering:m,done:!1,beingProcessed:!1,position:g.length})},this.onRenderProgress=function(e){p=e},this.isRendering=function(){return y},this.getBase64GIF=function(e){i((function(t){var i=S(t),l="data:image/gif;base64,"+btoa(i);e(l)}))},this.getBlobGIF=function(e){i((function(t){var i=new Uint8Array(t),l=new Blob([i],{type:"image/gif"});e(l)}))},this.destroy=function(){G.forEach((function(e){e.terminate()}))}}},{omggif:1}]},{},[2])(2)}))}},t={};function i(l){var a=t[l];if(void 0!==a)return a.exports;var n=t[l]={id:l,loaded:!1,exports:{}};return e[l](n,n.exports,i),n.loaded=!0,n.exports}i.amdO={},i.d=(e,t)=>{for(var l in t)i.o(t,l)&&!i.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var l={};(()=>{i.d(l,{l:()=>Ne});let e={Mode:{Front:0,Back:1,Full:2},CaptureMode:{SingleSide:0,DoubleSide:1},TrackStatus:{ChangeState:0,Tap:1,DocumentBorder:2,AccessibilityData:3,Diagnostic:4},ModeStr:["Front","Back","Full"],CaptureSensibilityStr:["Low","Normal","High","Auto"],SimpleModeStates:{InfoFront:0,PreviewFront:1,InfoBack:2,PreviewBack:3},DocumentType:{IDCard:0,Passport:1,DriversLicense:2,ForeignCard:3,CreditCard:4,Custom:5},ScanMode:{Generic:0,Specific:1,Search:2},SimpleModeStatesStr:["InfoFront","PreviewFront","InfoBack","PreviewBack"],Version:"4.1.1"};var t=i(871);class a{constructor(e,t,i,l,a,n,s){var d="";this.status=0,this.logDebug=!1,this.eventStatus=l,this.caller=i,this.baseURL=e,t.length>0&&(d=t+"."),this.widgetLoaded=0,this.languageCustomLoaded=0,this.languageDefaultLoaded=0,this.urlWidget=e+"/widget.xml",this.urlLanguageCustom=e+"/strings/strings."+d+"xml",this.resourceDict={},this.dpiList=a,this.browserDpi=n,this.scaleFactor=s;for(var c=163*n*s,h=this.dpiList.length-1,o=0;o<this.dpiList.length;o++)if(this.dpiList[o]>c){h=o;break}this.dpi=this.dpiList[h],this.imageScale=163/this.dpi,this.xmlHttpWidget=new XMLHttpRequest,this.xmlHttpWidget.rm=this,this.xmlHttpWidget.onreadystatechange=e=>{if(4==e.target.readyState&&200==e.target.status){var t=new DOMParser;e.target.rm.widgetLoaded=1,e.target.rm.xmlDoc=t.parseFromString(e.target.responseText,"text/xml")}else 4==e.target.readyState&&200!=e.target.status&&(e.target.rm.widgetLoaded=-1);e.target.rm.readyEvent(e)},this.xmlHttpWidget.open("GET",this.urlWidget),this.xmlHttpWidget.send(null),this.xmlHttpLanguageCustom=new XMLHttpRequest,this.xmlHttpLanguageCustom.rm=this,this.xmlHttpLanguageCustom.onreadystatechange=e=>{4==e.target.readyState&&200==e.target.status?e.target.rm.languageCustomLoaded=1:4==e.target.readyState&&200!=e.target.status&&(e.target.rm.languageCustomLoaded=-1),e.target.rm.readyEvent(e)},this.xmlHttpLanguageCustom.open("GET",this.urlLanguageCustom),this.xmlHttpLanguageCustom.send(null)}readyEvent(e){if(0!==e.target.rm.widgetLoaded&&(0!==e.target.rm.languageCustomLoaded||0!==e.target.rm.languageDefaultLoaded)){if(-1==e.target.rm.widgetLoaded)e.target.rm.status=-1;else if(1==e.target.rm.languageCustomLoaded){var t=e.target.rm.xmlHttpLanguageCustom.responseText,i=new DOMParser;e.target.rm.xmlLang=i.parseFromString(t,"text/xml"),e.target.rm.status=1}else 1==e.target.rm.languageDefaultLoaded?(t=e.target.rm.xmlHttpLanguageDefault.responseText,i=new DOMParser,e.target.rm.xmlLang=i.parseFromString(t,"text/xml"),e.target.rm.status=1):e.target.rm.status=-1;if(1==e.target.rm.status){for(var l,a={},n=e.target.rm.xmlDoc.querySelectorAll("[font]"),s=0;s<n.length;s++)(l=n[s].getAttribute("font")).length>0&&(a[l]=l);if(e.target.rm.fontRequestVector=[],null==document.getElementById("FPhi_Widget_style")){var d,c=document.createElement("style");for(d in c.id="FPhi_Widget_style",a){var h=e.target.rm.getResourceUrlBase(a[d]),o=a[d],r=new XMLHttpRequest;r.open("GET",h,!1),r.send(),200==r.status&&c.appendChild(document.createTextNode("@font-face { font-family: '"+o+"'; src: url('"+h+"'); }"))}document.head.appendChild(c)}e.target.rm.eventStatus(e.target.rm.caller,!0)}else e.target.rm.eventStatus(e.target.rm.caller,!1)}}static httpGet(e,t){var i=new XMLHttpRequest;return i.onreadystatechange=t,i.open("GET",e),i.send(null),200!=i.status?"":i.responseText}getElement(e,t,i){if("facephi-widget-conf"==e)return this.xmlDoc.getElementsByTagName("facephi-widget-conf")[0];var l="_portrait";i&&(l="_landscape");var a=this.xmlDoc.querySelector("[id="+e+l+"]");if(null!=a&&null!=a||(a=this.xmlDoc.querySelector("[id="+e+"]")),this.logDebug&&console.log(a),null!=a){var n=a.querySelector("[id="+t+"]");return this.logDebug&&console.log(n),null==n?void console.log("ResourceManager::getElement Error. elementId="+t+" undefined. Please verify resource's bundle."):n}console.log("ResourceManager::getElement Error. viewId="+e+" undefined. Please verify resource's bundle.")}getElements(e,t){var i="_portrait";t&&(i="_landscape");var l=this.xmlDoc.querySelector("[id="+e+i+"]");null!=l&&null!=l||(l=this.xmlDoc.querySelector("[id="+e+"]"));var a=[];if(l)for(var n=0;n<l.childNodes.length;n++)if(l.childNodes[n].nodeType==Node.ELEMENT_NODE){var s=null;void 0!==l.childNodes[n].attributes.mode&&(s=l.childNodes[n].attributes.mode.value),a.push({type:l.childNodes[n].nodeName,id:l.childNodes[n].attributes.id.value,mode:s})}return 0==a.length&&console.log("FPhi.ResourceManager: No elements for view="+e),a}isAttributeAvailable(e,t,i,l){var a=null;if("facephi-widget-conf"==e)a=this.xmlDoc.getElementsByTagName("facephi-widget-conf")[0];else{var n="_portrait";i&&(n="_landscape");var s=this.xmlDoc.querySelector("[id="+e+n+"]");if(null!=s&&null!=s||(s=this.xmlDoc.querySelector("[id="+e+"]")),null!=s){var d=s.querySelector("[id="+t+"]");null!=d&&(a=d)}}if(null==a||null==a)return!1;var c=a.getAttribute(l);return null!=c&&null!=c}getSetupColor(e,t,i,l){var a=this.getElement(e,t,i);if(null==a||null==a)return null;var n,s,d,c,h=a.getAttribute(l);return null==h||null==h?null:(9==h.length&&(n=parseInt(h.substring(1,3),16),s=parseInt(h.substring(3,5),16),d=parseInt(h.substring(5,7),16),c=parseInt(h.substring(7,9),16),h="rgba("+n+", "+s+", "+d+", "+(c/=255).toFixed(3)+")"),h)}getSetupColorWithAlpha(e,t,i,l,a){var n=this.getElement(e,t,i).getAttribute(l);return"rgba("+parseInt(n.substring(1,3),16)+", "+parseInt(n.substring(3,5),16)+", "+parseInt(n.substring(5,7),16)+", "+a.toFixed(3)+")"}getSetupFloat(e,t,i,l){var a=this.getElement(e,t,i).getAttribute(l);return parseFloat(a)}getSetupAlign(e,t,i,l){return this.getElement(e,t,i).getAttribute(l)}getSetupResourceId(e,t,i,l){var a=this.getElement(e,t,i).getAttribute(l),n=a.split(",");return n&&n.length>1?n[Math.floor(Math.random()*n.length)].trim():a}getSetupTextId(e,t,i,l){return this.getElement(e,t,i).getAttribute(l)}getSetupNodeType(e,t,i){return this.getElement(e,t,i).getAttribute("content_type")}getResourceUrl(e){return this.baseURL+"/resources/"+this.dpi+"dpi/"+e}getResourceUrlBase(e){return this.baseURL+"/resources/"+this.dpiList[0]+"dpi/"+e}getImageScale(){return this.imageScale}getImage(e){if(!(e in this.resourceDict)){var t=this.getResourceUrl(e),i=document.createElement("img");i.src=t,this.resourceDict[e]=i}return this.resourceDict[e]}translate(e){var t=e,i=this.xmlLang.querySelector("[id="+e+"]");return this.logDebug&&console.log(i),null!=i&&(t=i.textContent),t}}if(!n)var n={};n.SelphID=e;class s extends class{constructor(e){this.width=0,this.height=0,this.landscape=!1}cacheResources(){}setCanvasSize(e,t){this.width=e,this.height=t,this.landscape=this.width>=this.height}getCameraRect(e,t,i,l){this.setCanvasSize(e.canvas.clientWidth,e.canvas.clientHeight);var a=this.scaleRect({width:t,height:i},{x:0,y:0,width:this.width,height:this.height});return a.visible=!0,a}getResourceIdForState(e){throw new Error("FPhi.Widget.drawer.abstract.js: Can't instantiate abstract class")}onMouseMove(e,t,i,l,a){e.style.cursor="button"==a||"buttonImage"==a?"pointer":"default"}draw(e,t,i,l,a,n,s,d,c){throw new Error("Can't instantiate abstract class")}getLayout(e,t,i,l,a,n,s){throw new Error("Can't instantiate abstract class")}cacheAnimation(e,t){if(this.rm.isAttributeAvailable(e,t,this.landscape,"id"))for(var i=this.rm.getSetupResourceId(e,t,this.landscape,"name"),l=this.rm.getSetupResourceId(e,t,this.landscape,"ext"),a=parseInt(this.rm.getSetupResourceId(e,t,this.landscape,"start")),n=parseInt(this.rm.getSetupResourceId(e,t,this.landscape,"end")),s=a;s<=n;s++){var d=i+("0"+s).slice(-2)+"."+l;this.rm.getImage(d)}}scaleRect(e,t,i){var l=t.x+t.width/2,a=t.y+t.height/2,n=t.width/e.width,s=t.height/e.height,d=e.width*n,c=e.height*n;return null==i?c<t.height&&(d=e.width*s,c=e.height*s):c>=t.height&&(d=e.width*s,c=e.height*s),{x:l-d/2,y:a-c/2,width:d,height:c}}drawButtonImage(e,t,i,l,a,n,s,d){var c=this.rm.getSetupResourceId(i,l,this.landscape,"value"),h=this.rm.getImage(c),o=this.canvasSizeFactor*this.rm.getImageScale(),r=h.width*o,m=h.height*o;e.drawImage(h,t.x+t.width/2-r/2,t.y+t.height/2-m/2,r,m)}fillRoundRect(e,t,i,l,a,n){l<2*n&&(n=l/2),a<2*n&&(n=a/2),e.beginPath(),e.moveTo(t+n,i),e.arcTo(t+l,i,t+l,i+a,n),e.arcTo(t+l,i+a,t,i+a,n),e.arcTo(t,i+a,t,i,n),e.arcTo(t,i,t+l,i,n),e.closePath(),e.fill()}drawButton(e,t,i,l){if(this.rm.isAttributeAvailable(i,l,this.landscape,"radius")){let a=this.rm.getSetupFloat(i,l,this.landscape,"radius");e.fillStyle=this.rm.getSetupColor(i,l,this.landscape,"decorator"),this.fillRoundRect(e,t.x,t.y+4,t.width,t.height-4,a),e.fillStyle=this.rm.getSetupColor(i,l,this.landscape,"background"),this.fillRoundRect(e,t.x,t.y,t.width,t.height-4,a)}else e.fillStyle=this.rm.getSetupColor(i,l,this.landscape,"decorator"),e.fillRect(t.x,t.y+4,t.width,t.height-4),e.fillStyle=this.rm.getSetupColor(i,l,this.landscape,"background"),e.fillRect(t.x,t.y,t.width,t.height-4);var a=this.rm.getSetupAlign(i,l,this.landscape,"align"),n=this.rm.getSetupNodeType(i,l),s=10*this.canvasSizeFactor;if("TEXT_ID"==n){var d=this.rm.getSetupTextId(i,l,this.landscape,"content"),c=this.rm.translate(d),h=this.rm.getSetupFloat(i,l,this.landscape,"font_size");h=Math.round(h*this.fontSizeFactor);var o=this.rm.getSetupResourceId(i,l,this.landscape,"font");e.font=h+"px '"+o+"'",e.fillStyle=this.rm.getSetupColor(i,l,this.landscape,"foreground");var r=e.measureText(c);"LEFT"==a?e.fillText(c,t.x+s,t.y+t.height/2):"RIGHT"==a?e.fillText(c,t.x+t.width-r.width-s,t.y+t.height/2):e.fillText(c,t.x+t.width/2-r.width/2,t.y+t.height/2)}else{d=this.rm.getSetupResourceId(i,l,this.landscape,"content");var m=this.rm.getImage(d),I=this.canvasSizeFactor*this.rm.getImageScale();"LEFT"==a?e.drawImage(m,t.x+s,t.y+t.height/2-m.height*I/2,m.width*I,m.height*I):"RIGHT"==a?e.drawImage(m,t.x+t.width-m.width*I-s,t.y+t.height/2-m.height*I/2,m.width*I,m.height*I):e.drawImage(m,t.x+t.width/2-m.width*I/2,t.y+t.height/2-m.height*I/2,m.width*I,m.height*I)}}drawImage(e,t,i,l,a,n,s,d){var c=this.rm.getSetupResourceId(i,l,this.landscape,"value"),h=this.rm.getImage(c),o=!1;if(this.rm.isAttributeAvailable(i,l,this.landscape,"scale")&&"CONTAINER"==this.rm.getSetupResourceId(i,l,this.landscape,"scale")&&(o=!0),o)e.drawImage(h,t.x,t.y,t.width,t.height);else{var r=this.canvasSizeFactor*this.rm.getImageScale(),m=h.width*r,I=h.height*r;e.drawImage(h,t.x+t.width/2-m/2,t.y+t.height/2-I/2,m,I)}}drawImageWithClippingCircle(e,t,i,l,a,n){e.save(),e.beginPath(),e.arc(l,a,n,0,2*Math.PI,!1),e.clip(),e.drawImage(i,t.x,t.y,t.width,t.height),e.restore()}drawStringMultiline(e,t,i,l,a,n,s,d,c){var h=t.split("\n");e.imageSmoothingEnabled=!1,n=Math.round(n*this.fontSizeFactor),e.font=n+"px '"+a+"'",e.fillStyle=l,e.textBaseline="middle";var o=i.y;if("CENTER"==c){var r=h.length*s;o=i.y+i.height/2-r/2+n/2}else"BOTTOM"==c&&(r=h.length*s,o=i.y+i.height-r);for(var m=0;m<h.length;m++){var I=e.measureText(h[m]),Z=i.width/2-I.width/2;"LEFT"==d?Z=0:"RIGHT"==d&&(Z=i.width-I.width),e.fillText(h[m],i.x+Z,o+m*s)}}}{constructor(e){super(e),this.mode=e.mode,this.preview=e.preview,this.canvasSizeFactor=1,this.fontSizeFactor=1,this.enableButtonCamera=e.enableButtonCamera,this.documentAspectRatio=e.documentAspectRatio,this.documentRect={x:0,y:0,width:100*this.documentAspectRatio,height:100},this.searchingTextMode=1,this.searchingTextModeTime=0,this.cameraCount=0}setCanvasSize(e,t){this.width=e,this.height=t,this.landscape=this.width>=this.height,this.statusHeight=50,this.rm.isAttributeAvailable("facephi-widget-conf","facephi-widget-conf",this.landscape,"status_height")&&(this.statusHeight=this.rm.getSetupFloat("facephi-widget-conf","facephi-widget-conf",this.landscape,"status_height")),this.documentPadding=30,this.buttonWidth=216,this.buttonHeight=55}fromScreenToCamera(e,t,i,l,a,n,s){var d=this.getCameraRect(e,t,i,l,a),c=s.x-d.x,h=s.y-d.y,o=s.width,r=s.height,m={x:c/d.width*t,y:h/d.height*i,width:o/d.width*t,height:r/d.height*i};return 1==n&&(m.x=t-m.x-m.width),m}getCameraRect(e,t,i,l,a,n){var s=this.scaleRect({width:t,height:i},{x:0,y:0,width:l,height:a});return s.visible=!0,"UCTutorial1"!=n&&"UCTutorial2"!=n&&"UCTutorial3"!=n&&"UCPreview"!=n&&"Error"!=n||(s.visible=!1),s}getDocRectScreenSpace(e,t,i){var l={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:e-2*this.documentPadding,height:t-this.statusHeight-2*this.documentPadding},a=this.scaleRect(this.documentRect,l,"inner");return this.cameraCount>1&&a.x+a.width>e-60&&a.y+a.height>t-60&&(l={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:e-60-this.documentPadding,height:t-this.statusHeight-2*this.documentPadding},a=this.scaleRect(this.documentRect,l,"inner")),i&&(a.x+=i,a.y+=i,a.width-=2*i,a.height-=2*i),a}getDocRect(e,t,i,l,a,n,s){var d=this.getDocRectScreenSpace(l,a,s);return this.fromScreenToCamera(e,t,i,l,a,n,d)}getResourceIdForState(e){return"UCWaitingFaceStart"==e?"StartExtractor":"UCCapture"==e||"UCCaptureCameraSwitch"==e||"UCCaptureTip"==e?"UCCapture":"UCCaptureStatus"==e?"UCCaptureStatus":"UCPreview"==e?"UCPreview":"UCTimeoutPreview"==e?"UCTimeoutPreview":"UCFlip"==e?"UCFlip":"UCTutorial1"==e?"UCTutorial1":"UCTutorial2"==e?"UCTutorial2":"UCTutorial3"==e?"UCTutorial3":"UCWaitRecording"==e?"WaitRecording":"UCError"==e?"Error":"InfoFront"==e||"PreviewFront"==e||"InfoBack"==e||"PreviewBack"==e?e:null}onMouseMove(e,t,i,l,a){e.style.cursor="button"==a||"buttonImage"==a?"pointer":"default"}draw(e,t,i,l,a,n,s,d,c){if(e.imageSmoothingEnabled=!0,"background"==a)this.drawBackground(e,t,i,l);else if("clearRect"==a)this.clearRect(e,t,i,l);else if("imageProc"==a)this.drawImageProc(e,t,i,l,n,s,d,c);else if("button"==a)this.drawButton(e,t,i,l);else if("buttonGradient"==a)this.drawButtonGradient(e,t,i,l);else if("buttonImage"==a)this.drawButtonImage(e,t,i,l,n,s,d,c);else if("image"==a)this.drawImage(e,t,i,l,n,s,d,c);else if("text"==a)this.drawText(e,t,i,l,n,s,d,c);else if("documentBorder"==a)this.drawDocumentBorder(e,t,i,l,n,s,d,c);else if("documentFlipper"==a)this.drawDocumentFlipper(e,t,i,l,n,s,d,c);else if("video"==a)null!=c.player&&e.drawImage(c.player,t.x,t.y,t.width,t.height);else if("animation"==a){var h=0;"UCLivenessMoveDetecting"==c.state&&(h=c.livenessMoveDirection),this.drawAnimation(e,t,i,l,n,s,d,c,h)}else if("initialTip"==a)this.drawInitialTip(e,t,i,l,n,s,d,c);else if("progressRecord"==l){e.fillStyle=this.rm.getSetupColor(i,l,this.landscape,"background_color"),e.fillRect(t.x,t.y,t.width,t.height),e.fillStyle=this.rm.getSetupColor(i,l,this.landscape,"progress_color");let a=.2*t.width,n=s%2/1.6,d=t.width*n-a,c=d+a;d<0&&(d=0),d>t.width&&(d=t.width),c>t.width&&(c=t.width),e.fillRect(t.x+d,t.y,c-d,t.height)}else"rectangle"==a&&(e.fillStyle=this.rm.getSetupColor(i,l,this.landscape,"color"),e.fillRect(t.x,t.y,t.width,t.height))}getLayout(e,t,i,l,a,n,s,d){if("document"==i)return{x:0,y:0,width:this.width,height:this.height};if("documentFlipper"==i)return{x:0,y:0,width:this.width,height:this.height};if("logo"==i){var c=this.rm.getSetupResourceId(t,i,this.landscape,"value"),h=this.rm.getImage(c),o=this.canvasSizeFactor*this.rm.getImageScale(),r=h.width*o,m=h.height*o;return{x:this.width/2-r/2,y:this.height-m-16,width:r,height:m}}if("background"==i)return{x:0,y:0,width:this.width,height:this.height};if("preview"==i||"previewFail"==i){let e,t=0;if("UCPreview"==d.state||"PreviewFront"==d.state||"PreviewBack"==d.state){this.landscape&&(t=64);let i={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:this.width-2*this.documentPadding,height:this.height-this.statusHeight-2*this.documentPadding-t};e=this.scaleRect(this.documentRect,i,"inner")}else e=this.getDocRectScreenSpace(this.width,this.height,0);if(("UCPreview"==d.state||"PreviewFront"==d.state||"PreviewBack"==d.state)&&0==this.landscape){let t=this.height-50-100-39-12;e.y=50+t/2-e.height/2}return e}if("button_ok"==i){if(this.landscape){var I=300;return this.width/2<364&&(I=this.width/2-16-16),{x:this.width-I-16,y:this.height-14-50,width:I,height:50}}{let e=50,t={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:this.width-2*this.documentPadding,height:this.height-this.statusHeight-2*this.documentPadding},i=this.scaleRect(this.documentRect,t,"inner"),l=this.height-e-2*e-39-12;return i.y=e+l/2-i.height/2,i.y,i.height,{x:this.documentPadding,y:this.height-14-50,width:this.width-2*this.documentPadding,height:e}}}if("button_repeat"==i){if(this.landscape)return I=300,this.width/2<364&&(I=this.width/2-16-16),{x:16,y:this.height-14-50,width:I,height:50};{let e=50,t={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:this.width-2*this.documentPadding,height:this.height-this.statusHeight-2*this.documentPadding},i=this.scaleRect(this.documentRect,t,"inner"),l=this.height-e-2*e-39-12;return i.y=e+l/2-i.height/2,i.y,i.height,{x:this.documentPadding,y:this.height-28-100,width:this.width-2*this.documentPadding,height:e}}}if("button_start"==i){if("InfoFront"==d.state||"InfoBack"==d.state)return{x:this.width/2-134,y:this.height-66-58,width:268,height:66};if(this.landscape)return{x:this.width/2-75,y:this.height/2-25,width:150,height:50};{let e={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:this.width-2*this.documentPadding,height:this.height-this.statusHeight-2*this.documentPadding},t=this.scaleRect(this.documentRect,e,"inner"),i=this.height-50-100-39-12;t.y=50+i/2-t.height/2;let l=t.y+t.height+20;return{x:this.documentPadding,y:l,width:this.width-2*this.documentPadding,height:50}}}if("text"==i){if(this.landscape){if("UCCaptureStatus"==d.state){var Z=0,b={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:this.width-2*this.documentPadding,height:this.height-this.statusHeight-2*this.documentPadding-Z};return{x:(R=this.scaleRect(this.documentRect,b,"inner")).x+.4*R.width,y:R.y,width:.6*R.width,height:R.height}}return"UCWaitRecording"==d.state?{x:0,y:.6*this.height,width:this.width,height:50}:"InfoFront"==d.state?{x:0,y:374*this.height/640,width:this.width,height:50}:"UCTimeoutPreview"==d.state?{x:0,y:0,width:this.width,height:70}:{x:0,y:0,width:this.width,height:50}}return"UCCapture"==d.state?{x:0,y:(R=this.getDocRectScreenSpace(this.width,this.height,0)).y-35,width:this.width,height:R.y}:"UCCaptureStatus"==d.state?(Z=0,b={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:this.width-2*this.documentPadding,height:this.height-this.statusHeight-2*this.documentPadding-Z},{x:(R=this.scaleRect(this.documentRect,b,"inner")).x+.4*R.width,y:R.y,width:.6*R.width,height:R.height}):"UCWaitRecording"==d.state?{x:0,y:.6*this.height,width:this.width,height:50}:"InfoFront"==d.state?{x:0,y:374*this.height/640,width:this.width,height:50}:"UCTimeoutPreview"==d.state?{x:0,y:0,width:this.width,height:70}:{x:0,y:0,width:this.width,height:50}}if("diagnostic"==i)return{x:0,y:0,width:this.width,height:this.height};if("text_detail"==i){if("UCTimeoutPreview"==d.state)return this.landscape?{x:this.width/2,y:330*this.height/640,width:this.width/2,height:50}:{x:0,y:374*this.height/640,width:this.width,height:50};if(0==this.landscape)return{x:0,y:(R=this.getDocRectScreenSpace(this.width,this.height,0)).y+R.height+15+7,width:this.width,height:this.height}}else{if("text_detail2"==i)return this.landscape?{x:this.width/2,y:280*this.height/640,width:this.width/2,height:50}:{x:0,y:320*this.height/640,width:this.width,height:50};if("previewImgOk"==i||"previewImgFail"==i){Z=0,"UCPreview"==d.state&&this.landscape&&(Z=64),b={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:this.width-2*this.documentPadding,height:this.height-this.statusHeight-2*this.documentPadding-Z};var R=this.scaleRect(this.documentRect,b,"inner");if("UCPreview"==d.state&&0==this.landscape){var u=this.height-50-100-39-12;R.y=50+u/2-R.height/2}return c=this.rm.getSetupResourceId(t,i,this.landscape,"value"),h=this.rm.getImage(c),o=this.canvasSizeFactor*this.rm.getImageScale(),r=h.width*o,m=h.height*o,{x:R.x+R.width/3.5-r/2,y:R.y+R.height/2-m/2,width:r,height:m}}if("tip"==i)return this.landscape?{x:0,y:30,width:this.width,height:200}:{x:0,y:50,width:this.width,height:200};if("tip_detail"==i)return this.landscape?{x:this.width/2,y:0,width:this.width/2,height:this.height}:{x:0,y:this.height/2-60,width:this.width,height:this.height-this.documentPadding-15-2*this.buttonHeight-(this.height/2-60-95)};if("background"==i)return{x:0,y:0,width:this.width,height:this.height};if("button_skip"==i){if(this.landscape){var g=this.buttonWidth;return this.width<800&&((W=(this.width-600)/200)<0&&(W=0),g-=g/2*(W=1-W)),{x:this.documentPadding,y:this.height-this.documentPadding-this.buttonHeight,width:g,height:this.buttonHeight}}{let e=this.width-2*this.documentPadding;return e>262&&(e=262),{x:this.width/2-e/2,y:this.height-this.documentPadding-this.buttonHeight,width:e,height:this.buttonHeight}}}if("button_next"==i){if(this.landscape)return g=this.buttonWidth,this.width<800&&((W=(this.width-600)/200)<0&&(W=0),g-=g/2*(W=1-W)),{x:this.width-this.documentPadding-g,y:this.height-this.documentPadding-this.buttonHeight,width:g,height:this.buttonHeight};{let e=this.width-2*this.documentPadding;return e>262&&(e=262),{x:this.width/2-e/2,y:this.height-this.documentPadding-15-2*this.buttonHeight,width:e,height:this.buttonHeight}}}if("button_finish"==i){var W;if(this.landscape)return g=this.buttonWidth,this.width<800&&((W=(this.width-600)/200)<0&&(W=0),g-=g/2*(W=1-W)),{x:this.width-this.documentPadding-g,y:this.height-this.documentPadding-this.buttonHeight,width:g,height:this.buttonHeight};{let e=this.width-2*this.documentPadding;return e>262&&(e=262),{x:this.width/2-e/2,y:this.height-this.documentPadding-15-2*this.buttonHeight,width:e,height:this.buttonHeight}}}if("button_back"==i){let e=this.width-2*this.documentPadding;return e>262&&(e=262),{x:5,y:0,width:e,height:this.buttonHeight}}if("video"==i)return this.landscape?(b={x:this.documentPadding,y:60,width:this.width/2-2*this.documentPadding,height:this.height-this.buttonHeight-2*this.documentPadding-50},this.scaleRect(this.documentRect,b,"inner")):(b={x:this.documentPadding,y:95,width:this.width-2*this.documentPadding,height:this.height/2-60},this.scaleRect(this.documentRect,b,"inner"));if("initial_tip"==i){if("UCCaptureTip"==d.state)return{x:0,y:0,width:this.width,height:this.height}}else if("button_initial_tip"==i){if("UCCaptureTip"==d.state)return{x:this.width/2-113,y:this.height/2-79+92,width:226,height:45}}else{if("progressRecord"==i)return{x:.146*this.width,y:.52*this.height,width:.7*this.width,height:18};if("imageFront"==i||"imageBack"==i)return"UCTimeoutPreview"==d.state?this.landscape?(I=this.height-70-70,{x:0,y:75,width:this.width/2,height:I}):(I=220*this.height/640,{x:this.width/2-I/2,y:75,width:I,height:I}):(I=177*this.height/640,{x:this.width/2-I/2,y:103*this.height/640,width:I,height:I});if("titleBox"==i)return{x:0,y:0,width:this.width,height:70};if("tip_video"==i)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("video_success"==i)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("extraction_video"==i)return{x:this.width/2-.1*this.width,y:.73*this.height,width:.2*this.width,height:.2*this.width};if("button_finish"==i)return{x:.55*this.width,y:this.height-this.buttonHeight,width:.4*this.width,height:this.buttonHeight};if("button_exit"==i)return c=this.rm.getSetupResourceId(t,i,this.landscape,"value"),h=this.rm.getImage(c),o=this.canvasSizeFactor*this.rm.getImageScale(),r=h.width*o,m=h.height*o,"UCTimeoutPreview"==d.state?{x:this.width-r-30,y:0,width:r+30,height:70}:{x:this.width-r-30,y:0,width:r+30,height:50};if("button_info"==i)return c=this.rm.getSetupResourceId(t,i,this.landscape,"value"),h=this.rm.getImage(c),o=this.canvasSizeFactor*this.rm.getImageScale(),r=h.width*o,m=h.height*o,{x:0,y:0,width:r+30,height:50};if("button_camera"==i)return this.cameraCount<2?null:this.enableButtonCamera?(c=this.rm.getSetupResourceId(t,i,this.landscape,"value"),h=this.rm.getImage(c),o=this.canvasSizeFactor*this.rm.getImageScale(),r=h.width*o,m=h.height*o,{x:this.width-r-16,y:this.height-m-12,width:r+16,height:m+12}):null;if("button_rotate"==i)return c=this.rm.getSetupResourceId(t,i,this.landscape,"value"),h=this.rm.getImage(c),o=this.canvasSizeFactor*this.rm.getImageScale(),r=h.width*o,m=h.height*o,R=this.getDocRectScreenSpace(this.width,this.height,0),"UCPreview"!=d.state&&"PreviewFront"!=d.state&&"PreviewBack"!=d.state||(b={x:this.documentPadding,y:this.statusHeight+this.documentPadding,width:this.width-2*this.documentPadding,height:this.height-this.statusHeight-2*this.documentPadding-Z},R=this.scaleRect(this.documentRect,b,"inner"),0==this.landscape&&(u=this.height-50-100-39-12,R.y=50+u/2-R.height/2)),{x:R.x,y:30,width:r+16,height:m+12};if("warning"==i)return{x:0,y:.91*this.height,width:this.width,height:.1*this.height};if("warningTooFar"==i)return{x:0,y:.89*this.height,width:this.width,height:.1*this.height};if("camera"==l)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("results"==l)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("liveness_move_text"==i)return"UCLivenessMoveStabilizing"==d.state||"UCLivenessMoveStabilized"==d.state||"UCLivenessMoveDetecting"==d.state?{x:0,y:.89*this.height,width:this.width,height:.1*this.height}:null;if("liveness_move_tip_text"==i)return 800==this.width?null:{x:this.circleX-this.circleRadius,y:this.circleY-.39*this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("liveness_move_tip_text_challenge"==i)return 800!=this.width?null:{x:this.circleX-this.circleRadius,y:this.circleY-.39*this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius};if("livenessInfo_text"==i)return{x:0,y:.89*this.height,width:this.width,height:.1*this.height};if("liveness_move_left"==i||"liveness_move_right"==i||"liveness_move_top"==i||"liveness_move_bottom"==i){if(-1==d.livenessMoveDirection)return null;if("UCLivenessMoveDetecting"==d.state&&n>=.25&&n<1.75){if(0==d.livenessMoveDirection&&"liveness_move_top"!=i)return null;if(2==d.livenessMoveDirection&&"liveness_move_bottom"!=i)return null;if(1==d.livenessMoveDirection&&"liveness_move_right"!=i)return null;if(3==d.livenessMoveDirection&&"liveness_move_left"!=i)return null;var V=!1;return this.rm.isAttributeAvailable(t,i,"fullscreen")&&"true"==this.rm.getSetupResourceId(t,i,this.landscape,"fullscreen")&&(V=!0),V?{x:0,y:0,width:this.width,height:this.height}:{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}return null}if("face_searcher"==i)return{x:0,y:0,width:this.width,height:this.height};if("livenessMoveGlasses"==i){if(2==d.livenessMoveFailReason)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}else if("livenessMoveSunGlasses"==i){if(0==d.livenessMoveFailReason)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}else if("livenessMoveInfo"==i){if(1==d.livenessMoveFailReason)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}else{if("animation"==l)return i!=d.state?null:(V=!1,this.rm.isAttributeAvailable(t,i,"fullscreen")&&"true"==this.rm.getSetupResourceId(t,i,this.landscape,"fullscreen")&&(V=!0),V?{x:0,y:0,width:this.width,height:this.height}:{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius});if(("liveness_ok"==i||"liveness_nok"==i)&&"UCLivenessMoveStabilizing"==d.state)return{x:this.circleX-this.circleRadius,y:this.circleY-this.circleRadius,width:2*this.circleRadius,height:2*this.circleRadius}}}}return null}drawBackground(e,t,i,l){e.fillStyle=this.rm.getSetupColor(i,l,this.landscape,"color"),e.fillRect(t.x,t.y,t.width,t.height)}clearRect(e,t,i,l){e.clearRect(t.x,t.y,t.width,t.height)}drawPoint(e,t,i,l,a){e.fillStyle=a,e.beginPath(),e.arc(t,i,l,0,2*Math.PI),e.fill()}drawLine(e,t,i,l,a,n){e.lineWidth=1,e.strokeStyle=n,e.beginPath(),e.moveTo(t,i),e.lineTo(l,a),e.stroke()}drawButtonImage(e,t,i,l,a,n,s,d){var c=this.rm.getSetupResourceId(i,l,this.landscape,"value"),h=this.rm.getImage(c),o=this.canvasSizeFactor*this.rm.getImageScale(),r=h.width*o,m=h.height*o;e.drawImage(h,t.x+t.width/2-r/2,t.y+t.height/2-m/2,r,m)}drawButton(e,t,i,l){let a=0;this.rm.isAttributeAvailable(i,l,this.landscape,"radius")&&(a=this.rm.getSetupFloat(i,l,this.landscape,"radius"));var n=this.rm.getSetupColor(i,l,this.landscape,"background");this.fillRoundedRect(e,t,a,1,1,n);var s=this.rm.getSetupColor(i,l,this.landscape,"decorator");this.drawRoundedRectProgressive(e,t,a,1,1,s,1);var d=this.rm.getSetupAlign(i,l,this.landscape,"align"),c=this.rm.getSetupNodeType(i,l,this.landscape),h=10*this.canvasSizeFactor;if("TEXT_ID"==c){var o=this.rm.getSetupTextId(i,l,this.landscape,"content"),r=this.rm.translate(o),m=this.rm.getSetupFloat(i,l,this.landscape,"font_size");m=Math.round(m*this.fontSizeFactor);var I=this.rm.getSetupResourceId(i,l,this.landscape,"font");e.font=m+"px '"+I+"'",e.textBaseline="alphabetic",e.fillStyle=this.rm.getSetupColor(i,l,this.landscape,"foreground");var Z=e.measureText(r);"LEFT"==d?e.fillText(r,t.x+h,t.y+t.height/2+m/2):"RIGHT"==d?e.fillText(r,t.x+t.width-Z.width-h,t.y+t.height/2+m/2):e.fillText(r,t.x+t.width/2-Z.width/2,t.y+t.height/2+m/2)}else{o=this.rm.getSetupResourceId(i,l,this.landscape,"content");var b=this.rm.getImage(o),R=this.canvasSizeFactor*this.rm.getImageScale();"LEFT"==d?e.drawImage(b,t.x+h,t.y+t.height/2-b.height*R/2,b.width*R,b.height*R):"RIGHT"==d?e.drawImage(b,t.x+t.width-b.width*R-h,t.y+t.height/2-b.height*R/2,b.width*R,b.height*R):e.drawImage(b,t.x+t.width/2-b.width*R/2,t.y+t.height/2-b.height*R/2,b.width*R,b.height*R)}}drawButtonGradient(e,t,i,l){let a=0;this.rm.isAttributeAvailable(i,l,this.landscape,"radius")&&(a=this.rm.getSetupFloat(i,l,this.landscape,"radius"));var n=this.rm.getSetupColor(i,l,this.landscape,"colorFrom"),s=this.rm.getSetupColor(i,l,this.landscape,"colorTo");this.fillRoundedRectGradient(e,t,a,1,1,n,s);var d=this.rm.getSetupColor(i,l,this.landscape,"decorator");this.drawRoundedRectProgressive(e,t,a,1,1,d,1);var c=this.rm.getSetupAlign(i,l,this.landscape,"align"),h=this.rm.getSetupNodeType(i,l,this.landscape),o=10*this.canvasSizeFactor;if("TEXT_ID"==h){var r=this.rm.getSetupTextId(i,l,this.landscape,"content"),m=this.rm.translate(r),I=this.rm.getSetupFloat(i,l,this.landscape,"font_size");I=Math.round(I*this.fontSizeFactor);var Z=this.rm.getSetupResourceId(i,l,this.landscape,"font");e.font=I+"px '"+Z+"'",e.textBaseline="alphabetic",e.fillStyle=this.rm.getSetupColor(i,l,this.landscape,"foreground");var b=e.measureText(m);"LEFT"==c?e.fillText(m,t.x+o,t.y+t.height/2+I/2):"RIGHT"==c?e.fillText(m,t.x+t.width-b.width-o,t.y+t.height/2+I/2):e.fillText(m,t.x+t.width/2-b.width/2,t.y+t.height/2+I/2)}else{r=this.rm.getSetupResourceId(i,l,this.landscape,"content");var R=this.rm.getImage(r),u=this.canvasSizeFactor*this.rm.getImageScale();"LEFT"==c?e.drawImage(R,t.x+o,t.y+t.height/2-R.height*u/2,R.width*u,R.height*u):"RIGHT"==c?e.drawImage(R,t.x+t.width-R.width*u-o,t.y+t.height/2-R.height*u/2,R.width*u,R.height*u):e.drawImage(R,t.x+t.width/2-R.width*u/2,t.y+t.height/2-R.height*u/2,R.width*u,R.height*u)}}drawImageProc(e,t,i,l,a,n,s,d){if(null!=d.previewImage){let a="#ffffff";this.rm.isAttributeAvailable(i,l,this.landscape,"backgroundColor")&&(a=this.rm.getSetupColor(i,l,this.landscape,"backgroundColor")),e.fillStyle=a,e.fillRect(t.x,t.y,t.width,t.height);var c=d.previewImage,h=this.canvasSizeFactor*this.rm.getImageScale(),o={x:0,y:0,width:c.width*h,height:c.height*h},r=this.scaleRect(o,t,"inner");e.drawImage(c,r.x,r.y,r.width,r.height)}this.rm.isAttributeAvailable(i,l,this.landscape,"overlay")&&this.fillRoundedRect(e,t,6,1,1,this.rm.getSetupColor(i,l,this.landscape,"overlay"))}drawImage(e,t,i,l,a,n,s,d){var c=this.rm.getSetupResourceId(i,l,this.landscape,"value"),h=this.rm.getImage(c),o=!1;if(this.rm.isAttributeAvailable(i,l,this.landscape,"scale")&&"CONTAINER"==this.rm.getSetupResourceId(i,l,this.landscape,"scale")&&(o=!0),o)e.drawImage(h,t.x,t.y,t.width,t.height);else{var r=this.canvasSizeFactor*this.rm.getImageScale(),m=h.width*r,I=h.height*r;e.drawImage(h,t.x+t.width/2-m/2,t.y+t.height/2-I/2,m,I)}}drawImageWithClippingCircle(e,t,i,l,a,n){e.save(),e.beginPath(),e.arc(l,a,n,0,2*Math.PI,!1),e.clip(),e.drawImage(i,t.x,t.y,t.width,t.height),e.restore()}cacheAnimation(e,t){for(var i=this.rm.getSetupResourceId(e,t,this.landscape,"name"),l=this.rm.getSetupResourceId(e,t,this.landscape,"ext"),a=parseInt(this.rm.getSetupResourceId(e,t,this.landscape,"start")),n=parseInt(this.rm.getSetupResourceId(e,t,this.landscape,"end")),s=a;s<=n;s++){var d=i+("0"+s).slice(-2)+"."+l;this.rm.getImage(d)}}drawAnimation(e,t,i,l,a,n,s,d,c){var h=.1;this.rm.isAttributeAvailable(i,l,"rate")&&(h=1/parseFloat(this.rm.getSetupResourceId(i,l,this.landscape,"rate")));var o="FINISH";this.rm.isAttributeAvailable(i,l,this.landscape,"animMode")&&(o=this.rm.getSetupResourceId(i,l,this.landscape,"animMode"));var r,m=this.rm.getSetupResourceId(i,l,this.landscape,"name"),I=this.rm.getSetupResourceId(i,l,this.landscape,"ext"),Z=parseInt(this.rm.getSetupResourceId(i,l,this.landscape,"start")),b=parseInt(this.rm.getSetupResourceId(i,l,this.landscape,"end")),R=h*(b-Z+1);if("FINISH"==o)(r=Math.floor(n/h+Z))>b&&(r=b);else{var u=n%R/R;r=Math.floor((b-Z)*u+Z)}r<Z&&(r=Z),r>b&&(r=b);var g=m+("0"+r).slice(-2)+"."+I,W=this.rm.getImage(g);e.drawImage(W,t.x,t.y,t.width,t.height)}drawInitialTip(e,t,i,l,a,n,s,d){e.fillStyle="rgba(0,0,0,0.7)",e.fillRect(t.x,t.y,t.width,t.height);let c=this.rm.getSetupColor(i,l,this.landscape,"backgroundColor"),h={x:this.width/2-160,y:this.height/2-79,width:320,height:158};this.fillRoundedRect(e,h,6,1,1,c);var o=this.rm.getSetupResourceId(i,l,this.landscape,"image"),r=this.rm.getImage(o),m=this.canvasSizeFactor*this.rm.getImageScale(),I=r.width*m,Z=r.height*m;e.drawImage(r,h.x+16,h.y+31,I,Z);var b=this.rm.getSetupFloat(i,l,this.landscape,"font_size"),R=b+1;this.rm.isAttributeAvailable(i,l,this.landscape,"line_height")&&(R=this.rm.getSetupFloat(i,l,this.landscape,"line_height"));var u=this.rm.getSetupColor(i,l,this.landscape,"color"),g=this.rm.getSetupResourceId(i,l,this.landscape,"font"),W={x:h.x+50,y:h.y,width:h.width-35,height:92},V=this.rm.translate("capture_tip_text");this.drawStringMultiline(e,V,W,u,g,b,R,"LEFT","CENTER")}drawDocumentBorder(e,t,i,l,a,n,s,d){var c=this.rm.getSetupColor(i,l,this.landscape,"documentBorderColor"),h=this.rm.getSetupColor(i,l,this.landscape,"documentBorderDetectedColor"),o=0;"UCPreview"!=d.state&&"PreviewFront"!=d.state&&"PreviewBack"!=d.state||this.landscape&&(o=64);let r=this.rm.getSetupColor(i,l,this.landscape,"statusColor");0==d.cameraOverflow&&(r=this.rm.getSetupColor(i,l,this.landscape,"statusColorVariant")),e.fillStyle=r,e.fillRect(t.x,t.y,t.width,this.statusHeight);var m=this.getDocRectScreenSpace(t.width,t.height,0);if("UCPreview"==d.state||"PreviewFront"==d.state||"PreviewBack"==d.state){var I={x:t.x+this.documentPadding,y:t.y+this.statusHeight+this.documentPadding,width:t.width-2*this.documentPadding,height:t.height-this.statusHeight-2*this.documentPadding-o};if(m=this.scaleRect(this.documentRect,I,"inner"),0==this.landscape){var Z=this.height-50-100-39-12;m.y=50+Z/2-m.height/2}}e.save(),e.beginPath(),e.rect(t.x,t.y+this.statusHeight,t.width,t.height-this.statusHeight),e.rect(m.x,m.y,m.width,m.height),e.closePath(),e.clip("evenodd");let b=this.rm.getSetupColor(i,l,this.landscape,"backgroundColor");0==d.cameraOverflow&&(b=this.rm.getSetupColor(i,l,this.landscape,"backgroundColorVariant")),e.fillStyle=b,e.fillRect(t.x,t.y+this.statusHeight,t.width,t.height-this.statusHeight),e.restore();var R=this.rm.getSetupFloat(i,l,this.landscape,"documentBorder");if(this.drawRoundedRectProgressive(e,m,6,R,2*R,c,1),"UCCapture"==d.state){var u=0;1==d.contour[0]&&u++,1==d.contour[1]&&u++,1==d.contour[2]&&u++,1==d.contour[3]&&u++,u>=2?a-this.searchingTextModeTime>.5&&(this.searchingTextMode=2,this.searchingTextModeTime=a):a-this.searchingTextModeTime>.5&&(this.searchingTextMode=1,this.searchingTextModeTime=a);var g,W=this.rm.getSetupFloat(i,l,this.landscape,"font_size"),V=this.rm.getSetupColor(i,l,this.landscape,"font_color"),p=this.rm.getSetupResourceId(i,l,this.landscape,"font");g=1==this.searchingTextMode?this.rm.translate("searching1_text"):this.rm.translate("searching2_text"),this.drawStringMultiline(e,g,m,V,p,W,"CENTER","CENTER")}e.lineWidth=this.rm.getSetupFloat(i,l,this.landscape,"documentBorder");var G=.15*m.width,X=.15*m.height;1==d.contour[0]&&(e.beginPath(),e.strokeStyle=1==d.contour[0]?h:c,e.moveTo(m.x+G,m.y+6),e.lineTo(m.x+m.width-G,m.y+6),e.stroke()),1==d.contour[1]&&(e.beginPath(),e.strokeStyle=1==d.contour[1]?h:c,e.moveTo(m.x+m.width-6,m.y+X),e.lineTo(m.x+m.width-6,m.y+m.height-X),e.stroke()),1==d.contour[2]&&(e.beginPath(),e.strokeStyle=1==d.contour[2]?h:c,e.moveTo(m.x+m.width-G,m.y+m.height-6),e.lineTo(m.x+G,m.y+m.height-6),e.stroke()),1==d.contour[3]&&(e.beginPath(),e.strokeStyle=1==d.contour[3]?h:c,e.moveTo(m.x+6,m.y+m.height-X),e.lineTo(m.x+6,m.y+X),e.stroke())}drawDocumentFlipper(e,t,i,l,a,n,s,d){var c=this.rm.getSetupColor(i,l,this.landscape,"documentBorderColor");this.rm.getSetupColor(i,l,this.landscape,"documentBorderDetectedColor");let h=this.rm.getSetupColor(i,l,this.landscape,"statusColor");0==d.cameraOverflow&&(h=this.rm.getSetupColor(i,l,this.landscape,"statusColorVariant")),e.fillStyle=h,e.fillRect(t.x,t.y,t.width,this.statusHeight);var o,r=this.getDocRectScreenSpace(this.width,this.height,0),m=r.x+r.width/2,I=.5;n<I?(o=1-(1-(o=1-n/I))*(1-o)*(1-o),r.width=r.width*o,r.x=m-r.width/2):(o=1-(1-(o=(n-I)/I))*(1-o)*(1-o),r.width=r.width*o,r.x=m-r.width/2),e.save(),e.beginPath(),e.rect(t.x,t.y+this.statusHeight,t.width,t.height-this.statusHeight),e.rect(r.x,r.y,r.width,r.height),e.closePath(),e.clip("evenodd");let Z=this.rm.getSetupColor(i,l,this.landscape,"backgroundColor");if(0==d.cameraOverflow&&(Z=this.rm.getSetupColor(i,l,this.landscape,"backgroundColorVariant")),e.fillStyle=Z,e.fillRect(t.x,t.y+this.statusHeight,t.width,t.height-this.statusHeight),e.restore(),e.lineWidth=this.rm.getSetupFloat(i,l,this.landscape,"documentBorder"),e.strokeStyle=c,e.strokeRect(r.x,r.y,r.width,r.height),n<I){var b=d.previewImage;e.drawImage(b,r.x,r.y,r.width,r.height)}}drawText(e,t,i,l,a,s,d,c){var h=this.rm.getSetupFloat(i,l,this.landscape,"font_size"),o=h+1;this.rm.isAttributeAvailable(i,l,this.landscape,"line_height")&&(o=this.rm.getSetupFloat(i,l,this.landscape,"line_height"));var r=this.rm.getSetupColor(i,l,this.landscape,"color"),m=this.rm.getSetupResourceId(i,l,this.landscape,"font"),I="CENTER";this.rm.isAttributeAvailable(i,l,this.landscape,"align")&&(I=this.rm.getSetupAlign(i,l,this.landscape,"align"));var Z="TOP";this.rm.isAttributeAvailable(i,l,this.landscape,"valign")&&(Z=this.rm.getSetupAlign(i,l,this.landscape,"valign"));var b="";this.rm.isAttributeAvailable(i,l,this.landscape,"fontWeight")&&(b=this.rm.getSetupTextId(i,l,this.landscape,"fontWeight")),a<.1&&(r="#00000000");var R="";if("text"==l)"UCCapture"==i?R=c.status==n.SelphID.Mode.Front?this.rm.translate("capture_front_text"):this.rm.translate("capture_back_text"):"UCCaptureStatus"==i?R=c.status==n.SelphID.Mode.Front?"Warning"==d?this.rm.translate("capture_status_front_fail"):this.rm.translate("capture_status_front_ok"):"Warning"==d?this.rm.translate("capture_status_back_fail"):this.rm.translate("capture_status_back_ok"):"UCPreview"==i?R=c.status==n.SelphID.Mode.Front?this.rm.translate("preview_front_text"):this.rm.translate("preview_back_text"):"UCFlip"==i?R=this.rm.translate("flip_document"):"WaitRecording"==i?R=this.rm.translate("waitRecording"):"InfoFront"==i?R=this.rm.translate("infoFront"):"InfoBack"==i?R=this.rm.translate("infoBack"):"PreviewFront"==i||"PreviewBack"==i?R=this.rm.translate("infoQuality"):"UCTimeoutPreview"==i&&(R=this.rm.translate("infoTimeoutTitle"));else if("text_detail"==l)R="UCTimeoutPreview"==i?this.rm.translate("infoTimeout"):this.rm.translate("capture_detail_text");else if("text_detail2"==l)R=this.rm.translate("infoTimeout2");else if("tip"==l){if("UCTutorial1"==i?R=this.rm.translate("tutorial1_tip"):"UCTutorial2"==i?R=this.rm.translate("tutorial2_tip"):"UCTutorial3"==i&&(R=this.rm.translate("tutorial3_tip")),this.landscape&&this.width<800){var u=(this.width-600)/200;u<0&&(u=0),h-=h/2*(u=1-u)}}else if("tip_detail"==l)"UCTutorial1"==i?R=this.rm.translate("tutorial1_tip_detail"):"UCTutorial2"==i?R=this.rm.translate("tutorial2_tip_detail"):"UCTutorial3"==i&&(R=this.rm.translate("tutorial3_tip_detail"));else if("warning"==l)R="Fallo al cargar el modelo!!";else if("diagnostic"==l)switch(c.diagnostic){case 2:R=this.rm.translate("documentDiagnostic_2");break;case 3:R=this.rm.translate("documentDiagnostic_3");break;case 4:R=this.rm.translate("documentDiagnostic_4");break;case 5:R=this.rm.translate("documentDiagnostic_5");break;case 6:R=this.rm.translate("documentDiagnostic_6");break;case 11:R=this.rm.translate("documentDiagnostic_11");break;case 12:R=this.rm.translate("documentDiagnostic_12");break;case 13:R=this.rm.translate("documentDiagnostic_13");break;case 17:R=this.rm.translate("documentDiagnostic_17");break;case 18:R=this.rm.translate("documentDiagnostic_18");break;case 20:R=this.rm.translate("documentDiagnostic_20")}this.drawStringMultiline(e,R,t,r,m,h,o,I,Z,b)}drawStringMultiline(e,t,i,l,a,n,s,d,c,h){var o=t.split("\n");e.imageSmoothingEnabled=!1,n=Math.round(n*this.fontSizeFactor),e.font=h+" "+n+"px '"+a+"'",e.fillStyle=l,e.textBaseline="middle";var r=i.y;if("CENTER"==c){var m=o.length*s;r=i.y+i.height/2-m/2+n/2}else"BOTTOM"==c&&(m=o.length*s,r=i.y+i.height-m);for(var I=0;I<o.length;I++){var Z=e.measureText(o[I]),b=i.width/2-Z.width/2;"LEFT"==d?b=0:"RIGHT"==d&&(b=i.width-Z.width),e.fillText(o[I],i.x+b,r+I*s)}}scaleRect(e,t,i){var l=t.x+t.width/2,a=t.y+t.height/2,n=t.width/e.width,s=t.height/e.height,d=e.width*n,c=e.height*n;return null==i?c<t.height&&(d=e.width*s,c=e.height*s):c>=t.height&&(d=e.width*s,c=e.height*s),{x:l-d/2,y:a-c/2,width:d,height:c}}getRoundedRectPerimeter(e,t,i){return 2*Math.PI*i+2*(e-2*i)+2*(t-2*i)}rotatePoint(e,t){return{x:e*Math.cos(t),y:e*Math.sin(t)}}drawRoundedRectProgressive(e,t,i,l,a,n,s){var d,c=this.getRoundedRectPerimeter(t.width,t.height,i)*s,h=0;if(e.lineWidth=l,e.strokeStyle=n,e.fillStyle=n,e.beginPath(),e.moveTo(t.x,t.y+t.height/2),(c-=h=(t.height-2*i)/2)<0){var o=(c+h)/h,r=t.x,m=t.y+t.height/2-h*o;return e.lineTo(r,m),void e.stroke()}return e.lineTo(t.x,t.y+i),(c-=h=Math.PI/2*i)<0?(o=(c+h)/h,r=t.x+i,m=t.y+i,e.arc(r,m,i,Math.PI,Math.PI+Math.PI/2*o),e.stroke(),r+=(d=this.rotatePoint(i,Math.PI+Math.PI/2*o)).x,void(m+=d.y)):(e.arc(t.x+i,t.y+i,i,Math.PI,Math.PI+Math.PI/2),(c-=h=t.width-2*i)<0?(o=(c+h)/h,r=t.x+i+h*o,m=t.y,e.lineTo(r,m),void e.stroke()):(e.lineTo(t.x+t.width-i,t.y),(c-=h=Math.PI/2*i)<0?(o=(c+h)/h,r=t.x+t.width-i,m=t.y+i,e.arc(r,m,i,Math.PI+Math.PI/2,Math.PI+Math.PI/2+Math.PI/2*o),e.stroke(),r+=(d=this.rotatePoint(i,Math.PI+Math.PI/2+Math.PI/2*o)).x,void(m+=d.y)):(e.arc(t.x+t.width-i,t.y+i,i,Math.PI+Math.PI/2,0),(c-=h=t.height-2*i)<0?(o=(c+h)/h,r=t.x+t.width,m=t.y+i+h*o,e.lineTo(r,m),void e.stroke()):(e.lineTo(t.x+t.width,t.y+t.height-i),(c-=h=Math.PI/2*i)<0?(o=(c+h)/h,r=t.x+t.width-i,m=t.y+t.height-i,e.arc(r,m,i,0,Math.PI/2*o),e.stroke(),r+=(d=this.rotatePoint(i,Math.PI/2*o)).x,void(m+=d.y)):(e.arc(t.x+t.width-i,t.y+t.height-i,i,0,Math.PI/2),(c-=h=t.width-2*i)<0?(o=(c+h)/h,r=t.x+t.width-i-h*o,m=t.y+t.height,e.lineTo(r,m),void e.stroke()):(e.lineTo(t.x+i,t.y+t.height),(c-=h=Math.PI/2*i)<0?(o=(c+h)/h,r=t.x+i,m=t.y+t.height-i,e.arc(r,m,i,Math.PI/2,Math.PI/2+Math.PI/2*o),e.stroke(),r+=(d=this.rotatePoint(i,Math.PI/2+Math.PI/2*o)).x,void(m+=d.y)):(e.arc(t.x+i,t.y+t.height-i,i,Math.PI/2,Math.PI),(c-=h=(t.height-2*i)/2)<0?(o=(c+h)/h,r=t.x,m=t.y+t.height-i-h*o,e.lineTo(r,m),void e.stroke()):(r=t.x,m=t.y+t.height/2,e.lineTo(r,m),void e.stroke()))))))))}fillRoundedRect(e,t,i,l,a,n){e.lineWidth=l,e.strokeStyle=n,e.fillStyle=n,e.beginPath(),e.moveTo(t.x,t.y+t.height/2),e.lineTo(t.x,t.y+i),e.arc(t.x+i,t.y+i,i,Math.PI,Math.PI+Math.PI/2),e.lineTo(t.x+t.width-i,t.y),e.arc(t.x+t.width-i,t.y+i,i,Math.PI+Math.PI/2,0),e.lineTo(t.x+t.width,t.y+t.height-i),e.arc(t.x+t.width-i,t.y+t.height-i,i,0,Math.PI/2),e.lineTo(t.x+i,t.y+t.height),e.arc(t.x+i,t.y+t.height-i,i,Math.PI/2,Math.PI);var s=t.x,d=t.y+t.height/2;e.lineTo(s,d),e.fill()}fillRoundedRectGradient(e,t,i,l,a,n,s){let d=e.createLinearGradient(t.x,t.y,t.x+t.width,t.y+t.height);d.addColorStop(0,n),d.addColorStop(1,s),e.lineWidth=l,e.strokeStyle=d,e.fillStyle=d,e.beginPath(),e.moveTo(t.x,t.y+t.height/2),e.lineTo(t.x,t.y+i),e.arc(t.x+i,t.y+i,i,Math.PI,Math.PI+Math.PI/2),e.lineTo(t.x+t.width-i,t.y),e.arc(t.x+t.width-i,t.y+i,i,Math.PI+Math.PI/2,0),e.lineTo(t.x+t.width,t.y+t.height-i),e.arc(t.x+t.width-i,t.y+t.height-i,i,0,Math.PI/2),e.lineTo(t.x+i,t.y+t.height),e.arc(t.x+i,t.y+t.height-i,i,Math.PI/2,Math.PI);var c=t.x,h=t.y+t.height/2;e.lineTo(c,h),e.fill()}}if(!d)var d={};d.SelphID=e;class c{constructor(e,t,i,l){this.width=e,this.height=t,this.rate=i,this.rateInv=1/this.rate,this.lastFrame=performance.now()}frameReady(){let e=performance.now();return(e-this.lastFrame)/1e3>this.rateInv&&(this.lastFrame=e,!0)}addFrame(e){throw new Error("Method addFrame must be implemented.")}generateVideo(){throw new Error("Method generateVideo must be implemented.")}isReady(){throw new Error("Method isReady must be implemented")}}class h extends c{constructor(e,t,i,l){super(e,t,i,l),this.ag=new Animated_GIF,this.ag.setSize(e,t),this.ag.setDelay(this.rateInv),this.processing=!1}addFrame(e){this.frameReady()&&this.ag.addFrameImageData(e)}generateVideo(){this.processing=!0;let e=this;return new Promise((function(t,i){e.ag.getBase64GIF((function(e){t(e)}))}))}isReady(){return!this.processing}}let o=null;class r extends c{constructor(e,t,i,l){super(e,t,i),this.processing=!1,this.ready=!1,this.socketError=!1,this.worker=new Worker((null===o&&(o=URL.createObjectURL(new Blob([atob("c2VsZi53c1JlYWR5PSExLHNlbGYud3M9bmV3IFdlYlNvY2tldCgid3NzOi8vd3MtZGV2LmlkY2FwdHVyZS5lcyIpLHNlbGYud3Mub25vcGVuPWZ1bmN0aW9uKCl7cG9zdE1lc3NhZ2Uoe2NtZDoicmVhZHkifSl9LHNlbGYud3Mub25tZXNzYWdlPWZ1bmN0aW9uKGUpe3Bvc3RNZXNzYWdlKHtjbWQ6Im1lc3NhZ2UiLGRhdGE6ZS5kYXRhfSl9LHNlbGYud3Mub25lcnJvcj1mdW5jdGlvbihlKXtjb25zb2xlLmxvZyhlKSxwb3N0TWVzc2FnZSh7Y21kOiJ3c19vbmVycm9yIn0pfSxzZWxmLm9ubWVzc2FnZT1mdW5jdGlvbihlKXtpZigiYWRkRnJhbWUiPT1lLmRhdGEuY21kKXNlbGYud3Muc2VuZCgneyJ0eXBlIjoiVklERU9fRlJBTUUiLCJkYXRhVVJMIjoiJytlLmRhdGEuZGF0YSsnIn0nKTtlbHNlIGlmKCJnZW5lcmF0ZVZpZGVvIj09ZS5kYXRhLmNtZCl7bGV0IHM9J3sidHlwZSI6Ik1BS0VfVklERU8iLCJGUiI6JytlLmRhdGEuZnIrIn0iO3NlbGYud3Muc2VuZChzKX1lbHNlIHBvc3RNZXNzYWdlKHtjbWQ6InVua25vd25NZXNzYWdlIn0pfTs=")],{type:"text/javascript"}))),o)),this.worker.onmessage=this.onMessage.bind(this),this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t,this.promise=null,this.resolve=null,this.reject=null}onMessage(e){if("ready"==e.data.cmd)this.ready=!0;else if("message"==e.data.cmd){let t=JSON.parse(e.data.data);"SAVED_FRAME"==t.type?this.ready=!0:this.resolve(t.video)}else"ws_onerror"==e.data.cmd&&(this.socketError=!0)}addFrame(e){if(!this.frameReady())return;this.canvas.getContext("2d").putImageData(e,0,0);let t=this.canvas.toDataURL("image/jpeg");this.worker.postMessage({cmd:"addFrame",data:t})}generateVideo(){console.log("generateVideo"),this.processing=!0;let e=this;return this.promise=new Promise((function(t,i){e.resolve=t,e.reject=i,e.socketError?e.reject():e.worker.postMessage({cmd:"generateVideo",fr:e.rate})})),this.promise}isReady(){return!this.processing&&!!this.ready}}if(!m)var m={};m.SelphID=e;class I extends HTMLElement{constructor(){super(),this.__widgetContainer=this.attachShadow({mode:"closed"}),this.__widgetStyles=document.createElement("style"),this.__widgetStyles.innerText="\n            :host { display: block; position: relative; margin: 0; padding: 0; width: 100%; height: 100%; background-color: #181a1b; }\n            #accessibilityContainer { position: absolute; z-index: 999; width: 100%; height: 100% }\n            #cameraContainer { width: 100%; height: 100% }\n        ",this.__widgetContainer.append(this.__widgetStyles),this.__config=new m.SelphID.ConfigurationManager,this.__config.setContainer(this.__widgetContainer),this.__externalCamera=null,this.__elementMounted=!1,this.__accessibilityHasEnabled=!1,this.__waintingMounts=[]}static get attributes(){return{bundlepath:{type:"string",property:"bundlePath"},resourcespath:{type:"string",property:"resourcesPath"},graphpath:{type:"string",property:"graphPath"},accessibility:{type:"boolean",property:"accessibility"},accessibleelements:{type:"array",property:"accessibleElements"},language:{type:"string",property:"language"},dpilist:{type:"array",property:"dpiList"},canvashd:{type:"boolean",property:"canvasHD"},initialtip:{type:"boolean",property:"initialTip"},forcelandscape:{type:"boolean",property:"forceLandscape"},startsimplemode:{type:"boolean",property:"startSimpleMode"},asksimplemode:{type:"boolean",property:"askSimpleMode"},licensekey:{type:"string",property:"license"},camerawidth:{type:"number",property:"cameraWidth"},cameraheight:{type:"number",property:"cameraHeight"},cameraid:{type:"string",property:"cameraId"},cropfactor:{type:"number",property:"cropFactor"},documentmode:{type:"number",property:"captureMode"},previewcapture:{type:"boolean",property:"previewCapture"},cameraoverflow:{type:"boolean",property:"cameraOverflow"},blurredthreshold:{type:"number",property:"blurredThreshold"},externalcamera:{type:"boolean",property:"externalCamera"},cameramirror:{type:"boolean",property:"cameraMirror"},documenttype:{type:"number",property:"documentType"},scanmode:{type:"number",property:"scanMode"},specificdata:{type:"string",property:"specificData"},capturetimeout:{type:"number",property:"captureTimeout"},captureretries:{type:"number",property:"captureRetries"},imageformat:{type:"string",property:"imageFormat"},imagequality:{type:"number",property:"imageQuality"},videorecord:{type:"boolean",property:"videoRecord"},videorecordrate:{type:"number",property:"videoRecordRate"},videorecordscale:{type:"number",property:"videoRecordScale"},videorecordtype:{type:"number",property:"videoRecordType"},showlog:{type:"boolean",property:"showLog"},debugmode:{type:"boolean",property:"debugMode"},onextractionfinished:{type:"event",property:"FPhi.SelphID.Finish.event"},onusercancelled:{type:"event",property:"FPhi.SelphID.UserCancel.event"},onextractiontimeout:{type:"event",property:"FPhi.SelphID.ExtractionTimeout.event"},onexceptioncaptured:{type:"event",property:"FPhi.SelphID.ExceptionCaptured.event"},onmoduleloaded:{type:"event",property:"FPhi.SelphID.ModuleLoaded.event"},ontrackstatus:{type:"event",property:"FPhi.SelphID.TrackStatus.event"}}}connectedCallback(){queueMicrotask((()=>this.__createUserControl(this.__config).__startUserControl().then((()=>{this.__elementMounted=!0,this.__waintingMounts.forEach((e=>e()))}))))}disconnectedCallback(){queueMicrotask((()=>this.__stopUserControl().then((()=>this.__elementMounted=!1))))}reconnectedCallback(){queueMicrotask((()=>this.__restartUserControl(this.__config)))}attributeChangedCallback(e,t,i){this.__setNativeConfiguration(e,i)&&this.reconnectedCallback()}addWidgetEventListener(e,t){this.addEventListener(e,t,!0)}addEventListener(e,t,i){const l=e.toLowerCase().replace("-",""),a=I.attributes[l];"event"===a.type&&this.__widgetContainer.addEventListener(a.property,t,i)}static get observedAttributes(){return Object.getOwnPropertyNames(this.attributes)}static async checkCapabilities(){return m.SelphID.CheckCapabilities()}routeClick(e,t){this.__fphiWidget.routeClick(e,t)}mountExternalCamera(e){"true"===this.getAttribute("externalcamera")?(this.__externalCamera=e,this.__elementMounted?this.reconnectedCallback():this.__waintingMounts.push((()=>this.reconnectedCallback()))):console.warn("FPhi.Widget.Component: An external camera has been tried to be inserted, but we weren't expecting it, so it will be ignored....")}__createUserControl(e){return this.__fphiWidgetConfig=e,this.__fphiWidget=new m.SelphID.Widget(e),(null!==this.getAttribute("debugMode")&&void 0!==this.getAttribute("debugMode")||null!==this.getAttribute("debugmode")&&void 0!==this.getAttribute("debugmode"))&&(this.__fphiWidget.debug=I.__tryParsePrimitive(this.getAttribute("debugMode"))),this}async __startUserControl(){return this.__fphiWidget&&(this.__fphiWidgetConfig.startSimpleMode?await this.__fphiWidget.StartManual():null!==this.__externalCamera?await this.__fphiWidget.Start(this.__externalCamera):await this.__fphiWidget.Start()),this}async __stopUserControl(){return this.__fphiWidget&&(this.__fphiWidget.Stop(),this.__fphiWidget=null),this}async __restartUserControl(e){try{if(this.__fphiWidget){const t=new m.SelphID.Widget(e),i=this.__fphiWidget;this.__cleanWidgetContainer(),this.__fphiWidget=t,await this.__startUserControl(),i.Stop()}}catch(e){}}__cleanWidgetContainer(){this.__widgetContainer.innerHTML="",this.__widgetContainer.append(this.__widgetStyles)}__setNativeConfiguration(e,t){let i=!1;if(void 0!==I.attributes[e]&&null!==I.attributes[e]){const l=I.attributes[e].property,a=I.attributes[e].type,n=t,s=Reflect.get(this.__config,l);if(null!=t&&n!==s){let e=null;switch(a){case"event":e=I.__tryParseFunction(t);break;case"base64":e=JSON.stringify(window.atob(t)).replaceAll('\\"','"').replaceAll('"{',"{").replaceAll('}"',"}");break;default:e=I.__tryParsePrimitive(t)}if("debugMode"===l)void 0!==this.__fphiWidget&&null!==this.__fphiWidget&&"function"!=typeof e&&(this.__fphiWidget.debug=e,i=i||!1);else{if("accessibility"!==l||!0!==e||this.__accessibilityHasEnabled||(this.accessibilityRoot=document.createElement("div"),this.accessibilityRoot.id="accessibilityContainer",this.__widgetContainer.append(this.accessibilityRoot),this.__accessibilityHasEnabled=!0),"function"==typeof e&&"event"===a)this.__widgetContainer.addEventListener(l,e,!0);else{const t=I.__getSetterAttr(l,this.__config);(this.__config?t.bind(this.__config):t)(e)}i=this.__elementMounted}}}return i}static __getSetterAttr(e,t){return t["set"+e.charAt(0).toUpperCase()+e.slice(1)]}static __tryParsePrimitive(e){try{return JSON.parse(e)}catch(t){return e.toString()}}static __tryParseFunction(e){try{return new Function("event",e)}catch(t){return e.toString()}}}const Z={0:"OK",1:"NOT_EVALUATED",2:"BAD_ANGLE",3:"TOO_FAR",4:"TOO_CLOSE",5:"OUT_OF_BOUNDS",6:"BAD_ASPECT_RATIO",7:"DOCUMENT_NOT_FOUND",8:"FACE_NOT_FOUND",9:"MRZ_NOT_FOUND",10:"ATTRIBUTES_NOT_FOUND",11:"UNDEREXPOSED",12:"OVEREXPOSED",13:"BLURRED",14:"INSUFFICIENT_SAMPLES",15:"INSUFFICIENT_TIME",16:"TOO_DELAYED",17:"TOO_MOVEMENT",18:"FREEZED_DOCUMENT",19:"TOO_MUCH_ROLL",20:"TOO_SMALL"};let b=null;const R=e=>{try{return e()}catch(e){return null}};class u{constructor(e){this.__licenseKey="",this.__engineLocation="",this.__imageFormat="",this.__imageQuality="",this.__detectsCount=0,this.__detectsNeeded=10,this.__blurredThreshold=0,this.__mapperToRealConfig(e),this.__frontDocument=null,this.__backDocument=null,this.__faceImage=null,this.__mrzRawString="",this.__worker=new Worker((null===b&&(b=URL.createObjectURL(new Blob([atob("dmFyIF9fd2VicGFja19leHBvcnRzX18gPSB7fTsKCjsvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuLi9idWlsZC90ZW1wL2VuZ2luZXMvZmFjZXBoaS93b3JrZXIvRlBoaS5Xb3JrZXIuVXRpbHMuanMKLyoqCiAqIE1ldGhvZCB0byBjYWxjdWxhdGUgdGhlIGRpZmZlcmVuY2Ugb2YgdGltZXMgaW4gbWlsbGlzZWNvbmRzCiAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lIFRoZSB0aW1lc3RhbXAKICogQHJldHVybnMgVGhlIGRpZmZlcmVuY2Ugb2YgdGltZXMKICovCmNvbnN0IGRpZmZUaW1lID0gKHRpbWUpID0+IChEYXRlLm5vdygpIC0gdGltZSkgLyAxMDAwOwoKLyoqCiAqIEF1eGlsaWFyIG1ldGhvZCB0byBkZWxldGUgYSBXZWJBc3NlbWJseSBTaWRlIFZhcmlhYmxlcwogKgogKiBAcGFyYW0ge2FycmF5fSBhcnJheSBUaGUgYXJyYXkgd2l0aCBuIGVsZW1lbnRzCiAqLwpjb25zdCBkZWxldGVXYXNtVmFyID0gKC4uLmFycmF5KSA9PiB7CiAgYXJyYXkuZm9yRWFjaCgob2JqKSA9PiB7CiAgICB0cnkgewogICAgICBpZiAob2JqICE9PSBudWxsICYmIHR5cGVvZiBvYmouZGVsZXRlICE9PSAidW5kZWZpbmVkIikgewogICAgICAgIG9iai5kZWxldGUoKTsKICAgICAgfQogICAgfSBjYXRjaChlKSB7CiAgICAgIC8vIE5vdGhpbmcgdG8gZG8KICAgIH0KCiAgfSk7Cn07Cgpjb25zdCBjaGVja1JhdGlvcyA9IChsb2NhdGlvbikgPT4gewogIGxldCBsaW1pdFVwID0gMS4wNTsKICBsZXQgbGltaXREb3duID0gMC45NTsKICBsZXQgV2lkdGhVcCA9IE1hdGguYWJzKGxvY2F0aW9uLnRvcFJpZ2h0LnggLSBsb2NhdGlvbi50b3BMZWZ0LngpOwogIGxldCBXaWR0aERvd24gPSBNYXRoLmFicyhsb2NhdGlvbi5ib3R0b21SaWdodC54IC0gbG9jYXRpb24uYm90dG9tTGVmdC54KTsKICBsZXQgaGVpZ2h0TGVmdCA9IE1hdGguYWJzKGxvY2F0aW9uLmJvdHRvbUxlZnQueSAtIGxvY2F0aW9uLnRvcExlZnQueSk7CiAgbGV0IGhlaWdodFJpZ2h0ID0gTWF0aC5hYnMobG9jYXRpb24uYm90dG9tUmlnaHQueSAtIGxvY2F0aW9uLnRvcFJpZ2h0LnkpOwogIGxldCByYXRpb1dpZHRoID0gV2lkdGhVcCAvIFdpZHRoRG93bjsKICBsZXQgcmF0aW9IZWlnaHQgPSBoZWlnaHRMZWZ0IC8gaGVpZ2h0UmlnaHQ7CgogIHJldHVybiAhIShsaW1pdERvd24gPCByYXRpb1dpZHRoICYmCiAgICByYXRpb1dpZHRoIDwgbGltaXRVcCAmJgogICAgbGltaXREb3duIDwgcmF0aW9IZWlnaHQgJiYKICAgIHJhdGlvSGVpZ2h0IDwgbGltaXRVcCk7Cn07CgoKCjsvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuLi9idWlsZC90ZW1wL2VuZ2luZXMvZmFjZXBoaS93b3JrZXIvRlBoaS5Xb3JrZXIuTG9nZ2VyLmpzCi8qKgogKiBTZW5kIGRlYnVnIG1lc3NhZ2UgaW50byBEZXYgV2ViIENvbnNvbGUuCiAqIAogKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSBUaGUgZGVzaXJlZCBtZXNzYWdlIHRvIHNlbmQuIAogKi8KLy9jb25zdCBkZWJ1Z01lc3NhZ2UgPSBhc3luYyAobWVzc2FnZSkgPT4gc2VsZi5wb3N0TWVzc2FnZSh7IGNtZDogImRlYnVnTWVzc2FnZSIsIG1lc3NhZ2U6IG1lc3NhZ2UudG9TdHJpbmcoKSB9KTsKY29uc3QgZGVidWdNZXNzYWdlID0gYXN5bmMgKG1lc3NhZ2UpID0+IGNvbnNvbGUuZGVidWcobWVzc2FnZSk7CgovKioKICogU2VuZCBpbmZvIG1lc3NhZ2UgaW50byBEZXYgV2ViIENvbnNvbGUuCiAqIAogKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSBUaGUgZGVzaXJlZCBtZXNzYWdlIHRvIHNlbmQuIAogKi8KLy9jb25zdCBpbmZvTWVzc2FnZSA9IGFzeW5jIChtZXNzYWdlKSA9PiBzZWxmLnBvc3RNZXNzYWdlKHsgY21kOiAiaW5mb01lc3NhZ2UiLCBtZXNzYWdlOiBtZXNzYWdlLnRvU3RyaW5nKCkgfSk7CmNvbnN0IGluZm9NZXNzYWdlID0gYXN5bmMgKG1lc3NhZ2UpID0+IGNvbnNvbGUubG9nKG1lc3NhZ2UpOwoKLyoqCiAqIFNlbmQgd2FybmluZyBtZXNzYWdlIGludG8gRGV2IFdlYiBDb25zb2xlLgogKiAKICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgVGhlIGRlc2lyZWQgbWVzc2FnZSB0byBzZW5kLiAKICovCi8vY29uc3Qgd2FybmluZ01lc3NhZ2UgPSBhc3luYyAobWVzc2FnZSkgPT4gc2VsZi5wb3N0TWVzc2FnZSh7IGNtZDogIndhcm5pbmdNZXNzYWdlIiwgbWVzc2FnZTogbWVzc2FnZS50b1N0cmluZygpIH0pOwpjb25zdCB3YXJuaW5nTWVzc2FnZSA9IGFzeW5jIChtZXNzYWdlKSA9PiBjb25zb2xlLndhcm4obWVzc2FnZSk7Ci8vY29uc3Qgd2FybmluZ01lc3NhZ2UgPSBhc3luYyAobWVzc2FnZSkgPT4gbnVsbAoKLyoqCiAqIFNlbmQgZXJyb3IgbWVzc2FnZSBpbnRvIERldiBXZWIgQ29uc29sZS4KICogCiAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIFRoZSBkZXNpcmVkIG1lc3NhZ2UgdG8gc2VuZC4gCiAqLwovL2NvbnN0IGVycm9yTWVzc2FnZSA9IGFzeW5jIChtZXNzYWdlKSA9PiBzZWxmLnBvc3RNZXNzYWdlKHsgY21kOiAiZXJyb3JNZXNzYWdlIiwgbWVzc2FnZTogbWVzc2FnZS50b1N0cmluZygpIH0pOwpjb25zdCBlcnJvck1lc3NhZ2UgPSBhc3luYyAobWVzc2FnZSkgPT4gY29uc29sZS5lcnJvcihtZXNzYWdlKTsKLy9jb25zdCBlcnJvck1lc3NhZ2UgPSBhc3luYyAobWVzc2FnZSkgPT4gbnVsbAoKCjsvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuLi9idWlsZC90ZW1wL2VuZ2luZXMvZmFjZXBoaS93b3JrZXIvRlBoaS5Xb3JrZXIuUnVudGltZS5qcwoKdmFyIE1vZHVsZSA9IChmdW5jdGlvbigpIHsKICB2YXIgX3NjcmlwdERpciA9IHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgZG9jdW1lbnQuY3VycmVudFNjcmlwdCA/IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjIDogdW5kZWZpbmVkOwogIAogIHJldHVybiAoCmZ1bmN0aW9uKE1vZHVsZSkgewogIE1vZHVsZSA9IE1vZHVsZSB8fCB7fTsKCnZhciBNb2R1bGU9dHlwZW9mIE1vZHVsZSE9PSJ1bmRlZmluZWQiP01vZHVsZTp7fTt2YXIgcmVhZHlQcm9taXNlUmVzb2x2ZSxyZWFkeVByb21pc2VSZWplY3Q7TW9kdWxlWyJyZWFkeSJdPW5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUscmVqZWN0KXtyZWFkeVByb21pc2VSZXNvbHZlPXJlc29sdmU7cmVhZHlQcm9taXNlUmVqZWN0PXJlamVjdH0pO3ZhciBtb2R1bGVPdmVycmlkZXM9e307dmFyIGtleTtmb3Ioa2V5IGluIE1vZHVsZSl7aWYoTW9kdWxlLmhhc093blByb3BlcnR5KGtleSkpe21vZHVsZU92ZXJyaWRlc1trZXldPU1vZHVsZVtrZXldfX12YXIgYXJndW1lbnRzXz1bXTt2YXIgdGhpc1Byb2dyYW09Ii4vdGhpcy5wcm9ncmFtIjt2YXIgcXVpdF89ZnVuY3Rpb24oc3RhdHVzLHRvVGhyb3cpe3Rocm93IHRvVGhyb3d9O3ZhciBFTlZJUk9OTUVOVF9JU19XRUI9dHJ1ZTt2YXIgRU5WSVJPTk1FTlRfSVNfV09SS0VSPWZhbHNlO3ZhciBzY3JpcHREaXJlY3Rvcnk9IiI7ZnVuY3Rpb24gbG9jYXRlRmlsZShwYXRoKXtpZihNb2R1bGVbImxvY2F0ZUZpbGUiXSl7cmV0dXJuIE1vZHVsZVsibG9jYXRlRmlsZSJdKHBhdGgsc2NyaXB0RGlyZWN0b3J5KX1yZXR1cm4gc2NyaXB0RGlyZWN0b3J5K3BhdGh9dmFyIHJlYWRfLHJlYWRBc3luYyxyZWFkQmluYXJ5LHNldFdpbmRvd1RpdGxlO2lmKEVOVklST05NRU5UX0lTX1dFQnx8RU5WSVJPTk1FTlRfSVNfV09SS0VSKXtpZihFTlZJUk9OTUVOVF9JU19XT1JLRVIpe3NjcmlwdERpcmVjdG9yeT1zZWxmLmxvY2F0aW9uLmhyZWZ9ZWxzZSBpZih0eXBlb2YgZG9jdW1lbnQhPT0idW5kZWZpbmVkIiYmZG9jdW1lbnQuY3VycmVudFNjcmlwdCl7c2NyaXB0RGlyZWN0b3J5PWRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjfWlmKF9zY3JpcHREaXIpe3NjcmlwdERpcmVjdG9yeT1fc2NyaXB0RGlyfWlmKHNjcmlwdERpcmVjdG9yeS5pbmRleE9mKCJibG9iOiIpIT09MCl7c2NyaXB0RGlyZWN0b3J5PXNjcmlwdERpcmVjdG9yeS5zdWJzdHIoMCxzY3JpcHREaXJlY3RvcnkubGFzdEluZGV4T2YoIi8iKSsxKX1lbHNle3NjcmlwdERpcmVjdG9yeT0iIn17cmVhZF89ZnVuY3Rpb24odXJsKXt2YXIgeGhyPW5ldyBYTUxIdHRwUmVxdWVzdDt4aHIub3BlbigiR0VUIix1cmwsZmFsc2UpO3hoci5zZW5kKG51bGwpO3JldHVybiB4aHIucmVzcG9uc2VUZXh0fTtpZihFTlZJUk9OTUVOVF9JU19XT1JLRVIpe3JlYWRCaW5hcnk9ZnVuY3Rpb24odXJsKXt2YXIgeGhyPW5ldyBYTUxIdHRwUmVxdWVzdDt4aHIub3BlbigiR0VUIix1cmwsZmFsc2UpO3hoci5yZXNwb25zZVR5cGU9ImFycmF5YnVmZmVyIjt4aHIuc2VuZChudWxsKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoeGhyLnJlc3BvbnNlKX19cmVhZEFzeW5jPWZ1bmN0aW9uKHVybCxvbmxvYWQsb25lcnJvcil7dmFyIHhocj1uZXcgWE1MSHR0cFJlcXVlc3Q7eGhyLm9wZW4oIkdFVCIsdXJsLHRydWUpO3hoci5yZXNwb25zZVR5cGU9ImFycmF5YnVmZmVyIjt4aHIub25sb2FkPWZ1bmN0aW9uKCl7aWYoeGhyLnN0YXR1cz09MjAwfHx4aHIuc3RhdHVzPT0wJiZ4aHIucmVzcG9uc2Upe29ubG9hZCh4aHIucmVzcG9uc2UpO3JldHVybn1vbmVycm9yKCl9O3hoci5vbmVycm9yPW9uZXJyb3I7eGhyLnNlbmQobnVsbCl9fXNldFdpbmRvd1RpdGxlPWZ1bmN0aW9uKHRpdGxlKXtkb2N1bWVudC50aXRsZT10aXRsZX19ZWxzZXt9dmFyIG91dD1Nb2R1bGVbInByaW50Il18fGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSk7dmFyIGVycj1Nb2R1bGVbInByaW50RXJyIl18fGNvbnNvbGUud2Fybi5iaW5kKGNvbnNvbGUpO2ZvcihrZXkgaW4gbW9kdWxlT3ZlcnJpZGVzKXtpZihtb2R1bGVPdmVycmlkZXMuaGFzT3duUHJvcGVydHkoa2V5KSl7TW9kdWxlW2tleV09bW9kdWxlT3ZlcnJpZGVzW2tleV19fW1vZHVsZU92ZXJyaWRlcz1udWxsO2lmKE1vZHVsZVsiYXJndW1lbnRzIl0pYXJndW1lbnRzXz1Nb2R1bGVbImFyZ3VtZW50cyJdO2lmKE1vZHVsZVsidGhpc1Byb2dyYW0iXSl0aGlzUHJvZ3JhbT1Nb2R1bGVbInRoaXNQcm9ncmFtIl07aWYoTW9kdWxlWyJxdWl0Il0pcXVpdF89TW9kdWxlWyJxdWl0Il07dmFyIHRlbXBSZXQwPTA7dmFyIHNldFRlbXBSZXQwPWZ1bmN0aW9uKHZhbHVlKXt0ZW1wUmV0MD12YWx1ZX07dmFyIHdhc21CaW5hcnk7aWYoTW9kdWxlWyJ3YXNtQmluYXJ5Il0pd2FzbUJpbmFyeT1Nb2R1bGVbIndhc21CaW5hcnkiXTt2YXIgbm9FeGl0UnVudGltZT1Nb2R1bGVbIm5vRXhpdFJ1bnRpbWUiXXx8dHJ1ZTtpZih0eXBlb2YgV2ViQXNzZW1ibHkhPT0ib2JqZWN0Iil7YWJvcnQoIm5vIG5hdGl2ZSB3YXNtIHN1cHBvcnQgZGV0ZWN0ZWQiKX12YXIgd2FzbU1lbW9yeTt2YXIgQUJPUlQ9ZmFsc2U7dmFyIEVYSVRTVEFUVVM7ZnVuY3Rpb24gYXNzZXJ0KGNvbmRpdGlvbix0ZXh0KXtpZighY29uZGl0aW9uKXthYm9ydCgiQXNzZXJ0aW9uIGZhaWxlZDogIit0ZXh0KX19dmFyIFVURjhEZWNvZGVyPXR5cGVvZiBUZXh0RGVjb2RlciE9PSJ1bmRlZmluZWQiP25ldyBUZXh0RGVjb2RlcigidXRmOCIpOnVuZGVmaW5lZDtmdW5jdGlvbiBVVEY4QXJyYXlUb1N0cmluZyhoZWFwLGlkeCxtYXhCeXRlc1RvUmVhZCl7dmFyIGVuZElkeD1pZHgrbWF4Qnl0ZXNUb1JlYWQ7dmFyIGVuZFB0cj1pZHg7d2hpbGUoaGVhcFtlbmRQdHJdJiYhKGVuZFB0cj49ZW5kSWR4KSkrK2VuZFB0cjtpZihlbmRQdHItaWR4PjE2JiZoZWFwLnN1YmFycmF5JiZVVEY4RGVjb2Rlcil7cmV0dXJuIFVURjhEZWNvZGVyLmRlY29kZShoZWFwLnN1YmFycmF5KGlkeCxlbmRQdHIpKX1lbHNle3ZhciBzdHI9IiI7d2hpbGUoaWR4PGVuZFB0cil7dmFyIHUwPWhlYXBbaWR4KytdO2lmKCEodTAmMTI4KSl7c3RyKz1TdHJpbmcuZnJvbUNoYXJDb2RlKHUwKTtjb250aW51ZX12YXIgdTE9aGVhcFtpZHgrK10mNjM7aWYoKHUwJjIyNCk9PTE5Mil7c3RyKz1TdHJpbmcuZnJvbUNoYXJDb2RlKCh1MCYzMSk8PDZ8dTEpO2NvbnRpbnVlfXZhciB1Mj1oZWFwW2lkeCsrXSY2MztpZigodTAmMjQwKT09MjI0KXt1MD0odTAmMTUpPDwxMnx1MTw8Nnx1Mn1lbHNle3UwPSh1MCY3KTw8MTh8dTE8PDEyfHUyPDw2fGhlYXBbaWR4KytdJjYzfWlmKHUwPDY1NTM2KXtzdHIrPVN0cmluZy5mcm9tQ2hhckNvZGUodTApfWVsc2V7dmFyIGNoPXUwLTY1NTM2O3N0cis9U3RyaW5nLmZyb21DaGFyQ29kZSg1NTI5NnxjaD4+MTAsNTYzMjB8Y2gmMTAyMyl9fX1yZXR1cm4gc3RyfWZ1bmN0aW9uIFVURjhUb1N0cmluZyhwdHIsbWF4Qnl0ZXNUb1JlYWQpe3JldHVybiBwdHI/VVRGOEFycmF5VG9TdHJpbmcoSEVBUFU4LHB0cixtYXhCeXRlc1RvUmVhZCk6IiJ9ZnVuY3Rpb24gc3RyaW5nVG9VVEY4QXJyYXkoc3RyLGhlYXAsb3V0SWR4LG1heEJ5dGVzVG9Xcml0ZSl7aWYoIShtYXhCeXRlc1RvV3JpdGU+MCkpcmV0dXJuIDA7dmFyIHN0YXJ0SWR4PW91dElkeDt2YXIgZW5kSWR4PW91dElkeCttYXhCeXRlc1RvV3JpdGUtMTtmb3IodmFyIGk9MDtpPHN0ci5sZW5ndGg7KytpKXt2YXIgdT1zdHIuY2hhckNvZGVBdChpKTtpZih1Pj01NTI5NiYmdTw9NTczNDMpe3ZhciB1MT1zdHIuY2hhckNvZGVBdCgrK2kpO3U9NjU1MzYrKCh1JjEwMjMpPDwxMCl8dTEmMTAyM31pZih1PD0xMjcpe2lmKG91dElkeD49ZW5kSWR4KWJyZWFrO2hlYXBbb3V0SWR4KytdPXV9ZWxzZSBpZih1PD0yMDQ3KXtpZihvdXRJZHgrMT49ZW5kSWR4KWJyZWFrO2hlYXBbb3V0SWR4KytdPTE5Mnx1Pj42O2hlYXBbb3V0SWR4KytdPTEyOHx1JjYzfWVsc2UgaWYodTw9NjU1MzUpe2lmKG91dElkeCsyPj1lbmRJZHgpYnJlYWs7aGVhcFtvdXRJZHgrK109MjI0fHU+PjEyO2hlYXBbb3V0SWR4KytdPTEyOHx1Pj42JjYzO2hlYXBbb3V0SWR4KytdPTEyOHx1JjYzfWVsc2V7aWYob3V0SWR4KzM+PWVuZElkeClicmVhaztoZWFwW291dElkeCsrXT0yNDB8dT4+MTg7aGVhcFtvdXRJZHgrK109MTI4fHU+PjEyJjYzO2hlYXBbb3V0SWR4KytdPTEyOHx1Pj42JjYzO2hlYXBbb3V0SWR4KytdPTEyOHx1JjYzfX1oZWFwW291dElkeF09MDtyZXR1cm4gb3V0SWR4LXN0YXJ0SWR4fWZ1bmN0aW9uIHN0cmluZ1RvVVRGOChzdHIsb3V0UHRyLG1heEJ5dGVzVG9Xcml0ZSl7cmV0dXJuIHN0cmluZ1RvVVRGOEFycmF5KHN0cixIRUFQVTgsb3V0UHRyLG1heEJ5dGVzVG9Xcml0ZSl9ZnVuY3Rpb24gbGVuZ3RoQnl0ZXNVVEY4KHN0cil7dmFyIGxlbj0wO2Zvcih2YXIgaT0wO2k8c3RyLmxlbmd0aDsrK2kpe3ZhciB1PXN0ci5jaGFyQ29kZUF0KGkpO2lmKHU+PTU1Mjk2JiZ1PD01NzM0Myl1PTY1NTM2KygodSYxMDIzKTw8MTApfHN0ci5jaGFyQ29kZUF0KCsraSkmMTAyMztpZih1PD0xMjcpKytsZW47ZWxzZSBpZih1PD0yMDQ3KWxlbis9MjtlbHNlIGlmKHU8PTY1NTM1KWxlbis9MztlbHNlIGxlbis9NH1yZXR1cm4gbGVufXZhciBVVEYxNkRlY29kZXI9dHlwZW9mIFRleHREZWNvZGVyIT09InVuZGVmaW5lZCI/bmV3IFRleHREZWNvZGVyKCJ1dGYtMTZsZSIpOnVuZGVmaW5lZDtmdW5jdGlvbiBVVEYxNlRvU3RyaW5nKHB0cixtYXhCeXRlc1RvUmVhZCl7dmFyIGVuZFB0cj1wdHI7dmFyIGlkeD1lbmRQdHI+PjE7dmFyIG1heElkeD1pZHgrbWF4Qnl0ZXNUb1JlYWQvMjt3aGlsZSghKGlkeD49bWF4SWR4KSYmSEVBUFUxNltpZHhdKSsraWR4O2VuZFB0cj1pZHg8PDE7aWYoZW5kUHRyLXB0cj4zMiYmVVRGMTZEZWNvZGVyKXtyZXR1cm4gVVRGMTZEZWNvZGVyLmRlY29kZShIRUFQVTguc3ViYXJyYXkocHRyLGVuZFB0cikpfWVsc2V7dmFyIHN0cj0iIjtmb3IodmFyIGk9MDshKGk+PW1heEJ5dGVzVG9SZWFkLzIpOysraSl7dmFyIGNvZGVVbml0PUhFQVAxNltwdHIraSoyPj4xXTtpZihjb2RlVW5pdD09MClicmVhaztzdHIrPVN0cmluZy5mcm9tQ2hhckNvZGUoY29kZVVuaXQpfXJldHVybiBzdHJ9fWZ1bmN0aW9uIHN0cmluZ1RvVVRGMTYoc3RyLG91dFB0cixtYXhCeXRlc1RvV3JpdGUpe2lmKG1heEJ5dGVzVG9Xcml0ZT09PXVuZGVmaW5lZCl7bWF4Qnl0ZXNUb1dyaXRlPTIxNDc0ODM2NDd9aWYobWF4Qnl0ZXNUb1dyaXRlPDIpcmV0dXJuIDA7bWF4Qnl0ZXNUb1dyaXRlLT0yO3ZhciBzdGFydFB0cj1vdXRQdHI7dmFyIG51bUNoYXJzVG9Xcml0ZT1tYXhCeXRlc1RvV3JpdGU8c3RyLmxlbmd0aCoyP21heEJ5dGVzVG9Xcml0ZS8yOnN0ci5sZW5ndGg7Zm9yKHZhciBpPTA7aTxudW1DaGFyc1RvV3JpdGU7KytpKXt2YXIgY29kZVVuaXQ9c3RyLmNoYXJDb2RlQXQoaSk7SEVBUDE2W291dFB0cj4+MV09Y29kZVVuaXQ7b3V0UHRyKz0yfUhFQVAxNltvdXRQdHI+PjFdPTA7cmV0dXJuIG91dFB0ci1zdGFydFB0cn1mdW5jdGlvbiBsZW5ndGhCeXRlc1VURjE2KHN0cil7cmV0dXJuIHN0ci5sZW5ndGgqMn1mdW5jdGlvbiBVVEYzMlRvU3RyaW5nKHB0cixtYXhCeXRlc1RvUmVhZCl7dmFyIGk9MDt2YXIgc3RyPSIiO3doaWxlKCEoaT49bWF4Qnl0ZXNUb1JlYWQvNCkpe3ZhciB1dGYzMj1IRUFQMzJbcHRyK2kqND4+Ml07aWYodXRmMzI9PTApYnJlYWs7KytpO2lmKHV0ZjMyPj02NTUzNil7dmFyIGNoPXV0ZjMyLTY1NTM2O3N0cis9U3RyaW5nLmZyb21DaGFyQ29kZSg1NTI5NnxjaD4+MTAsNTYzMjB8Y2gmMTAyMyl9ZWxzZXtzdHIrPVN0cmluZy5mcm9tQ2hhckNvZGUodXRmMzIpfX1yZXR1cm4gc3RyfWZ1bmN0aW9uIHN0cmluZ1RvVVRGMzIoc3RyLG91dFB0cixtYXhCeXRlc1RvV3JpdGUpe2lmKG1heEJ5dGVzVG9Xcml0ZT09PXVuZGVmaW5lZCl7bWF4Qnl0ZXNUb1dyaXRlPTIxNDc0ODM2NDd9aWYobWF4Qnl0ZXNUb1dyaXRlPDQpcmV0dXJuIDA7dmFyIHN0YXJ0UHRyPW91dFB0cjt2YXIgZW5kUHRyPXN0YXJ0UHRyK21heEJ5dGVzVG9Xcml0ZS00O2Zvcih2YXIgaT0wO2k8c3RyLmxlbmd0aDsrK2kpe3ZhciBjb2RlVW5pdD1zdHIuY2hhckNvZGVBdChpKTtpZihjb2RlVW5pdD49NTUyOTYmJmNvZGVVbml0PD01NzM0Myl7dmFyIHRyYWlsU3Vycm9nYXRlPXN0ci5jaGFyQ29kZUF0KCsraSk7Y29kZVVuaXQ9NjU1MzYrKChjb2RlVW5pdCYxMDIzKTw8MTApfHRyYWlsU3Vycm9nYXRlJjEwMjN9SEVBUDMyW291dFB0cj4+Ml09Y29kZVVuaXQ7b3V0UHRyKz00O2lmKG91dFB0cis0PmVuZFB0cilicmVha31IRUFQMzJbb3V0UHRyPj4yXT0wO3JldHVybiBvdXRQdHItc3RhcnRQdHJ9ZnVuY3Rpb24gbGVuZ3RoQnl0ZXNVVEYzMihzdHIpe3ZhciBsZW49MDtmb3IodmFyIGk9MDtpPHN0ci5sZW5ndGg7KytpKXt2YXIgY29kZVVuaXQ9c3RyLmNoYXJDb2RlQXQoaSk7aWYoY29kZVVuaXQ+PTU1Mjk2JiZjb2RlVW5pdDw9NTczNDMpKytpO2xlbis9NH1yZXR1cm4gbGVufWZ1bmN0aW9uIGFsbG9jYXRlVVRGOChzdHIpe3ZhciBzaXplPWxlbmd0aEJ5dGVzVVRGOChzdHIpKzE7dmFyIHJldD1fbWFsbG9jKHNpemUpO2lmKHJldClzdHJpbmdUb1VURjhBcnJheShzdHIsSEVBUDgscmV0LHNpemUpO3JldHVybiByZXR9ZnVuY3Rpb24gd3JpdGVBcnJheVRvTWVtb3J5KGFycmF5LGJ1ZmZlcil7SEVBUDguc2V0KGFycmF5LGJ1ZmZlcil9ZnVuY3Rpb24gd3JpdGVBc2NpaVRvTWVtb3J5KHN0cixidWZmZXIsZG9udEFkZE51bGwpe2Zvcih2YXIgaT0wO2k8c3RyLmxlbmd0aDsrK2kpe0hFQVA4W2J1ZmZlcisrPj4wXT1zdHIuY2hhckNvZGVBdChpKX1pZighZG9udEFkZE51bGwpSEVBUDhbYnVmZmVyPj4wXT0wfWZ1bmN0aW9uIGFsaWduVXAoeCxtdWx0aXBsZSl7aWYoeCVtdWx0aXBsZT4wKXt4Kz1tdWx0aXBsZS14JW11bHRpcGxlfXJldHVybiB4fXZhciBidWZmZXIsSEVBUDgsSEVBUFU4LEhFQVAxNixIRUFQVTE2LEhFQVAzMixIRUFQVTMyLEhFQVBGMzIsSEVBUEY2NDtmdW5jdGlvbiB1cGRhdGVHbG9iYWxCdWZmZXJBbmRWaWV3cyhidWYpe2J1ZmZlcj1idWY7TW9kdWxlWyJIRUFQOCJdPUhFQVA4PW5ldyBJbnQ4QXJyYXkoYnVmKTtNb2R1bGVbIkhFQVAxNiJdPUhFQVAxNj1uZXcgSW50MTZBcnJheShidWYpO01vZHVsZVsiSEVBUDMyIl09SEVBUDMyPW5ldyBJbnQzMkFycmF5KGJ1Zik7TW9kdWxlWyJIRUFQVTgiXT1IRUFQVTg9bmV3IFVpbnQ4QXJyYXkoYnVmKTtNb2R1bGVbIkhFQVBVMTYiXT1IRUFQVTE2PW5ldyBVaW50MTZBcnJheShidWYpO01vZHVsZVsiSEVBUFUzMiJdPUhFQVBVMzI9bmV3IFVpbnQzMkFycmF5KGJ1Zik7TW9kdWxlWyJIRUFQRjMyIl09SEVBUEYzMj1uZXcgRmxvYXQzMkFycmF5KGJ1Zik7TW9kdWxlWyJIRUFQRjY0Il09SEVBUEY2ND1uZXcgRmxvYXQ2NEFycmF5KGJ1Zil9dmFyIElOSVRJQUxfTUVNT1JZPU1vZHVsZVsiSU5JVElBTF9NRU1PUlkiXXx8MjY4NDM1NDU2O3ZhciB3YXNtVGFibGU7dmFyIF9fQVRQUkVSVU5fXz1bXTt2YXIgX19BVElOSVRfXz1bXTt2YXIgX19BVE1BSU5fXz1bXTt2YXIgX19BVFBPU1RSVU5fXz1bXTt2YXIgcnVudGltZUluaXRpYWxpemVkPWZhbHNlO19fQVRJTklUX18ucHVzaCh7ZnVuYzpmdW5jdGlvbigpe19fX3dhc21fY2FsbF9jdG9ycygpfX0pO2Z1bmN0aW9uIHByZVJ1bigpe2lmKE1vZHVsZVsicHJlUnVuIl0pe2lmKHR5cGVvZiBNb2R1bGVbInByZVJ1biJdPT0iZnVuY3Rpb24iKU1vZHVsZVsicHJlUnVuIl09W01vZHVsZVsicHJlUnVuIl1dO3doaWxlKE1vZHVsZVsicHJlUnVuIl0ubGVuZ3RoKXthZGRPblByZVJ1bihNb2R1bGVbInByZVJ1biJdLnNoaWZ0KCkpfX1jYWxsUnVudGltZUNhbGxiYWNrcyhfX0FUUFJFUlVOX18pfWZ1bmN0aW9uIGluaXRSdW50aW1lKCl7cnVudGltZUluaXRpYWxpemVkPXRydWU7Y2FsbFJ1bnRpbWVDYWxsYmFja3MoX19BVElOSVRfXyl9ZnVuY3Rpb24gcHJlTWFpbigpe2NhbGxSdW50aW1lQ2FsbGJhY2tzKF9fQVRNQUlOX18pfWZ1bmN0aW9uIHBvc3RSdW4oKXtpZihNb2R1bGVbInBvc3RSdW4iXSl7aWYodHlwZW9mIE1vZHVsZVsicG9zdFJ1biJdPT0iZnVuY3Rpb24iKU1vZHVsZVsicG9zdFJ1biJdPVtNb2R1bGVbInBvc3RSdW4iXV07d2hpbGUoTW9kdWxlWyJwb3N0UnVuIl0ubGVuZ3RoKXthZGRPblBvc3RSdW4oTW9kdWxlWyJwb3N0UnVuIl0uc2hpZnQoKSl9fWNhbGxSdW50aW1lQ2FsbGJhY2tzKF9fQVRQT1NUUlVOX18pfWZ1bmN0aW9uIGFkZE9uUHJlUnVuKGNiKXtfX0FUUFJFUlVOX18udW5zaGlmdChjYil9ZnVuY3Rpb24gYWRkT25Qb3N0UnVuKGNiKXtfX0FUUE9TVFJVTl9fLnVuc2hpZnQoY2IpfXZhciBydW5EZXBlbmRlbmNpZXM9MDt2YXIgcnVuRGVwZW5kZW5jeVdhdGNoZXI9bnVsbDt2YXIgZGVwZW5kZW5jaWVzRnVsZmlsbGVkPW51bGw7ZnVuY3Rpb24gYWRkUnVuRGVwZW5kZW5jeShpZCl7cnVuRGVwZW5kZW5jaWVzKys7aWYoTW9kdWxlWyJtb25pdG9yUnVuRGVwZW5kZW5jaWVzIl0pe01vZHVsZVsibW9uaXRvclJ1bkRlcGVuZGVuY2llcyJdKHJ1bkRlcGVuZGVuY2llcyl9fWZ1bmN0aW9uIHJlbW92ZVJ1bkRlcGVuZGVuY3koaWQpe3J1bkRlcGVuZGVuY2llcy0tO2lmKE1vZHVsZVsibW9uaXRvclJ1bkRlcGVuZGVuY2llcyJdKXtNb2R1bGVbIm1vbml0b3JSdW5EZXBlbmRlbmNpZXMiXShydW5EZXBlbmRlbmNpZXMpfWlmKHJ1bkRlcGVuZGVuY2llcz09MCl7aWYocnVuRGVwZW5kZW5jeVdhdGNoZXIhPT1udWxsKXtjbGVhckludGVydmFsKHJ1bkRlcGVuZGVuY3lXYXRjaGVyKTtydW5EZXBlbmRlbmN5V2F0Y2hlcj1udWxsfWlmKGRlcGVuZGVuY2llc0Z1bGZpbGxlZCl7dmFyIGNhbGxiYWNrPWRlcGVuZGVuY2llc0Z1bGZpbGxlZDtkZXBlbmRlbmNpZXNGdWxmaWxsZWQ9bnVsbDtjYWxsYmFjaygpfX19TW9kdWxlWyJwcmVsb2FkZWRJbWFnZXMiXT17fTtNb2R1bGVbInByZWxvYWRlZEF1ZGlvcyJdPXt9O2Z1bmN0aW9uIGFib3J0KHdoYXQpe2lmKE1vZHVsZVsib25BYm9ydCJdKXtNb2R1bGVbIm9uQWJvcnQiXSh3aGF0KX13aGF0Kz0iIjtlcnIod2hhdCk7QUJPUlQ9dHJ1ZTtFWElUU1RBVFVTPTE7d2hhdD0iYWJvcnQoIit3aGF0KyIpLiBCdWlsZCB3aXRoIC1zIEFTU0VSVElPTlM9MSBmb3IgbW9yZSBpbmZvLiI7dmFyIGU9bmV3IFdlYkFzc2VtYmx5LlJ1bnRpbWVFcnJvcih3aGF0KTtyZWFkeVByb21pc2VSZWplY3QoZSk7dGhyb3cgZX1mdW5jdGlvbiBoYXNQcmVmaXgoc3RyLHByZWZpeCl7cmV0dXJuIFN0cmluZy5wcm90b3R5cGUuc3RhcnRzV2l0aD9zdHIuc3RhcnRzV2l0aChwcmVmaXgpOnN0ci5pbmRleE9mKHByZWZpeCk9PT0wfXZhciBkYXRhVVJJUHJlZml4PSJkYXRhOmFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbTtiYXNlNjQsIjtmdW5jdGlvbiBpc0RhdGFVUkkoZmlsZW5hbWUpe3JldHVybiBoYXNQcmVmaXgoZmlsZW5hbWUsZGF0YVVSSVByZWZpeCl9dmFyIHdhc21CaW5hcnlGaWxlPSJGUEJSZWNvZ25pdGlvbi53YXNtIjtpZighaXNEYXRhVVJJKHdhc21CaW5hcnlGaWxlKSl7d2FzbUJpbmFyeUZpbGU9bG9jYXRlRmlsZSh3YXNtQmluYXJ5RmlsZSl9ZnVuY3Rpb24gZ2V0QmluYXJ5KGZpbGUpe3RyeXtpZihmaWxlPT13YXNtQmluYXJ5RmlsZSYmd2FzbUJpbmFyeSl7cmV0dXJuIG5ldyBVaW50OEFycmF5KHdhc21CaW5hcnkpfWlmKHJlYWRCaW5hcnkpe3JldHVybiByZWFkQmluYXJ5KGZpbGUpfWVsc2V7dGhyb3cic3luYyBmZXRjaGluZyBvZiB0aGUgd2FzbSBmYWlsZWQ6IHlvdSBjYW4gcHJlbG9hZCBpdCB0byBNb2R1bGVbJ3dhc21CaW5hcnknXSBtYW51YWxseSwgb3IgZW1jYy5weSB3aWxsIGRvIHRoYXQgZm9yIHlvdSB3aGVuIGdlbmVyYXRpbmcgSFRNTCAoYnV0IG5vdCBKUykifX1jYXRjaChlcnIpe2Fib3J0KGVycil9fWZ1bmN0aW9uIGluc3RhbnRpYXRlU3luYyhmaWxlLGluZm8pe3ZhciBpbnN0YW5jZTt2YXIgbW9kdWxlO3ZhciBiaW5hcnk7dHJ5e2JpbmFyeT1nZXRCaW5hcnkoZmlsZSk7bW9kdWxlPW5ldyBXZWJBc3NlbWJseS5Nb2R1bGUoYmluYXJ5KTtpbnN0YW5jZT1uZXcgV2ViQXNzZW1ibHkuSW5zdGFuY2UobW9kdWxlLGluZm8pfWNhdGNoKGUpe3ZhciBzdHI9ZS50b1N0cmluZygpO2VycigiZmFpbGVkIHRvIGNvbXBpbGUgd2FzbSBtb2R1bGU6ICIrc3RyKTtpZihzdHIuaW5kZXhPZigiaW1wb3J0ZWQgTWVtb3J5Iik+PTB8fHN0ci5pbmRleE9mKCJtZW1vcnkgaW1wb3J0Iik+PTApe2VycigiTWVtb3J5IHNpemUgaW5jb21wYXRpYmlsaXR5IGlzc3VlcyBtYXkgYmUgZHVlIHRvIGNoYW5naW5nIElOSVRJQUxfTUVNT1JZIGF0IHJ1bnRpbWUgdG8gc29tZXRoaW5nIHRvbyBsYXJnZS4gVXNlIEFMTE9XX01FTU9SWV9HUk9XVEggdG8gYWxsb3cgYW55IHNpemUgbWVtb3J5IChhbmQgYWxzbyBtYWtlIHN1cmUgbm90IHRvIHNldCBJTklUSUFMX01FTU9SWSBhdCBydW50aW1lIHRvIHNvbWV0aGluZyBzbWFsbGVyIHRoYW4gaXQgd2FzIGF0IGNvbXBpbGUgdGltZSkuIil9dGhyb3cgZX1yZXR1cm5baW5zdGFuY2UsbW9kdWxlXX1mdW5jdGlvbiBjcmVhdGVXYXNtKCl7dmFyIGluZm89eyJhIjphc21MaWJyYXJ5QXJnfTtmdW5jdGlvbiByZWNlaXZlSW5zdGFuY2UoaW5zdGFuY2UsbW9kdWxlKXt2YXIgZXhwb3J0cz1pbnN0YW5jZS5leHBvcnRzO01vZHVsZVsiYXNtIl09ZXhwb3J0czt3YXNtTWVtb3J5PU1vZHVsZVsiYXNtIl1bImJhIl07dXBkYXRlR2xvYmFsQnVmZmVyQW5kVmlld3Mod2FzbU1lbW9yeS5idWZmZXIpO3dhc21UYWJsZT1Nb2R1bGVbImFzbSJdWyJlYSJdO3JlbW92ZVJ1bkRlcGVuZGVuY3koIndhc20taW5zdGFudGlhdGUiKX1hZGRSdW5EZXBlbmRlbmN5KCJ3YXNtLWluc3RhbnRpYXRlIik7aWYoTW9kdWxlWyJpbnN0YW50aWF0ZVdhc20iXSl7dHJ5e3ZhciBleHBvcnRzPU1vZHVsZVsiaW5zdGFudGlhdGVXYXNtIl0oaW5mbyxyZWNlaXZlSW5zdGFuY2UpO3JldHVybiBleHBvcnRzfWNhdGNoKGUpe2VycigiTW9kdWxlLmluc3RhbnRpYXRlV2FzbSBjYWxsYmFjayBmYWlsZWQgd2l0aCBlcnJvcjogIitlKTtyZXR1cm4gZmFsc2V9fXZhciByZXN1bHQ9aW5zdGFudGlhdGVTeW5jKHdhc21CaW5hcnlGaWxlLGluZm8pO3JlY2VpdmVJbnN0YW5jZShyZXN1bHRbMF0scmVzdWx0WzFdKTtyZXR1cm4gTW9kdWxlWyJhc20iXX1mdW5jdGlvbiBjYWxsUnVudGltZUNhbGxiYWNrcyhjYWxsYmFja3Mpe3doaWxlKGNhbGxiYWNrcy5sZW5ndGg+MCl7dmFyIGNhbGxiYWNrPWNhbGxiYWNrcy5zaGlmdCgpO2lmKHR5cGVvZiBjYWxsYmFjaz09ImZ1bmN0aW9uIil7Y2FsbGJhY2soTW9kdWxlKTtjb250aW51ZX12YXIgZnVuYz1jYWxsYmFjay5mdW5jO2lmKHR5cGVvZiBmdW5jPT09Im51bWJlciIpe2lmKGNhbGxiYWNrLmFyZz09PXVuZGVmaW5lZCl7d2FzbVRhYmxlLmdldChmdW5jKSgpfWVsc2V7d2FzbVRhYmxlLmdldChmdW5jKShjYWxsYmFjay5hcmcpfX1lbHNle2Z1bmMoY2FsbGJhY2suYXJnPT09dW5kZWZpbmVkP251bGw6Y2FsbGJhY2suYXJnKX19fXZhciBFeGNlcHRpb25JbmZvQXR0cnM9e0RFU1RSVUNUT1JfT0ZGU0VUOjAsUkVGQ09VTlRfT0ZGU0VUOjQsVFlQRV9PRkZTRVQ6OCxDQVVHSFRfT0ZGU0VUOjEyLFJFVEhST1dOX09GRlNFVDoxMyxTSVpFOjE2fTtmdW5jdGlvbiBfX19jeGFfYWxsb2NhdGVfZXhjZXB0aW9uKHNpemUpe3JldHVybiBfbWFsbG9jKHNpemUrRXhjZXB0aW9uSW5mb0F0dHJzLlNJWkUpK0V4Y2VwdGlvbkluZm9BdHRycy5TSVpFfXZhciBleGNlcHRpb25DYXVnaHQ9W107dmFyIGV4Y2VwdGlvbkxhc3Q9MDt2YXIgdW5jYXVnaHRFeGNlcHRpb25Db3VudD0wO2Z1bmN0aW9uIF9fX2N4YV9yZXRocm93KCl7dmFyIGNhdGNoSW5mbz1leGNlcHRpb25DYXVnaHQucG9wKCk7aWYoIWNhdGNoSW5mbyl7YWJvcnQoIm5vIGV4Y2VwdGlvbiB0byB0aHJvdyIpfXZhciBpbmZvPWNhdGNoSW5mby5nZXRfZXhjZXB0aW9uX2luZm8oKTt2YXIgcHRyPWNhdGNoSW5mby5nZXRfYmFzZV9wdHIoKTtpZighaW5mby5nZXRfcmV0aHJvd24oKSl7ZXhjZXB0aW9uQ2F1Z2h0LnB1c2goY2F0Y2hJbmZvKTtpbmZvLnNldF9yZXRocm93bih0cnVlKTtpbmZvLnNldF9jYXVnaHQoZmFsc2UpO3VuY2F1Z2h0RXhjZXB0aW9uQ291bnQrK31lbHNle2NhdGNoSW5mby5mcmVlKCl9ZXhjZXB0aW9uTGFzdD1wdHI7dGhyb3cgcHRyfWZ1bmN0aW9uIEV4Y2VwdGlvbkluZm8oZXhjUHRyKXt0aGlzLmV4Y1B0cj1leGNQdHI7dGhpcy5wdHI9ZXhjUHRyLUV4Y2VwdGlvbkluZm9BdHRycy5TSVpFO3RoaXMuc2V0X3R5cGU9ZnVuY3Rpb24odHlwZSl7SEVBUDMyW3RoaXMucHRyK0V4Y2VwdGlvbkluZm9BdHRycy5UWVBFX09GRlNFVD4+Ml09dHlwZX07dGhpcy5nZXRfdHlwZT1mdW5jdGlvbigpe3JldHVybiBIRUFQMzJbdGhpcy5wdHIrRXhjZXB0aW9uSW5mb0F0dHJzLlRZUEVfT0ZGU0VUPj4yXX07dGhpcy5zZXRfZGVzdHJ1Y3Rvcj1mdW5jdGlvbihkZXN0cnVjdG9yKXtIRUFQMzJbdGhpcy5wdHIrRXhjZXB0aW9uSW5mb0F0dHJzLkRFU1RSVUNUT1JfT0ZGU0VUPj4yXT1kZXN0cnVjdG9yfTt0aGlzLmdldF9kZXN0cnVjdG9yPWZ1bmN0aW9uKCl7cmV0dXJuIEhFQVAzMlt0aGlzLnB0citFeGNlcHRpb25JbmZvQXR0cnMuREVTVFJVQ1RPUl9PRkZTRVQ+PjJdfTt0aGlzLnNldF9yZWZjb3VudD1mdW5jdGlvbihyZWZjb3VudCl7SEVBUDMyW3RoaXMucHRyK0V4Y2VwdGlvbkluZm9BdHRycy5SRUZDT1VOVF9PRkZTRVQ+PjJdPXJlZmNvdW50fTt0aGlzLnNldF9jYXVnaHQ9ZnVuY3Rpb24oY2F1Z2h0KXtjYXVnaHQ9Y2F1Z2h0PzE6MDtIRUFQOFt0aGlzLnB0citFeGNlcHRpb25JbmZvQXR0cnMuQ0FVR0hUX09GRlNFVD4+MF09Y2F1Z2h0fTt0aGlzLmdldF9jYXVnaHQ9ZnVuY3Rpb24oKXtyZXR1cm4gSEVBUDhbdGhpcy5wdHIrRXhjZXB0aW9uSW5mb0F0dHJzLkNBVUdIVF9PRkZTRVQ+PjBdIT0wfTt0aGlzLnNldF9yZXRocm93bj1mdW5jdGlvbihyZXRocm93bil7cmV0aHJvd249cmV0aHJvd24/MTowO0hFQVA4W3RoaXMucHRyK0V4Y2VwdGlvbkluZm9BdHRycy5SRVRIUk9XTl9PRkZTRVQ+PjBdPXJldGhyb3dufTt0aGlzLmdldF9yZXRocm93bj1mdW5jdGlvbigpe3JldHVybiBIRUFQOFt0aGlzLnB0citFeGNlcHRpb25JbmZvQXR0cnMuUkVUSFJPV05fT0ZGU0VUPj4wXSE9MH07dGhpcy5pbml0PWZ1bmN0aW9uKHR5cGUsZGVzdHJ1Y3Rvcil7dGhpcy5zZXRfdHlwZSh0eXBlKTt0aGlzLnNldF9kZXN0cnVjdG9yKGRlc3RydWN0b3IpO3RoaXMuc2V0X3JlZmNvdW50KDApO3RoaXMuc2V0X2NhdWdodChmYWxzZSk7dGhpcy5zZXRfcmV0aHJvd24oZmFsc2UpfTt0aGlzLmFkZF9yZWY9ZnVuY3Rpb24oKXt2YXIgdmFsdWU9SEVBUDMyW3RoaXMucHRyK0V4Y2VwdGlvbkluZm9BdHRycy5SRUZDT1VOVF9PRkZTRVQ+PjJdO0hFQVAzMlt0aGlzLnB0citFeGNlcHRpb25JbmZvQXR0cnMuUkVGQ09VTlRfT0ZGU0VUPj4yXT12YWx1ZSsxfTt0aGlzLnJlbGVhc2VfcmVmPWZ1bmN0aW9uKCl7dmFyIHByZXY9SEVBUDMyW3RoaXMucHRyK0V4Y2VwdGlvbkluZm9BdHRycy5SRUZDT1VOVF9PRkZTRVQ+PjJdO0hFQVAzMlt0aGlzLnB0citFeGNlcHRpb25JbmZvQXR0cnMuUkVGQ09VTlRfT0ZGU0VUPj4yXT1wcmV2LTE7cmV0dXJuIHByZXY9PT0xfX1mdW5jdGlvbiBfX19jeGFfdGhyb3cocHRyLHR5cGUsZGVzdHJ1Y3Rvcil7dmFyIGluZm89bmV3IEV4Y2VwdGlvbkluZm8ocHRyKTtpbmZvLmluaXQodHlwZSxkZXN0cnVjdG9yKTtleGNlcHRpb25MYXN0PXB0cjt1bmNhdWdodEV4Y2VwdGlvbkNvdW50Kys7dGhyb3cgcHRyfWZ1bmN0aW9uIHNldEVyck5vKHZhbHVlKXtIRUFQMzJbX19fZXJybm9fbG9jYXRpb24oKT4+Ml09dmFsdWU7cmV0dXJuIHZhbHVlfXZhciBTWVNDQUxMUz17bWFwcGluZ3M6e30sYnVmZmVyczpbbnVsbCxbXSxbXV0scHJpbnRDaGFyOmZ1bmN0aW9uKHN0cmVhbSxjdXJyKXt2YXIgYnVmZmVyPVNZU0NBTExTLmJ1ZmZlcnNbc3RyZWFtXTtpZihjdXJyPT09MHx8Y3Vycj09PTEwKXsoc3RyZWFtPT09MT9vdXQ6ZXJyKShVVEY4QXJyYXlUb1N0cmluZyhidWZmZXIsMCkpO2J1ZmZlci5sZW5ndGg9MH1lbHNle2J1ZmZlci5wdXNoKGN1cnIpfX0sdmFyYXJnczp1bmRlZmluZWQsZ2V0OmZ1bmN0aW9uKCl7U1lTQ0FMTFMudmFyYXJncys9NDt2YXIgcmV0PUhFQVAzMltTWVNDQUxMUy52YXJhcmdzLTQ+PjJdO3JldHVybiByZXR9LGdldFN0cjpmdW5jdGlvbihwdHIpe3ZhciByZXQ9VVRGOFRvU3RyaW5nKHB0cik7cmV0dXJuIHJldH0sZ2V0NjQ6ZnVuY3Rpb24obG93LGhpZ2gpe3JldHVybiBsb3d9fTtmdW5jdGlvbiBfX19zeXNfZmNudGw2NChmZCxjbWQsdmFyYXJncyl7U1lTQ0FMTFMudmFyYXJncz12YXJhcmdzO3JldHVybiAwfWZ1bmN0aW9uIF9fX3N5c19nZXRwaWQoKXtyZXR1cm4gNDJ9ZnVuY3Rpb24gX19fc3lzX2lvY3RsKGZkLG9wLHZhcmFyZ3Mpe1NZU0NBTExTLnZhcmFyZ3M9dmFyYXJncztyZXR1cm4gMH1mdW5jdGlvbiBfX19zeXNfb3BlbihwYXRoLGZsYWdzLHZhcmFyZ3Mpe1NZU0NBTExTLnZhcmFyZ3M9dmFyYXJnc31mdW5jdGlvbiBnZXRTaGlmdEZyb21TaXplKHNpemUpe3N3aXRjaChzaXplKXtjYXNlIDE6cmV0dXJuIDA7Y2FzZSAyOnJldHVybiAxO2Nhc2UgNDpyZXR1cm4gMjtjYXNlIDg6cmV0dXJuIDM7ZGVmYXVsdDp0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIHR5cGUgc2l6ZTogIitzaXplKX19ZnVuY3Rpb24gZW1iaW5kX2luaXRfY2hhckNvZGVzKCl7dmFyIGNvZGVzPW5ldyBBcnJheSgyNTYpO2Zvcih2YXIgaT0wO2k8MjU2OysraSl7Y29kZXNbaV09U3RyaW5nLmZyb21DaGFyQ29kZShpKX1lbWJpbmRfY2hhckNvZGVzPWNvZGVzfXZhciBlbWJpbmRfY2hhckNvZGVzPXVuZGVmaW5lZDtmdW5jdGlvbiByZWFkTGF0aW4xU3RyaW5nKHB0cil7dmFyIHJldD0iIjt2YXIgYz1wdHI7d2hpbGUoSEVBUFU4W2NdKXtyZXQrPWVtYmluZF9jaGFyQ29kZXNbSEVBUFU4W2MrK11dfXJldHVybiByZXR9dmFyIGF3YWl0aW5nRGVwZW5kZW5jaWVzPXt9O3ZhciByZWdpc3RlcmVkVHlwZXM9e307dmFyIHR5cGVEZXBlbmRlbmNpZXM9e307dmFyIGNoYXJfMD00ODt2YXIgY2hhcl85PTU3O2Z1bmN0aW9uIG1ha2VMZWdhbEZ1bmN0aW9uTmFtZShuYW1lKXtpZih1bmRlZmluZWQ9PT1uYW1lKXtyZXR1cm4iX3Vua25vd24ifW5hbWU9bmFtZS5yZXBsYWNlKC9bXmEtekEtWjAtOV9dL2csIiQiKTt2YXIgZj1uYW1lLmNoYXJDb2RlQXQoMCk7aWYoZj49Y2hhcl8wJiZmPD1jaGFyXzkpe3JldHVybiJfIituYW1lfWVsc2V7cmV0dXJuIG5hbWV9fWZ1bmN0aW9uIGNyZWF0ZU5hbWVkRnVuY3Rpb24obmFtZSxib2R5KXtuYW1lPW1ha2VMZWdhbEZ1bmN0aW9uTmFtZShuYW1lKTtyZXR1cm4gbmV3IEZ1bmN0aW9uKCJib2R5IiwicmV0dXJuIGZ1bmN0aW9uICIrbmFtZSsiKCkge1xuIisnICAgICJ1c2Ugc3RyaWN0IjsnKyIgICAgcmV0dXJuIGJvZHkuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiIrIn07XG4iKShib2R5KX1mdW5jdGlvbiBleHRlbmRFcnJvcihiYXNlRXJyb3JUeXBlLGVycm9yTmFtZSl7dmFyIGVycm9yQ2xhc3M9Y3JlYXRlTmFtZWRGdW5jdGlvbihlcnJvck5hbWUsZnVuY3Rpb24obWVzc2FnZSl7dGhpcy5uYW1lPWVycm9yTmFtZTt0aGlzLm1lc3NhZ2U9bWVzc2FnZTt2YXIgc3RhY2s9bmV3IEVycm9yKG1lc3NhZ2UpLnN0YWNrO2lmKHN0YWNrIT09dW5kZWZpbmVkKXt0aGlzLnN0YWNrPXRoaXMudG9TdHJpbmcoKSsiXG4iK3N0YWNrLnJlcGxhY2UoL15FcnJvcig6W15cbl0qKT9cbi8sIiIpfX0pO2Vycm9yQ2xhc3MucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoYmFzZUVycm9yVHlwZS5wcm90b3R5cGUpO2Vycm9yQ2xhc3MucHJvdG90eXBlLmNvbnN0cnVjdG9yPWVycm9yQ2xhc3M7ZXJyb3JDbGFzcy5wcm90b3R5cGUudG9TdHJpbmc9ZnVuY3Rpb24oKXtpZih0aGlzLm1lc3NhZ2U9PT11bmRlZmluZWQpe3JldHVybiB0aGlzLm5hbWV9ZWxzZXtyZXR1cm4gdGhpcy5uYW1lKyI6ICIrdGhpcy5tZXNzYWdlfX07cmV0dXJuIGVycm9yQ2xhc3N9dmFyIEJpbmRpbmdFcnJvcj11bmRlZmluZWQ7ZnVuY3Rpb24gdGhyb3dCaW5kaW5nRXJyb3IobWVzc2FnZSl7dGhyb3cgbmV3IEJpbmRpbmdFcnJvcihtZXNzYWdlKX12YXIgSW50ZXJuYWxFcnJvcj11bmRlZmluZWQ7ZnVuY3Rpb24gdGhyb3dJbnRlcm5hbEVycm9yKG1lc3NhZ2Upe3Rocm93IG5ldyBJbnRlcm5hbEVycm9yKG1lc3NhZ2UpfWZ1bmN0aW9uIHdoZW5EZXBlbmRlbnRUeXBlc0FyZVJlc29sdmVkKG15VHlwZXMsZGVwZW5kZW50VHlwZXMsZ2V0VHlwZUNvbnZlcnRlcnMpe215VHlwZXMuZm9yRWFjaChmdW5jdGlvbih0eXBlKXt0eXBlRGVwZW5kZW5jaWVzW3R5cGVdPWRlcGVuZGVudFR5cGVzfSk7ZnVuY3Rpb24gb25Db21wbGV0ZSh0eXBlQ29udmVydGVycyl7dmFyIG15VHlwZUNvbnZlcnRlcnM9Z2V0VHlwZUNvbnZlcnRlcnModHlwZUNvbnZlcnRlcnMpO2lmKG15VHlwZUNvbnZlcnRlcnMubGVuZ3RoIT09bXlUeXBlcy5sZW5ndGgpe3Rocm93SW50ZXJuYWxFcnJvcigiTWlzbWF0Y2hlZCB0eXBlIGNvbnZlcnRlciBjb3VudCIpfWZvcih2YXIgaT0wO2k8bXlUeXBlcy5sZW5ndGg7KytpKXtyZWdpc3RlclR5cGUobXlUeXBlc1tpXSxteVR5cGVDb252ZXJ0ZXJzW2ldKX19dmFyIHR5cGVDb252ZXJ0ZXJzPW5ldyBBcnJheShkZXBlbmRlbnRUeXBlcy5sZW5ndGgpO3ZhciB1bnJlZ2lzdGVyZWRUeXBlcz1bXTt2YXIgcmVnaXN0ZXJlZD0wO2RlcGVuZGVudFR5cGVzLmZvckVhY2goZnVuY3Rpb24oZHQsaSl7aWYocmVnaXN0ZXJlZFR5cGVzLmhhc093blByb3BlcnR5KGR0KSl7dHlwZUNvbnZlcnRlcnNbaV09cmVnaXN0ZXJlZFR5cGVzW2R0XX1lbHNle3VucmVnaXN0ZXJlZFR5cGVzLnB1c2goZHQpO2lmKCFhd2FpdGluZ0RlcGVuZGVuY2llcy5oYXNPd25Qcm9wZXJ0eShkdCkpe2F3YWl0aW5nRGVwZW5kZW5jaWVzW2R0XT1bXX1hd2FpdGluZ0RlcGVuZGVuY2llc1tkdF0ucHVzaChmdW5jdGlvbigpe3R5cGVDb252ZXJ0ZXJzW2ldPXJlZ2lzdGVyZWRUeXBlc1tkdF07KytyZWdpc3RlcmVkO2lmKHJlZ2lzdGVyZWQ9PT11bnJlZ2lzdGVyZWRUeXBlcy5sZW5ndGgpe29uQ29tcGxldGUodHlwZUNvbnZlcnRlcnMpfX0pfX0pO2lmKDA9PT11bnJlZ2lzdGVyZWRUeXBlcy5sZW5ndGgpe29uQ29tcGxldGUodHlwZUNvbnZlcnRlcnMpfX1mdW5jdGlvbiByZWdpc3RlclR5cGUocmF3VHlwZSxyZWdpc3RlcmVkSW5zdGFuY2Usb3B0aW9ucyl7b3B0aW9ucz1vcHRpb25zfHx7fTtpZighKCJhcmdQYWNrQWR2YW5jZSJpbiByZWdpc3RlcmVkSW5zdGFuY2UpKXt0aHJvdyBuZXcgVHlwZUVycm9yKCJyZWdpc3RlclR5cGUgcmVnaXN0ZXJlZEluc3RhbmNlIHJlcXVpcmVzIGFyZ1BhY2tBZHZhbmNlIil9dmFyIG5hbWU9cmVnaXN0ZXJlZEluc3RhbmNlLm5hbWU7aWYoIXJhd1R5cGUpe3Rocm93QmluZGluZ0Vycm9yKCd0eXBlICInK25hbWUrJyIgbXVzdCBoYXZlIGEgcG9zaXRpdmUgaW50ZWdlciB0eXBlaWQgcG9pbnRlcicpfWlmKHJlZ2lzdGVyZWRUeXBlcy5oYXNPd25Qcm9wZXJ0eShyYXdUeXBlKSl7aWYob3B0aW9ucy5pZ25vcmVEdXBsaWNhdGVSZWdpc3RyYXRpb25zKXtyZXR1cm59ZWxzZXt0aHJvd0JpbmRpbmdFcnJvcigiQ2Fubm90IHJlZ2lzdGVyIHR5cGUgJyIrbmFtZSsiJyB0d2ljZSIpfX1yZWdpc3RlcmVkVHlwZXNbcmF3VHlwZV09cmVnaXN0ZXJlZEluc3RhbmNlO2RlbGV0ZSB0eXBlRGVwZW5kZW5jaWVzW3Jhd1R5cGVdO2lmKGF3YWl0aW5nRGVwZW5kZW5jaWVzLmhhc093blByb3BlcnR5KHJhd1R5cGUpKXt2YXIgY2FsbGJhY2tzPWF3YWl0aW5nRGVwZW5kZW5jaWVzW3Jhd1R5cGVdO2RlbGV0ZSBhd2FpdGluZ0RlcGVuZGVuY2llc1tyYXdUeXBlXTtjYWxsYmFja3MuZm9yRWFjaChmdW5jdGlvbihjYil7Y2IoKX0pfX1mdW5jdGlvbiBfX2VtYmluZF9yZWdpc3Rlcl9ib29sKHJhd1R5cGUsbmFtZSxzaXplLHRydWVWYWx1ZSxmYWxzZVZhbHVlKXt2YXIgc2hpZnQ9Z2V0U2hpZnRGcm9tU2l6ZShzaXplKTtuYW1lPXJlYWRMYXRpbjFTdHJpbmcobmFtZSk7cmVnaXN0ZXJUeXBlKHJhd1R5cGUse25hbWU6bmFtZSwiZnJvbVdpcmVUeXBlIjpmdW5jdGlvbih3dCl7cmV0dXJuISF3dH0sInRvV2lyZVR5cGUiOmZ1bmN0aW9uKGRlc3RydWN0b3JzLG8pe3JldHVybiBvP3RydWVWYWx1ZTpmYWxzZVZhbHVlfSwiYXJnUGFja0FkdmFuY2UiOjgsInJlYWRWYWx1ZUZyb21Qb2ludGVyIjpmdW5jdGlvbihwb2ludGVyKXt2YXIgaGVhcDtpZihzaXplPT09MSl7aGVhcD1IRUFQOH1lbHNlIGlmKHNpemU9PT0yKXtoZWFwPUhFQVAxNn1lbHNlIGlmKHNpemU9PT00KXtoZWFwPUhFQVAzMn1lbHNle3Rocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gYm9vbGVhbiB0eXBlIHNpemU6ICIrbmFtZSl9cmV0dXJuIHRoaXNbImZyb21XaXJlVHlwZSJdKGhlYXBbcG9pbnRlcj4+c2hpZnRdKX0sZGVzdHJ1Y3RvckZ1bmN0aW9uOm51bGx9KX1mdW5jdGlvbiBDbGFzc0hhbmRsZV9pc0FsaWFzT2Yob3RoZXIpe2lmKCEodGhpcyBpbnN0YW5jZW9mIENsYXNzSGFuZGxlKSl7cmV0dXJuIGZhbHNlfWlmKCEob3RoZXIgaW5zdGFuY2VvZiBDbGFzc0hhbmRsZSkpe3JldHVybiBmYWxzZX12YXIgbGVmdENsYXNzPXRoaXMuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3M7dmFyIGxlZnQ9dGhpcy4kJC5wdHI7dmFyIHJpZ2h0Q2xhc3M9b3RoZXIuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3M7dmFyIHJpZ2h0PW90aGVyLiQkLnB0cjt3aGlsZShsZWZ0Q2xhc3MuYmFzZUNsYXNzKXtsZWZ0PWxlZnRDbGFzcy51cGNhc3QobGVmdCk7bGVmdENsYXNzPWxlZnRDbGFzcy5iYXNlQ2xhc3N9d2hpbGUocmlnaHRDbGFzcy5iYXNlQ2xhc3Mpe3JpZ2h0PXJpZ2h0Q2xhc3MudXBjYXN0KHJpZ2h0KTtyaWdodENsYXNzPXJpZ2h0Q2xhc3MuYmFzZUNsYXNzfXJldHVybiBsZWZ0Q2xhc3M9PT1yaWdodENsYXNzJiZsZWZ0PT09cmlnaHR9ZnVuY3Rpb24gc2hhbGxvd0NvcHlJbnRlcm5hbFBvaW50ZXIobyl7cmV0dXJue2NvdW50Om8uY291bnQsZGVsZXRlU2NoZWR1bGVkOm8uZGVsZXRlU2NoZWR1bGVkLHByZXNlcnZlUG9pbnRlck9uRGVsZXRlOm8ucHJlc2VydmVQb2ludGVyT25EZWxldGUscHRyOm8ucHRyLHB0clR5cGU6by5wdHJUeXBlLHNtYXJ0UHRyOm8uc21hcnRQdHIsc21hcnRQdHJUeXBlOm8uc21hcnRQdHJUeXBlfX1mdW5jdGlvbiB0aHJvd0luc3RhbmNlQWxyZWFkeURlbGV0ZWQob2JqKXtmdW5jdGlvbiBnZXRJbnN0YW5jZVR5cGVOYW1lKGhhbmRsZSl7cmV0dXJuIGhhbmRsZS4kJC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzcy5uYW1lfXRocm93QmluZGluZ0Vycm9yKGdldEluc3RhbmNlVHlwZU5hbWUob2JqKSsiIGluc3RhbmNlIGFscmVhZHkgZGVsZXRlZCIpfXZhciBmaW5hbGl6YXRpb25Hcm91cD1mYWxzZTtmdW5jdGlvbiBkZXRhY2hGaW5hbGl6ZXIoaGFuZGxlKXt9ZnVuY3Rpb24gcnVuRGVzdHJ1Y3RvcigkJCl7aWYoJCQuc21hcnRQdHIpeyQkLnNtYXJ0UHRyVHlwZS5yYXdEZXN0cnVjdG9yKCQkLnNtYXJ0UHRyKX1lbHNleyQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzLnJhd0Rlc3RydWN0b3IoJCQucHRyKX19ZnVuY3Rpb24gcmVsZWFzZUNsYXNzSGFuZGxlKCQkKXskJC5jb3VudC52YWx1ZS09MTt2YXIgdG9EZWxldGU9MD09PSQkLmNvdW50LnZhbHVlO2lmKHRvRGVsZXRlKXtydW5EZXN0cnVjdG9yKCQkKX19ZnVuY3Rpb24gYXR0YWNoRmluYWxpemVyKGhhbmRsZSl7aWYoInVuZGVmaW5lZCI9PT10eXBlb2YgRmluYWxpemF0aW9uR3JvdXApe2F0dGFjaEZpbmFsaXplcj1mdW5jdGlvbihoYW5kbGUpe3JldHVybiBoYW5kbGV9O3JldHVybiBoYW5kbGV9ZmluYWxpemF0aW9uR3JvdXA9bmV3IEZpbmFsaXphdGlvbkdyb3VwKGZ1bmN0aW9uKGl0ZXIpe2Zvcih2YXIgcmVzdWx0PWl0ZXIubmV4dCgpOyFyZXN1bHQuZG9uZTtyZXN1bHQ9aXRlci5uZXh0KCkpe3ZhciAkJD1yZXN1bHQudmFsdWU7aWYoISQkLnB0cil7Y29uc29sZS53YXJuKCJvYmplY3QgYWxyZWFkeSBkZWxldGVkOiAiKyQkLnB0cil9ZWxzZXtyZWxlYXNlQ2xhc3NIYW5kbGUoJCQpfX19KTthdHRhY2hGaW5hbGl6ZXI9ZnVuY3Rpb24oaGFuZGxlKXtmaW5hbGl6YXRpb25Hcm91cC5yZWdpc3RlcihoYW5kbGUsaGFuZGxlLiQkLGhhbmRsZS4kJCk7cmV0dXJuIGhhbmRsZX07ZGV0YWNoRmluYWxpemVyPWZ1bmN0aW9uKGhhbmRsZSl7ZmluYWxpemF0aW9uR3JvdXAudW5yZWdpc3RlcihoYW5kbGUuJCQpfTtyZXR1cm4gYXR0YWNoRmluYWxpemVyKGhhbmRsZSl9ZnVuY3Rpb24gQ2xhc3NIYW5kbGVfY2xvbmUoKXtpZighdGhpcy4kJC5wdHIpe3Rocm93SW5zdGFuY2VBbHJlYWR5RGVsZXRlZCh0aGlzKX1pZih0aGlzLiQkLnByZXNlcnZlUG9pbnRlck9uRGVsZXRlKXt0aGlzLiQkLmNvdW50LnZhbHVlKz0xO3JldHVybiB0aGlzfWVsc2V7dmFyIGNsb25lPWF0dGFjaEZpbmFsaXplcihPYmplY3QuY3JlYXRlKE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKSx7JCQ6e3ZhbHVlOnNoYWxsb3dDb3B5SW50ZXJuYWxQb2ludGVyKHRoaXMuJCQpfX0pKTtjbG9uZS4kJC5jb3VudC52YWx1ZSs9MTtjbG9uZS4kJC5kZWxldGVTY2hlZHVsZWQ9ZmFsc2U7cmV0dXJuIGNsb25lfX1mdW5jdGlvbiBDbGFzc0hhbmRsZV9kZWxldGUoKXtpZighdGhpcy4kJC5wdHIpe3Rocm93SW5zdGFuY2VBbHJlYWR5RGVsZXRlZCh0aGlzKX1pZih0aGlzLiQkLmRlbGV0ZVNjaGVkdWxlZCYmIXRoaXMuJCQucHJlc2VydmVQb2ludGVyT25EZWxldGUpe3Rocm93QmluZGluZ0Vycm9yKCJPYmplY3QgYWxyZWFkeSBzY2hlZHVsZWQgZm9yIGRlbGV0aW9uIil9ZGV0YWNoRmluYWxpemVyKHRoaXMpO3JlbGVhc2VDbGFzc0hhbmRsZSh0aGlzLiQkKTtpZighdGhpcy4kJC5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSl7dGhpcy4kJC5zbWFydFB0cj11bmRlZmluZWQ7dGhpcy4kJC5wdHI9dW5kZWZpbmVkfX1mdW5jdGlvbiBDbGFzc0hhbmRsZV9pc0RlbGV0ZWQoKXtyZXR1cm4hdGhpcy4kJC5wdHJ9dmFyIGRlbGF5RnVuY3Rpb249dW5kZWZpbmVkO3ZhciBkZWxldGlvblF1ZXVlPVtdO2Z1bmN0aW9uIGZsdXNoUGVuZGluZ0RlbGV0ZXMoKXt3aGlsZShkZWxldGlvblF1ZXVlLmxlbmd0aCl7dmFyIG9iaj1kZWxldGlvblF1ZXVlLnBvcCgpO29iai4kJC5kZWxldGVTY2hlZHVsZWQ9ZmFsc2U7b2JqWyJkZWxldGUiXSgpfX1mdW5jdGlvbiBDbGFzc0hhbmRsZV9kZWxldGVMYXRlcigpe2lmKCF0aGlzLiQkLnB0cil7dGhyb3dJbnN0YW5jZUFscmVhZHlEZWxldGVkKHRoaXMpfWlmKHRoaXMuJCQuZGVsZXRlU2NoZWR1bGVkJiYhdGhpcy4kJC5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSl7dGhyb3dCaW5kaW5nRXJyb3IoIk9iamVjdCBhbHJlYWR5IHNjaGVkdWxlZCBmb3IgZGVsZXRpb24iKX1kZWxldGlvblF1ZXVlLnB1c2godGhpcyk7aWYoZGVsZXRpb25RdWV1ZS5sZW5ndGg9PT0xJiZkZWxheUZ1bmN0aW9uKXtkZWxheUZ1bmN0aW9uKGZsdXNoUGVuZGluZ0RlbGV0ZXMpfXRoaXMuJCQuZGVsZXRlU2NoZWR1bGVkPXRydWU7cmV0dXJuIHRoaXN9ZnVuY3Rpb24gaW5pdF9DbGFzc0hhbmRsZSgpe0NsYXNzSGFuZGxlLnByb3RvdHlwZVsiaXNBbGlhc09mIl09Q2xhc3NIYW5kbGVfaXNBbGlhc09mO0NsYXNzSGFuZGxlLnByb3RvdHlwZVsiY2xvbmUiXT1DbGFzc0hhbmRsZV9jbG9uZTtDbGFzc0hhbmRsZS5wcm90b3R5cGVbImRlbGV0ZSJdPUNsYXNzSGFuZGxlX2RlbGV0ZTtDbGFzc0hhbmRsZS5wcm90b3R5cGVbImlzRGVsZXRlZCJdPUNsYXNzSGFuZGxlX2lzRGVsZXRlZDtDbGFzc0hhbmRsZS5wcm90b3R5cGVbImRlbGV0ZUxhdGVyIl09Q2xhc3NIYW5kbGVfZGVsZXRlTGF0ZXJ9ZnVuY3Rpb24gQ2xhc3NIYW5kbGUoKXt9dmFyIHJlZ2lzdGVyZWRQb2ludGVycz17fTtmdW5jdGlvbiBlbnN1cmVPdmVybG9hZFRhYmxlKHByb3RvLG1ldGhvZE5hbWUsaHVtYW5OYW1lKXtpZih1bmRlZmluZWQ9PT1wcm90b1ttZXRob2ROYW1lXS5vdmVybG9hZFRhYmxlKXt2YXIgcHJldkZ1bmM9cHJvdG9bbWV0aG9kTmFtZV07cHJvdG9bbWV0aG9kTmFtZV09ZnVuY3Rpb24oKXtpZighcHJvdG9bbWV0aG9kTmFtZV0ub3ZlcmxvYWRUYWJsZS5oYXNPd25Qcm9wZXJ0eShhcmd1bWVudHMubGVuZ3RoKSl7dGhyb3dCaW5kaW5nRXJyb3IoIkZ1bmN0aW9uICciK2h1bWFuTmFtZSsiJyBjYWxsZWQgd2l0aCBhbiBpbnZhbGlkIG51bWJlciBvZiBhcmd1bWVudHMgKCIrYXJndW1lbnRzLmxlbmd0aCsiKSAtIGV4cGVjdHMgb25lIG9mICgiK3Byb3RvW21ldGhvZE5hbWVdLm92ZXJsb2FkVGFibGUrIikhIil9cmV0dXJuIHByb3RvW21ldGhvZE5hbWVdLm92ZXJsb2FkVGFibGVbYXJndW1lbnRzLmxlbmd0aF0uYXBwbHkodGhpcyxhcmd1bWVudHMpfTtwcm90b1ttZXRob2ROYW1lXS5vdmVybG9hZFRhYmxlPVtdO3Byb3RvW21ldGhvZE5hbWVdLm92ZXJsb2FkVGFibGVbcHJldkZ1bmMuYXJnQ291bnRdPXByZXZGdW5jfX1mdW5jdGlvbiBleHBvc2VQdWJsaWNTeW1ib2wobmFtZSx2YWx1ZSxudW1Bcmd1bWVudHMpe2lmKE1vZHVsZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSl7aWYodW5kZWZpbmVkPT09bnVtQXJndW1lbnRzfHx1bmRlZmluZWQhPT1Nb2R1bGVbbmFtZV0ub3ZlcmxvYWRUYWJsZSYmdW5kZWZpbmVkIT09TW9kdWxlW25hbWVdLm92ZXJsb2FkVGFibGVbbnVtQXJndW1lbnRzXSl7dGhyb3dCaW5kaW5nRXJyb3IoIkNhbm5vdCByZWdpc3RlciBwdWJsaWMgbmFtZSAnIituYW1lKyInIHR3aWNlIil9ZW5zdXJlT3ZlcmxvYWRUYWJsZShNb2R1bGUsbmFtZSxuYW1lKTtpZihNb2R1bGUuaGFzT3duUHJvcGVydHkobnVtQXJndW1lbnRzKSl7dGhyb3dCaW5kaW5nRXJyb3IoIkNhbm5vdCByZWdpc3RlciBtdWx0aXBsZSBvdmVybG9hZHMgb2YgYSBmdW5jdGlvbiB3aXRoIHRoZSBzYW1lIG51bWJlciBvZiBhcmd1bWVudHMgKCIrbnVtQXJndW1lbnRzKyIpISIpfU1vZHVsZVtuYW1lXS5vdmVybG9hZFRhYmxlW251bUFyZ3VtZW50c109dmFsdWV9ZWxzZXtNb2R1bGVbbmFtZV09dmFsdWU7aWYodW5kZWZpbmVkIT09bnVtQXJndW1lbnRzKXtNb2R1bGVbbmFtZV0ubnVtQXJndW1lbnRzPW51bUFyZ3VtZW50c319fWZ1bmN0aW9uIFJlZ2lzdGVyZWRDbGFzcyhuYW1lLGNvbnN0cnVjdG9yLGluc3RhbmNlUHJvdG90eXBlLHJhd0Rlc3RydWN0b3IsYmFzZUNsYXNzLGdldEFjdHVhbFR5cGUsdXBjYXN0LGRvd25jYXN0KXt0aGlzLm5hbWU9bmFtZTt0aGlzLmNvbnN0cnVjdG9yPWNvbnN0cnVjdG9yO3RoaXMuaW5zdGFuY2VQcm90b3R5cGU9aW5zdGFuY2VQcm90b3R5cGU7dGhpcy5yYXdEZXN0cnVjdG9yPXJhd0Rlc3RydWN0b3I7dGhpcy5iYXNlQ2xhc3M9YmFzZUNsYXNzO3RoaXMuZ2V0QWN0dWFsVHlwZT1nZXRBY3R1YWxUeXBlO3RoaXMudXBjYXN0PXVwY2FzdDt0aGlzLmRvd25jYXN0PWRvd25jYXN0O3RoaXMucHVyZVZpcnR1YWxGdW5jdGlvbnM9W119ZnVuY3Rpb24gdXBjYXN0UG9pbnRlcihwdHIscHRyQ2xhc3MsZGVzaXJlZENsYXNzKXt3aGlsZShwdHJDbGFzcyE9PWRlc2lyZWRDbGFzcyl7aWYoIXB0ckNsYXNzLnVwY2FzdCl7dGhyb3dCaW5kaW5nRXJyb3IoIkV4cGVjdGVkIG51bGwgb3IgaW5zdGFuY2Ugb2YgIitkZXNpcmVkQ2xhc3MubmFtZSsiLCBnb3QgYW4gaW5zdGFuY2Ugb2YgIitwdHJDbGFzcy5uYW1lKX1wdHI9cHRyQ2xhc3MudXBjYXN0KHB0cik7cHRyQ2xhc3M9cHRyQ2xhc3MuYmFzZUNsYXNzfXJldHVybiBwdHJ9ZnVuY3Rpb24gY29uc3ROb1NtYXJ0UHRyUmF3UG9pbnRlclRvV2lyZVR5cGUoZGVzdHJ1Y3RvcnMsaGFuZGxlKXtpZihoYW5kbGU9PT1udWxsKXtpZih0aGlzLmlzUmVmZXJlbmNlKXt0aHJvd0JpbmRpbmdFcnJvcigibnVsbCBpcyBub3QgYSB2YWxpZCAiK3RoaXMubmFtZSl9cmV0dXJuIDB9aWYoIWhhbmRsZS4kJCl7dGhyb3dCaW5kaW5nRXJyb3IoJ0Nhbm5vdCBwYXNzICInK19lbWJpbmRfcmVwcihoYW5kbGUpKyciIGFzIGEgJyt0aGlzLm5hbWUpfWlmKCFoYW5kbGUuJCQucHRyKXt0aHJvd0JpbmRpbmdFcnJvcigiQ2Fubm90IHBhc3MgZGVsZXRlZCBvYmplY3QgYXMgYSBwb2ludGVyIG9mIHR5cGUgIit0aGlzLm5hbWUpfXZhciBoYW5kbGVDbGFzcz1oYW5kbGUuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3M7dmFyIHB0cj11cGNhc3RQb2ludGVyKGhhbmRsZS4kJC5wdHIsaGFuZGxlQ2xhc3MsdGhpcy5yZWdpc3RlcmVkQ2xhc3MpO3JldHVybiBwdHJ9ZnVuY3Rpb24gZ2VuZXJpY1BvaW50ZXJUb1dpcmVUeXBlKGRlc3RydWN0b3JzLGhhbmRsZSl7dmFyIHB0cjtpZihoYW5kbGU9PT1udWxsKXtpZih0aGlzLmlzUmVmZXJlbmNlKXt0aHJvd0JpbmRpbmdFcnJvcigibnVsbCBpcyBub3QgYSB2YWxpZCAiK3RoaXMubmFtZSl9aWYodGhpcy5pc1NtYXJ0UG9pbnRlcil7cHRyPXRoaXMucmF3Q29uc3RydWN0b3IoKTtpZihkZXN0cnVjdG9ycyE9PW51bGwpe2Rlc3RydWN0b3JzLnB1c2godGhpcy5yYXdEZXN0cnVjdG9yLHB0cil9cmV0dXJuIHB0cn1lbHNle3JldHVybiAwfX1pZighaGFuZGxlLiQkKXt0aHJvd0JpbmRpbmdFcnJvcignQ2Fubm90IHBhc3MgIicrX2VtYmluZF9yZXByKGhhbmRsZSkrJyIgYXMgYSAnK3RoaXMubmFtZSl9aWYoIWhhbmRsZS4kJC5wdHIpe3Rocm93QmluZGluZ0Vycm9yKCJDYW5ub3QgcGFzcyBkZWxldGVkIG9iamVjdCBhcyBhIHBvaW50ZXIgb2YgdHlwZSAiK3RoaXMubmFtZSl9aWYoIXRoaXMuaXNDb25zdCYmaGFuZGxlLiQkLnB0clR5cGUuaXNDb25zdCl7dGhyb3dCaW5kaW5nRXJyb3IoIkNhbm5vdCBjb252ZXJ0IGFyZ3VtZW50IG9mIHR5cGUgIisoaGFuZGxlLiQkLnNtYXJ0UHRyVHlwZT9oYW5kbGUuJCQuc21hcnRQdHJUeXBlLm5hbWU6aGFuZGxlLiQkLnB0clR5cGUubmFtZSkrIiB0byBwYXJhbWV0ZXIgdHlwZSAiK3RoaXMubmFtZSl9dmFyIGhhbmRsZUNsYXNzPWhhbmRsZS4kJC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzcztwdHI9dXBjYXN0UG9pbnRlcihoYW5kbGUuJCQucHRyLGhhbmRsZUNsYXNzLHRoaXMucmVnaXN0ZXJlZENsYXNzKTtpZih0aGlzLmlzU21hcnRQb2ludGVyKXtpZih1bmRlZmluZWQ9PT1oYW5kbGUuJCQuc21hcnRQdHIpe3Rocm93QmluZGluZ0Vycm9yKCJQYXNzaW5nIHJhdyBwb2ludGVyIHRvIHNtYXJ0IHBvaW50ZXIgaXMgaWxsZWdhbCIpfXN3aXRjaCh0aGlzLnNoYXJpbmdQb2xpY3kpe2Nhc2UgMDppZihoYW5kbGUuJCQuc21hcnRQdHJUeXBlPT09dGhpcyl7cHRyPWhhbmRsZS4kJC5zbWFydFB0cn1lbHNle3Rocm93QmluZGluZ0Vycm9yKCJDYW5ub3QgY29udmVydCBhcmd1bWVudCBvZiB0eXBlICIrKGhhbmRsZS4kJC5zbWFydFB0clR5cGU/aGFuZGxlLiQkLnNtYXJ0UHRyVHlwZS5uYW1lOmhhbmRsZS4kJC5wdHJUeXBlLm5hbWUpKyIgdG8gcGFyYW1ldGVyIHR5cGUgIit0aGlzLm5hbWUpfWJyZWFrO2Nhc2UgMTpwdHI9aGFuZGxlLiQkLnNtYXJ0UHRyO2JyZWFrO2Nhc2UgMjppZihoYW5kbGUuJCQuc21hcnRQdHJUeXBlPT09dGhpcyl7cHRyPWhhbmRsZS4kJC5zbWFydFB0cn1lbHNle3ZhciBjbG9uZWRIYW5kbGU9aGFuZGxlWyJjbG9uZSJdKCk7cHRyPXRoaXMucmF3U2hhcmUocHRyLF9fZW12YWxfcmVnaXN0ZXIoZnVuY3Rpb24oKXtjbG9uZWRIYW5kbGVbImRlbGV0ZSJdKCl9KSk7aWYoZGVzdHJ1Y3RvcnMhPT1udWxsKXtkZXN0cnVjdG9ycy5wdXNoKHRoaXMucmF3RGVzdHJ1Y3RvcixwdHIpfX1icmVhaztkZWZhdWx0OnRocm93QmluZGluZ0Vycm9yKCJVbnN1cHBvcnRpbmcgc2hhcmluZyBwb2xpY3kiKX19cmV0dXJuIHB0cn1mdW5jdGlvbiBub25Db25zdE5vU21hcnRQdHJSYXdQb2ludGVyVG9XaXJlVHlwZShkZXN0cnVjdG9ycyxoYW5kbGUpe2lmKGhhbmRsZT09PW51bGwpe2lmKHRoaXMuaXNSZWZlcmVuY2Upe3Rocm93QmluZGluZ0Vycm9yKCJudWxsIGlzIG5vdCBhIHZhbGlkICIrdGhpcy5uYW1lKX1yZXR1cm4gMH1pZighaGFuZGxlLiQkKXt0aHJvd0JpbmRpbmdFcnJvcignQ2Fubm90IHBhc3MgIicrX2VtYmluZF9yZXByKGhhbmRsZSkrJyIgYXMgYSAnK3RoaXMubmFtZSl9aWYoIWhhbmRsZS4kJC5wdHIpe3Rocm93QmluZGluZ0Vycm9yKCJDYW5ub3QgcGFzcyBkZWxldGVkIG9iamVjdCBhcyBhIHBvaW50ZXIgb2YgdHlwZSAiK3RoaXMubmFtZSl9aWYoaGFuZGxlLiQkLnB0clR5cGUuaXNDb25zdCl7dGhyb3dCaW5kaW5nRXJyb3IoIkNhbm5vdCBjb252ZXJ0IGFyZ3VtZW50IG9mIHR5cGUgIitoYW5kbGUuJCQucHRyVHlwZS5uYW1lKyIgdG8gcGFyYW1ldGVyIHR5cGUgIit0aGlzLm5hbWUpfXZhciBoYW5kbGVDbGFzcz1oYW5kbGUuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3M7dmFyIHB0cj11cGNhc3RQb2ludGVyKGhhbmRsZS4kJC5wdHIsaGFuZGxlQ2xhc3MsdGhpcy5yZWdpc3RlcmVkQ2xhc3MpO3JldHVybiBwdHJ9ZnVuY3Rpb24gc2ltcGxlUmVhZFZhbHVlRnJvbVBvaW50ZXIocG9pbnRlcil7cmV0dXJuIHRoaXNbImZyb21XaXJlVHlwZSJdKEhFQVBVMzJbcG9pbnRlcj4+Ml0pfWZ1bmN0aW9uIFJlZ2lzdGVyZWRQb2ludGVyX2dldFBvaW50ZWUocHRyKXtpZih0aGlzLnJhd0dldFBvaW50ZWUpe3B0cj10aGlzLnJhd0dldFBvaW50ZWUocHRyKX1yZXR1cm4gcHRyfWZ1bmN0aW9uIFJlZ2lzdGVyZWRQb2ludGVyX2Rlc3RydWN0b3IocHRyKXtpZih0aGlzLnJhd0Rlc3RydWN0b3Ipe3RoaXMucmF3RGVzdHJ1Y3RvcihwdHIpfX1mdW5jdGlvbiBSZWdpc3RlcmVkUG9pbnRlcl9kZWxldGVPYmplY3QoaGFuZGxlKXtpZihoYW5kbGUhPT1udWxsKXtoYW5kbGVbImRlbGV0ZSJdKCl9fWZ1bmN0aW9uIGRvd25jYXN0UG9pbnRlcihwdHIscHRyQ2xhc3MsZGVzaXJlZENsYXNzKXtpZihwdHJDbGFzcz09PWRlc2lyZWRDbGFzcyl7cmV0dXJuIHB0cn1pZih1bmRlZmluZWQ9PT1kZXNpcmVkQ2xhc3MuYmFzZUNsYXNzKXtyZXR1cm4gbnVsbH12YXIgcnY9ZG93bmNhc3RQb2ludGVyKHB0cixwdHJDbGFzcyxkZXNpcmVkQ2xhc3MuYmFzZUNsYXNzKTtpZihydj09PW51bGwpe3JldHVybiBudWxsfXJldHVybiBkZXNpcmVkQ2xhc3MuZG93bmNhc3QocnYpfWZ1bmN0aW9uIGdldEluaGVyaXRlZEluc3RhbmNlQ291bnQoKXtyZXR1cm4gT2JqZWN0LmtleXMocmVnaXN0ZXJlZEluc3RhbmNlcykubGVuZ3RofWZ1bmN0aW9uIGdldExpdmVJbmhlcml0ZWRJbnN0YW5jZXMoKXt2YXIgcnY9W107Zm9yKHZhciBrIGluIHJlZ2lzdGVyZWRJbnN0YW5jZXMpe2lmKHJlZ2lzdGVyZWRJbnN0YW5jZXMuaGFzT3duUHJvcGVydHkoaykpe3J2LnB1c2gocmVnaXN0ZXJlZEluc3RhbmNlc1trXSl9fXJldHVybiBydn1mdW5jdGlvbiBzZXREZWxheUZ1bmN0aW9uKGZuKXtkZWxheUZ1bmN0aW9uPWZuO2lmKGRlbGV0aW9uUXVldWUubGVuZ3RoJiZkZWxheUZ1bmN0aW9uKXtkZWxheUZ1bmN0aW9uKGZsdXNoUGVuZGluZ0RlbGV0ZXMpfX1mdW5jdGlvbiBpbml0X2VtYmluZCgpe01vZHVsZVsiZ2V0SW5oZXJpdGVkSW5zdGFuY2VDb3VudCJdPWdldEluaGVyaXRlZEluc3RhbmNlQ291bnQ7TW9kdWxlWyJnZXRMaXZlSW5oZXJpdGVkSW5zdGFuY2VzIl09Z2V0TGl2ZUluaGVyaXRlZEluc3RhbmNlcztNb2R1bGVbImZsdXNoUGVuZGluZ0RlbGV0ZXMiXT1mbHVzaFBlbmRpbmdEZWxldGVzO01vZHVsZVsic2V0RGVsYXlGdW5jdGlvbiJdPXNldERlbGF5RnVuY3Rpb259dmFyIHJlZ2lzdGVyZWRJbnN0YW5jZXM9e307ZnVuY3Rpb24gZ2V0QmFzZXN0UG9pbnRlcihjbGFzc18scHRyKXtpZihwdHI9PT11bmRlZmluZWQpe3Rocm93QmluZGluZ0Vycm9yKCJwdHIgc2hvdWxkIG5vdCBiZSB1bmRlZmluZWQiKX13aGlsZShjbGFzc18uYmFzZUNsYXNzKXtwdHI9Y2xhc3NfLnVwY2FzdChwdHIpO2NsYXNzXz1jbGFzc18uYmFzZUNsYXNzfXJldHVybiBwdHJ9ZnVuY3Rpb24gZ2V0SW5oZXJpdGVkSW5zdGFuY2UoY2xhc3NfLHB0cil7cHRyPWdldEJhc2VzdFBvaW50ZXIoY2xhc3NfLHB0cik7cmV0dXJuIHJlZ2lzdGVyZWRJbnN0YW5jZXNbcHRyXX1mdW5jdGlvbiBtYWtlQ2xhc3NIYW5kbGUocHJvdG90eXBlLHJlY29yZCl7aWYoIXJlY29yZC5wdHJUeXBlfHwhcmVjb3JkLnB0cil7dGhyb3dJbnRlcm5hbEVycm9yKCJtYWtlQ2xhc3NIYW5kbGUgcmVxdWlyZXMgcHRyIGFuZCBwdHJUeXBlIil9dmFyIGhhc1NtYXJ0UHRyVHlwZT0hIXJlY29yZC5zbWFydFB0clR5cGU7dmFyIGhhc1NtYXJ0UHRyPSEhcmVjb3JkLnNtYXJ0UHRyO2lmKGhhc1NtYXJ0UHRyVHlwZSE9PWhhc1NtYXJ0UHRyKXt0aHJvd0ludGVybmFsRXJyb3IoIkJvdGggc21hcnRQdHJUeXBlIGFuZCBzbWFydFB0ciBtdXN0IGJlIHNwZWNpZmllZCIpfXJlY29yZC5jb3VudD17dmFsdWU6MX07cmV0dXJuIGF0dGFjaEZpbmFsaXplcihPYmplY3QuY3JlYXRlKHByb3RvdHlwZSx7JCQ6e3ZhbHVlOnJlY29yZH19KSl9ZnVuY3Rpb24gUmVnaXN0ZXJlZFBvaW50ZXJfZnJvbVdpcmVUeXBlKHB0cil7dmFyIHJhd1BvaW50ZXI9dGhpcy5nZXRQb2ludGVlKHB0cik7aWYoIXJhd1BvaW50ZXIpe3RoaXMuZGVzdHJ1Y3RvcihwdHIpO3JldHVybiBudWxsfXZhciByZWdpc3RlcmVkSW5zdGFuY2U9Z2V0SW5oZXJpdGVkSW5zdGFuY2UodGhpcy5yZWdpc3RlcmVkQ2xhc3MscmF3UG9pbnRlcik7aWYodW5kZWZpbmVkIT09cmVnaXN0ZXJlZEluc3RhbmNlKXtpZigwPT09cmVnaXN0ZXJlZEluc3RhbmNlLiQkLmNvdW50LnZhbHVlKXtyZWdpc3RlcmVkSW5zdGFuY2UuJCQucHRyPXJhd1BvaW50ZXI7cmVnaXN0ZXJlZEluc3RhbmNlLiQkLnNtYXJ0UHRyPXB0cjtyZXR1cm4gcmVnaXN0ZXJlZEluc3RhbmNlWyJjbG9uZSJdKCl9ZWxzZXt2YXIgcnY9cmVnaXN0ZXJlZEluc3RhbmNlWyJjbG9uZSJdKCk7dGhpcy5kZXN0cnVjdG9yKHB0cik7cmV0dXJuIHJ2fX1mdW5jdGlvbiBtYWtlRGVmYXVsdEhhbmRsZSgpe2lmKHRoaXMuaXNTbWFydFBvaW50ZXIpe3JldHVybiBtYWtlQ2xhc3NIYW5kbGUodGhpcy5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUse3B0clR5cGU6dGhpcy5wb2ludGVlVHlwZSxwdHI6cmF3UG9pbnRlcixzbWFydFB0clR5cGU6dGhpcyxzbWFydFB0cjpwdHJ9KX1lbHNle3JldHVybiBtYWtlQ2xhc3NIYW5kbGUodGhpcy5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUse3B0clR5cGU6dGhpcyxwdHI6cHRyfSl9fXZhciBhY3R1YWxUeXBlPXRoaXMucmVnaXN0ZXJlZENsYXNzLmdldEFjdHVhbFR5cGUocmF3UG9pbnRlcik7dmFyIHJlZ2lzdGVyZWRQb2ludGVyUmVjb3JkPXJlZ2lzdGVyZWRQb2ludGVyc1thY3R1YWxUeXBlXTtpZighcmVnaXN0ZXJlZFBvaW50ZXJSZWNvcmQpe3JldHVybiBtYWtlRGVmYXVsdEhhbmRsZS5jYWxsKHRoaXMpfXZhciB0b1R5cGU7aWYodGhpcy5pc0NvbnN0KXt0b1R5cGU9cmVnaXN0ZXJlZFBvaW50ZXJSZWNvcmQuY29uc3RQb2ludGVyVHlwZX1lbHNle3RvVHlwZT1yZWdpc3RlcmVkUG9pbnRlclJlY29yZC5wb2ludGVyVHlwZX12YXIgZHA9ZG93bmNhc3RQb2ludGVyKHJhd1BvaW50ZXIsdGhpcy5yZWdpc3RlcmVkQ2xhc3MsdG9UeXBlLnJlZ2lzdGVyZWRDbGFzcyk7aWYoZHA9PT1udWxsKXtyZXR1cm4gbWFrZURlZmF1bHRIYW5kbGUuY2FsbCh0aGlzKX1pZih0aGlzLmlzU21hcnRQb2ludGVyKXtyZXR1cm4gbWFrZUNsYXNzSGFuZGxlKHRvVHlwZS5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUse3B0clR5cGU6dG9UeXBlLHB0cjpkcCxzbWFydFB0clR5cGU6dGhpcyxzbWFydFB0cjpwdHJ9KX1lbHNle3JldHVybiBtYWtlQ2xhc3NIYW5kbGUodG9UeXBlLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZSx7cHRyVHlwZTp0b1R5cGUscHRyOmRwfSl9fWZ1bmN0aW9uIGluaXRfUmVnaXN0ZXJlZFBvaW50ZXIoKXtSZWdpc3RlcmVkUG9pbnRlci5wcm90b3R5cGUuZ2V0UG9pbnRlZT1SZWdpc3RlcmVkUG9pbnRlcl9nZXRQb2ludGVlO1JlZ2lzdGVyZWRQb2ludGVyLnByb3RvdHlwZS5kZXN0cnVjdG9yPVJlZ2lzdGVyZWRQb2ludGVyX2Rlc3RydWN0b3I7UmVnaXN0ZXJlZFBvaW50ZXIucHJvdG90eXBlWyJhcmdQYWNrQWR2YW5jZSJdPTg7UmVnaXN0ZXJlZFBvaW50ZXIucHJvdG90eXBlWyJyZWFkVmFsdWVGcm9tUG9pbnRlciJdPXNpbXBsZVJlYWRWYWx1ZUZyb21Qb2ludGVyO1JlZ2lzdGVyZWRQb2ludGVyLnByb3RvdHlwZVsiZGVsZXRlT2JqZWN0Il09UmVnaXN0ZXJlZFBvaW50ZXJfZGVsZXRlT2JqZWN0O1JlZ2lzdGVyZWRQb2ludGVyLnByb3RvdHlwZVsiZnJvbVdpcmVUeXBlIl09UmVnaXN0ZXJlZFBvaW50ZXJfZnJvbVdpcmVUeXBlfWZ1bmN0aW9uIFJlZ2lzdGVyZWRQb2ludGVyKG5hbWUscmVnaXN0ZXJlZENsYXNzLGlzUmVmZXJlbmNlLGlzQ29uc3QsaXNTbWFydFBvaW50ZXIscG9pbnRlZVR5cGUsc2hhcmluZ1BvbGljeSxyYXdHZXRQb2ludGVlLHJhd0NvbnN0cnVjdG9yLHJhd1NoYXJlLHJhd0Rlc3RydWN0b3Ipe3RoaXMubmFtZT1uYW1lO3RoaXMucmVnaXN0ZXJlZENsYXNzPXJlZ2lzdGVyZWRDbGFzczt0aGlzLmlzUmVmZXJlbmNlPWlzUmVmZXJlbmNlO3RoaXMuaXNDb25zdD1pc0NvbnN0O3RoaXMuaXNTbWFydFBvaW50ZXI9aXNTbWFydFBvaW50ZXI7dGhpcy5wb2ludGVlVHlwZT1wb2ludGVlVHlwZTt0aGlzLnNoYXJpbmdQb2xpY3k9c2hhcmluZ1BvbGljeTt0aGlzLnJhd0dldFBvaW50ZWU9cmF3R2V0UG9pbnRlZTt0aGlzLnJhd0NvbnN0cnVjdG9yPXJhd0NvbnN0cnVjdG9yO3RoaXMucmF3U2hhcmU9cmF3U2hhcmU7dGhpcy5yYXdEZXN0cnVjdG9yPXJhd0Rlc3RydWN0b3I7aWYoIWlzU21hcnRQb2ludGVyJiZyZWdpc3RlcmVkQ2xhc3MuYmFzZUNsYXNzPT09dW5kZWZpbmVkKXtpZihpc0NvbnN0KXt0aGlzWyJ0b1dpcmVUeXBlIl09Y29uc3ROb1NtYXJ0UHRyUmF3UG9pbnRlclRvV2lyZVR5cGU7dGhpcy5kZXN0cnVjdG9yRnVuY3Rpb249bnVsbH1lbHNle3RoaXNbInRvV2lyZVR5cGUiXT1ub25Db25zdE5vU21hcnRQdHJSYXdQb2ludGVyVG9XaXJlVHlwZTt0aGlzLmRlc3RydWN0b3JGdW5jdGlvbj1udWxsfX1lbHNle3RoaXNbInRvV2lyZVR5cGUiXT1nZW5lcmljUG9pbnRlclRvV2lyZVR5cGV9fWZ1bmN0aW9uIHJlcGxhY2VQdWJsaWNTeW1ib2wobmFtZSx2YWx1ZSxudW1Bcmd1bWVudHMpe2lmKCFNb2R1bGUuaGFzT3duUHJvcGVydHkobmFtZSkpe3Rocm93SW50ZXJuYWxFcnJvcigiUmVwbGFjaW5nIG5vbmV4aXN0YW50IHB1YmxpYyBzeW1ib2wiKX1pZih1bmRlZmluZWQhPT1Nb2R1bGVbbmFtZV0ub3ZlcmxvYWRUYWJsZSYmdW5kZWZpbmVkIT09bnVtQXJndW1lbnRzKXtNb2R1bGVbbmFtZV0ub3ZlcmxvYWRUYWJsZVtudW1Bcmd1bWVudHNdPXZhbHVlfWVsc2V7TW9kdWxlW25hbWVdPXZhbHVlO01vZHVsZVtuYW1lXS5hcmdDb3VudD1udW1Bcmd1bWVudHN9fWZ1bmN0aW9uIGR5bkNhbGxMZWdhY3koc2lnLHB0cixhcmdzKXt2YXIgZj1Nb2R1bGVbImR5bkNhbGxfIitzaWddO3JldHVybiBhcmdzJiZhcmdzLmxlbmd0aD9mLmFwcGx5KG51bGwsW3B0cl0uY29uY2F0KGFyZ3MpKTpmLmNhbGwobnVsbCxwdHIpfWZ1bmN0aW9uIGR5bkNhbGwoc2lnLHB0cixhcmdzKXtpZihzaWcuaW5kZXhPZigiaiIpIT0tMSl7cmV0dXJuIGR5bkNhbGxMZWdhY3koc2lnLHB0cixhcmdzKX1yZXR1cm4gd2FzbVRhYmxlLmdldChwdHIpLmFwcGx5KG51bGwsYXJncyl9ZnVuY3Rpb24gZ2V0RHluQ2FsbGVyKHNpZyxwdHIpe3ZhciBhcmdDYWNoZT1bXTtyZXR1cm4gZnVuY3Rpb24oKXthcmdDYWNoZS5sZW5ndGg9YXJndW1lbnRzLmxlbmd0aDtmb3IodmFyIGk9MDtpPGFyZ3VtZW50cy5sZW5ndGg7aSsrKXthcmdDYWNoZVtpXT1hcmd1bWVudHNbaV19cmV0dXJuIGR5bkNhbGwoc2lnLHB0cixhcmdDYWNoZSl9fWZ1bmN0aW9uIGVtYmluZF9fcmVxdWlyZUZ1bmN0aW9uKHNpZ25hdHVyZSxyYXdGdW5jdGlvbil7c2lnbmF0dXJlPXJlYWRMYXRpbjFTdHJpbmcoc2lnbmF0dXJlKTtmdW5jdGlvbiBtYWtlRHluQ2FsbGVyKCl7aWYoc2lnbmF0dXJlLmluZGV4T2YoImoiKSE9LTEpe3JldHVybiBnZXREeW5DYWxsZXIoc2lnbmF0dXJlLHJhd0Z1bmN0aW9uKX1yZXR1cm4gd2FzbVRhYmxlLmdldChyYXdGdW5jdGlvbil9dmFyIGZwPW1ha2VEeW5DYWxsZXIoKTtpZih0eXBlb2YgZnAhPT0iZnVuY3Rpb24iKXt0aHJvd0JpbmRpbmdFcnJvcigidW5rbm93biBmdW5jdGlvbiBwb2ludGVyIHdpdGggc2lnbmF0dXJlICIrc2lnbmF0dXJlKyI6ICIrcmF3RnVuY3Rpb24pfXJldHVybiBmcH12YXIgVW5ib3VuZFR5cGVFcnJvcj11bmRlZmluZWQ7ZnVuY3Rpb24gZ2V0VHlwZU5hbWUodHlwZSl7dmFyIHB0cj1fX19nZXRUeXBlTmFtZSh0eXBlKTt2YXIgcnY9cmVhZExhdGluMVN0cmluZyhwdHIpO19mcmVlKHB0cik7cmV0dXJuIHJ2fWZ1bmN0aW9uIHRocm93VW5ib3VuZFR5cGVFcnJvcihtZXNzYWdlLHR5cGVzKXt2YXIgdW5ib3VuZFR5cGVzPVtdO3ZhciBzZWVuPXt9O2Z1bmN0aW9uIHZpc2l0KHR5cGUpe2lmKHNlZW5bdHlwZV0pe3JldHVybn1pZihyZWdpc3RlcmVkVHlwZXNbdHlwZV0pe3JldHVybn1pZih0eXBlRGVwZW5kZW5jaWVzW3R5cGVdKXt0eXBlRGVwZW5kZW5jaWVzW3R5cGVdLmZvckVhY2godmlzaXQpO3JldHVybn11bmJvdW5kVHlwZXMucHVzaCh0eXBlKTtzZWVuW3R5cGVdPXRydWV9dHlwZXMuZm9yRWFjaCh2aXNpdCk7dGhyb3cgbmV3IFVuYm91bmRUeXBlRXJyb3IobWVzc2FnZSsiOiAiK3VuYm91bmRUeXBlcy5tYXAoZ2V0VHlwZU5hbWUpLmpvaW4oWyIsICJdKSl9ZnVuY3Rpb24gX19lbWJpbmRfcmVnaXN0ZXJfY2xhc3MocmF3VHlwZSxyYXdQb2ludGVyVHlwZSxyYXdDb25zdFBvaW50ZXJUeXBlLGJhc2VDbGFzc1Jhd1R5cGUsZ2V0QWN0dWFsVHlwZVNpZ25hdHVyZSxnZXRBY3R1YWxUeXBlLHVwY2FzdFNpZ25hdHVyZSx1cGNhc3QsZG93bmNhc3RTaWduYXR1cmUsZG93bmNhc3QsbmFtZSxkZXN0cnVjdG9yU2lnbmF0dXJlLHJhd0Rlc3RydWN0b3Ipe25hbWU9cmVhZExhdGluMVN0cmluZyhuYW1lKTtnZXRBY3R1YWxUeXBlPWVtYmluZF9fcmVxdWlyZUZ1bmN0aW9uKGdldEFjdHVhbFR5cGVTaWduYXR1cmUsZ2V0QWN0dWFsVHlwZSk7aWYodXBjYXN0KXt1cGNhc3Q9ZW1iaW5kX19yZXF1aXJlRnVuY3Rpb24odXBjYXN0U2lnbmF0dXJlLHVwY2FzdCl9aWYoZG93bmNhc3Qpe2Rvd25jYXN0PWVtYmluZF9fcmVxdWlyZUZ1bmN0aW9uKGRvd25jYXN0U2lnbmF0dXJlLGRvd25jYXN0KX1yYXdEZXN0cnVjdG9yPWVtYmluZF9fcmVxdWlyZUZ1bmN0aW9uKGRlc3RydWN0b3JTaWduYXR1cmUscmF3RGVzdHJ1Y3Rvcik7dmFyIGxlZ2FsRnVuY3Rpb25OYW1lPW1ha2VMZWdhbEZ1bmN0aW9uTmFtZShuYW1lKTtleHBvc2VQdWJsaWNTeW1ib2wobGVnYWxGdW5jdGlvbk5hbWUsZnVuY3Rpb24oKXt0aHJvd1VuYm91bmRUeXBlRXJyb3IoIkNhbm5vdCBjb25zdHJ1Y3QgIituYW1lKyIgZHVlIHRvIHVuYm91bmQgdHlwZXMiLFtiYXNlQ2xhc3NSYXdUeXBlXSl9KTt3aGVuRGVwZW5kZW50VHlwZXNBcmVSZXNvbHZlZChbcmF3VHlwZSxyYXdQb2ludGVyVHlwZSxyYXdDb25zdFBvaW50ZXJUeXBlXSxiYXNlQ2xhc3NSYXdUeXBlP1tiYXNlQ2xhc3NSYXdUeXBlXTpbXSxmdW5jdGlvbihiYXNlKXtiYXNlPWJhc2VbMF07dmFyIGJhc2VDbGFzczt2YXIgYmFzZVByb3RvdHlwZTtpZihiYXNlQ2xhc3NSYXdUeXBlKXtiYXNlQ2xhc3M9YmFzZS5yZWdpc3RlcmVkQ2xhc3M7YmFzZVByb3RvdHlwZT1iYXNlQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGV9ZWxzZXtiYXNlUHJvdG90eXBlPUNsYXNzSGFuZGxlLnByb3RvdHlwZX12YXIgY29uc3RydWN0b3I9Y3JlYXRlTmFtZWRGdW5jdGlvbihsZWdhbEZ1bmN0aW9uTmFtZSxmdW5jdGlvbigpe2lmKE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKSE9PWluc3RhbmNlUHJvdG90eXBlKXt0aHJvdyBuZXcgQmluZGluZ0Vycm9yKCJVc2UgJ25ldycgdG8gY29uc3RydWN0ICIrbmFtZSl9aWYodW5kZWZpbmVkPT09cmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHkpe3Rocm93IG5ldyBCaW5kaW5nRXJyb3IobmFtZSsiIGhhcyBubyBhY2Nlc3NpYmxlIGNvbnN0cnVjdG9yIil9dmFyIGJvZHk9cmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHlbYXJndW1lbnRzLmxlbmd0aF07aWYodW5kZWZpbmVkPT09Ym9keSl7dGhyb3cgbmV3IEJpbmRpbmdFcnJvcigiVHJpZWQgdG8gaW52b2tlIGN0b3Igb2YgIituYW1lKyIgd2l0aCBpbnZhbGlkIG51bWJlciBvZiBwYXJhbWV0ZXJzICgiK2FyZ3VtZW50cy5sZW5ndGgrIikgLSBleHBlY3RlZCAoIitPYmplY3Qua2V5cyhyZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keSkudG9TdHJpbmcoKSsiKSBwYXJhbWV0ZXJzIGluc3RlYWQhIil9cmV0dXJuIGJvZHkuYXBwbHkodGhpcyxhcmd1bWVudHMpfSk7dmFyIGluc3RhbmNlUHJvdG90eXBlPU9iamVjdC5jcmVhdGUoYmFzZVByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOmNvbnN0cnVjdG9yfX0pO2NvbnN0cnVjdG9yLnByb3RvdHlwZT1pbnN0YW5jZVByb3RvdHlwZTt2YXIgcmVnaXN0ZXJlZENsYXNzPW5ldyBSZWdpc3RlcmVkQ2xhc3MobmFtZSxjb25zdHJ1Y3RvcixpbnN0YW5jZVByb3RvdHlwZSxyYXdEZXN0cnVjdG9yLGJhc2VDbGFzcyxnZXRBY3R1YWxUeXBlLHVwY2FzdCxkb3duY2FzdCk7dmFyIHJlZmVyZW5jZUNvbnZlcnRlcj1uZXcgUmVnaXN0ZXJlZFBvaW50ZXIobmFtZSxyZWdpc3RlcmVkQ2xhc3MsdHJ1ZSxmYWxzZSxmYWxzZSk7dmFyIHBvaW50ZXJDb252ZXJ0ZXI9bmV3IFJlZ2lzdGVyZWRQb2ludGVyKG5hbWUrIioiLHJlZ2lzdGVyZWRDbGFzcyxmYWxzZSxmYWxzZSxmYWxzZSk7dmFyIGNvbnN0UG9pbnRlckNvbnZlcnRlcj1uZXcgUmVnaXN0ZXJlZFBvaW50ZXIobmFtZSsiIGNvbnN0KiIscmVnaXN0ZXJlZENsYXNzLGZhbHNlLHRydWUsZmFsc2UpO3JlZ2lzdGVyZWRQb2ludGVyc1tyYXdUeXBlXT17cG9pbnRlclR5cGU6cG9pbnRlckNvbnZlcnRlcixjb25zdFBvaW50ZXJUeXBlOmNvbnN0UG9pbnRlckNvbnZlcnRlcn07cmVwbGFjZVB1YmxpY1N5bWJvbChsZWdhbEZ1bmN0aW9uTmFtZSxjb25zdHJ1Y3Rvcik7cmV0dXJuW3JlZmVyZW5jZUNvbnZlcnRlcixwb2ludGVyQ29udmVydGVyLGNvbnN0UG9pbnRlckNvbnZlcnRlcl19KX1mdW5jdGlvbiBuZXdfKGNvbnN0cnVjdG9yLGFyZ3VtZW50TGlzdCl7aWYoIShjb25zdHJ1Y3RvciBpbnN0YW5jZW9mIEZ1bmN0aW9uKSl7dGhyb3cgbmV3IFR5cGVFcnJvcigibmV3XyBjYWxsZWQgd2l0aCBjb25zdHJ1Y3RvciB0eXBlICIrdHlwZW9mIGNvbnN0cnVjdG9yKyIgd2hpY2ggaXMgbm90IGEgZnVuY3Rpb24iKX12YXIgZHVtbXk9Y3JlYXRlTmFtZWRGdW5jdGlvbihjb25zdHJ1Y3Rvci5uYW1lfHwidW5rbm93bkZ1bmN0aW9uTmFtZSIsZnVuY3Rpb24oKXt9KTtkdW1teS5wcm90b3R5cGU9Y29uc3RydWN0b3IucHJvdG90eXBlO3ZhciBvYmo9bmV3IGR1bW15O3ZhciByPWNvbnN0cnVjdG9yLmFwcGx5KG9iaixhcmd1bWVudExpc3QpO3JldHVybiByIGluc3RhbmNlb2YgT2JqZWN0P3I6b2JqfWZ1bmN0aW9uIHJ1bkRlc3RydWN0b3JzKGRlc3RydWN0b3JzKXt3aGlsZShkZXN0cnVjdG9ycy5sZW5ndGgpe3ZhciBwdHI9ZGVzdHJ1Y3RvcnMucG9wKCk7dmFyIGRlbD1kZXN0cnVjdG9ycy5wb3AoKTtkZWwocHRyKX19ZnVuY3Rpb24gY3JhZnRJbnZva2VyRnVuY3Rpb24oaHVtYW5OYW1lLGFyZ1R5cGVzLGNsYXNzVHlwZSxjcHBJbnZva2VyRnVuYyxjcHBUYXJnZXRGdW5jKXt2YXIgYXJnQ291bnQ9YXJnVHlwZXMubGVuZ3RoO2lmKGFyZ0NvdW50PDIpe3Rocm93QmluZGluZ0Vycm9yKCJhcmdUeXBlcyBhcnJheSBzaXplIG1pc21hdGNoISBNdXN0IGF0IGxlYXN0IGdldCByZXR1cm4gdmFsdWUgYW5kICd0aGlzJyB0eXBlcyEiKX12YXIgaXNDbGFzc01ldGhvZEZ1bmM9YXJnVHlwZXNbMV0hPT1udWxsJiZjbGFzc1R5cGUhPT1udWxsO3ZhciBuZWVkc0Rlc3RydWN0b3JTdGFjaz1mYWxzZTtmb3IodmFyIGk9MTtpPGFyZ1R5cGVzLmxlbmd0aDsrK2kpe2lmKGFyZ1R5cGVzW2ldIT09bnVsbCYmYXJnVHlwZXNbaV0uZGVzdHJ1Y3RvckZ1bmN0aW9uPT09dW5kZWZpbmVkKXtuZWVkc0Rlc3RydWN0b3JTdGFjaz10cnVlO2JyZWFrfX12YXIgcmV0dXJucz1hcmdUeXBlc1swXS5uYW1lIT09InZvaWQiO3ZhciBhcmdzTGlzdD0iIjt2YXIgYXJnc0xpc3RXaXJlZD0iIjtmb3IodmFyIGk9MDtpPGFyZ0NvdW50LTI7KytpKXthcmdzTGlzdCs9KGkhPT0wPyIsICI6IiIpKyJhcmciK2k7YXJnc0xpc3RXaXJlZCs9KGkhPT0wPyIsICI6IiIpKyJhcmciK2krIldpcmVkIn12YXIgaW52b2tlckZuQm9keT0icmV0dXJuIGZ1bmN0aW9uICIrbWFrZUxlZ2FsRnVuY3Rpb25OYW1lKGh1bWFuTmFtZSkrIigiK2FyZ3NMaXN0KyIpIHtcbiIrImlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAiKyhhcmdDb3VudC0yKSsiKSB7XG4iKyJ0aHJvd0JpbmRpbmdFcnJvcignZnVuY3Rpb24gIitodW1hbk5hbWUrIiBjYWxsZWQgd2l0aCAnICsgYXJndW1lbnRzLmxlbmd0aCArICcgYXJndW1lbnRzLCBleHBlY3RlZCAiKyhhcmdDb3VudC0yKSsiIGFyZ3MhJyk7XG4iKyJ9XG4iO2lmKG5lZWRzRGVzdHJ1Y3RvclN0YWNrKXtpbnZva2VyRm5Cb2R5Kz0idmFyIGRlc3RydWN0b3JzID0gW107XG4ifXZhciBkdG9yU3RhY2s9bmVlZHNEZXN0cnVjdG9yU3RhY2s/ImRlc3RydWN0b3JzIjoibnVsbCI7dmFyIGFyZ3MxPVsidGhyb3dCaW5kaW5nRXJyb3IiLCJpbnZva2VyIiwiZm4iLCJydW5EZXN0cnVjdG9ycyIsInJldFR5cGUiLCJjbGFzc1BhcmFtIl07dmFyIGFyZ3MyPVt0aHJvd0JpbmRpbmdFcnJvcixjcHBJbnZva2VyRnVuYyxjcHBUYXJnZXRGdW5jLHJ1bkRlc3RydWN0b3JzLGFyZ1R5cGVzWzBdLGFyZ1R5cGVzWzFdXTtpZihpc0NsYXNzTWV0aG9kRnVuYyl7aW52b2tlckZuQm9keSs9InZhciB0aGlzV2lyZWQgPSBjbGFzc1BhcmFtLnRvV2lyZVR5cGUoIitkdG9yU3RhY2srIiwgdGhpcyk7XG4ifWZvcih2YXIgaT0wO2k8YXJnQ291bnQtMjsrK2kpe2ludm9rZXJGbkJvZHkrPSJ2YXIgYXJnIitpKyJXaXJlZCA9IGFyZ1R5cGUiK2krIi50b1dpcmVUeXBlKCIrZHRvclN0YWNrKyIsIGFyZyIraSsiKTsgLy8gIithcmdUeXBlc1tpKzJdLm5hbWUrIlxuIjthcmdzMS5wdXNoKCJhcmdUeXBlIitpKTthcmdzMi5wdXNoKGFyZ1R5cGVzW2krMl0pfWlmKGlzQ2xhc3NNZXRob2RGdW5jKXthcmdzTGlzdFdpcmVkPSJ0aGlzV2lyZWQiKyhhcmdzTGlzdFdpcmVkLmxlbmd0aD4wPyIsICI6IiIpK2FyZ3NMaXN0V2lyZWR9aW52b2tlckZuQm9keSs9KHJldHVybnM/InZhciBydiA9ICI6IiIpKyJpbnZva2VyKGZuIisoYXJnc0xpc3RXaXJlZC5sZW5ndGg+MD8iLCAiOiIiKSthcmdzTGlzdFdpcmVkKyIpO1xuIjtpZihuZWVkc0Rlc3RydWN0b3JTdGFjayl7aW52b2tlckZuQm9keSs9InJ1bkRlc3RydWN0b3JzKGRlc3RydWN0b3JzKTtcbiJ9ZWxzZXtmb3IodmFyIGk9aXNDbGFzc01ldGhvZEZ1bmM/MToyO2k8YXJnVHlwZXMubGVuZ3RoOysraSl7dmFyIHBhcmFtTmFtZT1pPT09MT8idGhpc1dpcmVkIjoiYXJnIisoaS0yKSsiV2lyZWQiO2lmKGFyZ1R5cGVzW2ldLmRlc3RydWN0b3JGdW5jdGlvbiE9PW51bGwpe2ludm9rZXJGbkJvZHkrPXBhcmFtTmFtZSsiX2R0b3IoIitwYXJhbU5hbWUrIik7IC8vICIrYXJnVHlwZXNbaV0ubmFtZSsiXG4iO2FyZ3MxLnB1c2gocGFyYW1OYW1lKyJfZHRvciIpO2FyZ3MyLnB1c2goYXJnVHlwZXNbaV0uZGVzdHJ1Y3RvckZ1bmN0aW9uKX19fWlmKHJldHVybnMpe2ludm9rZXJGbkJvZHkrPSJ2YXIgcmV0ID0gcmV0VHlwZS5mcm9tV2lyZVR5cGUocnYpO1xuIisicmV0dXJuIHJldDtcbiJ9ZWxzZXt9aW52b2tlckZuQm9keSs9In1cbiI7YXJnczEucHVzaChpbnZva2VyRm5Cb2R5KTt2YXIgaW52b2tlckZ1bmN0aW9uPW5ld18oRnVuY3Rpb24sYXJnczEpLmFwcGx5KG51bGwsYXJnczIpO3JldHVybiBpbnZva2VyRnVuY3Rpb259ZnVuY3Rpb24gaGVhcDMyVmVjdG9yVG9BcnJheShjb3VudCxmaXJzdEVsZW1lbnQpe3ZhciBhcnJheT1bXTtmb3IodmFyIGk9MDtpPGNvdW50O2krKyl7YXJyYXkucHVzaChIRUFQMzJbKGZpcnN0RWxlbWVudD4+MikraV0pfXJldHVybiBhcnJheX1mdW5jdGlvbiBfX2VtYmluZF9yZWdpc3Rlcl9jbGFzc19jbGFzc19mdW5jdGlvbihyYXdDbGFzc1R5cGUsbWV0aG9kTmFtZSxhcmdDb3VudCxyYXdBcmdUeXBlc0FkZHIsaW52b2tlclNpZ25hdHVyZSxyYXdJbnZva2VyLGZuKXt2YXIgcmF3QXJnVHlwZXM9aGVhcDMyVmVjdG9yVG9BcnJheShhcmdDb3VudCxyYXdBcmdUeXBlc0FkZHIpO21ldGhvZE5hbWU9cmVhZExhdGluMVN0cmluZyhtZXRob2ROYW1lKTtyYXdJbnZva2VyPWVtYmluZF9fcmVxdWlyZUZ1bmN0aW9uKGludm9rZXJTaWduYXR1cmUscmF3SW52b2tlcik7d2hlbkRlcGVuZGVudFR5cGVzQXJlUmVzb2x2ZWQoW10sW3Jhd0NsYXNzVHlwZV0sZnVuY3Rpb24oY2xhc3NUeXBlKXtjbGFzc1R5cGU9Y2xhc3NUeXBlWzBdO3ZhciBodW1hbk5hbWU9Y2xhc3NUeXBlLm5hbWUrIi4iK21ldGhvZE5hbWU7ZnVuY3Rpb24gdW5ib3VuZFR5cGVzSGFuZGxlcigpe3Rocm93VW5ib3VuZFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgIitodW1hbk5hbWUrIiBkdWUgdG8gdW5ib3VuZCB0eXBlcyIscmF3QXJnVHlwZXMpfXZhciBwcm90bz1jbGFzc1R5cGUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yO2lmKHVuZGVmaW5lZD09PXByb3RvW21ldGhvZE5hbWVdKXt1bmJvdW5kVHlwZXNIYW5kbGVyLmFyZ0NvdW50PWFyZ0NvdW50LTE7cHJvdG9bbWV0aG9kTmFtZV09dW5ib3VuZFR5cGVzSGFuZGxlcn1lbHNle2Vuc3VyZU92ZXJsb2FkVGFibGUocHJvdG8sbWV0aG9kTmFtZSxodW1hbk5hbWUpO3Byb3RvW21ldGhvZE5hbWVdLm92ZXJsb2FkVGFibGVbYXJnQ291bnQtMV09dW5ib3VuZFR5cGVzSGFuZGxlcn13aGVuRGVwZW5kZW50VHlwZXNBcmVSZXNvbHZlZChbXSxyYXdBcmdUeXBlcyxmdW5jdGlvbihhcmdUeXBlcyl7dmFyIGludm9rZXJBcmdzQXJyYXk9W2FyZ1R5cGVzWzBdLG51bGxdLmNvbmNhdChhcmdUeXBlcy5zbGljZSgxKSk7dmFyIGZ1bmM9Y3JhZnRJbnZva2VyRnVuY3Rpb24oaHVtYW5OYW1lLGludm9rZXJBcmdzQXJyYXksbnVsbCxyYXdJbnZva2VyLGZuKTtpZih1bmRlZmluZWQ9PT1wcm90b1ttZXRob2ROYW1lXS5vdmVybG9hZFRhYmxlKXtmdW5jLmFyZ0NvdW50PWFyZ0NvdW50LTE7cHJvdG9bbWV0aG9kTmFtZV09ZnVuY31lbHNle3Byb3RvW21ldGhvZE5hbWVdLm92ZXJsb2FkVGFibGVbYXJnQ291bnQtMV09ZnVuY31yZXR1cm5bXX0pO3JldHVybltdfSl9ZnVuY3Rpb24gX19lbWJpbmRfcmVnaXN0ZXJfY2xhc3NfY29uc3RydWN0b3IocmF3Q2xhc3NUeXBlLGFyZ0NvdW50LHJhd0FyZ1R5cGVzQWRkcixpbnZva2VyU2lnbmF0dXJlLGludm9rZXIscmF3Q29uc3RydWN0b3Ipe2Fzc2VydChhcmdDb3VudD4wKTt2YXIgcmF3QXJnVHlwZXM9aGVhcDMyVmVjdG9yVG9BcnJheShhcmdDb3VudCxyYXdBcmdUeXBlc0FkZHIpO2ludm9rZXI9ZW1iaW5kX19yZXF1aXJlRnVuY3Rpb24oaW52b2tlclNpZ25hdHVyZSxpbnZva2VyKTt2YXIgYXJncz1bcmF3Q29uc3RydWN0b3JdO3ZhciBkZXN0cnVjdG9ycz1bXTt3aGVuRGVwZW5kZW50VHlwZXNBcmVSZXNvbHZlZChbXSxbcmF3Q2xhc3NUeXBlXSxmdW5jdGlvbihjbGFzc1R5cGUpe2NsYXNzVHlwZT1jbGFzc1R5cGVbMF07dmFyIGh1bWFuTmFtZT0iY29uc3RydWN0b3IgIitjbGFzc1R5cGUubmFtZTtpZih1bmRlZmluZWQ9PT1jbGFzc1R5cGUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHkpe2NsYXNzVHlwZS5yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keT1bXX1pZih1bmRlZmluZWQhPT1jbGFzc1R5cGUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHlbYXJnQ291bnQtMV0pe3Rocm93IG5ldyBCaW5kaW5nRXJyb3IoIkNhbm5vdCByZWdpc3RlciBtdWx0aXBsZSBjb25zdHJ1Y3RvcnMgd2l0aCBpZGVudGljYWwgbnVtYmVyIG9mIHBhcmFtZXRlcnMgKCIrKGFyZ0NvdW50LTEpKyIpIGZvciBjbGFzcyAnIitjbGFzc1R5cGUubmFtZSsiJyEgT3ZlcmxvYWQgcmVzb2x1dGlvbiBpcyBjdXJyZW50bHkgb25seSBwZXJmb3JtZWQgdXNpbmcgdGhlIHBhcmFtZXRlciBjb3VudCwgbm90IGFjdHVhbCB0eXBlIGluZm8hIil9Y2xhc3NUeXBlLnJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcl9ib2R5W2FyZ0NvdW50LTFdPWZ1bmN0aW9uIHVuYm91bmRUeXBlSGFuZGxlcigpe3Rocm93VW5ib3VuZFR5cGVFcnJvcigiQ2Fubm90IGNvbnN0cnVjdCAiK2NsYXNzVHlwZS5uYW1lKyIgZHVlIHRvIHVuYm91bmQgdHlwZXMiLHJhd0FyZ1R5cGVzKX07d2hlbkRlcGVuZGVudFR5cGVzQXJlUmVzb2x2ZWQoW10scmF3QXJnVHlwZXMsZnVuY3Rpb24oYXJnVHlwZXMpe2NsYXNzVHlwZS5yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keVthcmdDb3VudC0xXT1mdW5jdGlvbiBjb25zdHJ1Y3Rvcl9ib2R5KCl7aWYoYXJndW1lbnRzLmxlbmd0aCE9PWFyZ0NvdW50LTEpe3Rocm93QmluZGluZ0Vycm9yKGh1bWFuTmFtZSsiIGNhbGxlZCB3aXRoICIrYXJndW1lbnRzLmxlbmd0aCsiIGFyZ3VtZW50cywgZXhwZWN0ZWQgIisoYXJnQ291bnQtMSkpfWRlc3RydWN0b3JzLmxlbmd0aD0wO2FyZ3MubGVuZ3RoPWFyZ0NvdW50O2Zvcih2YXIgaT0xO2k8YXJnQ291bnQ7KytpKXthcmdzW2ldPWFyZ1R5cGVzW2ldWyJ0b1dpcmVUeXBlIl0oZGVzdHJ1Y3RvcnMsYXJndW1lbnRzW2ktMV0pfXZhciBwdHI9aW52b2tlci5hcHBseShudWxsLGFyZ3MpO3J1bkRlc3RydWN0b3JzKGRlc3RydWN0b3JzKTtyZXR1cm4gYXJnVHlwZXNbMF1bImZyb21XaXJlVHlwZSJdKHB0cil9O3JldHVybltdfSk7cmV0dXJuW119KX1mdW5jdGlvbiBfX2VtYmluZF9yZWdpc3Rlcl9jbGFzc19mdW5jdGlvbihyYXdDbGFzc1R5cGUsbWV0aG9kTmFtZSxhcmdDb3VudCxyYXdBcmdUeXBlc0FkZHIsaW52b2tlclNpZ25hdHVyZSxyYXdJbnZva2VyLGNvbnRleHQsaXNQdXJlVmlydHVhbCl7dmFyIHJhd0FyZ1R5cGVzPWhlYXAzMlZlY3RvclRvQXJyYXkoYXJnQ291bnQscmF3QXJnVHlwZXNBZGRyKTttZXRob2ROYW1lPXJlYWRMYXRpbjFTdHJpbmcobWV0aG9kTmFtZSk7cmF3SW52b2tlcj1lbWJpbmRfX3JlcXVpcmVGdW5jdGlvbihpbnZva2VyU2lnbmF0dXJlLHJhd0ludm9rZXIpO3doZW5EZXBlbmRlbnRUeXBlc0FyZVJlc29sdmVkKFtdLFtyYXdDbGFzc1R5cGVdLGZ1bmN0aW9uKGNsYXNzVHlwZSl7Y2xhc3NUeXBlPWNsYXNzVHlwZVswXTt2YXIgaHVtYW5OYW1lPWNsYXNzVHlwZS5uYW1lKyIuIittZXRob2ROYW1lO2lmKGlzUHVyZVZpcnR1YWwpe2NsYXNzVHlwZS5yZWdpc3RlcmVkQ2xhc3MucHVyZVZpcnR1YWxGdW5jdGlvbnMucHVzaChtZXRob2ROYW1lKX1mdW5jdGlvbiB1bmJvdW5kVHlwZXNIYW5kbGVyKCl7dGhyb3dVbmJvdW5kVHlwZUVycm9yKCJDYW5ub3QgY2FsbCAiK2h1bWFuTmFtZSsiIGR1ZSB0byB1bmJvdW5kIHR5cGVzIixyYXdBcmdUeXBlcyl9dmFyIHByb3RvPWNsYXNzVHlwZS5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGU7dmFyIG1ldGhvZD1wcm90b1ttZXRob2ROYW1lXTtpZih1bmRlZmluZWQ9PT1tZXRob2R8fHVuZGVmaW5lZD09PW1ldGhvZC5vdmVybG9hZFRhYmxlJiZtZXRob2QuY2xhc3NOYW1lIT09Y2xhc3NUeXBlLm5hbWUmJm1ldGhvZC5hcmdDb3VudD09PWFyZ0NvdW50LTIpe3VuYm91bmRUeXBlc0hhbmRsZXIuYXJnQ291bnQ9YXJnQ291bnQtMjt1bmJvdW5kVHlwZXNIYW5kbGVyLmNsYXNzTmFtZT1jbGFzc1R5cGUubmFtZTtwcm90b1ttZXRob2ROYW1lXT11bmJvdW5kVHlwZXNIYW5kbGVyfWVsc2V7ZW5zdXJlT3ZlcmxvYWRUYWJsZShwcm90byxtZXRob2ROYW1lLGh1bWFuTmFtZSk7cHJvdG9bbWV0aG9kTmFtZV0ub3ZlcmxvYWRUYWJsZVthcmdDb3VudC0yXT11bmJvdW5kVHlwZXNIYW5kbGVyfXdoZW5EZXBlbmRlbnRUeXBlc0FyZVJlc29sdmVkKFtdLHJhd0FyZ1R5cGVzLGZ1bmN0aW9uKGFyZ1R5cGVzKXt2YXIgbWVtYmVyRnVuY3Rpb249Y3JhZnRJbnZva2VyRnVuY3Rpb24oaHVtYW5OYW1lLGFyZ1R5cGVzLGNsYXNzVHlwZSxyYXdJbnZva2VyLGNvbnRleHQpO2lmKHVuZGVmaW5lZD09PXByb3RvW21ldGhvZE5hbWVdLm92ZXJsb2FkVGFibGUpe21lbWJlckZ1bmN0aW9uLmFyZ0NvdW50PWFyZ0NvdW50LTI7cHJvdG9bbWV0aG9kTmFtZV09bWVtYmVyRnVuY3Rpb259ZWxzZXtwcm90b1ttZXRob2ROYW1lXS5vdmVybG9hZFRhYmxlW2FyZ0NvdW50LTJdPW1lbWJlckZ1bmN0aW9ufXJldHVybltdfSk7cmV0dXJuW119KX1mdW5jdGlvbiB2YWxpZGF0ZVRoaXModGhpc18sY2xhc3NUeXBlLGh1bWFuTmFtZSl7aWYoISh0aGlzXyBpbnN0YW5jZW9mIE9iamVjdCkpe3Rocm93QmluZGluZ0Vycm9yKGh1bWFuTmFtZSsnIHdpdGggaW52YWxpZCAidGhpcyI6ICcrdGhpc18pfWlmKCEodGhpc18gaW5zdGFuY2VvZiBjbGFzc1R5cGUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yKSl7dGhyb3dCaW5kaW5nRXJyb3IoaHVtYW5OYW1lKycgaW5jb21wYXRpYmxlIHdpdGggInRoaXMiIG9mIHR5cGUgJyt0aGlzXy5jb25zdHJ1Y3Rvci5uYW1lKX1pZighdGhpc18uJCQucHRyKXt0aHJvd0JpbmRpbmdFcnJvcigiY2Fubm90IGNhbGwgZW1zY3JpcHRlbiBiaW5kaW5nIG1ldGhvZCAiK2h1bWFuTmFtZSsiIG9uIGRlbGV0ZWQgb2JqZWN0Iil9cmV0dXJuIHVwY2FzdFBvaW50ZXIodGhpc18uJCQucHRyLHRoaXNfLiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzLGNsYXNzVHlwZS5yZWdpc3RlcmVkQ2xhc3MpfWZ1bmN0aW9uIF9fZW1iaW5kX3JlZ2lzdGVyX2NsYXNzX3Byb3BlcnR5KGNsYXNzVHlwZSxmaWVsZE5hbWUsZ2V0dGVyUmV0dXJuVHlwZSxnZXR0ZXJTaWduYXR1cmUsZ2V0dGVyLGdldHRlckNvbnRleHQsc2V0dGVyQXJndW1lbnRUeXBlLHNldHRlclNpZ25hdHVyZSxzZXR0ZXIsc2V0dGVyQ29udGV4dCl7ZmllbGROYW1lPXJlYWRMYXRpbjFTdHJpbmcoZmllbGROYW1lKTtnZXR0ZXI9ZW1iaW5kX19yZXF1aXJlRnVuY3Rpb24oZ2V0dGVyU2lnbmF0dXJlLGdldHRlcik7d2hlbkRlcGVuZGVudFR5cGVzQXJlUmVzb2x2ZWQoW10sW2NsYXNzVHlwZV0sZnVuY3Rpb24oY2xhc3NUeXBlKXtjbGFzc1R5cGU9Y2xhc3NUeXBlWzBdO3ZhciBodW1hbk5hbWU9Y2xhc3NUeXBlLm5hbWUrIi4iK2ZpZWxkTmFtZTt2YXIgZGVzYz17Z2V0OmZ1bmN0aW9uKCl7dGhyb3dVbmJvdW5kVHlwZUVycm9yKCJDYW5ub3QgYWNjZXNzICIraHVtYW5OYW1lKyIgZHVlIHRvIHVuYm91bmQgdHlwZXMiLFtnZXR0ZXJSZXR1cm5UeXBlLHNldHRlckFyZ3VtZW50VHlwZV0pfSxlbnVtZXJhYmxlOnRydWUsY29uZmlndXJhYmxlOnRydWV9O2lmKHNldHRlcil7ZGVzYy5zZXQ9ZnVuY3Rpb24oKXt0aHJvd1VuYm91bmRUeXBlRXJyb3IoIkNhbm5vdCBhY2Nlc3MgIitodW1hbk5hbWUrIiBkdWUgdG8gdW5ib3VuZCB0eXBlcyIsW2dldHRlclJldHVyblR5cGUsc2V0dGVyQXJndW1lbnRUeXBlXSl9fWVsc2V7ZGVzYy5zZXQ9ZnVuY3Rpb24odil7dGhyb3dCaW5kaW5nRXJyb3IoaHVtYW5OYW1lKyIgaXMgYSByZWFkLW9ubHkgcHJvcGVydHkiKX19T2JqZWN0LmRlZmluZVByb3BlcnR5KGNsYXNzVHlwZS5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUsZmllbGROYW1lLGRlc2MpO3doZW5EZXBlbmRlbnRUeXBlc0FyZVJlc29sdmVkKFtdLHNldHRlcj9bZ2V0dGVyUmV0dXJuVHlwZSxzZXR0ZXJBcmd1bWVudFR5cGVdOltnZXR0ZXJSZXR1cm5UeXBlXSxmdW5jdGlvbih0eXBlcyl7dmFyIGdldHRlclJldHVyblR5cGU9dHlwZXNbMF07dmFyIGRlc2M9e2dldDpmdW5jdGlvbigpe3ZhciBwdHI9dmFsaWRhdGVUaGlzKHRoaXMsY2xhc3NUeXBlLGh1bWFuTmFtZSsiIGdldHRlciIpO3JldHVybiBnZXR0ZXJSZXR1cm5UeXBlWyJmcm9tV2lyZVR5cGUiXShnZXR0ZXIoZ2V0dGVyQ29udGV4dCxwdHIpKX0sZW51bWVyYWJsZTp0cnVlfTtpZihzZXR0ZXIpe3NldHRlcj1lbWJpbmRfX3JlcXVpcmVGdW5jdGlvbihzZXR0ZXJTaWduYXR1cmUsc2V0dGVyKTt2YXIgc2V0dGVyQXJndW1lbnRUeXBlPXR5cGVzWzFdO2Rlc2Muc2V0PWZ1bmN0aW9uKHYpe3ZhciBwdHI9dmFsaWRhdGVUaGlzKHRoaXMsY2xhc3NUeXBlLGh1bWFuTmFtZSsiIHNldHRlciIpO3ZhciBkZXN0cnVjdG9ycz1bXTtzZXR0ZXIoc2V0dGVyQ29udGV4dCxwdHIsc2V0dGVyQXJndW1lbnRUeXBlWyJ0b1dpcmVUeXBlIl0oZGVzdHJ1Y3RvcnMsdikpO3J1bkRlc3RydWN0b3JzKGRlc3RydWN0b3JzKX19T2JqZWN0LmRlZmluZVByb3BlcnR5KGNsYXNzVHlwZS5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUsZmllbGROYW1lLGRlc2MpO3JldHVybltdfSk7cmV0dXJuW119KX12YXIgZW12YWxfZnJlZV9saXN0PVtdO3ZhciBlbXZhbF9oYW5kbGVfYXJyYXk9W3t9LHt2YWx1ZTp1bmRlZmluZWR9LHt2YWx1ZTpudWxsfSx7dmFsdWU6dHJ1ZX0se3ZhbHVlOmZhbHNlfV07ZnVuY3Rpb24gX19lbXZhbF9kZWNyZWYoaGFuZGxlKXtpZihoYW5kbGU+NCYmMD09PS0tZW12YWxfaGFuZGxlX2FycmF5W2hhbmRsZV0ucmVmY291bnQpe2VtdmFsX2hhbmRsZV9hcnJheVtoYW5kbGVdPXVuZGVmaW5lZDtlbXZhbF9mcmVlX2xpc3QucHVzaChoYW5kbGUpfX1mdW5jdGlvbiBjb3VudF9lbXZhbF9oYW5kbGVzKCl7dmFyIGNvdW50PTA7Zm9yKHZhciBpPTU7aTxlbXZhbF9oYW5kbGVfYXJyYXkubGVuZ3RoOysraSl7aWYoZW12YWxfaGFuZGxlX2FycmF5W2ldIT09dW5kZWZpbmVkKXsrK2NvdW50fX1yZXR1cm4gY291bnR9ZnVuY3Rpb24gZ2V0X2ZpcnN0X2VtdmFsKCl7Zm9yKHZhciBpPTU7aTxlbXZhbF9oYW5kbGVfYXJyYXkubGVuZ3RoOysraSl7aWYoZW12YWxfaGFuZGxlX2FycmF5W2ldIT09dW5kZWZpbmVkKXtyZXR1cm4gZW12YWxfaGFuZGxlX2FycmF5W2ldfX1yZXR1cm4gbnVsbH1mdW5jdGlvbiBpbml0X2VtdmFsKCl7TW9kdWxlWyJjb3VudF9lbXZhbF9oYW5kbGVzIl09Y291bnRfZW12YWxfaGFuZGxlcztNb2R1bGVbImdldF9maXJzdF9lbXZhbCJdPWdldF9maXJzdF9lbXZhbH1mdW5jdGlvbiBfX2VtdmFsX3JlZ2lzdGVyKHZhbHVlKXtzd2l0Y2godmFsdWUpe2Nhc2UgdW5kZWZpbmVkOntyZXR1cm4gMX1jYXNlIG51bGw6e3JldHVybiAyfWNhc2UgdHJ1ZTp7cmV0dXJuIDN9Y2FzZSBmYWxzZTp7cmV0dXJuIDR9ZGVmYXVsdDp7dmFyIGhhbmRsZT1lbXZhbF9mcmVlX2xpc3QubGVuZ3RoP2VtdmFsX2ZyZWVfbGlzdC5wb3AoKTplbXZhbF9oYW5kbGVfYXJyYXkubGVuZ3RoO2VtdmFsX2hhbmRsZV9hcnJheVtoYW5kbGVdPXtyZWZjb3VudDoxLHZhbHVlOnZhbHVlfTtyZXR1cm4gaGFuZGxlfX19ZnVuY3Rpb24gX19lbWJpbmRfcmVnaXN0ZXJfZW12YWwocmF3VHlwZSxuYW1lKXtuYW1lPXJlYWRMYXRpbjFTdHJpbmcobmFtZSk7cmVnaXN0ZXJUeXBlKHJhd1R5cGUse25hbWU6bmFtZSwiZnJvbVdpcmVUeXBlIjpmdW5jdGlvbihoYW5kbGUpe3ZhciBydj1lbXZhbF9oYW5kbGVfYXJyYXlbaGFuZGxlXS52YWx1ZTtfX2VtdmFsX2RlY3JlZihoYW5kbGUpO3JldHVybiBydn0sInRvV2lyZVR5cGUiOmZ1bmN0aW9uKGRlc3RydWN0b3JzLHZhbHVlKXtyZXR1cm4gX19lbXZhbF9yZWdpc3Rlcih2YWx1ZSl9LCJhcmdQYWNrQWR2YW5jZSI6OCwicmVhZFZhbHVlRnJvbVBvaW50ZXIiOnNpbXBsZVJlYWRWYWx1ZUZyb21Qb2ludGVyLGRlc3RydWN0b3JGdW5jdGlvbjpudWxsfSl9ZnVuY3Rpb24gZW51bVJlYWRWYWx1ZUZyb21Qb2ludGVyKG5hbWUsc2hpZnQsc2lnbmVkKXtzd2l0Y2goc2hpZnQpe2Nhc2UgMDpyZXR1cm4gZnVuY3Rpb24ocG9pbnRlcil7dmFyIGhlYXA9c2lnbmVkP0hFQVA4OkhFQVBVODtyZXR1cm4gdGhpc1siZnJvbVdpcmVUeXBlIl0oaGVhcFtwb2ludGVyXSl9O2Nhc2UgMTpyZXR1cm4gZnVuY3Rpb24ocG9pbnRlcil7dmFyIGhlYXA9c2lnbmVkP0hFQVAxNjpIRUFQVTE2O3JldHVybiB0aGlzWyJmcm9tV2lyZVR5cGUiXShoZWFwW3BvaW50ZXI+PjFdKX07Y2FzZSAyOnJldHVybiBmdW5jdGlvbihwb2ludGVyKXt2YXIgaGVhcD1zaWduZWQ/SEVBUDMyOkhFQVBVMzI7cmV0dXJuIHRoaXNbImZyb21XaXJlVHlwZSJdKGhlYXBbcG9pbnRlcj4+Ml0pfTtkZWZhdWx0OnRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gaW50ZWdlciB0eXBlOiAiK25hbWUpfX1mdW5jdGlvbiBfX2VtYmluZF9yZWdpc3Rlcl9lbnVtKHJhd1R5cGUsbmFtZSxzaXplLGlzU2lnbmVkKXt2YXIgc2hpZnQ9Z2V0U2hpZnRGcm9tU2l6ZShzaXplKTtuYW1lPXJlYWRMYXRpbjFTdHJpbmcobmFtZSk7ZnVuY3Rpb24gY3Rvcigpe31jdG9yLnZhbHVlcz17fTtyZWdpc3RlclR5cGUocmF3VHlwZSx7bmFtZTpuYW1lLGNvbnN0cnVjdG9yOmN0b3IsImZyb21XaXJlVHlwZSI6ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuY29uc3RydWN0b3IudmFsdWVzW2NdfSwidG9XaXJlVHlwZSI6ZnVuY3Rpb24oZGVzdHJ1Y3RvcnMsYyl7cmV0dXJuIGMudmFsdWV9LCJhcmdQYWNrQWR2YW5jZSI6OCwicmVhZFZhbHVlRnJvbVBvaW50ZXIiOmVudW1SZWFkVmFsdWVGcm9tUG9pbnRlcihuYW1lLHNoaWZ0LGlzU2lnbmVkKSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pO2V4cG9zZVB1YmxpY1N5bWJvbChuYW1lLGN0b3IpfWZ1bmN0aW9uIHJlcXVpcmVSZWdpc3RlcmVkVHlwZShyYXdUeXBlLGh1bWFuTmFtZSl7dmFyIGltcGw9cmVnaXN0ZXJlZFR5cGVzW3Jhd1R5cGVdO2lmKHVuZGVmaW5lZD09PWltcGwpe3Rocm93QmluZGluZ0Vycm9yKGh1bWFuTmFtZSsiIGhhcyB1bmtub3duIHR5cGUgIitnZXRUeXBlTmFtZShyYXdUeXBlKSl9cmV0dXJuIGltcGx9ZnVuY3Rpb24gX19lbWJpbmRfcmVnaXN0ZXJfZW51bV92YWx1ZShyYXdFbnVtVHlwZSxuYW1lLGVudW1WYWx1ZSl7dmFyIGVudW1UeXBlPXJlcXVpcmVSZWdpc3RlcmVkVHlwZShyYXdFbnVtVHlwZSwiZW51bSIpO25hbWU9cmVhZExhdGluMVN0cmluZyhuYW1lKTt2YXIgRW51bT1lbnVtVHlwZS5jb25zdHJ1Y3Rvcjt2YXIgVmFsdWU9T2JqZWN0LmNyZWF0ZShlbnVtVHlwZS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUse3ZhbHVlOnt2YWx1ZTplbnVtVmFsdWV9LGNvbnN0cnVjdG9yOnt2YWx1ZTpjcmVhdGVOYW1lZEZ1bmN0aW9uKGVudW1UeXBlLm5hbWUrIl8iK25hbWUsZnVuY3Rpb24oKXt9KX19KTtFbnVtLnZhbHVlc1tlbnVtVmFsdWVdPVZhbHVlO0VudW1bbmFtZV09VmFsdWV9ZnVuY3Rpb24gX2VtYmluZF9yZXByKHYpe2lmKHY9PT1udWxsKXtyZXR1cm4ibnVsbCJ9dmFyIHQ9dHlwZW9mIHY7aWYodD09PSJvYmplY3QifHx0PT09ImFycmF5Inx8dD09PSJmdW5jdGlvbiIpe3JldHVybiB2LnRvU3RyaW5nKCl9ZWxzZXtyZXR1cm4iIit2fX1mdW5jdGlvbiBmbG9hdFJlYWRWYWx1ZUZyb21Qb2ludGVyKG5hbWUsc2hpZnQpe3N3aXRjaChzaGlmdCl7Y2FzZSAyOnJldHVybiBmdW5jdGlvbihwb2ludGVyKXtyZXR1cm4gdGhpc1siZnJvbVdpcmVUeXBlIl0oSEVBUEYzMltwb2ludGVyPj4yXSl9O2Nhc2UgMzpyZXR1cm4gZnVuY3Rpb24ocG9pbnRlcil7cmV0dXJuIHRoaXNbImZyb21XaXJlVHlwZSJdKEhFQVBGNjRbcG9pbnRlcj4+M10pfTtkZWZhdWx0OnRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gZmxvYXQgdHlwZTogIituYW1lKX19ZnVuY3Rpb24gX19lbWJpbmRfcmVnaXN0ZXJfZmxvYXQocmF3VHlwZSxuYW1lLHNpemUpe3ZhciBzaGlmdD1nZXRTaGlmdEZyb21TaXplKHNpemUpO25hbWU9cmVhZExhdGluMVN0cmluZyhuYW1lKTtyZWdpc3RlclR5cGUocmF3VHlwZSx7bmFtZTpuYW1lLCJmcm9tV2lyZVR5cGUiOmZ1bmN0aW9uKHZhbHVlKXtyZXR1cm4gdmFsdWV9LCJ0b1dpcmVUeXBlIjpmdW5jdGlvbihkZXN0cnVjdG9ycyx2YWx1ZSl7aWYodHlwZW9mIHZhbHVlIT09Im51bWJlciImJnR5cGVvZiB2YWx1ZSE9PSJib29sZWFuIil7dGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNvbnZlcnQgIicrX2VtYmluZF9yZXByKHZhbHVlKSsnIiB0byAnK3RoaXMubmFtZSl9cmV0dXJuIHZhbHVlfSwiYXJnUGFja0FkdmFuY2UiOjgsInJlYWRWYWx1ZUZyb21Qb2ludGVyIjpmbG9hdFJlYWRWYWx1ZUZyb21Qb2ludGVyKG5hbWUsc2hpZnQpLGRlc3RydWN0b3JGdW5jdGlvbjpudWxsfSl9ZnVuY3Rpb24gX19lbWJpbmRfcmVnaXN0ZXJfZnVuY3Rpb24obmFtZSxhcmdDb3VudCxyYXdBcmdUeXBlc0FkZHIsc2lnbmF0dXJlLHJhd0ludm9rZXIsZm4pe3ZhciBhcmdUeXBlcz1oZWFwMzJWZWN0b3JUb0FycmF5KGFyZ0NvdW50LHJhd0FyZ1R5cGVzQWRkcik7bmFtZT1yZWFkTGF0aW4xU3RyaW5nKG5hbWUpO3Jhd0ludm9rZXI9ZW1iaW5kX19yZXF1aXJlRnVuY3Rpb24oc2lnbmF0dXJlLHJhd0ludm9rZXIpO2V4cG9zZVB1YmxpY1N5bWJvbChuYW1lLGZ1bmN0aW9uKCl7dGhyb3dVbmJvdW5kVHlwZUVycm9yKCJDYW5ub3QgY2FsbCAiK25hbWUrIiBkdWUgdG8gdW5ib3VuZCB0eXBlcyIsYXJnVHlwZXMpfSxhcmdDb3VudC0xKTt3aGVuRGVwZW5kZW50VHlwZXNBcmVSZXNvbHZlZChbXSxhcmdUeXBlcyxmdW5jdGlvbihhcmdUeXBlcyl7dmFyIGludm9rZXJBcmdzQXJyYXk9W2FyZ1R5cGVzWzBdLG51bGxdLmNvbmNhdChhcmdUeXBlcy5zbGljZSgxKSk7cmVwbGFjZVB1YmxpY1N5bWJvbChuYW1lLGNyYWZ0SW52b2tlckZ1bmN0aW9uKG5hbWUsaW52b2tlckFyZ3NBcnJheSxudWxsLHJhd0ludm9rZXIsZm4pLGFyZ0NvdW50LTEpO3JldHVybltdfSl9ZnVuY3Rpb24gaW50ZWdlclJlYWRWYWx1ZUZyb21Qb2ludGVyKG5hbWUsc2hpZnQsc2lnbmVkKXtzd2l0Y2goc2hpZnQpe2Nhc2UgMDpyZXR1cm4gc2lnbmVkP2Z1bmN0aW9uIHJlYWRTOEZyb21Qb2ludGVyKHBvaW50ZXIpe3JldHVybiBIRUFQOFtwb2ludGVyXX06ZnVuY3Rpb24gcmVhZFU4RnJvbVBvaW50ZXIocG9pbnRlcil7cmV0dXJuIEhFQVBVOFtwb2ludGVyXX07Y2FzZSAxOnJldHVybiBzaWduZWQ/ZnVuY3Rpb24gcmVhZFMxNkZyb21Qb2ludGVyKHBvaW50ZXIpe3JldHVybiBIRUFQMTZbcG9pbnRlcj4+MV19OmZ1bmN0aW9uIHJlYWRVMTZGcm9tUG9pbnRlcihwb2ludGVyKXtyZXR1cm4gSEVBUFUxNltwb2ludGVyPj4xXX07Y2FzZSAyOnJldHVybiBzaWduZWQ/ZnVuY3Rpb24gcmVhZFMzMkZyb21Qb2ludGVyKHBvaW50ZXIpe3JldHVybiBIRUFQMzJbcG9pbnRlcj4+Ml19OmZ1bmN0aW9uIHJlYWRVMzJGcm9tUG9pbnRlcihwb2ludGVyKXtyZXR1cm4gSEVBUFUzMltwb2ludGVyPj4yXX07ZGVmYXVsdDp0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIGludGVnZXIgdHlwZTogIituYW1lKX19ZnVuY3Rpb24gX19lbWJpbmRfcmVnaXN0ZXJfaW50ZWdlcihwcmltaXRpdmVUeXBlLG5hbWUsc2l6ZSxtaW5SYW5nZSxtYXhSYW5nZSl7bmFtZT1yZWFkTGF0aW4xU3RyaW5nKG5hbWUpO2lmKG1heFJhbmdlPT09LTEpe21heFJhbmdlPTQyOTQ5NjcyOTV9dmFyIHNoaWZ0PWdldFNoaWZ0RnJvbVNpemUoc2l6ZSk7dmFyIGZyb21XaXJlVHlwZT1mdW5jdGlvbih2YWx1ZSl7cmV0dXJuIHZhbHVlfTtpZihtaW5SYW5nZT09PTApe3ZhciBiaXRzaGlmdD0zMi04KnNpemU7ZnJvbVdpcmVUeXBlPWZ1bmN0aW9uKHZhbHVlKXtyZXR1cm4gdmFsdWU8PGJpdHNoaWZ0Pj4+Yml0c2hpZnR9fXZhciBpc1Vuc2lnbmVkVHlwZT1uYW1lLmluZGV4T2YoInVuc2lnbmVkIikhPS0xO3JlZ2lzdGVyVHlwZShwcmltaXRpdmVUeXBlLHtuYW1lOm5hbWUsImZyb21XaXJlVHlwZSI6ZnJvbVdpcmVUeXBlLCJ0b1dpcmVUeXBlIjpmdW5jdGlvbihkZXN0cnVjdG9ycyx2YWx1ZSl7aWYodHlwZW9mIHZhbHVlIT09Im51bWJlciImJnR5cGVvZiB2YWx1ZSE9PSJib29sZWFuIil7dGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNvbnZlcnQgIicrX2VtYmluZF9yZXByKHZhbHVlKSsnIiB0byAnK3RoaXMubmFtZSl9aWYodmFsdWU8bWluUmFuZ2V8fHZhbHVlPm1heFJhbmdlKXt0aHJvdyBuZXcgVHlwZUVycm9yKCdQYXNzaW5nIGEgbnVtYmVyICInK19lbWJpbmRfcmVwcih2YWx1ZSkrJyIgZnJvbSBKUyBzaWRlIHRvIEMvQysrIHNpZGUgdG8gYW4gYXJndW1lbnQgb2YgdHlwZSAiJytuYW1lKyciLCB3aGljaCBpcyBvdXRzaWRlIHRoZSB2YWxpZCByYW5nZSBbJyttaW5SYW5nZSsiLCAiK21heFJhbmdlKyJdISIpfXJldHVybiBpc1Vuc2lnbmVkVHlwZT92YWx1ZT4+PjA6dmFsdWV8MH0sImFyZ1BhY2tBZHZhbmNlIjo4LCJyZWFkVmFsdWVGcm9tUG9pbnRlciI6aW50ZWdlclJlYWRWYWx1ZUZyb21Qb2ludGVyKG5hbWUsc2hpZnQsbWluUmFuZ2UhPT0wKSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfWZ1bmN0aW9uIF9fZW1iaW5kX3JlZ2lzdGVyX21lbW9yeV92aWV3KHJhd1R5cGUsZGF0YVR5cGVJbmRleCxuYW1lKXt2YXIgdHlwZU1hcHBpbmc9W0ludDhBcnJheSxVaW50OEFycmF5LEludDE2QXJyYXksVWludDE2QXJyYXksSW50MzJBcnJheSxVaW50MzJBcnJheSxGbG9hdDMyQXJyYXksRmxvYXQ2NEFycmF5XTt2YXIgVEE9dHlwZU1hcHBpbmdbZGF0YVR5cGVJbmRleF07ZnVuY3Rpb24gZGVjb2RlTWVtb3J5VmlldyhoYW5kbGUpe2hhbmRsZT1oYW5kbGU+PjI7dmFyIGhlYXA9SEVBUFUzMjt2YXIgc2l6ZT1oZWFwW2hhbmRsZV07dmFyIGRhdGE9aGVhcFtoYW5kbGUrMV07cmV0dXJuIG5ldyBUQShidWZmZXIsZGF0YSxzaXplKX1uYW1lPXJlYWRMYXRpbjFTdHJpbmcobmFtZSk7cmVnaXN0ZXJUeXBlKHJhd1R5cGUse25hbWU6bmFtZSwiZnJvbVdpcmVUeXBlIjpkZWNvZGVNZW1vcnlWaWV3LCJhcmdQYWNrQWR2YW5jZSI6OCwicmVhZFZhbHVlRnJvbVBvaW50ZXIiOmRlY29kZU1lbW9yeVZpZXd9LHtpZ25vcmVEdXBsaWNhdGVSZWdpc3RyYXRpb25zOnRydWV9KX1mdW5jdGlvbiBfX2VtYmluZF9yZWdpc3Rlcl9zdGRfc3RyaW5nKHJhd1R5cGUsbmFtZSl7bmFtZT1yZWFkTGF0aW4xU3RyaW5nKG5hbWUpO3ZhciBzdGRTdHJpbmdJc1VURjg9bmFtZT09PSJzdGQ6OnN0cmluZyI7cmVnaXN0ZXJUeXBlKHJhd1R5cGUse25hbWU6bmFtZSwiZnJvbVdpcmVUeXBlIjpmdW5jdGlvbih2YWx1ZSl7dmFyIGxlbmd0aD1IRUFQVTMyW3ZhbHVlPj4yXTt2YXIgc3RyO2lmKHN0ZFN0cmluZ0lzVVRGOCl7dmFyIGRlY29kZVN0YXJ0UHRyPXZhbHVlKzQ7Zm9yKHZhciBpPTA7aTw9bGVuZ3RoOysraSl7dmFyIGN1cnJlbnRCeXRlUHRyPXZhbHVlKzQraTtpZihpPT1sZW5ndGh8fEhFQVBVOFtjdXJyZW50Qnl0ZVB0cl09PTApe3ZhciBtYXhSZWFkPWN1cnJlbnRCeXRlUHRyLWRlY29kZVN0YXJ0UHRyO3ZhciBzdHJpbmdTZWdtZW50PVVURjhUb1N0cmluZyhkZWNvZGVTdGFydFB0cixtYXhSZWFkKTtpZihzdHI9PT11bmRlZmluZWQpe3N0cj1zdHJpbmdTZWdtZW50fWVsc2V7c3RyKz1TdHJpbmcuZnJvbUNoYXJDb2RlKDApO3N0cis9c3RyaW5nU2VnbWVudH1kZWNvZGVTdGFydFB0cj1jdXJyZW50Qnl0ZVB0cisxfX19ZWxzZXt2YXIgYT1uZXcgQXJyYXkobGVuZ3RoKTtmb3IodmFyIGk9MDtpPGxlbmd0aDsrK2kpe2FbaV09U3RyaW5nLmZyb21DaGFyQ29kZShIRUFQVThbdmFsdWUrNCtpXSl9c3RyPWEuam9pbigiIil9X2ZyZWUodmFsdWUpO3JldHVybiBzdHJ9LCJ0b1dpcmVUeXBlIjpmdW5jdGlvbihkZXN0cnVjdG9ycyx2YWx1ZSl7aWYodmFsdWUgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcil7dmFsdWU9bmV3IFVpbnQ4QXJyYXkodmFsdWUpfXZhciBnZXRMZW5ndGg7dmFyIHZhbHVlSXNPZlR5cGVTdHJpbmc9dHlwZW9mIHZhbHVlPT09InN0cmluZyI7aWYoISh2YWx1ZUlzT2ZUeXBlU3RyaW5nfHx2YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXl8fHZhbHVlIGluc3RhbmNlb2YgVWludDhDbGFtcGVkQXJyYXl8fHZhbHVlIGluc3RhbmNlb2YgSW50OEFycmF5KSl7dGhyb3dCaW5kaW5nRXJyb3IoIkNhbm5vdCBwYXNzIG5vbi1zdHJpbmcgdG8gc3RkOjpzdHJpbmciKX1pZihzdGRTdHJpbmdJc1VURjgmJnZhbHVlSXNPZlR5cGVTdHJpbmcpe2dldExlbmd0aD1mdW5jdGlvbigpe3JldHVybiBsZW5ndGhCeXRlc1VURjgodmFsdWUpfX1lbHNle2dldExlbmd0aD1mdW5jdGlvbigpe3JldHVybiB2YWx1ZS5sZW5ndGh9fXZhciBsZW5ndGg9Z2V0TGVuZ3RoKCk7dmFyIHB0cj1fbWFsbG9jKDQrbGVuZ3RoKzEpO0hFQVBVMzJbcHRyPj4yXT1sZW5ndGg7aWYoc3RkU3RyaW5nSXNVVEY4JiZ2YWx1ZUlzT2ZUeXBlU3RyaW5nKXtzdHJpbmdUb1VURjgodmFsdWUscHRyKzQsbGVuZ3RoKzEpfWVsc2V7aWYodmFsdWVJc09mVHlwZVN0cmluZyl7Zm9yKHZhciBpPTA7aTxsZW5ndGg7KytpKXt2YXIgY2hhckNvZGU9dmFsdWUuY2hhckNvZGVBdChpKTtpZihjaGFyQ29kZT4yNTUpe19mcmVlKHB0cik7dGhyb3dCaW5kaW5nRXJyb3IoIlN0cmluZyBoYXMgVVRGLTE2IGNvZGUgdW5pdHMgdGhhdCBkbyBub3QgZml0IGluIDggYml0cyIpfUhFQVBVOFtwdHIrNCtpXT1jaGFyQ29kZX19ZWxzZXtmb3IodmFyIGk9MDtpPGxlbmd0aDsrK2kpe0hFQVBVOFtwdHIrNCtpXT12YWx1ZVtpXX19fWlmKGRlc3RydWN0b3JzIT09bnVsbCl7ZGVzdHJ1Y3RvcnMucHVzaChfZnJlZSxwdHIpfXJldHVybiBwdHJ9LCJhcmdQYWNrQWR2YW5jZSI6OCwicmVhZFZhbHVlRnJvbVBvaW50ZXIiOnNpbXBsZVJlYWRWYWx1ZUZyb21Qb2ludGVyLGRlc3RydWN0b3JGdW5jdGlvbjpmdW5jdGlvbihwdHIpe19mcmVlKHB0cil9fSl9ZnVuY3Rpb24gX19lbWJpbmRfcmVnaXN0ZXJfc3RkX3dzdHJpbmcocmF3VHlwZSxjaGFyU2l6ZSxuYW1lKXtuYW1lPXJlYWRMYXRpbjFTdHJpbmcobmFtZSk7dmFyIGRlY29kZVN0cmluZyxlbmNvZGVTdHJpbmcsZ2V0SGVhcCxsZW5ndGhCeXRlc1VURixzaGlmdDtpZihjaGFyU2l6ZT09PTIpe2RlY29kZVN0cmluZz1VVEYxNlRvU3RyaW5nO2VuY29kZVN0cmluZz1zdHJpbmdUb1VURjE2O2xlbmd0aEJ5dGVzVVRGPWxlbmd0aEJ5dGVzVVRGMTY7Z2V0SGVhcD1mdW5jdGlvbigpe3JldHVybiBIRUFQVTE2fTtzaGlmdD0xfWVsc2UgaWYoY2hhclNpemU9PT00KXtkZWNvZGVTdHJpbmc9VVRGMzJUb1N0cmluZztlbmNvZGVTdHJpbmc9c3RyaW5nVG9VVEYzMjtsZW5ndGhCeXRlc1VURj1sZW5ndGhCeXRlc1VURjMyO2dldEhlYXA9ZnVuY3Rpb24oKXtyZXR1cm4gSEVBUFUzMn07c2hpZnQ9Mn1yZWdpc3RlclR5cGUocmF3VHlwZSx7bmFtZTpuYW1lLCJmcm9tV2lyZVR5cGUiOmZ1bmN0aW9uKHZhbHVlKXt2YXIgbGVuZ3RoPUhFQVBVMzJbdmFsdWU+PjJdO3ZhciBIRUFQPWdldEhlYXAoKTt2YXIgc3RyO3ZhciBkZWNvZGVTdGFydFB0cj12YWx1ZSs0O2Zvcih2YXIgaT0wO2k8PWxlbmd0aDsrK2kpe3ZhciBjdXJyZW50Qnl0ZVB0cj12YWx1ZSs0K2kqY2hhclNpemU7aWYoaT09bGVuZ3RofHxIRUFQW2N1cnJlbnRCeXRlUHRyPj5zaGlmdF09PTApe3ZhciBtYXhSZWFkQnl0ZXM9Y3VycmVudEJ5dGVQdHItZGVjb2RlU3RhcnRQdHI7dmFyIHN0cmluZ1NlZ21lbnQ9ZGVjb2RlU3RyaW5nKGRlY29kZVN0YXJ0UHRyLG1heFJlYWRCeXRlcyk7aWYoc3RyPT09dW5kZWZpbmVkKXtzdHI9c3RyaW5nU2VnbWVudH1lbHNle3N0cis9U3RyaW5nLmZyb21DaGFyQ29kZSgwKTtzdHIrPXN0cmluZ1NlZ21lbnR9ZGVjb2RlU3RhcnRQdHI9Y3VycmVudEJ5dGVQdHIrY2hhclNpemV9fV9mcmVlKHZhbHVlKTtyZXR1cm4gc3RyfSwidG9XaXJlVHlwZSI6ZnVuY3Rpb24oZGVzdHJ1Y3RvcnMsdmFsdWUpe2lmKCEodHlwZW9mIHZhbHVlPT09InN0cmluZyIpKXt0aHJvd0JpbmRpbmdFcnJvcigiQ2Fubm90IHBhc3Mgbm9uLXN0cmluZyB0byBDKysgc3RyaW5nIHR5cGUgIituYW1lKX12YXIgbGVuZ3RoPWxlbmd0aEJ5dGVzVVRGKHZhbHVlKTt2YXIgcHRyPV9tYWxsb2MoNCtsZW5ndGgrY2hhclNpemUpO0hFQVBVMzJbcHRyPj4yXT1sZW5ndGg+PnNoaWZ0O2VuY29kZVN0cmluZyh2YWx1ZSxwdHIrNCxsZW5ndGgrY2hhclNpemUpO2lmKGRlc3RydWN0b3JzIT09bnVsbCl7ZGVzdHJ1Y3RvcnMucHVzaChfZnJlZSxwdHIpfXJldHVybiBwdHJ9LCJhcmdQYWNrQWR2YW5jZSI6OCwicmVhZFZhbHVlRnJvbVBvaW50ZXIiOnNpbXBsZVJlYWRWYWx1ZUZyb21Qb2ludGVyLGRlc3RydWN0b3JGdW5jdGlvbjpmdW5jdGlvbihwdHIpe19mcmVlKHB0cil9fSl9ZnVuY3Rpb24gX19lbWJpbmRfcmVnaXN0ZXJfdm9pZChyYXdUeXBlLG5hbWUpe25hbWU9cmVhZExhdGluMVN0cmluZyhuYW1lKTtyZWdpc3RlclR5cGUocmF3VHlwZSx7aXNWb2lkOnRydWUsbmFtZTpuYW1lLCJhcmdQYWNrQWR2YW5jZSI6MCwiZnJvbVdpcmVUeXBlIjpmdW5jdGlvbigpe3JldHVybiB1bmRlZmluZWR9LCJ0b1dpcmVUeXBlIjpmdW5jdGlvbihkZXN0cnVjdG9ycyxvKXtyZXR1cm4gdW5kZWZpbmVkfX0pfWZ1bmN0aW9uIHJlcXVpcmVIYW5kbGUoaGFuZGxlKXtpZighaGFuZGxlKXt0aHJvd0JpbmRpbmdFcnJvcigiQ2Fubm90IHVzZSBkZWxldGVkIHZhbC4gaGFuZGxlID0gIitoYW5kbGUpfXJldHVybiBlbXZhbF9oYW5kbGVfYXJyYXlbaGFuZGxlXS52YWx1ZX1mdW5jdGlvbiBfX2VtdmFsX2FzKGhhbmRsZSxyZXR1cm5UeXBlLGRlc3RydWN0b3JzUmVmKXtoYW5kbGU9cmVxdWlyZUhhbmRsZShoYW5kbGUpO3JldHVyblR5cGU9cmVxdWlyZVJlZ2lzdGVyZWRUeXBlKHJldHVyblR5cGUsImVtdmFsOjphcyIpO3ZhciBkZXN0cnVjdG9ycz1bXTt2YXIgcmQ9X19lbXZhbF9yZWdpc3RlcihkZXN0cnVjdG9ycyk7SEVBUDMyW2Rlc3RydWN0b3JzUmVmPj4yXT1yZDtyZXR1cm4gcmV0dXJuVHlwZVsidG9XaXJlVHlwZSJdKGRlc3RydWN0b3JzLGhhbmRsZSl9dmFyIGVtdmFsX3N5bWJvbHM9e307ZnVuY3Rpb24gZ2V0U3RyaW5nT3JTeW1ib2woYWRkcmVzcyl7dmFyIHN5bWJvbD1lbXZhbF9zeW1ib2xzW2FkZHJlc3NdO2lmKHN5bWJvbD09PXVuZGVmaW5lZCl7cmV0dXJuIHJlYWRMYXRpbjFTdHJpbmcoYWRkcmVzcyl9ZWxzZXtyZXR1cm4gc3ltYm9sfX12YXIgZW12YWxfbWV0aG9kQ2FsbGVycz1bXTtmdW5jdGlvbiBfX2VtdmFsX2NhbGxfdm9pZF9tZXRob2QoY2FsbGVyLGhhbmRsZSxtZXRob2ROYW1lLGFyZ3Mpe2NhbGxlcj1lbXZhbF9tZXRob2RDYWxsZXJzW2NhbGxlcl07aGFuZGxlPXJlcXVpcmVIYW5kbGUoaGFuZGxlKTttZXRob2ROYW1lPWdldFN0cmluZ09yU3ltYm9sKG1ldGhvZE5hbWUpO2NhbGxlcihoYW5kbGUsbWV0aG9kTmFtZSxudWxsLGFyZ3MpfWZ1bmN0aW9uIF9fZW12YWxfYWRkTWV0aG9kQ2FsbGVyKGNhbGxlcil7dmFyIGlkPWVtdmFsX21ldGhvZENhbGxlcnMubGVuZ3RoO2VtdmFsX21ldGhvZENhbGxlcnMucHVzaChjYWxsZXIpO3JldHVybiBpZH1mdW5jdGlvbiBfX2VtdmFsX2xvb2t1cFR5cGVzKGFyZ0NvdW50LGFyZ1R5cGVzKXt2YXIgYT1uZXcgQXJyYXkoYXJnQ291bnQpO2Zvcih2YXIgaT0wO2k8YXJnQ291bnQ7KytpKXthW2ldPXJlcXVpcmVSZWdpc3RlcmVkVHlwZShIRUFQMzJbKGFyZ1R5cGVzPj4yKStpXSwicGFyYW1ldGVyICIraSl9cmV0dXJuIGF9ZnVuY3Rpb24gX19lbXZhbF9nZXRfbWV0aG9kX2NhbGxlcihhcmdDb3VudCxhcmdUeXBlcyl7dmFyIHR5cGVzPV9fZW12YWxfbG9va3VwVHlwZXMoYXJnQ291bnQsYXJnVHlwZXMpO3ZhciByZXRUeXBlPXR5cGVzWzBdO3ZhciBzaWduYXR1cmVOYW1lPXJldFR5cGUubmFtZSsiXyQiK3R5cGVzLnNsaWNlKDEpLm1hcChmdW5jdGlvbih0KXtyZXR1cm4gdC5uYW1lfSkuam9pbigiXyIpKyIkIjt2YXIgcGFyYW1zPVsicmV0VHlwZSJdO3ZhciBhcmdzPVtyZXRUeXBlXTt2YXIgYXJnc0xpc3Q9IiI7Zm9yKHZhciBpPTA7aTxhcmdDb3VudC0xOysraSl7YXJnc0xpc3QrPShpIT09MD8iLCAiOiIiKSsiYXJnIitpO3BhcmFtcy5wdXNoKCJhcmdUeXBlIitpKTthcmdzLnB1c2godHlwZXNbMStpXSl9dmFyIGZ1bmN0aW9uTmFtZT1tYWtlTGVnYWxGdW5jdGlvbk5hbWUoIm1ldGhvZENhbGxlcl8iK3NpZ25hdHVyZU5hbWUpO3ZhciBmdW5jdGlvbkJvZHk9InJldHVybiBmdW5jdGlvbiAiK2Z1bmN0aW9uTmFtZSsiKGhhbmRsZSwgbmFtZSwgZGVzdHJ1Y3RvcnMsIGFyZ3MpIHtcbiI7dmFyIG9mZnNldD0wO2Zvcih2YXIgaT0wO2k8YXJnQ291bnQtMTsrK2kpe2Z1bmN0aW9uQm9keSs9IiAgICB2YXIgYXJnIitpKyIgPSBhcmdUeXBlIitpKyIucmVhZFZhbHVlRnJvbVBvaW50ZXIoYXJncyIrKG9mZnNldD8iKyIrb2Zmc2V0OiIiKSsiKTtcbiI7b2Zmc2V0Kz10eXBlc1tpKzFdWyJhcmdQYWNrQWR2YW5jZSJdfWZ1bmN0aW9uQm9keSs9IiAgICB2YXIgcnYgPSBoYW5kbGVbbmFtZV0oIithcmdzTGlzdCsiKTtcbiI7Zm9yKHZhciBpPTA7aTxhcmdDb3VudC0xOysraSl7aWYodHlwZXNbaSsxXVsiZGVsZXRlT2JqZWN0Il0pe2Z1bmN0aW9uQm9keSs9IiAgICBhcmdUeXBlIitpKyIuZGVsZXRlT2JqZWN0KGFyZyIraSsiKTtcbiJ9fWlmKCFyZXRUeXBlLmlzVm9pZCl7ZnVuY3Rpb25Cb2R5Kz0iICAgIHJldHVybiByZXRUeXBlLnRvV2lyZVR5cGUoZGVzdHJ1Y3RvcnMsIHJ2KTtcbiJ9ZnVuY3Rpb25Cb2R5Kz0ifTtcbiI7cGFyYW1zLnB1c2goZnVuY3Rpb25Cb2R5KTt2YXIgaW52b2tlckZ1bmN0aW9uPW5ld18oRnVuY3Rpb24scGFyYW1zKS5hcHBseShudWxsLGFyZ3MpO3JldHVybiBfX2VtdmFsX2FkZE1ldGhvZENhbGxlcihpbnZva2VyRnVuY3Rpb24pfWZ1bmN0aW9uIF9fZW12YWxfZ2V0X3Byb3BlcnR5KGhhbmRsZSxrZXkpe2hhbmRsZT1yZXF1aXJlSGFuZGxlKGhhbmRsZSk7a2V5PXJlcXVpcmVIYW5kbGUoa2V5KTtyZXR1cm4gX19lbXZhbF9yZWdpc3RlcihoYW5kbGVba2V5XSl9ZnVuY3Rpb24gX19lbXZhbF9pbmNyZWYoaGFuZGxlKXtpZihoYW5kbGU+NCl7ZW12YWxfaGFuZGxlX2FycmF5W2hhbmRsZV0ucmVmY291bnQrPTF9fWZ1bmN0aW9uIF9fZW12YWxfbmV3X2FycmF5KCl7cmV0dXJuIF9fZW12YWxfcmVnaXN0ZXIoW10pfWZ1bmN0aW9uIF9fZW12YWxfbmV3X2NzdHJpbmcodil7cmV0dXJuIF9fZW12YWxfcmVnaXN0ZXIoZ2V0U3RyaW5nT3JTeW1ib2wodikpfWZ1bmN0aW9uIF9fZW12YWxfcnVuX2Rlc3RydWN0b3JzKGhhbmRsZSl7dmFyIGRlc3RydWN0b3JzPWVtdmFsX2hhbmRsZV9hcnJheVtoYW5kbGVdLnZhbHVlO3J1bkRlc3RydWN0b3JzKGRlc3RydWN0b3JzKTtfX2VtdmFsX2RlY3JlZihoYW5kbGUpfWZ1bmN0aW9uIF9fZW12YWxfdGFrZV92YWx1ZSh0eXBlLGFyZ3Ype3R5cGU9cmVxdWlyZVJlZ2lzdGVyZWRUeXBlKHR5cGUsIl9lbXZhbF90YWtlX3ZhbHVlIik7dmFyIHY9dHlwZVsicmVhZFZhbHVlRnJvbVBvaW50ZXIiXShhcmd2KTtyZXR1cm4gX19lbXZhbF9yZWdpc3Rlcih2KX1mdW5jdGlvbiBfYWJvcnQoKXthYm9ydCgpfXZhciBfZW1zY3JpcHRlbl9nZXRfbm93O19lbXNjcmlwdGVuX2dldF9ub3c9ZnVuY3Rpb24oKXtyZXR1cm4gcGVyZm9ybWFuY2Uubm93KCl9O3ZhciBfZW1zY3JpcHRlbl9nZXRfbm93X2lzX21vbm90b25pYz10cnVlO2Z1bmN0aW9uIF9jbG9ja19nZXR0aW1lKGNsa19pZCx0cCl7dmFyIG5vdztpZihjbGtfaWQ9PT0wKXtub3c9RGF0ZS5ub3coKX1lbHNlIGlmKChjbGtfaWQ9PT0xfHxjbGtfaWQ9PT00KSYmX2Vtc2NyaXB0ZW5fZ2V0X25vd19pc19tb25vdG9uaWMpe25vdz1fZW1zY3JpcHRlbl9nZXRfbm93KCl9ZWxzZXtzZXRFcnJObygyOCk7cmV0dXJuLTF9SEVBUDMyW3RwPj4yXT1ub3cvMWUzfDA7SEVBUDMyW3RwKzQ+PjJdPW5vdyUxZTMqMWUzKjFlM3wwO3JldHVybiAwfWZ1bmN0aW9uIF9kbG9wZW4oZmlsZW5hbWUsZmxhZyl7YWJvcnQoIlRvIHVzZSBkbG9wZW4sIHlvdSBuZWVkIHRvIHVzZSBFbXNjcmlwdGVuJ3MgbGlua2luZyBzdXBwb3J0LCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2Vtc2NyaXB0ZW4tY29yZS9lbXNjcmlwdGVuL3dpa2kvTGlua2luZyIpfWZ1bmN0aW9uIF9kbHN5bShoYW5kbGUsc3ltYm9sKXthYm9ydCgiVG8gdXNlIGRsb3BlbiwgeW91IG5lZWQgdG8gdXNlIEVtc2NyaXB0ZW4ncyBsaW5raW5nIHN1cHBvcnQsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZW1zY3JpcHRlbi1jb3JlL2Vtc2NyaXB0ZW4vd2lraS9MaW5raW5nIil9ZnVuY3Rpb24gX2Vtc2NyaXB0ZW5fbWVtY3B5X2JpZyhkZXN0LHNyYyxudW0pe0hFQVBVOC5jb3B5V2l0aGluKGRlc3Qsc3JjLHNyYytudW0pfWZ1bmN0aW9uIF9lbXNjcmlwdGVuX2dldF9oZWFwX3NpemUoKXtyZXR1cm4gSEVBUFU4Lmxlbmd0aH1mdW5jdGlvbiBlbXNjcmlwdGVuX3JlYWxsb2NfYnVmZmVyKHNpemUpe3RyeXt3YXNtTWVtb3J5Lmdyb3coc2l6ZS1idWZmZXIuYnl0ZUxlbmd0aCs2NTUzNT4+PjE2KTt1cGRhdGVHbG9iYWxCdWZmZXJBbmRWaWV3cyh3YXNtTWVtb3J5LmJ1ZmZlcik7cmV0dXJuIDF9Y2F0Y2goZSl7fX1mdW5jdGlvbiBfZW1zY3JpcHRlbl9yZXNpemVfaGVhcChyZXF1ZXN0ZWRTaXplKXt2YXIgb2xkU2l6ZT1fZW1zY3JpcHRlbl9nZXRfaGVhcF9zaXplKCk7dmFyIG1heEhlYXBTaXplPTIxNDc0ODM2NDg7aWYocmVxdWVzdGVkU2l6ZT5tYXhIZWFwU2l6ZSl7cmV0dXJuIGZhbHNlfWZvcih2YXIgY3V0RG93bj0xO2N1dERvd248PTQ7Y3V0RG93bio9Mil7dmFyIG92ZXJHcm93bkhlYXBTaXplPW9sZFNpemUqKDErLjIvY3V0RG93bik7b3Zlckdyb3duSGVhcFNpemU9TWF0aC5taW4ob3Zlckdyb3duSGVhcFNpemUscmVxdWVzdGVkU2l6ZSsxMDA2NjMyOTYpO3ZhciBuZXdTaXplPU1hdGgubWluKG1heEhlYXBTaXplLGFsaWduVXAoTWF0aC5tYXgocmVxdWVzdGVkU2l6ZSxvdmVyR3Jvd25IZWFwU2l6ZSksNjU1MzYpKTt2YXIgcmVwbGFjZW1lbnQ9ZW1zY3JpcHRlbl9yZWFsbG9jX2J1ZmZlcihuZXdTaXplKTtpZihyZXBsYWNlbWVudCl7cmV0dXJuIHRydWV9fXJldHVybiBmYWxzZX1mdW5jdGlvbiBfZW1zY3JpcHRlbl90aHJlYWRfc2xlZXAobXNlY3Mpe3ZhciBzdGFydD1fZW1zY3JpcHRlbl9nZXRfbm93KCk7d2hpbGUoX2Vtc2NyaXB0ZW5fZ2V0X25vdygpLXN0YXJ0PG1zZWNzKXt9fXZhciBFTlY9e307ZnVuY3Rpb24gZ2V0RXhlY3V0YWJsZU5hbWUoKXtyZXR1cm4gdGhpc1Byb2dyYW18fCIuL3RoaXMucHJvZ3JhbSJ9ZnVuY3Rpb24gZ2V0RW52U3RyaW5ncygpe2lmKCFnZXRFbnZTdHJpbmdzLnN0cmluZ3Mpe3ZhciBsYW5nPSh0eXBlb2YgbmF2aWdhdG9yPT09Im9iamVjdCImJm5hdmlnYXRvci5sYW5ndWFnZXMmJm5hdmlnYXRvci5sYW5ndWFnZXNbMF18fCJDIikucmVwbGFjZSgiLSIsIl8iKSsiLlVURi04Ijt2YXIgZW52PXsiVVNFUiI6IndlYl91c2VyIiwiTE9HTkFNRSI6IndlYl91c2VyIiwiUEFUSCI6Ii8iLCJQV0QiOiIvIiwiSE9NRSI6Ii9ob21lL3dlYl91c2VyIiwiTEFORyI6bGFuZywiXyI6Z2V0RXhlY3V0YWJsZU5hbWUoKX07Zm9yKHZhciB4IGluIEVOVil7ZW52W3hdPUVOVlt4XX12YXIgc3RyaW5ncz1bXTtmb3IodmFyIHggaW4gZW52KXtzdHJpbmdzLnB1c2goeCsiPSIrZW52W3hdKX1nZXRFbnZTdHJpbmdzLnN0cmluZ3M9c3RyaW5nc31yZXR1cm4gZ2V0RW52U3RyaW5ncy5zdHJpbmdzfWZ1bmN0aW9uIF9lbnZpcm9uX2dldChfX2Vudmlyb24sZW52aXJvbl9idWYpe3ZhciBidWZTaXplPTA7Z2V0RW52U3RyaW5ncygpLmZvckVhY2goZnVuY3Rpb24oc3RyaW5nLGkpe3ZhciBwdHI9ZW52aXJvbl9idWYrYnVmU2l6ZTtIRUFQMzJbX19lbnZpcm9uK2kqND4+Ml09cHRyO3dyaXRlQXNjaWlUb01lbW9yeShzdHJpbmcscHRyKTtidWZTaXplKz1zdHJpbmcubGVuZ3RoKzF9KTtyZXR1cm4gMH1mdW5jdGlvbiBfZW52aXJvbl9zaXplc19nZXQocGVudmlyb25fY291bnQscGVudmlyb25fYnVmX3NpemUpe3ZhciBzdHJpbmdzPWdldEVudlN0cmluZ3MoKTtIRUFQMzJbcGVudmlyb25fY291bnQ+PjJdPXN0cmluZ3MubGVuZ3RoO3ZhciBidWZTaXplPTA7c3RyaW5ncy5mb3JFYWNoKGZ1bmN0aW9uKHN0cmluZyl7YnVmU2l6ZSs9c3RyaW5nLmxlbmd0aCsxfSk7SEVBUDMyW3BlbnZpcm9uX2J1Zl9zaXplPj4yXT1idWZTaXplO3JldHVybiAwfWZ1bmN0aW9uIF9mZF9jbG9zZShmZCl7cmV0dXJuIDB9ZnVuY3Rpb24gX2ZkX2Zkc3RhdF9nZXQoZmQscGJ1Zil7dmFyIHR5cGU9ZmQ9PTF8fGZkPT0yPzI6YWJvcnQoKTtIRUFQOFtwYnVmPj4wXT10eXBlO3JldHVybiAwfWZ1bmN0aW9uIF9mZF9yZWFkKGZkLGlvdixpb3ZjbnQscG51bSl7dmFyIHN0cmVhbT1TWVNDQUxMUy5nZXRTdHJlYW1Gcm9tRkQoZmQpO3ZhciBudW09U1lTQ0FMTFMuZG9SZWFkdihzdHJlYW0saW92LGlvdmNudCk7SEVBUDMyW3BudW0+PjJdPW51bTtyZXR1cm4gMH1mdW5jdGlvbiBfZmRfc2VlayhmZCxvZmZzZXRfbG93LG9mZnNldF9oaWdoLHdoZW5jZSxuZXdPZmZzZXQpe31mdW5jdGlvbiBfZmRfd3JpdGUoZmQsaW92LGlvdmNudCxwbnVtKXt2YXIgbnVtPTA7Zm9yKHZhciBpPTA7aTxpb3ZjbnQ7aSsrKXt2YXIgcHRyPUhFQVAzMltpb3YraSo4Pj4yXTt2YXIgbGVuPUhFQVAzMltpb3YrKGkqOCs0KT4+Ml07Zm9yKHZhciBqPTA7ajxsZW47aisrKXtTWVNDQUxMUy5wcmludENoYXIoZmQsSEVBUFU4W3B0citqXSl9bnVtKz1sZW59SEVBUDMyW3BudW0+PjJdPW51bTtyZXR1cm4gMH1mdW5jdGlvbiBfZ210aW1lX3IodGltZSx0bVB0cil7dmFyIGRhdGU9bmV3IERhdGUoSEVBUDMyW3RpbWU+PjJdKjFlMyk7SEVBUDMyW3RtUHRyPj4yXT1kYXRlLmdldFVUQ1NlY29uZHMoKTtIRUFQMzJbdG1QdHIrND4+Ml09ZGF0ZS5nZXRVVENNaW51dGVzKCk7SEVBUDMyW3RtUHRyKzg+PjJdPWRhdGUuZ2V0VVRDSG91cnMoKTtIRUFQMzJbdG1QdHIrMTI+PjJdPWRhdGUuZ2V0VVRDRGF0ZSgpO0hFQVAzMlt0bVB0cisxNj4+Ml09ZGF0ZS5nZXRVVENNb250aCgpO0hFQVAzMlt0bVB0cisyMD4+Ml09ZGF0ZS5nZXRVVENGdWxsWWVhcigpLTE5MDA7SEVBUDMyW3RtUHRyKzI0Pj4yXT1kYXRlLmdldFVUQ0RheSgpO0hFQVAzMlt0bVB0ciszNj4+Ml09MDtIRUFQMzJbdG1QdHIrMzI+PjJdPTA7dmFyIHN0YXJ0PURhdGUuVVRDKGRhdGUuZ2V0VVRDRnVsbFllYXIoKSwwLDEsMCwwLDAsMCk7dmFyIHlkYXk9KGRhdGUuZ2V0VGltZSgpLXN0YXJ0KS8oMWUzKjYwKjYwKjI0KXwwO0hFQVAzMlt0bVB0cisyOD4+Ml09eWRheTtpZighX2dtdGltZV9yLkdNVFN0cmluZylfZ210aW1lX3IuR01UU3RyaW5nPWFsbG9jYXRlVVRGOCgiR01UIik7SEVBUDMyW3RtUHRyKzQwPj4yXT1fZ210aW1lX3IuR01UU3RyaW5nO3JldHVybiB0bVB0cn1mdW5jdGlvbiBfdHpzZXQoKXtpZihfdHpzZXQuY2FsbGVkKXJldHVybjtfdHpzZXQuY2FsbGVkPXRydWU7dmFyIGN1cnJlbnRZZWFyPShuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKTt2YXIgd2ludGVyPW5ldyBEYXRlKGN1cnJlbnRZZWFyLDAsMSk7dmFyIHN1bW1lcj1uZXcgRGF0ZShjdXJyZW50WWVhciw2LDEpO3ZhciB3aW50ZXJPZmZzZXQ9d2ludGVyLmdldFRpbWV6b25lT2Zmc2V0KCk7dmFyIHN1bW1lck9mZnNldD1zdW1tZXIuZ2V0VGltZXpvbmVPZmZzZXQoKTt2YXIgc3RkVGltZXpvbmVPZmZzZXQ9TWF0aC5tYXgod2ludGVyT2Zmc2V0LHN1bW1lck9mZnNldCk7SEVBUDMyW19fZ2V0X3RpbWV6b25lKCk+PjJdPXN0ZFRpbWV6b25lT2Zmc2V0KjYwO0hFQVAzMltfX2dldF9kYXlsaWdodCgpPj4yXT1OdW1iZXIod2ludGVyT2Zmc2V0IT1zdW1tZXJPZmZzZXQpO2Z1bmN0aW9uIGV4dHJhY3Rab25lKGRhdGUpe3ZhciBtYXRjaD1kYXRlLnRvVGltZVN0cmluZygpLm1hdGNoKC9cKChbQS1aYS16IF0rKVwpJC8pO3JldHVybiBtYXRjaD9tYXRjaFsxXToiR01UIn12YXIgd2ludGVyTmFtZT1leHRyYWN0Wm9uZSh3aW50ZXIpO3ZhciBzdW1tZXJOYW1lPWV4dHJhY3Rab25lKHN1bW1lcik7dmFyIHdpbnRlck5hbWVQdHI9YWxsb2NhdGVVVEY4KHdpbnRlck5hbWUpO3ZhciBzdW1tZXJOYW1lUHRyPWFsbG9jYXRlVVRGOChzdW1tZXJOYW1lKTtpZihzdW1tZXJPZmZzZXQ8d2ludGVyT2Zmc2V0KXtIRUFQMzJbX19nZXRfdHpuYW1lKCk+PjJdPXdpbnRlck5hbWVQdHI7SEVBUDMyW19fZ2V0X3R6bmFtZSgpKzQ+PjJdPXN1bW1lck5hbWVQdHJ9ZWxzZXtIRUFQMzJbX19nZXRfdHpuYW1lKCk+PjJdPXN1bW1lck5hbWVQdHI7SEVBUDMyW19fZ2V0X3R6bmFtZSgpKzQ+PjJdPXdpbnRlck5hbWVQdHJ9fWZ1bmN0aW9uIF9sb2NhbHRpbWVfcih0aW1lLHRtUHRyKXtfdHpzZXQoKTt2YXIgZGF0ZT1uZXcgRGF0ZShIRUFQMzJbdGltZT4+Ml0qMWUzKTtIRUFQMzJbdG1QdHI+PjJdPWRhdGUuZ2V0U2Vjb25kcygpO0hFQVAzMlt0bVB0cis0Pj4yXT1kYXRlLmdldE1pbnV0ZXMoKTtIRUFQMzJbdG1QdHIrOD4+Ml09ZGF0ZS5nZXRIb3VycygpO0hFQVAzMlt0bVB0cisxMj4+Ml09ZGF0ZS5nZXREYXRlKCk7SEVBUDMyW3RtUHRyKzE2Pj4yXT1kYXRlLmdldE1vbnRoKCk7SEVBUDMyW3RtUHRyKzIwPj4yXT1kYXRlLmdldEZ1bGxZZWFyKCktMTkwMDtIRUFQMzJbdG1QdHIrMjQ+PjJdPWRhdGUuZ2V0RGF5KCk7dmFyIHN0YXJ0PW5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwwLDEpO3ZhciB5ZGF5PShkYXRlLmdldFRpbWUoKS1zdGFydC5nZXRUaW1lKCkpLygxZTMqNjAqNjAqMjQpfDA7SEVBUDMyW3RtUHRyKzI4Pj4yXT15ZGF5O0hFQVAzMlt0bVB0ciszNj4+Ml09LShkYXRlLmdldFRpbWV6b25lT2Zmc2V0KCkqNjApO3ZhciBzdW1tZXJPZmZzZXQ9bmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLDYsMSkuZ2V0VGltZXpvbmVPZmZzZXQoKTt2YXIgd2ludGVyT2Zmc2V0PXN0YXJ0LmdldFRpbWV6b25lT2Zmc2V0KCk7dmFyIGRzdD0oc3VtbWVyT2Zmc2V0IT13aW50ZXJPZmZzZXQmJmRhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKT09TWF0aC5taW4od2ludGVyT2Zmc2V0LHN1bW1lck9mZnNldCkpfDA7SEVBUDMyW3RtUHRyKzMyPj4yXT1kc3Q7dmFyIHpvbmVQdHI9SEVBUDMyW19fZ2V0X3R6bmFtZSgpKyhkc3Q/NDowKT4+Ml07SEVBUDMyW3RtUHRyKzQwPj4yXT16b25lUHRyO3JldHVybiB0bVB0cn1mdW5jdGlvbiBfcHRocmVhZF9jcmVhdGUoKXtyZXR1cm4gNn1mdW5jdGlvbiBfcHRocmVhZF9qb2luKCl7cmV0dXJuIDI4fWZ1bmN0aW9uIF9zZXRUZW1wUmV0MCgkaSl7c2V0VGVtcFJldDAoJGl8MCl9ZnVuY3Rpb24gX19pc0xlYXBZZWFyKHllYXIpe3JldHVybiB5ZWFyJTQ9PT0wJiYoeWVhciUxMDAhPT0wfHx5ZWFyJTQwMD09PTApfWZ1bmN0aW9uIF9fYXJyYXlTdW0oYXJyYXksaW5kZXgpe3ZhciBzdW09MDtmb3IodmFyIGk9MDtpPD1pbmRleDtzdW0rPWFycmF5W2krK10pe31yZXR1cm4gc3VtfXZhciBfX01PTlRIX0RBWVNfTEVBUD1bMzEsMjksMzEsMzAsMzEsMzAsMzEsMzEsMzAsMzEsMzAsMzFdO3ZhciBfX01PTlRIX0RBWVNfUkVHVUxBUj1bMzEsMjgsMzEsMzAsMzEsMzAsMzEsMzEsMzAsMzEsMzAsMzFdO2Z1bmN0aW9uIF9fYWRkRGF5cyhkYXRlLGRheXMpe3ZhciBuZXdEYXRlPW5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpKTt3aGlsZShkYXlzPjApe3ZhciBsZWFwPV9faXNMZWFwWWVhcihuZXdEYXRlLmdldEZ1bGxZZWFyKCkpO3ZhciBjdXJyZW50TW9udGg9bmV3RGF0ZS5nZXRNb250aCgpO3ZhciBkYXlzSW5DdXJyZW50TW9udGg9KGxlYXA/X19NT05USF9EQVlTX0xFQVA6X19NT05USF9EQVlTX1JFR1VMQVIpW2N1cnJlbnRNb250aF07aWYoZGF5cz5kYXlzSW5DdXJyZW50TW9udGgtbmV3RGF0ZS5nZXREYXRlKCkpe2RheXMtPWRheXNJbkN1cnJlbnRNb250aC1uZXdEYXRlLmdldERhdGUoKSsxO25ld0RhdGUuc2V0RGF0ZSgxKTtpZihjdXJyZW50TW9udGg8MTEpe25ld0RhdGUuc2V0TW9udGgoY3VycmVudE1vbnRoKzEpfWVsc2V7bmV3RGF0ZS5zZXRNb250aCgwKTtuZXdEYXRlLnNldEZ1bGxZZWFyKG5ld0RhdGUuZ2V0RnVsbFllYXIoKSsxKX19ZWxzZXtuZXdEYXRlLnNldERhdGUobmV3RGF0ZS5nZXREYXRlKCkrZGF5cyk7cmV0dXJuIG5ld0RhdGV9fXJldHVybiBuZXdEYXRlfWZ1bmN0aW9uIF9zdHJmdGltZShzLG1heHNpemUsZm9ybWF0LHRtKXt2YXIgdG1fem9uZT1IRUFQMzJbdG0rNDA+PjJdO3ZhciBkYXRlPXt0bV9zZWM6SEVBUDMyW3RtPj4yXSx0bV9taW46SEVBUDMyW3RtKzQ+PjJdLHRtX2hvdXI6SEVBUDMyW3RtKzg+PjJdLHRtX21kYXk6SEVBUDMyW3RtKzEyPj4yXSx0bV9tb246SEVBUDMyW3RtKzE2Pj4yXSx0bV95ZWFyOkhFQVAzMlt0bSsyMD4+Ml0sdG1fd2RheTpIRUFQMzJbdG0rMjQ+PjJdLHRtX3lkYXk6SEVBUDMyW3RtKzI4Pj4yXSx0bV9pc2RzdDpIRUFQMzJbdG0rMzI+PjJdLHRtX2dtdG9mZjpIRUFQMzJbdG0rMzY+PjJdLHRtX3pvbmU6dG1fem9uZT9VVEY4VG9TdHJpbmcodG1fem9uZSk6IiJ9O3ZhciBwYXR0ZXJuPVVURjhUb1N0cmluZyhmb3JtYXQpO3ZhciBFWFBBTlNJT05fUlVMRVNfMT17IiVjIjoiJWEgJWIgJWQgJUg6JU06JVMgJVkiLCIlRCI6IiVtLyVkLyV5IiwiJUYiOiIlWS0lbS0lZCIsIiVoIjoiJWIiLCIlciI6IiVJOiVNOiVTICVwIiwiJVIiOiIlSDolTSIsIiVUIjoiJUg6JU06JVMiLCIleCI6IiVtLyVkLyV5IiwiJVgiOiIlSDolTTolUyIsIiVFYyI6IiVjIiwiJUVDIjoiJUMiLCIlRXgiOiIlbS8lZC8leSIsIiVFWCI6IiVIOiVNOiVTIiwiJUV5IjoiJXkiLCIlRVkiOiIlWSIsIiVPZCI6IiVkIiwiJU9lIjoiJWUiLCIlT0giOiIlSCIsIiVPSSI6IiVJIiwiJU9tIjoiJW0iLCIlT00iOiIlTSIsIiVPUyI6IiVTIiwiJU91IjoiJXUiLCIlT1UiOiIlVSIsIiVPViI6IiVWIiwiJU93IjoiJXciLCIlT1ciOiIlVyIsIiVPeSI6IiV5In07Zm9yKHZhciBydWxlIGluIEVYUEFOU0lPTl9SVUxFU18xKXtwYXR0ZXJuPXBhdHRlcm4ucmVwbGFjZShuZXcgUmVnRXhwKHJ1bGUsImciKSxFWFBBTlNJT05fUlVMRVNfMVtydWxlXSl9dmFyIFdFRUtEQVlTPVsiU3VuZGF5IiwiTW9uZGF5IiwiVHVlc2RheSIsIldlZG5lc2RheSIsIlRodXJzZGF5IiwiRnJpZGF5IiwiU2F0dXJkYXkiXTt2YXIgTU9OVEhTPVsiSmFudWFyeSIsIkZlYnJ1YXJ5IiwiTWFyY2giLCJBcHJpbCIsIk1heSIsIkp1bmUiLCJKdWx5IiwiQXVndXN0IiwiU2VwdGVtYmVyIiwiT2N0b2JlciIsIk5vdmVtYmVyIiwiRGVjZW1iZXIiXTtmdW5jdGlvbiBsZWFkaW5nU29tZXRoaW5nKHZhbHVlLGRpZ2l0cyxjaGFyYWN0ZXIpe3ZhciBzdHI9dHlwZW9mIHZhbHVlPT09Im51bWJlciI/dmFsdWUudG9TdHJpbmcoKTp2YWx1ZXx8IiI7d2hpbGUoc3RyLmxlbmd0aDxkaWdpdHMpe3N0cj1jaGFyYWN0ZXJbMF0rc3RyfXJldHVybiBzdHJ9ZnVuY3Rpb24gbGVhZGluZ051bGxzKHZhbHVlLGRpZ2l0cyl7cmV0dXJuIGxlYWRpbmdTb21ldGhpbmcodmFsdWUsZGlnaXRzLCIwIil9ZnVuY3Rpb24gY29tcGFyZUJ5RGF5KGRhdGUxLGRhdGUyKXtmdW5jdGlvbiBzZ24odmFsdWUpe3JldHVybiB2YWx1ZTwwPy0xOnZhbHVlPjA/MTowfXZhciBjb21wYXJlO2lmKChjb21wYXJlPXNnbihkYXRlMS5nZXRGdWxsWWVhcigpLWRhdGUyLmdldEZ1bGxZZWFyKCkpKT09PTApe2lmKChjb21wYXJlPXNnbihkYXRlMS5nZXRNb250aCgpLWRhdGUyLmdldE1vbnRoKCkpKT09PTApe2NvbXBhcmU9c2duKGRhdGUxLmdldERhdGUoKS1kYXRlMi5nZXREYXRlKCkpfX1yZXR1cm4gY29tcGFyZX1mdW5jdGlvbiBnZXRGaXJzdFdlZWtTdGFydERhdGUoamFuRm91cnRoKXtzd2l0Y2goamFuRm91cnRoLmdldERheSgpKXtjYXNlIDA6cmV0dXJuIG5ldyBEYXRlKGphbkZvdXJ0aC5nZXRGdWxsWWVhcigpLTEsMTEsMjkpO2Nhc2UgMTpyZXR1cm4gamFuRm91cnRoO2Nhc2UgMjpyZXR1cm4gbmV3IERhdGUoamFuRm91cnRoLmdldEZ1bGxZZWFyKCksMCwzKTtjYXNlIDM6cmV0dXJuIG5ldyBEYXRlKGphbkZvdXJ0aC5nZXRGdWxsWWVhcigpLDAsMik7Y2FzZSA0OnJldHVybiBuZXcgRGF0ZShqYW5Gb3VydGguZ2V0RnVsbFllYXIoKSwwLDEpO2Nhc2UgNTpyZXR1cm4gbmV3IERhdGUoamFuRm91cnRoLmdldEZ1bGxZZWFyKCktMSwxMSwzMSk7Y2FzZSA2OnJldHVybiBuZXcgRGF0ZShqYW5Gb3VydGguZ2V0RnVsbFllYXIoKS0xLDExLDMwKX19ZnVuY3Rpb24gZ2V0V2Vla0Jhc2VkWWVhcihkYXRlKXt2YXIgdGhpc0RhdGU9X19hZGREYXlzKG5ldyBEYXRlKGRhdGUudG1feWVhcisxOTAwLDAsMSksZGF0ZS50bV95ZGF5KTt2YXIgamFuRm91cnRoVGhpc1llYXI9bmV3IERhdGUodGhpc0RhdGUuZ2V0RnVsbFllYXIoKSwwLDQpO3ZhciBqYW5Gb3VydGhOZXh0WWVhcj1uZXcgRGF0ZSh0aGlzRGF0ZS5nZXRGdWxsWWVhcigpKzEsMCw0KTt2YXIgZmlyc3RXZWVrU3RhcnRUaGlzWWVhcj1nZXRGaXJzdFdlZWtTdGFydERhdGUoamFuRm91cnRoVGhpc1llYXIpO3ZhciBmaXJzdFdlZWtTdGFydE5leHRZZWFyPWdldEZpcnN0V2Vla1N0YXJ0RGF0ZShqYW5Gb3VydGhOZXh0WWVhcik7aWYoY29tcGFyZUJ5RGF5KGZpcnN0V2Vla1N0YXJ0VGhpc1llYXIsdGhpc0RhdGUpPD0wKXtpZihjb21wYXJlQnlEYXkoZmlyc3RXZWVrU3RhcnROZXh0WWVhcix0aGlzRGF0ZSk8PTApe3JldHVybiB0aGlzRGF0ZS5nZXRGdWxsWWVhcigpKzF9ZWxzZXtyZXR1cm4gdGhpc0RhdGUuZ2V0RnVsbFllYXIoKX19ZWxzZXtyZXR1cm4gdGhpc0RhdGUuZ2V0RnVsbFllYXIoKS0xfX12YXIgRVhQQU5TSU9OX1JVTEVTXzI9eyIlYSI6ZnVuY3Rpb24oZGF0ZSl7cmV0dXJuIFdFRUtEQVlTW2RhdGUudG1fd2RheV0uc3Vic3RyaW5nKDAsMyl9LCIlQSI6ZnVuY3Rpb24oZGF0ZSl7cmV0dXJuIFdFRUtEQVlTW2RhdGUudG1fd2RheV19LCIlYiI6ZnVuY3Rpb24oZGF0ZSl7cmV0dXJuIE1PTlRIU1tkYXRlLnRtX21vbl0uc3Vic3RyaW5nKDAsMyl9LCIlQiI6ZnVuY3Rpb24oZGF0ZSl7cmV0dXJuIE1PTlRIU1tkYXRlLnRtX21vbl19LCIlQyI6ZnVuY3Rpb24oZGF0ZSl7dmFyIHllYXI9ZGF0ZS50bV95ZWFyKzE5MDA7cmV0dXJuIGxlYWRpbmdOdWxscyh5ZWFyLzEwMHwwLDIpfSwiJWQiOmZ1bmN0aW9uKGRhdGUpe3JldHVybiBsZWFkaW5nTnVsbHMoZGF0ZS50bV9tZGF5LDIpfSwiJWUiOmZ1bmN0aW9uKGRhdGUpe3JldHVybiBsZWFkaW5nU29tZXRoaW5nKGRhdGUudG1fbWRheSwyLCIgIil9LCIlZyI6ZnVuY3Rpb24oZGF0ZSl7cmV0dXJuIGdldFdlZWtCYXNlZFllYXIoZGF0ZSkudG9TdHJpbmcoKS5zdWJzdHJpbmcoMil9LCIlRyI6ZnVuY3Rpb24oZGF0ZSl7cmV0dXJuIGdldFdlZWtCYXNlZFllYXIoZGF0ZSl9LCIlSCI6ZnVuY3Rpb24oZGF0ZSl7cmV0dXJuIGxlYWRpbmdOdWxscyhkYXRlLnRtX2hvdXIsMil9LCIlSSI6ZnVuY3Rpb24oZGF0ZSl7dmFyIHR3ZWx2ZUhvdXI9ZGF0ZS50bV9ob3VyO2lmKHR3ZWx2ZUhvdXI9PTApdHdlbHZlSG91cj0xMjtlbHNlIGlmKHR3ZWx2ZUhvdXI+MTIpdHdlbHZlSG91ci09MTI7cmV0dXJuIGxlYWRpbmdOdWxscyh0d2VsdmVIb3VyLDIpfSwiJWoiOmZ1bmN0aW9uKGRhdGUpe3JldHVybiBsZWFkaW5nTnVsbHMoZGF0ZS50bV9tZGF5K19fYXJyYXlTdW0oX19pc0xlYXBZZWFyKGRhdGUudG1feWVhcisxOTAwKT9fX01PTlRIX0RBWVNfTEVBUDpfX01PTlRIX0RBWVNfUkVHVUxBUixkYXRlLnRtX21vbi0xKSwzKX0sIiVtIjpmdW5jdGlvbihkYXRlKXtyZXR1cm4gbGVhZGluZ051bGxzKGRhdGUudG1fbW9uKzEsMil9LCIlTSI6ZnVuY3Rpb24oZGF0ZSl7cmV0dXJuIGxlYWRpbmdOdWxscyhkYXRlLnRtX21pbiwyKX0sIiVuIjpmdW5jdGlvbigpe3JldHVybiJcbiJ9LCIlcCI6ZnVuY3Rpb24oZGF0ZSl7aWYoZGF0ZS50bV9ob3VyPj0wJiZkYXRlLnRtX2hvdXI8MTIpe3JldHVybiJBTSJ9ZWxzZXtyZXR1cm4iUE0ifX0sIiVTIjpmdW5jdGlvbihkYXRlKXtyZXR1cm4gbGVhZGluZ051bGxzKGRhdGUudG1fc2VjLDIpfSwiJXQiOmZ1bmN0aW9uKCl7cmV0dXJuIlx0In0sIiV1IjpmdW5jdGlvbihkYXRlKXtyZXR1cm4gZGF0ZS50bV93ZGF5fHw3fSwiJVUiOmZ1bmN0aW9uKGRhdGUpe3ZhciBqYW5GaXJzdD1uZXcgRGF0ZShkYXRlLnRtX3llYXIrMTkwMCwwLDEpO3ZhciBmaXJzdFN1bmRheT1qYW5GaXJzdC5nZXREYXkoKT09PTA/amFuRmlyc3Q6X19hZGREYXlzKGphbkZpcnN0LDctamFuRmlyc3QuZ2V0RGF5KCkpO3ZhciBlbmREYXRlPW5ldyBEYXRlKGRhdGUudG1feWVhcisxOTAwLGRhdGUudG1fbW9uLGRhdGUudG1fbWRheSk7aWYoY29tcGFyZUJ5RGF5KGZpcnN0U3VuZGF5LGVuZERhdGUpPDApe3ZhciBmZWJydWFyeUZpcnN0VW50aWxFbmRNb250aD1fX2FycmF5U3VtKF9faXNMZWFwWWVhcihlbmREYXRlLmdldEZ1bGxZZWFyKCkpP19fTU9OVEhfREFZU19MRUFQOl9fTU9OVEhfREFZU19SRUdVTEFSLGVuZERhdGUuZ2V0TW9udGgoKS0xKS0zMTt2YXIgZmlyc3RTdW5kYXlVbnRpbEVuZEphbnVhcnk9MzEtZmlyc3RTdW5kYXkuZ2V0RGF0ZSgpO3ZhciBkYXlzPWZpcnN0U3VuZGF5VW50aWxFbmRKYW51YXJ5K2ZlYnJ1YXJ5Rmlyc3RVbnRpbEVuZE1vbnRoK2VuZERhdGUuZ2V0RGF0ZSgpO3JldHVybiBsZWFkaW5nTnVsbHMoTWF0aC5jZWlsKGRheXMvNyksMil9cmV0dXJuIGNvbXBhcmVCeURheShmaXJzdFN1bmRheSxqYW5GaXJzdCk9PT0wPyIwMSI6IjAwIn0sIiVWIjpmdW5jdGlvbihkYXRlKXt2YXIgamFuRm91cnRoVGhpc1llYXI9bmV3IERhdGUoZGF0ZS50bV95ZWFyKzE5MDAsMCw0KTt2YXIgamFuRm91cnRoTmV4dFllYXI9bmV3IERhdGUoZGF0ZS50bV95ZWFyKzE5MDEsMCw0KTt2YXIgZmlyc3RXZWVrU3RhcnRUaGlzWWVhcj1nZXRGaXJzdFdlZWtTdGFydERhdGUoamFuRm91cnRoVGhpc1llYXIpO3ZhciBmaXJzdFdlZWtTdGFydE5leHRZZWFyPWdldEZpcnN0V2Vla1N0YXJ0RGF0ZShqYW5Gb3VydGhOZXh0WWVhcik7dmFyIGVuZERhdGU9X19hZGREYXlzKG5ldyBEYXRlKGRhdGUudG1feWVhcisxOTAwLDAsMSksZGF0ZS50bV95ZGF5KTtpZihjb21wYXJlQnlEYXkoZW5kRGF0ZSxmaXJzdFdlZWtTdGFydFRoaXNZZWFyKTwwKXtyZXR1cm4iNTMifWlmKGNvbXBhcmVCeURheShmaXJzdFdlZWtTdGFydE5leHRZZWFyLGVuZERhdGUpPD0wKXtyZXR1cm4iMDEifXZhciBkYXlzRGlmZmVyZW5jZTtpZihmaXJzdFdlZWtTdGFydFRoaXNZZWFyLmdldEZ1bGxZZWFyKCk8ZGF0ZS50bV95ZWFyKzE5MDApe2RheXNEaWZmZXJlbmNlPWRhdGUudG1feWRheSszMi1maXJzdFdlZWtTdGFydFRoaXNZZWFyLmdldERhdGUoKX1lbHNle2RheXNEaWZmZXJlbmNlPWRhdGUudG1feWRheSsxLWZpcnN0V2Vla1N0YXJ0VGhpc1llYXIuZ2V0RGF0ZSgpfXJldHVybiBsZWFkaW5nTnVsbHMoTWF0aC5jZWlsKGRheXNEaWZmZXJlbmNlLzcpLDIpfSwiJXciOmZ1bmN0aW9uKGRhdGUpe3JldHVybiBkYXRlLnRtX3dkYXl9LCIlVyI6ZnVuY3Rpb24oZGF0ZSl7dmFyIGphbkZpcnN0PW5ldyBEYXRlKGRhdGUudG1feWVhciwwLDEpO3ZhciBmaXJzdE1vbmRheT1qYW5GaXJzdC5nZXREYXkoKT09PTE/amFuRmlyc3Q6X19hZGREYXlzKGphbkZpcnN0LGphbkZpcnN0LmdldERheSgpPT09MD8xOjctamFuRmlyc3QuZ2V0RGF5KCkrMSk7dmFyIGVuZERhdGU9bmV3IERhdGUoZGF0ZS50bV95ZWFyKzE5MDAsZGF0ZS50bV9tb24sZGF0ZS50bV9tZGF5KTtpZihjb21wYXJlQnlEYXkoZmlyc3RNb25kYXksZW5kRGF0ZSk8MCl7dmFyIGZlYnJ1YXJ5Rmlyc3RVbnRpbEVuZE1vbnRoPV9fYXJyYXlTdW0oX19pc0xlYXBZZWFyKGVuZERhdGUuZ2V0RnVsbFllYXIoKSk/X19NT05USF9EQVlTX0xFQVA6X19NT05USF9EQVlTX1JFR1VMQVIsZW5kRGF0ZS5nZXRNb250aCgpLTEpLTMxO3ZhciBmaXJzdE1vbmRheVVudGlsRW5kSmFudWFyeT0zMS1maXJzdE1vbmRheS5nZXREYXRlKCk7dmFyIGRheXM9Zmlyc3RNb25kYXlVbnRpbEVuZEphbnVhcnkrZmVicnVhcnlGaXJzdFVudGlsRW5kTW9udGgrZW5kRGF0ZS5nZXREYXRlKCk7cmV0dXJuIGxlYWRpbmdOdWxscyhNYXRoLmNlaWwoZGF5cy83KSwyKX1yZXR1cm4gY29tcGFyZUJ5RGF5KGZpcnN0TW9uZGF5LGphbkZpcnN0KT09PTA/IjAxIjoiMDAifSwiJXkiOmZ1bmN0aW9uKGRhdGUpe3JldHVybihkYXRlLnRtX3llYXIrMTkwMCkudG9TdHJpbmcoKS5zdWJzdHJpbmcoMil9LCIlWSI6ZnVuY3Rpb24oZGF0ZSl7cmV0dXJuIGRhdGUudG1feWVhcisxOTAwfSwiJXoiOmZ1bmN0aW9uKGRhdGUpe3ZhciBvZmY9ZGF0ZS50bV9nbXRvZmY7dmFyIGFoZWFkPW9mZj49MDtvZmY9TWF0aC5hYnMob2ZmKS82MDtvZmY9b2ZmLzYwKjEwMCtvZmYlNjA7cmV0dXJuKGFoZWFkPyIrIjoiLSIpK1N0cmluZygiMDAwMCIrb2ZmKS5zbGljZSgtNCl9LCIlWiI6ZnVuY3Rpb24oZGF0ZSl7cmV0dXJuIGRhdGUudG1fem9uZX0sIiUlIjpmdW5jdGlvbigpe3JldHVybiIlIn19O2Zvcih2YXIgcnVsZSBpbiBFWFBBTlNJT05fUlVMRVNfMil7aWYocGF0dGVybi5pbmRleE9mKHJ1bGUpPj0wKXtwYXR0ZXJuPXBhdHRlcm4ucmVwbGFjZShuZXcgUmVnRXhwKHJ1bGUsImciKSxFWFBBTlNJT05fUlVMRVNfMltydWxlXShkYXRlKSl9fXZhciBieXRlcz1pbnRBcnJheUZyb21TdHJpbmcocGF0dGVybixmYWxzZSk7aWYoYnl0ZXMubGVuZ3RoPm1heHNpemUpe3JldHVybiAwfXdyaXRlQXJyYXlUb01lbW9yeShieXRlcyxzKTtyZXR1cm4gYnl0ZXMubGVuZ3RoLTF9ZnVuY3Rpb24gX3N0cmZ0aW1lX2wocyxtYXhzaXplLGZvcm1hdCx0bSl7cmV0dXJuIF9zdHJmdGltZShzLG1heHNpemUsZm9ybWF0LHRtKX1mdW5jdGlvbiBfc3lzY29uZihuYW1lKXtzd2l0Y2gobmFtZSl7Y2FzZSAzMDpyZXR1cm4gMTYzODQ7Y2FzZSA4NTp2YXIgbWF4SGVhcFNpemU9MjE0NzQ4MzY0ODtyZXR1cm4gbWF4SGVhcFNpemUvMTYzODQ7Y2FzZSAxMzI6Y2FzZSAxMzM6Y2FzZSAxMjpjYXNlIDEzNzpjYXNlIDEzODpjYXNlIDE1OmNhc2UgMjM1OmNhc2UgMTY6Y2FzZSAxNzpjYXNlIDE4OmNhc2UgMTk6Y2FzZSAyMDpjYXNlIDE0OTpjYXNlIDEzOmNhc2UgMTA6Y2FzZSAyMzY6Y2FzZSAxNTM6Y2FzZSA5OmNhc2UgMjE6Y2FzZSAyMjpjYXNlIDE1OTpjYXNlIDE1NDpjYXNlIDE0OmNhc2UgNzc6Y2FzZSA3ODpjYXNlIDEzOTpjYXNlIDgyOmNhc2UgNjg6Y2FzZSA2NzpjYXNlIDE2NDpjYXNlIDExOmNhc2UgMjk6Y2FzZSA0NzpjYXNlIDQ4OmNhc2UgOTU6Y2FzZSA1MjpjYXNlIDUxOmNhc2UgNDY6cmV0dXJuIDIwMDgwOTtjYXNlIDI3OmNhc2UgMjQ2OmNhc2UgMTI3OmNhc2UgMTI4OmNhc2UgMjM6Y2FzZSAyNDpjYXNlIDE2MDpjYXNlIDE2MTpjYXNlIDE4MTpjYXNlIDE4MjpjYXNlIDI0MjpjYXNlIDE4MzpjYXNlIDE4NDpjYXNlIDI0MzpjYXNlIDI0NDpjYXNlIDI0NTpjYXNlIDE2NTpjYXNlIDE3ODpjYXNlIDE3OTpjYXNlIDQ5OmNhc2UgNTA6Y2FzZSAxNjg6Y2FzZSAxNjk6Y2FzZSAxNzU6Y2FzZSAxNzA6Y2FzZSAxNzE6Y2FzZSAxNzI6Y2FzZSA5NzpjYXNlIDc2OmNhc2UgMzI6Y2FzZSAxNzM6Y2FzZSAzNTpjYXNlIDgwOmNhc2UgODE6Y2FzZSA3OTpyZXR1cm4tMTtjYXNlIDE3NjpjYXNlIDE3NzpjYXNlIDc6Y2FzZSAxNTU6Y2FzZSA4OmNhc2UgMTU3OmNhc2UgMTI1OmNhc2UgMTI2OmNhc2UgOTI6Y2FzZSA5MzpjYXNlIDEyOTpjYXNlIDEzMDpjYXNlIDEzMTpjYXNlIDk0OmNhc2UgOTE6cmV0dXJuIDE7Y2FzZSA3NDpjYXNlIDYwOmNhc2UgNjk6Y2FzZSA3MDpjYXNlIDQ6cmV0dXJuIDEwMjQ7Y2FzZSAzMTpjYXNlIDQyOmNhc2UgNzI6cmV0dXJuIDMyO2Nhc2UgODc6Y2FzZSAyNjpjYXNlIDMzOnJldHVybiAyMTQ3NDgzNjQ3O2Nhc2UgMzQ6Y2FzZSAxOnJldHVybiA0NzgzOTtjYXNlIDM4OmNhc2UgMzY6cmV0dXJuIDk5O2Nhc2UgNDM6Y2FzZSAzNzpyZXR1cm4gMjA0ODtjYXNlIDA6cmV0dXJuIDIwOTcxNTI7Y2FzZSAzOnJldHVybiA2NTUzNjtjYXNlIDI4OnJldHVybiAzMjc2ODtjYXNlIDQ0OnJldHVybiAzMjc2NztjYXNlIDc1OnJldHVybiAxNjM4NDtjYXNlIDM5OnJldHVybiAxZTM7Y2FzZSA4OTpyZXR1cm4gNzAwO2Nhc2UgNzE6cmV0dXJuIDI1NjtjYXNlIDQwOnJldHVybiAyNTU7Y2FzZSAyOnJldHVybiAxMDA7Y2FzZSAxODA6cmV0dXJuIDY0O2Nhc2UgMjU6cmV0dXJuIDIwO2Nhc2UgNTpyZXR1cm4gMTY7Y2FzZSA2OnJldHVybiA2O2Nhc2UgNzM6cmV0dXJuIDQ7Y2FzZSA4NDp7aWYodHlwZW9mIG5hdmlnYXRvcj09PSJvYmplY3QiKXJldHVybiBuYXZpZ2F0b3JbImhhcmR3YXJlQ29uY3VycmVuY3kiXXx8MTtyZXR1cm4gMX19c2V0RXJyTm8oMjgpO3JldHVybi0xfWZ1bmN0aW9uIF90aW1lKHB0cil7dmFyIHJldD1EYXRlLm5vdygpLzFlM3wwO2lmKHB0cil7SEVBUDMyW3B0cj4+Ml09cmV0fXJldHVybiByZXR9ZW1iaW5kX2luaXRfY2hhckNvZGVzKCk7QmluZGluZ0Vycm9yPU1vZHVsZVsiQmluZGluZ0Vycm9yIl09ZXh0ZW5kRXJyb3IoRXJyb3IsIkJpbmRpbmdFcnJvciIpO0ludGVybmFsRXJyb3I9TW9kdWxlWyJJbnRlcm5hbEVycm9yIl09ZXh0ZW5kRXJyb3IoRXJyb3IsIkludGVybmFsRXJyb3IiKTtpbml0X0NsYXNzSGFuZGxlKCk7aW5pdF9SZWdpc3RlcmVkUG9pbnRlcigpO2luaXRfZW1iaW5kKCk7VW5ib3VuZFR5cGVFcnJvcj1Nb2R1bGVbIlVuYm91bmRUeXBlRXJyb3IiXT1leHRlbmRFcnJvcihFcnJvciwiVW5ib3VuZFR5cGVFcnJvciIpO2luaXRfZW12YWwoKTtmdW5jdGlvbiBpbnRBcnJheUZyb21TdHJpbmcoc3RyaW5neSxkb250QWRkTnVsbCxsZW5ndGgpe3ZhciBsZW49bGVuZ3RoPjA/bGVuZ3RoOmxlbmd0aEJ5dGVzVVRGOChzdHJpbmd5KSsxO3ZhciB1OGFycmF5PW5ldyBBcnJheShsZW4pO3ZhciBudW1CeXRlc1dyaXR0ZW49c3RyaW5nVG9VVEY4QXJyYXkoc3RyaW5neSx1OGFycmF5LDAsdThhcnJheS5sZW5ndGgpO2lmKGRvbnRBZGROdWxsKXU4YXJyYXkubGVuZ3RoPW51bUJ5dGVzV3JpdHRlbjtyZXR1cm4gdThhcnJheX12YXIgYXNtTGlicmFyeUFyZz17ImQiOl9fX2N4YV9hbGxvY2F0ZV9leGNlcHRpb24sInIiOl9fX2N4YV9yZXRocm93LCJjIjpfX19jeGFfdGhyb3csIkUiOl9fX3N5c19mY250bDY0LCJDIjpfX19zeXNfZ2V0cGlkLCJVIjpfX19zeXNfaW9jdGwsIlYiOl9fX3N5c19vcGVuLCJYIjpfX2VtYmluZF9yZWdpc3Rlcl9ib29sLCJqIjpfX2VtYmluZF9yZWdpc3Rlcl9jbGFzcywiSyI6X19lbWJpbmRfcmVnaXN0ZXJfY2xhc3NfY2xhc3NfZnVuY3Rpb24sImciOl9fZW1iaW5kX3JlZ2lzdGVyX2NsYXNzX2NvbnN0cnVjdG9yLCJmIjpfX2VtYmluZF9yZWdpc3Rlcl9jbGFzc19mdW5jdGlvbiwiZSI6X19lbWJpbmRfcmVnaXN0ZXJfY2xhc3NfcHJvcGVydHksIlciOl9fZW1iaW5kX3JlZ2lzdGVyX2VtdmFsLCJtIjpfX2VtYmluZF9yZWdpc3Rlcl9lbnVtLCJiIjpfX2VtYmluZF9yZWdpc3Rlcl9lbnVtX3ZhbHVlLCJHIjpfX2VtYmluZF9yZWdpc3Rlcl9mbG9hdCwiaCI6X19lbWJpbmRfcmVnaXN0ZXJfZnVuY3Rpb24sIm4iOl9fZW1iaW5kX3JlZ2lzdGVyX2ludGVnZXIsImsiOl9fZW1iaW5kX3JlZ2lzdGVyX21lbW9yeV92aWV3LCJIIjpfX2VtYmluZF9yZWdpc3Rlcl9zdGRfc3RyaW5nLCJ1IjpfX2VtYmluZF9yZWdpc3Rlcl9zdGRfd3N0cmluZywiWSI6X19lbWJpbmRfcmVnaXN0ZXJfdm9pZCwieCI6X19lbXZhbF9hcywicCI6X19lbXZhbF9jYWxsX3ZvaWRfbWV0aG9kLCJpIjpfX2VtdmFsX2RlY3JlZiwicSI6X19lbXZhbF9nZXRfbWV0aG9kX2NhbGxlciwieSI6X19lbXZhbF9nZXRfcHJvcGVydHksImwiOl9fZW12YWxfaW5jcmVmLCJzIjpfX2VtdmFsX25ld19hcnJheSwieiI6X19lbXZhbF9uZXdfY3N0cmluZywidyI6X19lbXZhbF9ydW5fZGVzdHJ1Y3RvcnMsInQiOl9fZW12YWxfdGFrZV92YWx1ZSwiYSI6X2Fib3J0LCJCIjpfY2xvY2tfZ2V0dGltZSwiXyI6X2Rsb3BlbiwiWiI6X2Rsc3ltLCJNIjpfZW1zY3JpcHRlbl9tZW1jcHlfYmlnLCJOIjpfZW1zY3JpcHRlbl9yZXNpemVfaGVhcCwiTyI6X2Vtc2NyaXB0ZW5fdGhyZWFkX3NsZWVwLCJRIjpfZW52aXJvbl9nZXQsIlIiOl9lbnZpcm9uX3NpemVzX2dldCwiRiI6X2ZkX2Nsb3NlLCJTIjpfZmRfZmRzdGF0X2dldCwiVCI6X2ZkX3JlYWQsIkwiOl9mZF9zZWVrLCJEIjpfZmRfd3JpdGUsIiQiOl9nbXRpbWVfciwiYWEiOl9sb2NhbHRpbWVfciwidiI6X3B0aHJlYWRfY3JlYXRlLCJJIjpfcHRocmVhZF9qb2luLCJBIjpfc2V0VGVtcFJldDAsIlAiOl9zdHJmdGltZV9sLCJvIjpfc3lzY29uZiwiSiI6X3RpbWV9O3ZhciBhc209Y3JlYXRlV2FzbSgpO3ZhciBfX193YXNtX2NhbGxfY3RvcnM9TW9kdWxlWyJfX193YXNtX2NhbGxfY3RvcnMiXT1hc21bImNhIl07dmFyIF9tYWxsb2M9TW9kdWxlWyJfbWFsbG9jIl09YXNtWyJkYSJdO3ZhciBfX19lcnJub19sb2NhdGlvbj1Nb2R1bGVbIl9fX2Vycm5vX2xvY2F0aW9uIl09YXNtWyJmYSJdO3ZhciBfZnJlZT1Nb2R1bGVbIl9mcmVlIl09YXNtWyJnYSJdO3ZhciBfX19nZXRUeXBlTmFtZT1Nb2R1bGVbIl9fX2dldFR5cGVOYW1lIl09YXNtWyJoYSJdO3ZhciBfX19lbWJpbmRfcmVnaXN0ZXJfbmF0aXZlX2FuZF9idWlsdGluX3R5cGVzPU1vZHVsZVsiX19fZW1iaW5kX3JlZ2lzdGVyX25hdGl2ZV9hbmRfYnVpbHRpbl90eXBlcyJdPWFzbVsiaWEiXTt2YXIgX19nZXRfdHpuYW1lPU1vZHVsZVsiX19nZXRfdHpuYW1lIl09YXNtWyJqYSJdO3ZhciBfX2dldF9kYXlsaWdodD1Nb2R1bGVbIl9fZ2V0X2RheWxpZ2h0Il09YXNtWyJrYSJdO3ZhciBfX2dldF90aW1lem9uZT1Nb2R1bGVbIl9fZ2V0X3RpbWV6b25lIl09YXNtWyJsYSJdO3ZhciBkeW5DYWxsX3ZpaWppaT1Nb2R1bGVbImR5bkNhbGxfdmlpamlpIl09YXNtWyJtYSJdO3ZhciBkeW5DYWxsX2pqaj1Nb2R1bGVbImR5bkNhbGxfampqIl09YXNtWyJuYSJdO3ZhciBkeW5DYWxsX2ppamk9TW9kdWxlWyJkeW5DYWxsX2ppamkiXT1hc21bIm9hIl07dmFyIGR5bkNhbGxfaWlpaWlqPU1vZHVsZVsiZHluQ2FsbF9paWlpaWoiXT1hc21bInBhIl07dmFyIGR5bkNhbGxfaWlpaWlqaj1Nb2R1bGVbImR5bkNhbGxfaWlpaWlqaiJdPWFzbVsicWEiXTt2YXIgZHluQ2FsbF9paWlpaWlqaj1Nb2R1bGVbImR5bkNhbGxfaWlpaWlpamoiXT1hc21bInJhIl07dmFyIGNhbGxlZFJ1bjtkZXBlbmRlbmNpZXNGdWxmaWxsZWQ9ZnVuY3Rpb24gcnVuQ2FsbGVyKCl7aWYoIWNhbGxlZFJ1bilydW4oKTtpZighY2FsbGVkUnVuKWRlcGVuZGVuY2llc0Z1bGZpbGxlZD1ydW5DYWxsZXJ9O2Z1bmN0aW9uIHJ1bihhcmdzKXthcmdzPWFyZ3N8fGFyZ3VtZW50c187aWYocnVuRGVwZW5kZW5jaWVzPjApe3JldHVybn1wcmVSdW4oKTtpZihydW5EZXBlbmRlbmNpZXM+MCl7cmV0dXJufWZ1bmN0aW9uIGRvUnVuKCl7aWYoY2FsbGVkUnVuKXJldHVybjtjYWxsZWRSdW49dHJ1ZTtNb2R1bGVbImNhbGxlZFJ1biJdPXRydWU7aWYoQUJPUlQpcmV0dXJuO2luaXRSdW50aW1lKCk7cHJlTWFpbigpO3JlYWR5UHJvbWlzZVJlc29sdmUoTW9kdWxlKTtpZihNb2R1bGVbIm9uUnVudGltZUluaXRpYWxpemVkIl0pTW9kdWxlWyJvblJ1bnRpbWVJbml0aWFsaXplZCJdKCk7cG9zdFJ1bigpfWlmKE1vZHVsZVsic2V0U3RhdHVzIl0pe01vZHVsZVsic2V0U3RhdHVzIl0oIlJ1bm5pbmcuLi4iKTtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7c2V0VGltZW91dChmdW5jdGlvbigpe01vZHVsZVsic2V0U3RhdHVzIl0oIiIpfSwxKTtkb1J1bigpfSwxKX1lbHNle2RvUnVuKCl9fU1vZHVsZVsicnVuIl09cnVuO2lmKE1vZHVsZVsicHJlSW5pdCJdKXtpZih0eXBlb2YgTW9kdWxlWyJwcmVJbml0Il09PSJmdW5jdGlvbiIpTW9kdWxlWyJwcmVJbml0Il09W01vZHVsZVsicHJlSW5pdCJdXTt3aGlsZShNb2R1bGVbInByZUluaXQiXS5sZW5ndGg+MCl7TW9kdWxlWyJwcmVJbml0Il0ucG9wKCkoKX19cnVuKCk7CgoKICByZXR1cm4gTW9kdWxlCn0KKTsKfSkoKTsKLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyBjb25zdCBGUGhpX1dvcmtlcl9SdW50aW1lID0gKE1vZHVsZSk7CjsvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuLi9idWlsZC90ZW1wL2VuZ2luZXMvRlBoaS5FbmdpbmUuQ29uc3QuanMKY29uc3QgRXh0cmFjdGlvblJlc3VsdCA9IHsKICAgIE9LOiAwLAogICAgTk9UX0VWQUxVQVRFRDogMSwgICAgCiAgICBCQURfQU5HTEU6IDIsICAgIAogICAgVE9PX0ZBUjogMywgICAgCiAgICBUT09fQ0xPU0U6IDQsICAgIAogICAgT1VUX09GX0JPVU5EUzogNSwgICAgIAogICAgQkFEX0FTUEVDVF9SQVRJTzogNiwgICAgCiAgICBET0NVTUVOVF9OT1RfRk9VTkQ6IDcsICAgIAogICAgRkFDRV9OT1RfRk9VTkQ6IDgsICAgIAogICAgTVJaX05PVF9GT1VORDogOSwKICAgIEFUVFJJQlVURVNfTk9UX0ZPVU5EOiAxMCwKICAgIFVOREVSRVhQT1NFRDogMTEsIAogICAgT1ZFUkVYUE9TRUQ6IDEyLCAKICAgIEJMVVJSRUQ6IDEzLCAKICAgIElOU1VGRklDSUVOVF9TQU1QTEVTOiAxNCwgCiAgICBJTlNVRkZJQ0lFTlRfVElNRTogMTUsCiAgICBUT09fREVMQVlFRDogMTYsIAogICAgVE9PX01PVkVNRU5UOiAxNywgCiAgICBGUkVFWkVEX0RPQ1VNRU5UOiAxOCwgCiAgICBUT09fTVVDSF9ST0xMOiAxOSwgCiAgICBUT09fU01BTEw6IDIwIAp9Cgpjb25zdCBFeHRyYWN0aW9uUmVzdWx0U3RyID0gewogICAgMDogIk9LIiwKICAgIDE6ICJOT1RfRVZBTFVBVEVEIiwgICAgCiAgICAyOiAiQkFEX0FOR0xFIiwgICAgCiAgICAzOiAiVE9PX0ZBUiIsICAgIAogICAgNDogIlRPT19DTE9TRSIsICAgIAogICAgNTogIk9VVF9PRl9CT1VORFMiLCAgICAgCiAgICA2OiAiQkFEX0FTUEVDVF9SQVRJTyIsICAgIAogICAgNzogIkRPQ1VNRU5UX05PVF9GT1VORCIsICAgIAogICAgODogIkZBQ0VfTk9UX0ZPVU5EIiwgICAgCiAgICA5OiAiTVJaX05PVF9GT1VORCIsCiAgICAxMDogIkFUVFJJQlVURVNfTk9UX0ZPVU5EIiwKICAgIDExOiAiVU5ERVJFWFBPU0VEIiwgCiAgICAxMjogIk9WRVJFWFBPU0VEIiwgCiAgICAxMzogIkJMVVJSRUQiLCAKICAgIDE0OiAiSU5TVUZGSUNJRU5UX1NBTVBMRVMiLCAKICAgIDE1OiAiSU5TVUZGSUNJRU5UX1RJTUUiLAogICAgMTY6ICJUT09fREVMQVlFRCIsIAogICAgMTc6ICJUT09fTU9WRU1FTlQiLCAKICAgIDE4OiAiRlJFRVpFRF9ET0NVTUVOVCIsIAogICAgMTk6ICJUT09fTVVDSF9ST0xMIiwgCiAgICAyMDogIlRPT19TTUFMTCIgCn0KOy8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4uL2J1aWxkL3RlbXAvZW5naW5lcy9mYWNlcGhpL3dvcmtlci9GUGhpLldvcmtlci5FdmVudHMuanMKCgoKCgovKioKICogR2xvYmFsIGluc3RhbmNlcwogKi8KdmFyIGluc3RhbmNlID0gbnVsbDsKdmFyIG9jckVuZ2luZSA9IG51bGw7CnZhciBmYWNlTXJ6RW5naW5lID0gbnVsbDsKdmFyIGRvY3VtZW50RW5naW5lID0gbnVsbDsKdmFyIGRvY3VtZW50Q2FwdHVyZSA9IG51bGw7CgovKioKICogRXh0cmFjdG9yIE1vZGVscwogKi8KdmFyIGRvY3VtZW50TW9kZWwgPSBudWxsOwp2YXIgZmFjZU1vZGVsID0gbnVsbDsKdmFyIG1yek1vZGVsID0gbnVsbDsKdmFyIG9jck1vZGVsID0gbnVsbDsKCi8qKgogKiBXb3JrZXIgY29uZmlndXJhdGlvbgogKi8KdmFyIGJ1bmRsZVBhdGggPSAiIjsKdmFyIGxhc3REZXRlY3RUaW1lc3RhbXAgPSAtMTsKCi8qKgogKiBFdmVudCB0byBpbml0aWFsaXplIGFsbCByZXF1aXJlZCBjb21wb25lbnRzIGZvciB0aGUgZXh0cmFjdGlvbi4KICoKICogQHBhcmFtIHthcnJheX0gbWVzc2FnZQogKi8KY29uc3QgcHJlbG9hZEluaXRFeHRyYWN0b3IgPSBhc3luYyAobWVzc2FnZSkgPT4gewogICAgZGVidWdNZXNzYWdlKCJbV29ya2VyXTogUmVjZWl2ZWQgbWVzc2FnZSBpbiAiICsgInByZUluaXQiICsgIiBldmVudCIpOwoKICAgIC8vIFByb2Nlc3MgaW5wdXQgdmFyaWFibGVzCiAgICBidW5kbGVQYXRoID0gbWVzc2FnZS5idW5kbGVQYXRoOwoKICAgIHRyeSB7CiAgICAgICAgbGV0IHdhc21pbnN0YW5jZSA9IG51bGw7CiAgICAgICAgbGV0IGRvd25sb2FkQnVmZiA9IG51bGw7CgogICAgICAgIC8vIEFzeW5jIGZldGNoZXMgYmVmb3JlIGdldCB0aGUgbW9kZWxzIGluc3RhbmNlCiAgICAgICAgZG93bmxvYWRCdWZmID0gYXdhaXQgZmV0Y2goYnVuZGxlUGF0aCArICcvbW9kZWxzL2ZhY2VwaGlfaWRfY2FyZHNfY29ybmVyX2RldGVjdG9yXzFfMl9tb2RlbC5kYXQnKTsKICAgICAgICBkb2N1bWVudE1vZGVsID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGF3YWl0IGRvd25sb2FkQnVmZi5hcnJheUJ1ZmZlcigpKTsKCiAgICAgICAgZG93bmxvYWRCdWZmID0gYXdhaXQgZmV0Y2goYnVuZGxlUGF0aCArICcvbW9kZWxzL2ZhY2VwaGlfZmFjZV9kZXRlY3Rvcl8xXzBfbW9kZWwuZGF0Jyk7CiAgICAgICAgZmFjZU1vZGVsID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGF3YWl0IGRvd25sb2FkQnVmZi5hcnJheUJ1ZmZlcigpKTsKCiAgICAgICAgZG93bmxvYWRCdWZmID0gYXdhaXQgZmV0Y2goYnVuZGxlUGF0aCArICcvbW9kZWxzL2ZhY2VwaGlfbXJ6X2RldGVjdG9yXzFfMF9tb2RlbC5kYXQnKTsKICAgICAgICBtcnpNb2RlbCA9IG5ldyBVaW50OENsYW1wZWRBcnJheShhd2FpdCBkb3dubG9hZEJ1ZmYuYXJyYXlCdWZmZXIoKSk7CgogICAgICAgIGRvd25sb2FkQnVmZiA9IGF3YWl0IGZldGNoKGJ1bmRsZVBhdGggKyAnL21vZGVscy9mYWNlcGhpX29jcl9tcnpfMV8wX21vZGVsLmRhdCcpOwogICAgICAgIG9jck1vZGVsID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGF3YWl0IGRvd25sb2FkQnVmZi5hcnJheUJ1ZmZlcigpKTsKCiAgICAgICAgLy8gQXN5bmMgZmV0Y2ggYmVmb3JlIGdldCB0aGUgaW5zdGFuY2UKICAgICAgICBkb3dubG9hZEJ1ZmYgPSBhd2FpdCBmZXRjaChidW5kbGVQYXRoICsgIi9GUEJSZWNvZ25pdGlvbi53YXNtIik7CiAgICAgICAgd2FzbWluc3RhbmNlID0gYXdhaXQgZG93bmxvYWRCdWZmLmFycmF5QnVmZmVyKCk7CgogICAgICAgIC8vIEluaXRpYWxpemUgdGhlIGluc3RhbmNlIGluIGdsb2JhbHMgaW5zdGFuY2UKICAgICAgICBpbnN0YW5jZSA9IGF3YWl0IEZQaGlfV29ya2VyX1J1bnRpbWUoewogICAgICAgICAgICB3YXNtQmluYXJ5IDogd2FzbWluc3RhbmNlLAogICAgICAgICAgICBvblJ1bnRpbWVJbml0aWFsaXplZCA6ICgpID0+IHNlbGYucG9zdE1lc3NhZ2UoeyBjbWQ6ICJyZWFkeSIgfSkKICAgICAgICB9KQoKICAgICAgICAvLyBSZXBvcnQgdGhlIHN1Y2Nlc3NmdWwgbG9hZCBvZiBpbnN0YW5jZSB0byBkZWJ1ZyBtZXNzYWdlCiAgICAgICAgZGVidWdNZXNzYWdlKCJbV29ya2VyXTogUHJlbG9hZGluZyB3YXNtIGluc3RhbmNlIGZyb20gcGF0aDogIiArIGJ1bmRsZVBhdGggKyAiL0ZQQlJlY29nbml0aW9uLndhc20iKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAvLyBDcml0aWNhbCBlcnJvciBoYXMgb2NjdXJyZWQgaW4gdGhlIFdvcmtlciBTaWRlLCBzZW5kaW5nIHRvIG1haW4gdGhyZWFkCiAgICAgICAgZXJyb3JNZXNzYWdlKCJbV29ya2VyXTogIiArIGUpOwogICAgfQp9CgovKioKICogRXZlbnQgdG8gaW5pdGlhbGl6ZSBhbGwgcmVxdWlyZWQgZW5naW5lcyBmb3IgdGhlIGV4dHJhY3Rpb24uCiAqLwpjb25zdCBpbml0aWFsaXplRXh0cmFjdG9yID0gYXN5bmMgKCkgPT4gewogICAgLy8gUHJlcGFyZSB0aGUgZGlhZ25vc3RpY0NvZGUgaW5zdGFuY2UKICAgIGxldCBkaWFnbm9zdGljQ29kZSA9IC0xOwoKICAgIC8vIFJlY292ZXIgdGhlIHJlZmVyZW5jZSB0byBlcnJvciBjb2RlIGZ1bmN0aW9ucwogICAgY29uc3QgZXJyb3JDb2RlID0gaW5zdGFuY2UuZ2V0TWVzc2FnZUVycm9yQ29kZURvY3VtZW50OwoKICAgIHRyeSB7CiAgICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgZW5naW5lcwogICAgICAgIG9jckVuZ2luZSA9IG5ldyBpbnN0YW5jZS5SZWNvZ25pemVyT0NSRW5naW5lKCk7CiAgICAgICAgZG9jdW1lbnRDYXB0dXJlID0gbmV3IGluc3RhbmNlLkRvY3VtZW50Q2FwdHVyZUVuZ2luZSgpOwogICAgICAgIGZhY2VNcnpFbmdpbmUgPSBuZXcgaW5zdGFuY2UuUmVjb2duaXplckZhY2VNcnpFbmdpbmUoKTsKCiAgICAgICAgLy8gQ2hlY2sgaWYgaXMgbG9hYmxlIHRoZSBtb2RlbHMgYW5kIGxvYWQgaXQKICAgICAgICBpZigoZGlhZ25vc3RpY0NvZGUgPSBlcnJvckNvZGUoZG9jdW1lbnRDYXB0dXJlLmxvYWREb2N1bWVudERhdGFGcm9tQnVmZmVyKGRvY3VtZW50TW9kZWwpKSkgIT09ICJPSyIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFcnJvciBsb2FkaW5nIHRoZSBtb2RlbCAnRG9jdW1lbnRDYXB0dXJlJywgIiwgZGlhZ25vc3RpY0NvZGUpOwogICAgICAgIH0gZWxzZSBpZigoZGlhZ25vc3RpY0NvZGUgPSBlcnJvckNvZGUoZmFjZU1yekVuZ2luZS5sb2FkTXJ6RGF0YUZyb21CdWZmZXIobXJ6TW9kZWwpKSkgIT09ICJPSyIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFcnJvciBsb2FkaW5nIHRoZSBtb2RlbCAnTXJ6TW9kZWwnLCAiLCBkaWFnbm9zdGljQ29kZSk7CiAgICAgICAgfSBlbHNlIGlmKChkaWFnbm9zdGljQ29kZSA9IGVycm9yQ29kZShmYWNlTXJ6RW5naW5lLmxvYWRGYWNlRGF0YUZyb21CdWZmZXIoZmFjZU1vZGVsKSkpICE9PSAiT0siKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRXJyb3IgbG9hZGluZyB0aGUgbW9kZWwgJ0ZhY2VNb2RlbCcsICIsIGRpYWdub3N0aWNDb2RlKTsKICAgICAgICB9IGVsc2UgaWYoKGRpYWdub3N0aWNDb2RlID0gZXJyb3JDb2RlKG9jckVuZ2luZS5sb2FkT2NyRGF0YUZyb21CdWZmZXIob2NyTW9kZWwpKSkgIT09ICJPSyIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFcnJvciBsb2FkaW5nIHRoZSBtb2RlbCAnT2NyTW9kZWwnLCAiLCBkaWFnbm9zdGljQ29kZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gTG9hZCB0aGUgcmVzdCBvZiB1c2VkIG1vZGVscyBvZiBmYWNlIGVuZ2luZS4KICAgICAgICAgICAgZmFjZU1yekVuZ2luZS5sb2FkRG9jdW1lbnREYXRhRnJvbUJ1ZmZlcihkb2N1bWVudE1vZGVsKTsKCiAgICAgICAgICAgIC8vIExvYWQgdGhlIHJlc3Qgb2YgdXNlZCBtb2RlbHMgb2Ygb2NyIGVuZ2luZS4KICAgICAgICAgICAgb2NyRW5naW5lLmxvYWREb2N1bWVudERhdGFGcm9tQnVmZmVyKGRvY3VtZW50TW9kZWwpOwogICAgICAgICAgICBvY3JFbmdpbmUubG9hZE1yekRhdGFGcm9tQnVmZmVyKG1yek1vZGVsKTsKCiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyBjbWQ6ICJpbml0IiB9KTsKICAgICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgLy8gQ3JpdGljYWwgZXJyb3IgaGFzIG9jY3VycmVkIGluIHRoZSBXb3JrZXIgU2lkZSwgc2VuZGluZyB0byBtYWluIHRocmVhZAogICAgICAgIGVycm9yTWVzc2FnZSgiW1dvcmtlcl06ICIgKyBlKTsKICAgIH0KfQoKLyoqCiAqIEV2ZW50IHRvIGRldGVjdCB0aGUgZG9jdW1lbnQgYW5kIGV4dHJhY3QgZGF0YQogKgogKiBAcGFyYW0ge2FycmF5fSBtZXNzYWdlCiAqLwpjb25zdCBkZXRlY3QgPSBhc3luYyAobWVzc2FnZSkgPT4gewogICAgbGV0IHBvc3REYXRhID0geyBjbWQ6ICJkZXRlY3QiLCByZXN1bHQ6IHt9IH07CgogICAgLy8gTWVhc3VyZSB0aGUgdGltZSBiZXR3ZWVuIGRldGVjdGlvbnMKICAgIHBvc3REYXRhLm1wcyA9IE1hdGgucm91bmQoKDEgLyBkaWZmVGltZShsYXN0RGV0ZWN0VGltZXN0YW1wKSkgKiAxMDApIC8gMTAwOwoKICAgIC8vIFJlZnJlc2ggdGhlIHRpbWVzdGFtcAogICAgbGFzdERldGVjdFRpbWVzdGFtcCA9IERhdGUubm93KCk7CgogICAgbGV0IGVycm9yVGlsdCA9IDE7CgogICAgbGV0IGltYWdlUGFyYW0gPSBtZXNzYWdlLmltYWdlOwogICAgbGV0IGltYWdlRGF0YVBhcmFtID0gbmV3IEltYWdlRGF0YShtZXNzYWdlLmltYWdlLCBtZXNzYWdlLndpZHRoLCBtZXNzYWdlLmhlaWdodCk7CiAgICBsZXQgYWNjZXNzaWJpbGl0eVBhcmFtID0gbWVzc2FnZS5hY2Nlc3NpYmlsaXR5OwogICAgbGV0IHRlc3RpbmdUaW1lc3RhbXAgPSBtZXNzYWdlLnRpbWVzdGFtcCB8fCAtMTsKCiAgICBsZXQgcmVzdWx0T2NyID0gbnVsbDsKICAgIGxldCByZXN1bHRGYWNlTXJ6ID0gbnVsbDsKICAgIGxldCByZXN1bHREb2N1bWVudCA9IG51bGw7CiAgICBsZXQgc2l6ZU9iaiA9IG51bGw7CiAgICBsZXQgaW1hZ2VPYmogPSBudWxsOwogICAgbGV0IG9wdGlvbnMgPSBudWxsOwoKICAgIGxldCBmYWNlSW1hZ2UgPSBudWxsOwogICAgbGV0IGRvY3VtZW50SW1hZ2UgPSBudWxsOwoKICAgIHRyeSB7CiAgICAgICAgc2l6ZU9iaiA9IG5ldyBpbnN0YW5jZS5TaXplKG1lc3NhZ2Uud2lkdGgsIG1lc3NhZ2UuaGVpZ2h0KTsKICAgICAgICBpbWFnZU9iaiA9IG5ldyBpbnN0YW5jZS5JbWFnZShpbWFnZVBhcmFtLCBzaXplT2JqLCBpbnN0YW5jZS5PcmllbnRhdGlvbi5GQUNFX1VQLCBpbnN0YW5jZS5JbWFnZUZvcm1hdC5SR0JBKTsKICAgICAgICBvcHRpb25zID0gbmV3IGluc3RhbmNlLlJlY29nbml6ZXJPcHRpb25zKCk7CiAgICAgICAgc2l6ZU9iai5kZWxldGUoKTsKCiAgICAgICAgaWYgKHRlc3RpbmdUaW1lc3RhbXAgPiAwKSB7CiAgICAgICAgICAgIGltYWdlT2JqLnNldFRpbWVzdGFtcCh0ZXN0aW5nVGltZXN0YW1wLnRvU3RyaW5nKCkpOwogICAgICAgIH0KCiAgICAgICAgcmVzdWx0RG9jdW1lbnQgPSBkb2N1bWVudENhcHR1cmUucmVjb2duaXplRnJvbUltYWdlKGltYWdlT2JqKQoKICAgICAgICBpZihyZXN1bHREb2N1bWVudC5kaXFhUmVzdWx0ICE9PSB1bmRlZmluZWQgJiYgcmVzdWx0RG9jdW1lbnQuZGlxYVJlc3VsdC5kaWFnbm9zdGljLnZhbHVlICE9PSAxKXsKICAgICAgICAgICAgcG9zdERhdGEucmVzdWx0WyJkaXFhUmVzdWx0Il0gPSB7CiAgICAgICAgICAgICAgICBibHVyIDogcmVzdWx0RG9jdW1lbnQuZGlxYVJlc3VsdC5ibHVyLAogICAgICAgICAgICAgICAgZXhwb3N1cmUgOiByZXN1bHREb2N1bWVudC5kaXFhUmVzdWx0LmV4cG9zdXJlLAogICAgICAgICAgICAgICAgZXhwb3N1cmVNZWRpYW4gOiByZXN1bHREb2N1bWVudC5kaXFhUmVzdWx0LmV4cG9zdXJlTWVkaWFuLAogICAgICAgICAgICAgICAgZGlhZ25vc3RpYyA6IHJlc3VsdERvY3VtZW50LmRpcWFSZXN1bHQuZGlhZ25vc3RpYy52YWx1ZQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZihyZXN1bHREb2N1bWVudC5zaGFwZUZpbHRlckRpYWdub3N0aWMgIT09IHVuZGVmaW5lZCAmJiByZXN1bHREb2N1bWVudC5zaGFwZUZpbHRlckRpYWdub3N0aWMudmFsdWUgIT09IDEpewogICAgICAgICAgICBwb3N0RGF0YS5yZXN1bHRbInNoYXBlRmlsdGVyRGlhZ25vc3RpYyJdID0gewogICAgICAgICAgICAgICAgZGlhZ25vc3RpYyA6IHJlc3VsdERvY3VtZW50LnNoYXBlRmlsdGVyRGlhZ25vc3RpYy52YWx1ZQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocmVzdWx0RG9jdW1lbnQuZXJyb3IgPT09IGluc3RhbmNlLkRvY3VtZW50RXJyb3JDb2RlLk9LICYmIHJlc3VsdERvY3VtZW50LmRpYWdub3N0aWMgPT09IGluc3RhbmNlLkRvY3VtZW50RGlhZ25vc3RpYy5PSyApewogICAgICAgICAgICAvLyBQcmVwYXJlIGV4dHJhY3Rpb24gb3B0aW9ucwogICAgICAgICAgICBvcHRpb25zLmdlbmVyYXRlSW1hZ2UgPSB0cnVlOwoKICAgICAgICAgICAgLy8gU2V0IHRoZSBkb2N1bWVudExvY2F0aW9uIG9iamVjdAogICAgICAgICAgICBwb3N0RGF0YS5yZXN1bHRbImRvY3VtZW50TG9jYXRpb24iXSA9IHsKICAgICAgICAgICAgICAgIHRvcFJpZ2h0OiB7CiAgICAgICAgICAgICAgICAgICAgeDogcmVzdWx0RG9jdW1lbnQuZG9jdW1lbnRMb2NhdGlvbi50b3BSaWdodC54LAogICAgICAgICAgICAgICAgICAgIHk6IHJlc3VsdERvY3VtZW50LmRvY3VtZW50TG9jYXRpb24udG9wUmlnaHQueQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHRvcExlZnQ6IHsKICAgICAgICAgICAgICAgICAgICB4OiByZXN1bHREb2N1bWVudC5kb2N1bWVudExvY2F0aW9uLnRvcExlZnQueCwKICAgICAgICAgICAgICAgICAgICB5OiByZXN1bHREb2N1bWVudC5kb2N1bWVudExvY2F0aW9uLnRvcExlZnQueQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGJvdHRvbVJpZ2h0OiB7CiAgICAgICAgICAgICAgICAgICAgeDogcmVzdWx0RG9jdW1lbnQuZG9jdW1lbnRMb2NhdGlvbi5ib3R0b21SaWdodC54LAogICAgICAgICAgICAgICAgICAgIHk6IHJlc3VsdERvY3VtZW50LmRvY3VtZW50TG9jYXRpb24uYm90dG9tUmlnaHQueQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGJvdHRvbUxlZnQ6IHsKICAgICAgICAgICAgICAgICAgICB4OiByZXN1bHREb2N1bWVudC5kb2N1bWVudExvY2F0aW9uLmJvdHRvbUxlZnQueCwKICAgICAgICAgICAgICAgICAgICB5OiByZXN1bHREb2N1bWVudC5kb2N1bWVudExvY2F0aW9uLmJvdHRvbUxlZnQueQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgYmVzdEltYWdlID0gcmVzdWx0RG9jdW1lbnQuYmVzdEltYWdlOwoKICAgICAgICAgICAgLy8gUHJvY2VzcyBkb2N1bWVudCBleHRyYWN0aW9uCiAgICAgICAgICAgIGRvY3VtZW50SW1hZ2UgPSBpbnN0YW5jZS5jcm9wSW1hZ2VXaXRoTG9jYXRpb24oYmVzdEltYWdlLCByZXN1bHREb2N1bWVudC5kb2N1bWVudExvY2F0aW9uKTsKCiAgICAgICAgICAgIC8vUmVzZXQgRG9jdW1lbnRDYXB0dXJlRW5naW5lCiAgICAgICAgICAgIGRvY3VtZW50Q2FwdHVyZS5yZXNldCgpOwoKICAgICAgICAgICAgLy8gU2V0IHRoZSBkb2N1bWVudEltYWdlIG9iamVjdAogICAgICAgICAgICBwb3N0RGF0YS5yZXN1bHRbImRvY3VtZW50SW1hZ2UiXSA9IHsKICAgICAgICAgICAgICAgIGJ1ZmZlcjogbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGRvY3VtZW50SW1hZ2UuaW1hZ2VUb1JnYmEoKSksCiAgICAgICAgICAgICAgICB3aWR0aDogZG9jdW1lbnRJbWFnZS53aWR0aCgpLAogICAgICAgICAgICAgICAgaGVpZ2h0OiBkb2N1bWVudEltYWdlLmhlaWdodCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGRvY3VtZW50SW1hZ2UuZGVsZXRlKCk7CgogICAgICAgICAgICAvLyBHZXQgZGF0YSBmcm9tIEZhY2VNcnpFbmdpbmUKICAgICAgICAgICAgcmVzdWx0RmFjZU1yeiA9IGZhY2VNcnpFbmdpbmUucmVjb2duaXplRnJvbUltYWdlKGJlc3RJbWFnZSwgb3B0aW9ucyk7CgogICAgICAgICAgICBwb3N0RGF0YS5yZXN1bHRbImZhY2VEZXRlY3QiXSA9IHJlc3VsdEZhY2VNcnouZmFjZUxvY2F0aW9uLmlzVmFsaWQoKTsKICAgICAgICAgICAgcG9zdERhdGEucmVzdWx0WyJtcnpEZXRlY3QiXSA9IHJlc3VsdEZhY2VNcnoubXJ6TG9jYXRpb24uaXNWYWxpZCgpOwoKICAgICAgICAgICAgLy8gUHJvY2VzcyBGYWNlIExvY2F0aW9uCiAgICAgICAgICAgIGlmIChyZXN1bHRGYWNlTXJ6LmZhY2VMb2NhdGlvbi5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgZmFjZUxvY2F0aW9uIG9iamVjdAogICAgICAgICAgICAgICAgcG9zdERhdGEucmVzdWx0WyJmYWNlTG9jYXRpb24iXSA9IHsKICAgICAgICAgICAgICAgICAgICB0b3BSaWdodDogewogICAgICAgICAgICAgICAgICAgICAgICB4OiByZXN1bHRGYWNlTXJ6LmZhY2VMb2NhdGlvbi50b3BSaWdodC54LAogICAgICAgICAgICAgICAgICAgICAgICB5OiByZXN1bHRGYWNlTXJ6LmZhY2VMb2NhdGlvbi50b3BSaWdodC55CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB0b3BMZWZ0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHJlc3VsdEZhY2VNcnouZmFjZUxvY2F0aW9uLnRvcExlZnQueCwKICAgICAgICAgICAgICAgICAgICAgICAgeTogcmVzdWx0RmFjZU1yei5mYWNlTG9jYXRpb24udG9wTGVmdC55CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBib3R0b21SaWdodDogewogICAgICAgICAgICAgICAgICAgICAgICB4OiByZXN1bHRGYWNlTXJ6LmZhY2VMb2NhdGlvbi5ib3R0b21SaWdodC54LAogICAgICAgICAgICAgICAgICAgICAgICB5OiByZXN1bHRGYWNlTXJ6LmZhY2VMb2NhdGlvbi5ib3R0b21SaWdodC55CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBib3R0b21MZWZ0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHJlc3VsdEZhY2VNcnouZmFjZUxvY2F0aW9uLmJvdHRvbUxlZnQueCwKICAgICAgICAgICAgICAgICAgICAgICAgeTogcmVzdWx0RmFjZU1yei5mYWNlTG9jYXRpb24uYm90dG9tTGVmdC55CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGRvY3VtZW50IGV4dHJhY3Rpb24KICAgICAgICAgICAgICAgIGZhY2VJbWFnZSA9IGluc3RhbmNlLmNyb3BJbWFnZVdpdGhMb2NhdGlvbihiZXN0SW1hZ2UsIHJlc3VsdEZhY2VNcnouZmFjZUxvY2F0aW9uKTsKCiAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGZhY2VJbWFnZSBvYmplY3QKICAgICAgICAgICAgICAgIHBvc3REYXRhLnJlc3VsdFsiZmFjZUltYWdlIl0gPSB7CiAgICAgICAgICAgICAgICAgICAgYnVmZmVyOiBuZXcgVWludDhDbGFtcGVkQXJyYXkoZmFjZUltYWdlLmltYWdlVG9SZ2JhKCkpLAogICAgICAgICAgICAgICAgICAgIHdpZHRoOiBmYWNlSW1hZ2Uud2lkdGgoKSwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGZhY2VJbWFnZS5oZWlnaHQoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmYWNlSW1hZ2UuZGVsZXRlKCk7CgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcG9zdERhdGFbImRpYWdub3N0aWMiXSA9IEV4dHJhY3Rpb25SZXN1bHQuRkFDRV9OT1RfRk9VTkQ7CiAgICAgICAgICAgICAgICBwb3N0RGF0YS5yZXN1bHRbImRpYWdub3N0aWMiXSA9IEV4dHJhY3Rpb25SZXN1bHQuRkFDRV9OT1RfRk9VTkQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChyZXN1bHRGYWNlTXJ6Lm1yekxvY2F0aW9uLmlzVmFsaWQoKSkgewogICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBtcnpMb2NhdGlvbiBvYmplY3QKICAgICAgICAgICAgICAgIHBvc3REYXRhLnJlc3VsdFsibXJ6TG9jYXRpb24iXSA9IHsKICAgICAgICAgICAgICAgICAgICB0b3BSaWdodDogewogICAgICAgICAgICAgICAgICAgICAgICB4OiByZXN1bHRGYWNlTXJ6Lm1yekxvY2F0aW9uLnRvcFJpZ2h0LngsCiAgICAgICAgICAgICAgICAgICAgICAgIHk6IHJlc3VsdEZhY2VNcnoubXJ6TG9jYXRpb24udG9wUmlnaHQueQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgdG9wTGVmdDogewogICAgICAgICAgICAgICAgICAgICAgICB4OiByZXN1bHRGYWNlTXJ6Lm1yekxvY2F0aW9uLnRvcExlZnQueCwKICAgICAgICAgICAgICAgICAgICAgICAgeTogcmVzdWx0RmFjZU1yei5tcnpMb2NhdGlvbi50b3BMZWZ0LnkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGJvdHRvbVJpZ2h0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHJlc3VsdEZhY2VNcnoubXJ6TG9jYXRpb24uYm90dG9tUmlnaHQueCwKICAgICAgICAgICAgICAgICAgICAgICAgeTogcmVzdWx0RmFjZU1yei5tcnpMb2NhdGlvbi5ib3R0b21SaWdodC55CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBib3R0b21MZWZ0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHJlc3VsdEZhY2VNcnoubXJ6TG9jYXRpb24uYm90dG9tTGVmdC54LAogICAgICAgICAgICAgICAgICAgICAgICB5OiByZXN1bHRGYWNlTXJ6Lm1yekxvY2F0aW9uLmJvdHRvbUxlZnQueQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIE9DUiBEYXRhCiAgICAgICAgICAgICAgICByZXN1bHRPY3IgPSBvY3JFbmdpbmUucmVjb2duaXplRnJvbUltYWdlKGJlc3RJbWFnZSwgb3B0aW9ucyk7CgogICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBPQ1IgUmVzdWx0cwogICAgICAgICAgICAgICAgaWYgKHJlc3VsdE9jci5vY3JSZXN1bHQgIT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgcG9zdERhdGEucmVzdWx0Lm9jclJlc3VsdCA9IHJlc3VsdE9jci5vY3JSZXN1bHQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gRGVsZXRlIHJlc3VsdCBvZiBNUloKICAgICAgICAgICAgICAgIHJlc3VsdE9jci5kZWxldGUoKTsKICAgICAgICAgICAgICAgIGJlc3RJbWFnZS5kZWxldGUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoIXJlc3VsdEZhY2VNcnoubXJ6TG9jYXRpb24uaXNWYWxpZCgpICYmICFyZXN1bHRGYWNlTXJ6LmZhY2VMb2NhdGlvbi5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgIHBvc3REYXRhWyJkaWFnbm9zdGljIl0gPSBFeHRyYWN0aW9uUmVzdWx0LkFUVFJJQlVURVNfTk9UX0ZPVU5EOwogICAgICAgICAgICAgICAgcG9zdERhdGEucmVzdWx0WyJkaWFnbm9zdGljIl0gPSBFeHRyYWN0aW9uUmVzdWx0LkFUVFJJQlVURVNfTk9UX0ZPVU5EOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcG9zdERhdGFbImRpYWdub3N0aWMiXSA9IHJlc3VsdERvY3VtZW50LmRpYWdub3N0aWMudmFsdWU7CiAgICAgICAgICAgICAgICBwb3N0RGF0YS5yZXN1bHRbImRpYWdub3N0aWMiXSA9IHJlc3VsdERvY3VtZW50LmRpYWdub3N0aWMudmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENsZWFuIHJlc3VsdCBkb2N1bWVudAogICAgICAgICAgICByZXN1bHREb2N1bWVudC5kZWxldGUoKTsKCiAgICAgICAgICAgIC8vIERlbGV0ZSB0aGUgZmFjZSByZXN1bHQgZXh0cmFjdGlvbgogICAgICAgICAgICByZXN1bHRGYWNlTXJ6LmRlbGV0ZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9fY2xlYW5BY2Nlc3NpYmlsaXR5RXJyb3JzKHBvc3REYXRhLCByZXN1bHREb2N1bWVudCwgYWNjZXNzaWJpbGl0eVBhcmFtKTsKICAgICAgICB9CgogICAgICAgIC8vIENsZWFudXAgV2ViQXNzZW1ibHkgT2JqZWN0cwogICAgICAgIGRlbGV0ZVdhc21WYXIoCiAgICAgICAgICAgIG9wdGlvbnMsCiAgICAgICAgICAgIHNpemVPYmosCiAgICAgICAgICAgIGltYWdlT2JqCiAgICAgICAgKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAvLyBDbGVhbnVwIHRoZSByZXN1bHQgZm9yIGF2b2lkIHBhcnRpYWwgZGV0ZWN0aW9uIHJlc3VsdHMKICAgICAgICBwb3N0RGF0YS5yZXN1bHQgPSB7fTsKCiAgICAgICAgLy8gU2V0IHRoZSBlcnJvciBjb2RlIGZvciBjYXRjaAogICAgICAgIF9fY2xlYW5BY2Nlc3NpYmlsaXR5RXJyb3JzKHBvc3REYXRhLCB7IGRpYWdub3N0aWM6IHsgdmFsdWU6IGVycm9yVGlsdCB9IH0sIGFjY2Vzc2liaWxpdHlQYXJhbSk7CgogICAgICAgIC8vIFNlbmQgbG9ncyBpbnRvIHdlYiBjb25zb2xlCiAgICAgICAgZXJyb3JNZXNzYWdlKCJbV29ya2VyXTogIiArIGUpOwoKICAgICAgICAvLyBDbGVhbnVwIFdlYkFzc2VtYmx5IE9iamVjdHMKICAgICAgICBkZWxldGVXYXNtVmFyKAogICAgICAgICAgICBmYWNlSW1hZ2UsCiAgICAgICAgICAgIGRvY3VtZW50SW1hZ2UsCiAgICAgICAgICAgIHJlc3VsdE9jciwKICAgICAgICAgICAgcmVzdWx0RmFjZU1yeiwKICAgICAgICAgICAgcmVzdWx0RG9jdW1lbnQsCiAgICAgICAgICAgIG9wdGlvbnMsCiAgICAgICAgICAgIHNpemVPYmosCiAgICAgICAgICAgIGltYWdlT2JqCiAgICAgICAgKTsKICAgIH0KCiAgICAvLyBTZW5kIGluZm9ybWF0aW9uIHRvIG1haW4gdGhyZWFkCiAgICBzZWxmLnBvc3RNZXNzYWdlKHBvc3REYXRhKTsKfQoKLyoqCiAqIEdldCB0aGUgZXh0cmFjdG9yIHZlcnNpb24gZnJvbSBXZWJBc3NlbWJseSBzaWRlLgogKi8KY29uc3QgdmVyc2lvbiA9IGFzeW5jICgpID0+IHsKICAgIGxldCByZXR1cm5Kc29uID0geyBjbWQgOiAidmVyc2lvbiIgfTsKCiAgICByZXR1cm5Kc29uWyJ2ZXJzaW9uIl0gPSBpbnN0YW5jZS5nZXRWZXJzaW9uKCk7CgogICAgc2VsZi5wb3N0TWVzc2FnZShyZXR1cm5Kc29uKTsKfQoKLyoqCiAqIERlc3Ryb3kgY3JlYXRlZCBvYmplY3RzIGluIFdlYkFzc2VtYmx5IHNpZGUKICovCiBjb25zdCBkZXN0cm95ID0gYXN5bmMgKCkgPT4gewogICAgLy8gRGVzdHJveSBXZWJBc3NlbWJseSBHbG9iYWxzCiAgICBkZWxldGVXYXNtVmFyKAogICAgICAgIGluc3RhbmNlLAogICAgICAgIG9jckVuZ2luZSwKICAgICAgICBmYWNlTXJ6RW5naW5lLAogICAgICAgIGRvY3VtZW50RW5naW5lLAogICAgICAgIGRvY3VtZW50Q2FwdHVyZQogICAgKTsKCiAgICAvLyBDbG9zZSBXb3JrZXIgVGhyZWFkCiAgICBjbG9zZSgpOwp9OwoKLyoqCiAqIFJlc2V0IGJ1ZmZlcnMgb24gZGVtYW5kCiAqLwpjb25zdCByZXNldEJ1ZmZlcnMgPSBhc3luYyAoKSA9PiB7CiAgICBsZXQgcmV0dXJuSnNvbiA9IHsgY21kOiAicmVzZXRCdWZmZXJzIiB9OwoKICAgIGRvY3VtZW50Q2FwdHVyZS5yZXNldCgpOwoKICAgIHNlbGYucG9zdE1lc3NhZ2UocmV0dXJuSnNvbik7Cn0KCi8qKgogKiBNZXRob2QgdG8gY2xlYW4gdGhlIGFjY2Vzc2liaWxpdHkgZGF0YSBpZiBpcyBuZWVkZWQKICoKICogQHBhcmFtIHthcnJheX0gcG9zdERhdGEgVGhlIG9iamVjdCB3aXRoIGRhdGEgYmVmb3JlIHNlbnQgaXQKICogQHBhcmFtIHthcnJheX0gcmVzdWx0RGV0ZWN0IFJhdyBkZXRlY3Rpb24gZGF0YQogKiBAcGFyYW0ge2Jvb2xlYW59IGFjY2Vzc2liaWxpdHlQYXJhbSBUaGUgYWNjZXNzaWJpbGl0eSBwYXJhbSBlbmFibGVkCiAqLwpjb25zdCBfX2NsZWFuQWNjZXNzaWJpbGl0eUVycm9ycyA9IChwb3N0RGF0YSwgcmVzdWx0RGV0ZWN0LCBhY2Nlc3NpYmlsaXR5UGFyYW0pID0+IHsKICAgIGlmIChhY2Nlc3NpYmlsaXR5UGFyYW0gIT09IHRydWUpIHsKICAgICAgICBwb3N0RGF0YS5kaWFnbm9zdGljID0gcmVzdWx0RGV0ZWN0LmRpYWdub3N0aWMudmFsdWU7CiAgICB9IGVsc2UgewogICAgICAgIHBvc3REYXRhLmRpYWdub3N0aWMgPSAwOwogICAgfQp9CgoKCjsvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuLi9idWlsZC90ZW1wL2VuZ2luZXMvZmFjZXBoaS93b3JrZXIvRlBoaS5Xb3JrZXIuTWFpbi5qcwoKCgovKioKICogT3V0cHV0IG1lc3NhZ2VzIHBhc3NlZCBieSB0aGUgbG9nZ2VyIHN5c3RlbS4KICovCi8vIGNvbnNvbGUubG9nID0gbG9nZ2VyLmluZm9NZXNzYWdlOwovLyBjb25zb2xlLndhcm4gPSBsb2dnZXIud2FybmluZ01lc3NhZ2U7Ci8vIGNvbnNvbGUuZGVidWcgPSBsb2dnZXIuZGVidWdNZXNzYWdlOwovLyBjb25zb2xlLmVycm9yID0gbG9nZ2VyLmVycm9yTWVzc2FnZTsKCgovKioKICogRW50cnlwb2ludCBvZiBtZXNzYWdlIGRhdGEgcmVjZWl2ZWQKICoKICogQHBhcmFtIHtvYmplY3R9IG1lc3NhZ2UgdGhlIG9iamVjdCBvZiB0aGUgZXZlbnQKICovCnNlbGYub25tZXNzYWdlID0gKG1lc3NhZ2UpID0+IHsKICAgIHN3aXRjaCAobWVzc2FnZS5kYXRhLmNtZCkgewogICAgICAgIGNhc2UgInByZUluaXQiOgogICAgICAgICAgICBwcmVsb2FkSW5pdEV4dHJhY3RvcihtZXNzYWdlLmRhdGEpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJpbml0IjoKICAgICAgICAgICAgaW5pdGlhbGl6ZUV4dHJhY3RvcihtZXNzYWdlLmRhdGEpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJkZXRlY3QiOgogICAgICAgICAgICBkZXRlY3QobWVzc2FnZS5kYXRhKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAidmVyc2lvbiI6CiAgICAgICAgICAgIHZlcnNpb24obWVzc2FnZS5kYXRhKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZGVzdHJveSI6CiAgICAgICAgICAgIGRlc3Ryb3kobWVzc2FnZS5kYXRhKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicmVzZXRCdWZmZXJzIjoKICAgICAgICAgICAgcmVzZXRCdWZmZXJzKG1lc3NhZ2UuZGF0YSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGRlYnVnTWVzc2FnZSgidW5rbm93bk1lc3NhZ2UiKTsKICAgICAgICAgICAgYnJlYWs7CiAgICB9Cgp9Cg==")],{type:"text/javascript"}))),b))}async initializeEngine(){try{this.__worker.postMessage({cmd:"preInit",licenseKey:this.__licenseKey,bundlePath:this.__engineLocation+"/FPhi.Engine.Facephi",imageFormat:this.__imageFormat,imageQuality:this.__imageQuality,blurredThreshold:this.__blurredThreshold}),await new Promise((e=>{this.__worker.onmessage=t=>{"ready"===t.data.cmd&&e()}})),this.__worker.postMessage({cmd:"init"}),await new Promise((e=>{this.__worker.onmessage=t=>{"init"===t.data.cmd&&e()}}))}catch(e){throw new Error("Fail to initialize the engine!")}}detectImage(e){const{width:t,height:i}=e,l=e.getContext("2d").getImageData(0,0,t,i);return this.__worker.postMessage({cmd:"detect",image:l.data,width:t,height:i,accessibility:this.__accessibility,timestamp:Date.now()}),new Promise((e=>{this.__worker.onmessage=t=>{"detect"===t.data.cmd&&e(this.__generateResultObject(t.data))}}))}async cleanImageBuffer(){return this.__frontDocument=null,this.__faceImage=null,this.__backDocument=null,this.__worker.postMessage({cmd:"resetBuffers"}),new Promise((e=>{this.__worker.onmessage=t=>{"resetBuffers"===t.data.cmd&&e()}}))}async finalizeEngine(){this.__worker.postMessage({cmd:"destroy"})}get __attributes(){return{licenseKey:{type:"string",property:"__licenseKey"},bundlePath:{type:"string",property:"__engineLocation"},imageFormat:{type:"string",property:"__imageFormat"},imageQuality:{type:"number",property:"__imageQuality"},accessibility:{type:"boolean",property:"__accessibility"},blurredThreshold:{type:"number",property:"__blurredThreshold"}}}get __scanResultType(){return{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20}}__mapperToRealConfig(e){for(const[t,i]of Object.entries(e))void 0!==this.__attributes[t]&&(this[this.__attributes[t].property]=i)}__transformDate(e){try{let t,i,l;const a=Number((new Date).getFullYear().toString().slice(-2));return t=parseInt(e.slice(0,2))>a?"19"+e.slice(0,2):"20"+e.slice(0,2),i=e.slice(2,4),l=e.slice(4,7),l+"/"+i+"/"+t}catch(e){return null}}__generateResultObject(e){let t={};const i={};if(t.diagnostic=this.__scanResultType[e.result.diagnostic],t.detectionStatus={status:this.__scanResultType[e.result.diagnostic],quad:0,glare:0,internalStatus:e.result.diagnostic},t.simpleModeOutput=0,void 0!==e.result.diqaResult&&e.result.diqaResult.blur<this.__blurredThreshold)return this.__generateErrorResultObject(13);if(0===e.result.diagnostic){if(!1!==e.result.faceDetect){const t=e.result.documentImage.buffer,l=e.result.documentImage.width,a=e.result.documentImage.height;this.__frontDocument=new ImageData(new Uint8ClampedArray(t),l,a,i);const n=e.result.faceImage.buffer,s=e.result.faceImage.width,d=e.result.faceImage.height;this.__faceImage=new ImageData(new Uint8ClampedArray(n),s,d,i)}else{const t=e.result.documentImage.buffer,l=e.result.documentImage.width,a=e.result.documentImage.height;this.__backDocument=new ImageData(new Uint8ClampedArray(t),l,a,i)}if(t.images={frontDocument:this.__convertToImageOutput(this.__frontDocument),faceImage:this.__convertToImageOutput(this.__faceImage),backDocument:this.__convertToImageOutput(this.__backDocument),signatureImage:null},t.imagesRaw={frontDocument:this.__frontDocument,faceImage:this.__faceImage,backDocument:this.__backDocument,signatureImage:null},t.extractionRaw={},this.__mrzRawString=e.result.ocrResult,!1!==e.result.mrzDetect&&void 0!==this.__mrzRawString&&93===this.__mrzRawString.length){let e=(e=>{if(null!=e&&""!==e){let t={},i=null,l=null;const a=e.split("\n");if(a.length>=3){const e=new RegExp("([A|C|I][A-Z0-9<]{1})([A-Z]{3})([A-Z0-9<]{9})([0-9<]{1})([A-Z0-9<]{15})"),n=new RegExp("([0-9]{6})([0-9]{1})(.{1})([0-9]{6})([0-9]{1})([A-Z]{3})([A-Z0-9<]{11})([0-9]{1})"),s=new RegExp("([A-Z0-9<]{30})");if(t.extractionValidated=e.test(a[0])&&n.test(a[1])&&s.test(a[2]),t.extractionValidated)return i=e.exec(a[0]),t.documentType=i[1],t.countryEmitterCode=i[2],t.documentNumber=i[3].replaceAll("<",""),t.opt1=i[5],t.documentId=i[5].replaceAll("<",""),i=n.exec(a[1]),t.birthDate=i[1],t.gender=i[3],t.documentExpiry=i[4],t.nationality=i[6],t.opt2=i[7],i=s.exec(a[2]),l=i[1].replaceAll(/[<]{3,}/g,"").split("<<").map((e=>e.replaceAll("<"," "))),t.firstName=l[1],t.lastName=l[0],t}}return null})(this.__mrzRawString);if(null===e)return this.__generateErrorResultObject(13);t.extractionRaw.mrz={rawData:this.__mrzRawString,opt1:e.opt1,opt2:e.opt2,firstName:e.firstName,lastName:e.lastName,documentId:e.documentId,documentNumber:e.documentNumber,documentIssuer:e.countryEmitterCode,dateOfExpiry:e.documentExpiry,dateOfBirth:e.birthDate,gender:e.gender,nationality:e.nationality}}}return t.extractionData={firstName:R((()=>t.extractionRaw.mrz.firstName))||R((()=>t.extractionRaw.ocr.firstName))||null,lastName:R((()=>t.extractionRaw.mrz.lastName))||R((()=>t.extractionRaw.ocr.lastName))||null,gender:R((()=>t.extractionRaw.mrz.gender))||R((()=>t.extractionRaw.ocr.gender))||null,nationality:R((()=>t.extractionRaw.mrz.nationality))||R((()=>t.extractionRaw.ocr.nationality))||null,dateOfBirth:this.__transformDate(R((()=>t.extractionRaw.mrz.dateOfBirth)))||R((()=>t.extractionRaw.ocr.dateOfBirth))||null,documentId:R((()=>t.extractionRaw.mrz.documentId))||R((()=>t.extractionRaw.ocr.documentId))||null,documentNumber:R((()=>t.extractionRaw.mrz.documentNumber))||R((()=>t.extractionRaw.ocr.documentNumber))||null},t}__generateErrorResultObject(e){return{diagnostic:e,simpleModeOutput:0,detectionStatus:{status:e,glare:0,quad:0,internalStatus:e}}}__convertToImageOutput(e){if(null!==e){let t=document.createElement("canvas"),i=t.getContext("2d");return t.width=e.width,t.height=e.height,i.putImageData(e,0,0),t.toDataURL(this.__imageFormat,this.__imageQuality)}return null}__roundUpLenght(e,t){return Math.ceil(e/t)*t}}class g{constructor(e){this.__licenseKey="",this.__engineLocation="",this.__mockInformation={},this.__detectsCount=0,this.__detectsNeeded=10,this.__mapperToRealConfig(e)}async initializeEngine(){}async detectImage(e){return this.__detectsCount<this.__detectsNeeded?(this.__detectsCount++,await(async e=>new Promise((e=>setTimeout(e,200))))(),{result:1}):this.__generateResultObject(this.__mockInformation,e.getContext("2d").getImageData(0,0,e.width,e.height))}async cleanImageBuffer(e){}async finalizeEngine(){}get __attributes(){return{licenseKey:{type:"string",property:"__licenseKey"},bundlePath:{type:"string",property:"__engineLocation"},mockInformation:{type:"object",property:"__mockInformation"}}}get __scanResultType(){return{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10}}__mapperToRealConfig(e){for(const[t,i]of Object.entries(e))void 0!==this.__attributes[t]&&(this[this.__attributes[t].property]=i)}__generateResultObject(e,t){let i=null;return i=e&&0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype?{extractionRaw:{mrz:{rawData:null,opt1:null,opt2:null,firstName:null,lastName:null,documentId:null,documentNumber:null,documentIssuer:null,dateOfExpiry:null,dateOfBirth:null,gender:null,nationality:null},ocr:{firstName:null,lastName:null,documentId:null,documentNumber:null,dateOfBirth:null,dateOfExpiry:null,dateOfIssue:null,gender:null,nationality:null}},extractionData:{firstName:null,lastName:null,gender:null,nationality:null,dateOfBirth:null,placeOfBirth:null,documentId:null,documentNumber:null,address:null}}:e,{diagnostic:this.__scanResultType[0],images:{backDocument:this.__convertToImageOutput(t),frontDocument:this.__convertToImageOutput(t)},imagesRaw:{backDocument:t,frontDocument:t},extractionRaw:{mrz:i.extractionRaw.mrz,ocr:i.extractionRaw.ocr},extractionData:i.extractionData}}__convertToImageOutput(e){if(null!==e){let t=document.createElement("canvas"),i=t.getContext("2d");return t.width=e.width,t.height=e.height,i.putImageData(e,0,0),t.toDataURL(this.__imageFormat,this.__imageQuality)}return null}}function W(e,t,i,l){return new(i||(i=Promise))((function(a,n){function s(e){try{c(l.next(e))}catch(e){n(e)}}function d(e){try{c(l.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,d)}c((l=l.apply(e,t||[])).next())}))}let V=0;class p{constructor(e){this.action=e,this.messageID=function(){const e=V;return V+=1,e}()}}class G extends p{constructor(e,t){super(G.action),this.wasmModuleName=e.wasmModuleName,this.licenseKey=e.licenseKey,this.userId=t,this.registerLoadCallback=null!==e.loadProgressCallback,this.allowHelloMessage=e.allowHelloMessage,this.engineLocation=e.engineLocation,this.wasmType=e.wasmType,this.numberOfWorkers=e.numberOfWorkers}}var X,y,C,N,S;G.action="init",function(e){e[e.Any=0]="Any",e[e.Recognizer=1]="Recognizer",e[e.RecognizerSettings=2]="RecognizerSettings",e[e.Callback=3]="Callback"}(X||(X={}));class A extends p{constructor(e,t){super(A.action),this.className=e,this.params=t}}A.action="createNewNativeObject";class Y extends p{constructor(e,t,i){super(Y.action),this.recognizerHandles=e,this.allowMultipleResults=t,this.registeredMetadataCallbacks=i}}Y.action="createRecognizerRunner";class F extends p{constructor(e,t){super(F.action),this.recognizerHandles=e,this.allowMultipleResults=t}}F.action="reconfigureRecognizerRunner";class E extends p{constructor(){super(E.action)}}E.action="deleteRecognizerRunner";class v extends p{constructor(e,t,i){super(v.action),this.objectHandle=e,this.methodName=t,this.params=i}}v.action="invokeObject";class U extends p{constructor(e){super(U.action),this.frame=e}getTransferrables(){return[this.frame.imageData.data.buffer]}}U.action="processImage";class T extends p{constructor(e){super(T.action),this.hardReset=e}}T.action="resetRecognizers";class J{constructor(){this.onDebugText=!1,this.onDetectionFailed=!1,this.onQuadDetection=!1,this.onPointsDetection=!1,this.onFirstSideResult=!1,this.onGlare=!1}}class H extends p{constructor(e){super(H.action),this.registeredMetadataCallbacks=e}}H.action="registerMetadataCallbacks";class w extends p{constructor(e){super(w.action),this.detectionOnlyMode=e}}w.action="setDetectionOnly";class K extends p{constructor(e){super(K.action),this.callbackNonEmpty=e}}K.action="setClearTimeoutCallback";class f extends p{constructor(e){super(f.action),this.cameraPreviewMirrored=e}}f.action="setCameraPreviewMirrored";class x extends p{constructor(e){super(x.action),this.userId=e}}function k(e,t){return i=>{const l=i;l.success?e():t(l.error)}}function B(e,t){return i=>{const l=i;l.success?e(i):t(l.error)}}x.action="getProductIntegrationInfo",function(e){e[e.onDebugText=0]="onDebugText",e[e.onDetectionFailed=1]="onDetectionFailed",e[e.onQuadDetection=2]="onQuadDetection",e[e.onPointsDetection=3]="onPointsDetection",e[e.onFirstSideResult=4]="onFirstSideResult",e[e.clearTimeoutCallback=5]="clearTimeoutCallback",e[e.onGlare=6]="onGlare",e[e.recognizerCallback=7]="recognizerCallback"}(y||(y={})),function(e){e.Basic="BASIC",e.Advanced="ADVANCED",e.AdvancedWithThreads="ADVANCED_WITH_THREADS"}(C||(C={}));class L{constructor(e,t,i){this.wasmSDKWorker=e,this.objectHandle=i,this.recognizerName=t,this.callbacks=new Map}getRemoteObjectHandle(){return this.objectHandle}currentSettings(){return new Promise(((e,t)=>{if(0>this.objectHandle)return void t("Invalid object handle: "+this.objectHandle);const i=new v(this.objectHandle,"currentSettings",[]),l=B((t=>{e(t.result)}),t);this.wasmSDKWorker.postMessage(i,l)}))}toSignedJSON(){return new Promise(((e,t)=>{if(0>this.objectHandle)return void t("Invalid object handle: "+this.objectHandle);const i=new v(this.objectHandle,"toSignedJSON",[]),l=B((t=>{e(t.result)}),t);this.wasmSDKWorker.postMessage(i,l)}))}clearAllCallbacks(){this.callbacks.clear(),this.wasmSDKWorker.unregisterRecognizerCallbacks(this.objectHandle)}removeFunctions(e){this.clearAllCallbacks();const t=Object.keys(e);let i=!1;for(const l of t){const t=e[l];"function"==typeof t&&(this.callbacks.set(l,t),e[l]={parameter:{recognizerHandle:this.objectHandle,callbackName:l},type:X.Callback},i=!0)}return i&&this.wasmSDKWorker.registerRecognizerCallbacks(this.objectHandle,this),e}updateSettings(e){return new Promise(((t,i)=>{if(0>this.objectHandle)return void i("Invalid object handle: "+this.objectHandle);const l=new v(this.objectHandle,"updateSettings",[{parameter:this.removeFunctions(e),type:X.RecognizerSettings}]),a=k(t,i);this.wasmSDKWorker.postMessage(l,a)}))}invokeCallback(e,t){const i=this.callbacks.get(e);void 0!==i?i(...t):console.warn("Cannot find callback",e)}getResult(){return new Promise(((e,t)=>{if(0>this.objectHandle)return void t("Invalid object handle: "+this.objectHandle);const i=new v(this.objectHandle,"getResult",[]),l=B((t=>{e(t.result)}),t);this.wasmSDKWorker.postMessage(i,l)}))}delete(){return new Promise(((e,t)=>{if(0>this.objectHandle)return void t("Invalid object handle: "+this.objectHandle);this.clearAllCallbacks();const i=new v(this.objectHandle,"delete",[]),l=k((()=>{this.objectHandle=-1,e()}),t);this.wasmSDKWorker.postMessage(i,l)}))}}function O(e){const t=new J;return t.onDebugText=!!e.onDebugText,t.onDetectionFailed=!!e.onDetectionFailed,t.onPointsDetection=!!e.onPointsDetection,t.onQuadDetection=!!e.onQuadDetection,t.onFirstSideResult=!!e.onFirstSideResult,t.onGlare=!!e.onGlare,t}class M{constructor(e){this.deleted=!1,this.wasmSDKWorker=e}processImage(e){return new Promise(((t,i)=>{if(this.deleted)return void i("Recognizer runner is deleted. It cannot be used anymore!");const l=new U(e),a=B((e=>{t(e.recognitionState)}),i);this.wasmSDKWorker.postTransferrableMessage(l,a)}))}reconfigureRecognizers(e,t){return new Promise(((i,l)=>{if(this.deleted)return void l("Recognizer runner is deleted. It cannot be used anymore!");const a=z(e),n=new F(a,t),s=k(i,l);this.wasmSDKWorker.postMessage(n,s)}))}setMetadataCallbacks(e){return new Promise(((t,i)=>{const l=new H(O(e)),a=k(t,i);this.wasmSDKWorker.postMessageAndRegisterCallbacks(l,e,a)}))}resetRecognizers(e){return new Promise(((t,i)=>{const l=new T(e),a=k(t,i);this.wasmSDKWorker.postMessage(l,a)}))}setDetectionOnlyMode(e){return new Promise(((t,i)=>{const l=new w(e),a=k(t,i);this.wasmSDKWorker.postMessage(l,a)}))}setClearTimeoutCallback(e){return new Promise(((t,i)=>{const l=new K(null!==e),a=k(t,i);this.wasmSDKWorker.registerClearTimeoutCallback(e),this.wasmSDKWorker.postMessage(l,a)}))}setCameraPreviewMirrored(e){return new Promise(((t,i)=>{const l=new f(e),a=k(t,i);this.wasmSDKWorker.postMessage(l,a)}))}delete(){return this.deleted?Promise.reject("Recognizer runner is already deleted."):new Promise(((e,t)=>{const i=new E,l=k((()=>{this.deleted=!0,e()}),t);this.wasmSDKWorker.postMessage(i,l)}))}}function z(e){const t=[];for(const i of e)t.push(i.getRemoteObjectHandle());return t}class D{constructor(e){this.wasmSDKWorker=e}createRecognizerRunner(e,t=!1,i={}){return new Promise(((l,a)=>{const n=z(e),s=new Y(n,t,O(i)),d=k((()=>{l(new M(this.wasmSDKWorker))}),a);this.wasmSDKWorker.postMessageAndRegisterCallbacks(s,i,d)}))}newRecognizer(e,...t){return new Promise(((i,l)=>{const a=new A(e,function(e){const t=[];for(let i of e){let e=X.Any;i instanceof L&&(e=X.Recognizer,i=i.getRemoteObjectHandle()),t.push({parameter:i,type:e})}return t}(t)),n=B((t=>{const l=new L(this.wasmSDKWorker,e,t.objectHandle);i(l)}),l);this.wasmSDKWorker.postMessage(a,n)}))}}class P{constructor(e,t,i,l){this.eventHandlers={},this.metadataCallbacks={},this.clearTimeoutCallback=null,this.loadedWasmType=C.Basic,this.mbWasmWorker=e,this.mbWasmWorker.onmessage=e=>{this.handleWorkerEvent(e)},this.mbWasmWorker.onerror=()=>{l("Problem during initialization of worker file!")},this.mbWasmModule=new D(this),this.loadCallback=t,this.recognizersWithCallbacks=new Map,this.userId=i,this.showOverlay=!1}postMessage(e,t){this.eventHandlers[e.messageID]=t,this.mbWasmWorker.postMessage(e)}postTransferrableMessage(e,t){this.eventHandlers[e.messageID]=t,this.mbWasmWorker.postMessage(e,e.getTransferrables())}postMessageAndRegisterCallbacks(e,t,i){this.eventHandlers[e.messageID]=i,this.metadataCallbacks=t,this.mbWasmWorker.postMessage(e)}registerClearTimeoutCallback(e){this.clearTimeoutCallback=e}registerRecognizerCallbacks(e,t){this.recognizersWithCallbacks.set(e,t)}unregisterRecognizerCallbacks(e){this.recognizersWithCallbacks.delete(e)}delete(){this.mbWasmWorker.terminate()}getProductIntegrationInfo(){return new Promise(((e,t)=>{const i=new x(this.userId),l=B((t=>{e(t.result)}),t);this.postMessage(i,l)}))}handleWorkerEvent(e){if("isCallbackMessage"in e.data){const t=e.data;switch(t.callbackType){case y.onDebugText:"function"==typeof this.metadataCallbacks.onDebugText&&this.metadataCallbacks.onDebugText(t.callbackParameters[0]);break;case y.onDetectionFailed:"function"==typeof this.metadataCallbacks.onDetectionFailed&&this.metadataCallbacks.onDetectionFailed();break;case y.onPointsDetection:"function"==typeof this.metadataCallbacks.onPointsDetection&&this.metadataCallbacks.onPointsDetection(t.callbackParameters[0]);break;case y.onQuadDetection:"function"==typeof this.metadataCallbacks.onQuadDetection&&this.metadataCallbacks.onQuadDetection(t.callbackParameters[0]);break;case y.onFirstSideResult:"function"==typeof this.metadataCallbacks.onFirstSideResult&&this.metadataCallbacks.onFirstSideResult();break;case y.clearTimeoutCallback:this.clearTimeoutCallback&&"function"==typeof this.clearTimeoutCallback.onClearTimeout&&this.clearTimeoutCallback.onClearTimeout();break;case y.onGlare:"function"==typeof this.metadataCallbacks.onGlare&&this.metadataCallbacks.onGlare(t.callbackParameters[0]);break;case y.recognizerCallback:{const e=t.callbackParameters.shift(),i=this.recognizersWithCallbacks.get(e.recognizerHandle);void 0!==i?i.invokeCallback(e.callbackName,t.callbackParameters):console.warn("Cannot find recognizer to deliver callback message. Maybe it's destroyed?",e);break}default:throw Error("Unknown callback type: "+y[t.callbackType])}}else if("isLoadProgressMessage"in e.data){const t=e.data;"function"==typeof this.loadCallback&&this.loadCallback(t.progress)}else{const t=e.data,i=this.eventHandlers[t.messageID];delete this.eventHandlers[t.messageID],i(t)}}static createWasmWorker(e,t,i){return W(this,void 0,void 0,(function*(){return new Promise(((l,a)=>{const n=new P(e,t.loadProgressCallback,i,a),s=new G(t,i),d=B((e=>{const t=e;n.showOverlay=t.showOverlay,n.loadedWasmType=t.wasmType,l(n)}),(e=>{n&&"function"==typeof n.delete&&n.delete(),a(e)}));n.postMessage(s,d)}))}))}}class _{constructor(e,t){if(!e.code||!e.message)throw Error("Instance of SDKError is required to have code and message.");this.message=e.message,this.code=e.code,this.details=t}}!function(e){e.WORKER_WASM_LOAD_FAILURE="WORKER_WASM_LOAD_FAILURE",e.WORKER_WASM_INIT_MISSING="WORKER_WASM_INIT_MISSING",e.WORKER_FUNCTION_INVOKE_FAILURE="WORKER_FUNCTION_INVOKE_FAILURE",e.WORKER_RECOGNIZER_CREATION_FAILURE="WORKER_RECOGNIZER_CREATION_FAILURE",e.WORKER_RUNNER_EXISTS="WORKER_RUNNER_EXISTS",e.WORKER_RUNNER_CREATION_FAILURE="WORKER_RUNNER_CREATION_FAILURE",e.WORKER_RUNNER_MISSING="WORKER_RUNNER_MISSING",e.WORKER_RUNNER_RECONFIGURE_FAILURE="WORKER_RUNNER_RECONFIGURE_FAILURE",e.WORKER_RUNNER_DELETED="WORKER_RUNNER_DELETED",e.WORKER_RUNNER_DELETE_FAILURE="WORKER_RUNNER_DELETE_FAILURE",e.WORKER_OBJECT_INVOKE_FAILURE="WORKER_OBJECT_INVOKE_FAILURE",e.WORKER_IMAGE_PROCESS_FAILURE="WORKER_IMAGE_PROCESS_FAILURE",e.WORKER_HANDLE_UNDEFINED="WORKER_HANDLE_UNDEFINED",e.WORKER_MESSAGE_ACTION_UNKNOWN="WORKER_MESSAGE_ACTION_UNKNOWN",e.WORKER_LICENSE_UNLOCK_ERROR="WORKER_LICENSE_UNLOCK_ERROR",e.WORKER_INTEGRATION_INFO_FAILURE="WORKER_INTEGRATION_INFO_FAILURE",e.LOCAL_SDK_RUNNER_MISSING="LOCAL_SDK_RUNNER_MISSING",e.LOCAL_SDK_RUNNER_EMPTY="LOCAL_SDK_RUNNER_EMPTY",e.LICENSE_UNLOCK_ERROR="LICENSE_UNLOCK_ERROR",e.FRAME_CAPTURE_SVG_UNSUPPORTED="FRAME_CAPTURE_SVG_UNSUPPORTED",e.FRAME_CAPTURE_CANVAS_MISSING="FRAME_CAPTURE_CANVAS_MISSING",e.SDK_WASM_SETTINGS_MISSING="SDK_WASM_SETTINGS_MISSING",e.SDK_LICENSE_KEY_MISSING="SDK_LICENSE_KEY_MISSING",e.SDK_WASM_MODULE_NAME_MISSING="SDK_WASM_MODULE_NAME_MISSING",e.SDK_ENGINE_LOCATION_INVALID="SDK_ENGINE_LOCATION_INVALID",e.SDK_MISSING="SDK_MISSING",e.SDK_RECOGNIZERS_MISSING="SDK_RECOGNIZERS_MISSING",e.VIDEO_RECOGNIZER_ELEMENT_MISSING="VIDEO_RECOGNIZER_ELEMENT_MISSING",e.VIDEO_RECOGNIZER_CAMERA_MISSING="VIDEO_RECOGNIZER_CAMERA_MISSING",e.VIDEO_RECOGNIZER_CAMERA_NOT_ALLOWED="VIDEO_RECOGNIZER_CAMERA_NOT_ALLOWED",e.VIDEO_RECOGNIZER_CAMERA_UNAVAILABLE="VIDEO_RECOGNIZER_CAMERA_UNAVAILABLE",e.VIDEO_RECOGNIZER_CAMERA_IN_USE="VIDEO_RECOGNIZER_CAMERA_IN_USE",e.VIDEO_RECOGNIZER_MEDIA_DEVICES_UNSUPPORTED="VIDEO_RECOGNIZER_MEDIA_DEVICES_UNSUPPORTED",e.VIDEO_RECOGNIZER_FEED_RELEASED="VIDEO_RECOGNIZER_FEED_RELEASED",e.VIDEO_RECOGNIZER_FEED_NOT_PAUSED="VIDEO_RECOGNIZER_FEED_NOT_PAUSED",e.VIDEO_RECOGNIZER_PLAY_REQUEST_INTERRUPTED="VIDEO_RECOGNIZER_PLAY_REQUEST_INTERRUPTED",e.VIDEO_RECOGNIZER_FEED_PAUSED="VIDEO_RECOGNIZER_FEED_PAUSED",e.VIDEO_RECOGNIZER_RECOGNIZERS_RESET_FAILURE="VIDEO_RECOGNIZER_RECOGNIZERS_RESET_FAILURE",e.VIDEO_RECOGNIZER_FEED_MISSING="VIDEO_RECOGNIZER_FEED_MISSING"}(N||(N={})),function(e){e.WORKER_HANDLE_UNDEFINED="Cannot find object with handle: undefined",e.WORKER_WASM_LOAD_FAILURE="Failed to load WASM in web worker!",e.WORKER_WASM_INIT_MISSING="WASM module is not initialized!",e.WORKER_FUNCTION_INVOKE_FAILURE="Failed to invoke function!",e.WORKER_RECOGNIZER_CREATION_FAILURE="Failed to create new recognizer!",e.WORKER_RUNNER_EXISTS="Recognizer runner is already created! Multiple instances are not allowed!",e.WORKER_RUNNER_CREATION_FAILURE="Failed to create new recognizer runner!",e.WORKER_RUNNER_MISSING="Recognizer runner is not created! There is nothing to reconfigure!",e.WORKER_RUNNER_RECONFIGURE_FAILURE="Failed to reconfigure recognizer runner!",e.WORKER_RUNNER_DELETED="Recognizer runner is already deleted!",e.WORKER_RUNNER_DELETE_FAILURE="Failed to delete recognizer runner!",e.WORKER_OBJECT_INVOKE_FAILURE="Failed to invoke object!",e.WORKER_IMAGE_PROCESS_FAILURE="Recognizer runner is not initialized! Cannot process image!",e.WORKER_INTEGRATION_INFO_FAILURE="Failed to get product integration info!",e.LOCAL_SDK_RUNNER_MISSING="Property nativeRecognizerRunner is not available!",e.LOCAL_SDK_RUNNER_EMPTY="Native RecognizerRunner cannot be empty!",e.LICENSE_TOKEN_STATE_INCORRECT="Internal error (Incorrect token state)",e.LICENSE_PAYLOAD_VERIFICATION_FAILED="Failed to verify server permission's digital signature!",e.LICENSE_PAYLOAD_CORRUPTED="Server permission payload is corrupted!",e.LICENSE_PERMISSION_EXPIRED="Internal error (server permission expired)",e.LICENSE_REMOTE_LOCKED="Provided license key has been remotely locked. Please contact support for more information!",e.FRAME_CAPTURE_SVG_UNSUPPORTED="Recognition of SVG elements not supported!",e.FRAME_CAPTURE_CANVAS_MISSING="Could not get canvas 2d context!",e.SDK_WASM_SETTINGS_MISSING="Missing WASM load settings!",e.SDK_LICENSE_KEY_MISSING="Missing license key!",e.SDK_WASM_MODULE_NAME_MISSING="Missing WASM module name!",e.SDK_ENGINE_LOCATION_INVALID="Setting property 'engineLocation' must be a string!",e.SDK_MISSING="SDK is not provided!",e.SDK_RECOGNIZERS_MISSING="To create RecognizerRunner at least 1 recognizer is required.",e.VIDEO_RECOGNIZER_ELEMENT_MISSING="Video element, i.e. camera feed is not provided!",e.VIDEO_RECOGNIZER_CAMERA_MISSING="Camera not found!",e.VIDEO_RECOGNIZER_CAMERA_NOT_ALLOWED="Camera not allowed!",e.VIDEO_RECOGNIZER_CAMERA_UNAVAILABLE="Camera not available!",e.VIDEO_RECOGNIZER_CAMERA_IN_USE="Camera in use!",e.VIDEO_RECOGNIZER_MEDIA_DEVICES_UNSUPPORTED="Media devices not supported by browser.",e.VIDEO_RECOGNIZER_FEED_RELEASED="The associated video feed has been released!",e.VIDEO_RECOGNIZER_FEED_NOT_PAUSED="The associated video feed is not paused. Use resumeRecognition instead!",e.VIDEO_RECOGNIZER_PLAY_REQUEST_INTERRUPTED="The play() request was interrupted or prevented by browser security rules!",e.VIDEO_RECOGNIZER_FEED_PAUSED="Cannot resume recognition while video feed is paused! Use recognize or startRecognition",e.VIDEO_RECOGNIZER_RECOGNIZERS_RESET_FAILURE="Could not reset recognizers!",e.VIDEO_RECOGNIZER_FEED_MISSING="Missing video feed!"}(S||(S={})),S.VIDEO_RECOGNIZER_FEED_MISSING,N.VIDEO_RECOGNIZER_FEED_MISSING,S.VIDEO_RECOGNIZER_RECOGNIZERS_RESET_FAILURE,N.VIDEO_RECOGNIZER_RECOGNIZERS_RESET_FAILURE,S.VIDEO_RECOGNIZER_FEED_PAUSED,N.VIDEO_RECOGNIZER_FEED_PAUSED,S.VIDEO_RECOGNIZER_PLAY_REQUEST_INTERRUPTED,N.VIDEO_RECOGNIZER_PLAY_REQUEST_INTERRUPTED,S.VIDEO_RECOGNIZER_FEED_NOT_PAUSED,N.VIDEO_RECOGNIZER_FEED_NOT_PAUSED,S.VIDEO_RECOGNIZER_FEED_RELEASED,N.VIDEO_RECOGNIZER_FEED_RELEASED,N.VIDEO_RECOGNIZER_MEDIA_DEVICES_UNSUPPORTED,S.VIDEO_RECOGNIZER_MEDIA_DEVICES_UNSUPPORTED,N.VIDEO_RECOGNIZER_CAMERA_MISSING,S.VIDEO_RECOGNIZER_CAMERA_MISSING,S.VIDEO_RECOGNIZER_ELEMENT_MISSING,N.VIDEO_RECOGNIZER_ELEMENT_MISSING;const j={wasmSettingsMissing:{message:S.SDK_WASM_SETTINGS_MISSING,code:N.SDK_WASM_SETTINGS_MISSING},licenseKeyMissing:{message:S.SDK_LICENSE_KEY_MISSING,code:N.SDK_LICENSE_KEY_MISSING},wasmModuleNameMissing:{message:S.SDK_WASM_MODULE_NAME_MISSING,code:N.SDK_WASM_MODULE_NAME_MISSING},engineLocationInvalid:{message:S.SDK_ENGINE_LOCATION_INVALID,code:N.SDK_ENGINE_LOCATION_INVALID},missing:{message:S.SDK_MISSING,code:N.SDK_MISSING},recognizersMissing:{message:S.SDK_RECOGNIZERS_MISSING,code:N.SDK_RECOGNIZERS_MISSING}},Q={svgUnsupported:{message:S.FRAME_CAPTURE_SVG_UNSUPPORTED,code:N.FRAME_CAPTURE_SVG_UNSUPPORTED},canvasMissing:{message:S.FRAME_CAPTURE_CANVAS_MISSING,code:N.FRAME_CAPTURE_CANVAS_MISSING}};var q,$,ee;let te;N.LICENSE_UNLOCK_ERROR,S.LICENSE_TOKEN_STATE_INCORRECT,N.LICENSE_UNLOCK_ERROR,S.LICENSE_PAYLOAD_VERIFICATION_FAILED,N.LICENSE_UNLOCK_ERROR,S.LICENSE_PAYLOAD_CORRUPTED,N.LICENSE_UNLOCK_ERROR,S.LICENSE_PERMISSION_EXPIRED,N.LICENSE_UNLOCK_ERROR,S.LICENSE_REMOTE_LOCKED,N.LICENSE_UNLOCK_ERROR,N.LICENSE_UNLOCK_ERROR,S.LOCAL_SDK_RUNNER_MISSING,N.LOCAL_SDK_RUNNER_MISSING,S.LOCAL_SDK_RUNNER_EMPTY,N.LOCAL_SDK_RUNNER_EMPTY,S.WORKER_IMAGE_PROCESS_FAILURE,N.WORKER_IMAGE_PROCESS_FAILURE,S.WORKER_OBJECT_INVOKE_FAILURE,N.WORKER_OBJECT_INVOKE_FAILURE,S.WORKER_RUNNER_DELETE_FAILURE,N.WORKER_RUNNER_DELETE_FAILURE,S.WORKER_RUNNER_DELETED,N.WORKER_RUNNER_DELETED,S.WORKER_RUNNER_RECONFIGURE_FAILURE,N.WORKER_RUNNER_RECONFIGURE_FAILURE,S.WORKER_RUNNER_MISSING,N.WORKER_RUNNER_MISSING,S.WORKER_RUNNER_CREATION_FAILURE,N.WORKER_RUNNER_CREATION_FAILURE,S.WORKER_RUNNER_EXISTS,N.WORKER_RUNNER_EXISTS,S.WORKER_RECOGNIZER_CREATION_FAILURE,N.WORKER_RECOGNIZER_CREATION_FAILURE,S.WORKER_FUNCTION_INVOKE_FAILURE,N.WORKER_FUNCTION_INVOKE_FAILURE,S.WORKER_WASM_INIT_MISSING,N.WORKER_WASM_INIT_MISSING,S.WORKER_WASM_LOAD_FAILURE,N.WORKER_WASM_LOAD_FAILURE,S.WORKER_HANDLE_UNDEFINED,N.WORKER_HANDLE_UNDEFINED,S.WORKER_INTEGRATION_INFO_FAILURE,N.WORKER_INTEGRATION_INFO_FAILURE,function(e){e[e.BackFacingCamera=0]="BackFacingCamera",e[e.FrontFacingCamera=1]="FrontFacingCamera"}(q||(q={})),function(e){e[e.RotatedLeft90=0]="RotatedLeft90",e[e.NoRotation=1]="NoRotation",e[e.RotatedRight90=2]="RotatedRight90",e[e.Rotated180=3]="Rotated180"}($||($={})),function(e){e[e.Empty=0]="Empty",e[e.Uncertain=1]="Uncertain",e[e.Valid=2]="Valid",e[e.StageValid=3]="StageValid"}(ee||(ee={}));class ie{constructor(e,t,i){this.imageData=e,this.orientation=t,this.videoFrame=i}}var le,ae,ne,se,de,ce,he,oe,re,me,Ie,Ze,be,Re,ue,ge,We;!function(e){e[e.Invalid=0]="Invalid",e[e.RequiresServerPermission=1]="RequiresServerPermission",e[e.Valid=2]="Valid"}(le||(le={})),function(e){e.LicenseTokenStateInvalid="LICENSE_TOKEN_STATE_INVALID",e.NetworkError="NETWORK_ERROR",e.RemoteLock="REMOTE_LOCK",e.PermissionExpired="PERMISSION_EXPIRED",e.PayloadCorrupted="PAYLOAD_CORRUPTED",e.PayloadSignatureVerificationFailed="PAYLOAD_SIGNATURE_VERIFICATION_FAILED",e.IncorrectTokenState="INCORRECT_TOKEN_STATE"}(ae||(ae={})),function(e){e[e.Ok=0]="Ok",e[e.NetworkError=1]="NetworkError",e[e.RemoteLock=2]="RemoteLock",e[e.PermissionExpired=3]="PermissionExpired",e[e.PayloadCorrupted=4]="PayloadCorrupted",e[e.PayloadSignatureVerificationFailed=5]="PayloadSignatureVerificationFailed",e[e.IncorrectTokenState=6]="IncorrectTokenState"}(ne||(ne={})),function(e){e[e.Fail=0]="Fail",e[e.Success=1]="Success",e[e.CameraTooHigh=2]="CameraTooHigh",e[e.FallbackSuccess=3]="FallbackSuccess",e[e.Partial=4]="Partial",e[e.CameraAtAngle=5]="CameraAtAngle",e[e.CameraTooNear=6]="CameraTooNear",e[e.DocumentTooCloseToEdge=7]="DocumentTooCloseToEdge"}(se||(se={})),function(e){e.MediaDevicesNotSupported="MediaDevicesNotSupported",e.CameraNotFound="CameraNotFound",e.CameraNotAllowed="CameraNotAllowed",e.CameraInUse="CameraInUse",e.CameraNotAvailable="CameraNotAvailable",e.VideoElementNotProvided="VideoElementNotProvided"}(de||(de={})),function(e){e[e.Recognition=0]="Recognition",e[e.RecognitionTest=1]="RecognitionTest",e[e.DetectionTest=2]="DetectionTest"}(ce||(ce={}));class Ve{constructor(e){if(this.allowHelloMessage=!0,this.engineLocation="",this.wasmType=null,this.numberOfWorkers=null,this.loadProgressCallback=null,this.wasmModuleName="BlinkIDWasmSDK",!e)throw new _(j.licenseKeyMissing);this.licenseKey=e}}function pe(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)))}!function(e){e[e.NONE=0]="NONE",e[e.QR_CODE=1]="QR_CODE",e[e.DATA_MATRIX=2]="DATA_MATRIX",e[e.UPC_E=3]="UPC_E",e[e.UPC_A=4]="UPC_A",e[e.EAN_8=5]="EAN_8",e[e.EAN_13=6]="EAN_13",e[e.CODE_128=7]="CODE_128",e[e.CODE_39=8]="CODE_39",e[e.ITF=9]="ITF",e[e.AZTEC_BARCODE=10]="AZTEC_BARCODE",e[e.PDF417_BARCODE=11]="PDF417_BARCODE"}(he||(he={})),function(e){e[e.None=0]="None",e[e.ImageOnly=1]="ImageOnly",e[e.ResultFieldsOnly=2]="ResultFieldsOnly",e[e.FullResult=3]="FullResult"}(oe||(oe={})),function(e){e[e.DocumentType=0]="DocumentType",e[e.StandardVersionNumber=1]="StandardVersionNumber",e[e.CustomerFamilyName=2]="CustomerFamilyName",e[e.CustomerFirstName=3]="CustomerFirstName",e[e.CustomerFullName=4]="CustomerFullName",e[e.DateOfBirth=5]="DateOfBirth",e[e.Sex=6]="Sex",e[e.EyeColor=7]="EyeColor",e[e.AddressStreet=8]="AddressStreet",e[e.AddressCity=9]="AddressCity",e[e.AddressJurisdictionCode=10]="AddressJurisdictionCode",e[e.AddressPostalCode=11]="AddressPostalCode",e[e.FullAddress=12]="FullAddress",e[e.Height=13]="Height",e[e.HeightIn=14]="HeightIn",e[e.HeightCm=15]="HeightCm",e[e.CustomerMiddleName=16]="CustomerMiddleName",e[e.HairColor=17]="HairColor",e[e.NameSuffix=18]="NameSuffix",e[e.AKAFullName=19]="AKAFullName",e[e.AKAFamilyName=20]="AKAFamilyName",e[e.AKAGivenName=21]="AKAGivenName",e[e.AKASuffixName=22]="AKASuffixName",e[e.WeightRange=23]="WeightRange",e[e.WeightPounds=24]="WeightPounds",e[e.WeightKilograms=25]="WeightKilograms",e[e.CustomerIdNumber=26]="CustomerIdNumber",e[e.FamilyNameTruncation=27]="FamilyNameTruncation",e[e.FirstNameTruncation=28]="FirstNameTruncation",e[e.MiddleNameTruncation=29]="MiddleNameTruncation",e[e.PlaceOfBirth=30]="PlaceOfBirth",e[e.AddressStreet2=31]="AddressStreet2",e[e.RaceEthnicity=32]="RaceEthnicity",e[e.NamePrefix=33]="NamePrefix",e[e.CountryIdentification=34]="CountryIdentification",e[e.ResidenceStreetAddress=35]="ResidenceStreetAddress",e[e.ResidenceStreetAddress2=36]="ResidenceStreetAddress2",e[e.ResidenceCity=37]="ResidenceCity",e[e.ResidenceJurisdictionCode=38]="ResidenceJurisdictionCode",e[e.ResidencePostalCode=39]="ResidencePostalCode",e[e.ResidenceFullAddress=40]="ResidenceFullAddress",e[e.Under18=41]="Under18",e[e.Under19=42]="Under19",e[e.Under21=43]="Under21",e[e.SocialSecurityNumber=44]="SocialSecurityNumber",e[e.AKASocialSecurityNumber=45]="AKASocialSecurityNumber",e[e.AKAMiddleName=46]="AKAMiddleName",e[e.AKAPrefixName=47]="AKAPrefixName",e[e.OrganDonor=48]="OrganDonor",e[e.Veteran=49]="Veteran",e[e.AKADateOfBirth=50]="AKADateOfBirth",e[e.IssuerIdentificationNumber=51]="IssuerIdentificationNumber",e[e.DocumentExpirationDate=52]="DocumentExpirationDate",e[e.JurisdictionVersionNumber=53]="JurisdictionVersionNumber",e[e.JurisdictionVehicleClass=54]="JurisdictionVehicleClass",e[e.JurisdictionRestrictionCodes=55]="JurisdictionRestrictionCodes",e[e.JurisdictionEndorsementCodes=56]="JurisdictionEndorsementCodes",e[e.DocumentIssueDate=57]="DocumentIssueDate",e[e.FederalCommercialVehicleCodes=58]="FederalCommercialVehicleCodes",e[e.IssuingJurisdiction=59]="IssuingJurisdiction",e[e.StandardVehicleClassification=60]="StandardVehicleClassification",e[e.IssuingJurisdictionName=61]="IssuingJurisdictionName",e[e.StandardEndorsementCode=62]="StandardEndorsementCode",e[e.StandardRestrictionCode=63]="StandardRestrictionCode",e[e.JurisdictionVehicleClassificationDescription=64]="JurisdictionVehicleClassificationDescription",e[e.JurisdictionEndorsmentCodeDescription=65]="JurisdictionEndorsmentCodeDescription",e[e.JurisdictionRestrictionCodeDescription=66]="JurisdictionRestrictionCodeDescription",e[e.InventoryControlNumber=67]="InventoryControlNumber",e[e.CardRevisionDate=68]="CardRevisionDate",e[e.DocumentDiscriminator=69]="DocumentDiscriminator",e[e.LimitedDurationDocument=70]="LimitedDurationDocument",e[e.AuditInformation=71]="AuditInformation",e[e.ComplianceType=72]="ComplianceType",e[e.IssueTimestamp=73]="IssueTimestamp",e[e.PermitExpirationDate=74]="PermitExpirationDate",e[e.PermitIdentifier=75]="PermitIdentifier",e[e.PermitIssueDate=76]="PermitIssueDate",e[e.NumberOfDuplicates=77]="NumberOfDuplicates",e[e.HAZMATExpirationDate=78]="HAZMATExpirationDate",e[e.MedicalIndicator=79]="MedicalIndicator",e[e.NonResident=80]="NonResident",e[e.UniqueCustomerId=81]="UniqueCustomerId",e[e.DataDiscriminator=82]="DataDiscriminator",e[e.DocumentExpirationMonth=83]="DocumentExpirationMonth",e[e.DocumentNonexpiring=84]="DocumentNonexpiring",e[e.SecurityVersion=85]="SecurityVersion",e[e.Count=86]="Count"}(re||(re={})),function(e){e[e.NONE=0]="NONE",e[e.ALBANIA=1]="ALBANIA",e[e.ALGERIA=2]="ALGERIA",e[e.ARGENTINA=3]="ARGENTINA",e[e.AUSTRALIA=4]="AUSTRALIA",e[e.AUSTRIA=5]="AUSTRIA",e[e.AZERBAIJAN=6]="AZERBAIJAN",e[e.BAHRAIN=7]="BAHRAIN",e[e.BANGLADESH=8]="BANGLADESH",e[e.BELGIUM=9]="BELGIUM",e[e.BOSNIA_AND_HERZEGOVINA=10]="BOSNIA_AND_HERZEGOVINA",e[e.BRUNEI=11]="BRUNEI",e[e.BULGARIA=12]="BULGARIA",e[e.CAMBODIA=13]="CAMBODIA",e[e.CANADA=14]="CANADA",e[e.CHILE=15]="CHILE",e[e.COLOMBIA=16]="COLOMBIA",e[e.COSTA_RICA=17]="COSTA_RICA",e[e.CROATIA=18]="CROATIA",e[e.CYPRUS=19]="CYPRUS",e[e.CZECHIA=20]="CZECHIA",e[e.DENMARK=21]="DENMARK",e[e.DOMINICAN_REPUBLIC=22]="DOMINICAN_REPUBLIC",e[e.EGYPT=23]="EGYPT",e[e.ESTONIA=24]="ESTONIA",e[e.FINLAND=25]="FINLAND",e[e.FRANCE=26]="FRANCE",e[e.GEORGIA=27]="GEORGIA",e[e.GERMANY=28]="GERMANY",e[e.GHANA=29]="GHANA",e[e.GREECE=30]="GREECE",e[e.GUATEMALA=31]="GUATEMALA",e[e.HONG_KONG=32]="HONG_KONG",e[e.HUNGARY=33]="HUNGARY",e[e.INDIA=34]="INDIA",e[e.INDONESIA=35]="INDONESIA",e[e.IRELAND=36]="IRELAND",e[e.ISRAEL=37]="ISRAEL",e[e.ITALY=38]="ITALY",e[e.JORDAN=39]="JORDAN",e[e.KAZAKHSTAN=40]="KAZAKHSTAN",e[e.KENYA=41]="KENYA",e[e.KOSOVO=42]="KOSOVO",e[e.KUWAIT=43]="KUWAIT",e[e.LATVIA=44]="LATVIA",e[e.LITHUANIA=45]="LITHUANIA",e[e.MALAYSIA=46]="MALAYSIA",e[e.MALDIVES=47]="MALDIVES",e[e.MALTA=48]="MALTA",e[e.MAURITIUS=49]="MAURITIUS",e[e.MEXICO=50]="MEXICO",e[e.MOROCCO=51]="MOROCCO",e[e.NETHERLANDS=52]="NETHERLANDS",e[e.NEW_ZEALAND=53]="NEW_ZEALAND",e[e.NIGERIA=54]="NIGERIA",e[e.PAKISTAN=55]="PAKISTAN",e[e.PANAMA=56]="PANAMA",e[e.PARAGUAY=57]="PARAGUAY",e[e.PHILIPPINES=58]="PHILIPPINES",e[e.POLAND=59]="POLAND",e[e.PORTUGAL=60]="PORTUGAL",e[e.PUERTO_RICO=61]="PUERTO_RICO",e[e.QATAR=62]="QATAR",e[e.ROMANIA=63]="ROMANIA",e[e.RUSSIA=64]="RUSSIA",e[e.SAUDI_ARABIA=65]="SAUDI_ARABIA",e[e.SERBIA=66]="SERBIA",e[e.SINGAPORE=67]="SINGAPORE",e[e.SLOVAKIA=68]="SLOVAKIA",e[e.SLOVENIA=69]="SLOVENIA",e[e.SOUTH_AFRICA=70]="SOUTH_AFRICA",e[e.SPAIN=71]="SPAIN",e[e.SWEDEN=72]="SWEDEN",e[e.SWITZERLAND=73]="SWITZERLAND",e[e.TAIWAN=74]="TAIWAN",e[e.THAILAND=75]="THAILAND",e[e.TUNISIA=76]="TUNISIA",e[e.TURKEY=77]="TURKEY",e[e.UAE=78]="UAE",e[e.UGANDA=79]="UGANDA",e[e.UK=80]="UK",e[e.UKRAINE=81]="UKRAINE",e[e.USA=82]="USA",e[e.VIETNAM=83]="VIETNAM",e[e.BRAZIL=84]="BRAZIL",e[e.NORWAY=85]="NORWAY",e[e.OMAN=86]="OMAN",e[e.ECUADOR=87]="ECUADOR",e[e.EL_SALVADOR=88]="EL_SALVADOR",e[e.SRI_LANKA=89]="SRI_LANKA",e[e.PERU=90]="PERU",e[e.URUGUAY=91]="URUGUAY",e[e.BAHAMAS=92]="BAHAMAS",e[e.BERMUDA=93]="BERMUDA",e[e.BOLIVIA=94]="BOLIVIA",e[e.CHINA=95]="CHINA",e[e.EUROPEAN_UNION=96]="EUROPEAN_UNION",e[e.HAITI=97]="HAITI",e[e.HONDURAS=98]="HONDURAS",e[e.ICELAND=99]="ICELAND",e[e.JAPAN=100]="JAPAN",e[e.LUXEMBOURG=101]="LUXEMBOURG",e[e.MONTENEGRO=102]="MONTENEGRO",e[e.NICARAGUA=103]="NICARAGUA",e[e.SOUTH_KOREA=104]="SOUTH_KOREA",e[e.VENEZUELA=105]="VENEZUELA",e[e.AFGHANISTAN=106]="AFGHANISTAN",e[e.ALAND_ISLANDS=107]="ALAND_ISLANDS",e[e.AMERICAN_SAMOA=108]="AMERICAN_SAMOA",e[e.ANDORRA=109]="ANDORRA",e[e.ANGOLA=110]="ANGOLA",e[e.ANGUILLA=111]="ANGUILLA",e[e.ANTARCTICA=112]="ANTARCTICA",e[e.ANTIGUA_AND_BARBUDA=113]="ANTIGUA_AND_BARBUDA",e[e.ARMENIA=114]="ARMENIA",e[e.ARUBA=115]="ARUBA",e[e.BAILIWICK_OF_GUERNSEY=116]="BAILIWICK_OF_GUERNSEY",e[e.BAILIWICK_OF_JERSEY=117]="BAILIWICK_OF_JERSEY",e[e.BARBADOS=118]="BARBADOS",e[e.BELARUS=119]="BELARUS",e[e.BELIZE=120]="BELIZE",e[e.BENIN=121]="BENIN",e[e.BHUTAN=122]="BHUTAN",e[e.BONAIRE_SAINT_EUSTATIUS_AND_SABA=123]="BONAIRE_SAINT_EUSTATIUS_AND_SABA",e[e.BOTSWANA=124]="BOTSWANA",e[e.BOUVET_ISLAND=125]="BOUVET_ISLAND",e[e.BRITISH_INDIAN_OCEAN_TERRITORY=126]="BRITISH_INDIAN_OCEAN_TERRITORY",e[e.BURKINA_FASO=127]="BURKINA_FASO",e[e.BURUNDI=128]="BURUNDI",e[e.CAMEROON=129]="CAMEROON",e[e.CAPE_VERDE=130]="CAPE_VERDE",e[e.CARIBBEAN_NETHERLANDS=131]="CARIBBEAN_NETHERLANDS",e[e.CAYMAN_ISLANDS=132]="CAYMAN_ISLANDS",e[e.CENTRAL_AFRICAN_REPUBLIC=133]="CENTRAL_AFRICAN_REPUBLIC",e[e.CHAD=134]="CHAD",e[e.CHRISTMAS_ISLAND=135]="CHRISTMAS_ISLAND",e[e.COCOS_ISLANDS=136]="COCOS_ISLANDS",e[e.COMOROS=137]="COMOROS",e[e.CONGO=138]="CONGO",e[e.COOK_ISLANDS=139]="COOK_ISLANDS",e[e.CUBA=140]="CUBA",e[e.CURACAO=141]="CURACAO",e[e.DEMOCRATIC_REPUBLIC_OF_THE_CONGO=142]="DEMOCRATIC_REPUBLIC_OF_THE_CONGO",e[e.DJIBOUTI=143]="DJIBOUTI",e[e.DOMINICA=144]="DOMINICA",e[e.EAST_TIMOR=145]="EAST_TIMOR",e[e.EQUATORIAL_GUINEA=146]="EQUATORIAL_GUINEA",e[e.ERITREA=147]="ERITREA",e[e.ETHIOPIA=148]="ETHIOPIA",e[e.FALKLAND_ISLANDS=149]="FALKLAND_ISLANDS",e[e.FAROE_ISLANDS=150]="FAROE_ISLANDS",e[e.FEDERATED_STATES_OF_MICRONESIA=151]="FEDERATED_STATES_OF_MICRONESIA",e[e.FIJI=152]="FIJI",e[e.FRENCH_GUIANA=153]="FRENCH_GUIANA",e[e.FRENCH_POLYNESIA=154]="FRENCH_POLYNESIA",e[e.FRENCH_SOUTHERN_TERRITORIES=155]="FRENCH_SOUTHERN_TERRITORIES",e[e.GABON=156]="GABON",e[e.GAMBIA=157]="GAMBIA",e[e.GIBRALTAR=158]="GIBRALTAR",e[e.GREENLAND=159]="GREENLAND",e[e.GRENADA=160]="GRENADA",e[e.GUADELOUPE=161]="GUADELOUPE",e[e.GUAM=162]="GUAM",e[e.GUINEA=163]="GUINEA",e[e.GUINEA_BISSAU=164]="GUINEA_BISSAU",e[e.GUYANA=165]="GUYANA",e[e.HEARD_ISLAND_AND_MCDONALD_ISLANDS=166]="HEARD_ISLAND_AND_MCDONALD_ISLANDS",e[e.IRAN=167]="IRAN",e[e.IRAQ=168]="IRAQ",e[e.ISLE_OF_MAN=169]="ISLE_OF_MAN",e[e.IVORY_COAST=170]="IVORY_COAST",e[e.JAMAICA=171]="JAMAICA",e[e.KIRIBATI=172]="KIRIBATI",e[e.KYRGYZSTAN=173]="KYRGYZSTAN",e[e.LAOS=174]="LAOS",e[e.LEBANON=175]="LEBANON",e[e.LESOTHO=176]="LESOTHO",e[e.LIBERIA=177]="LIBERIA",e[e.LIBYA=178]="LIBYA",e[e.LIECHTENSTEIN=179]="LIECHTENSTEIN",e[e.MACAU=180]="MACAU",e[e.MADAGASCAR=181]="MADAGASCAR",e[e.MALAWI=182]="MALAWI",e[e.MALI=183]="MALI",e[e.MARSHALL_ISLANDS=184]="MARSHALL_ISLANDS",e[e.MARTINIQUE=185]="MARTINIQUE",e[e.MAURITANIA=186]="MAURITANIA",e[e.MAYOTTE=187]="MAYOTTE",e[e.MOLDOVA=188]="MOLDOVA",e[e.MONACO=189]="MONACO",e[e.MONGOLIA=190]="MONGOLIA",e[e.MONTSERRAT=191]="MONTSERRAT",e[e.MOZAMBIQUE=192]="MOZAMBIQUE",e[e.MYANMAR=193]="MYANMAR",e[e.NAMIBIA=194]="NAMIBIA",e[e.NAURU=195]="NAURU",e[e.NEPAL=196]="NEPAL",e[e.NEW_CALEDONIA=197]="NEW_CALEDONIA",e[e.NIGER=198]="NIGER",e[e.NIUE=199]="NIUE",e[e.NORFOLK_ISLAND=200]="NORFOLK_ISLAND",e[e.NORTHERN_CYPRUS=201]="NORTHERN_CYPRUS",e[e.NORTHERN_MARIANA_ISLANDS=202]="NORTHERN_MARIANA_ISLANDS",e[e.NORTH_KOREA=203]="NORTH_KOREA",e[e.NORTH_MACEDONIA=204]="NORTH_MACEDONIA",e[e.PALAU=205]="PALAU",e[e.PALESTINE=206]="PALESTINE",e[e.PAPUA_NEW_GUINEA=207]="PAPUA_NEW_GUINEA",e[e.PITCAIRN=208]="PITCAIRN",e[e.REUNION=209]="REUNION",e[e.RWANDA=210]="RWANDA",e[e.SAINT_BARTHELEMY=211]="SAINT_BARTHELEMY",e[e.SAINT_HELENA_ASCENSION_AND_TRISTIAN_DA_CUNHA=212]="SAINT_HELENA_ASCENSION_AND_TRISTIAN_DA_CUNHA",e[e.SAINT_KITTS_AND_NEVIS=213]="SAINT_KITTS_AND_NEVIS",e[e.SAINT_LUCIA=214]="SAINT_LUCIA",e[e.SAINT_MARTIN=215]="SAINT_MARTIN",e[e.SAINT_PIERRE_AND_MIQUELON=216]="SAINT_PIERRE_AND_MIQUELON",e[e.SAINT_VINCENT_AND_THE_GRENADINES=217]="SAINT_VINCENT_AND_THE_GRENADINES",e[e.SAMOA=218]="SAMOA",e[e.SAN_MARINO=219]="SAN_MARINO",e[e.SAO_TOME_AND_PRINCIPE=220]="SAO_TOME_AND_PRINCIPE",e[e.SENEGAL=221]="SENEGAL",e[e.SEYCHELLES=222]="SEYCHELLES",e[e.SIERRA_LEONE=223]="SIERRA_LEONE",e[e.SINT_MAARTEN=224]="SINT_MAARTEN",e[e.SOLOMON_ISLANDS=225]="SOLOMON_ISLANDS",e[e.SOMALIA=226]="SOMALIA",e[e.SOUTH_GEORGIA_AND_THE_SOUTH_SANDWICH_ISLANDS=227]="SOUTH_GEORGIA_AND_THE_SOUTH_SANDWICH_ISLANDS",e[e.SOUTH_SUDAN=228]="SOUTH_SUDAN",e[e.SUDAN=229]="SUDAN",e[e.SURINAME=230]="SURINAME",e[e.SVALBARD_AND_JAN_MAYEN=231]="SVALBARD_AND_JAN_MAYEN",e[e.ESWATINI=232]="ESWATINI",e[e.SYRIA=233]="SYRIA",e[e.TAJIKISTAN=234]="TAJIKISTAN",e[e.TANZANIA=235]="TANZANIA",e[e.TOGO=236]="TOGO",e[e.TOKELAU=237]="TOKELAU",e[e.TONGA=238]="TONGA",e[e.TRINIDAD_AND_TOBAGO=239]="TRINIDAD_AND_TOBAGO",e[e.TURKMENISTAN=240]="TURKMENISTAN",e[e.TURKS_AND_CAICOS_ISLANDS=241]="TURKS_AND_CAICOS_ISLANDS",e[e.TUVALU=242]="TUVALU",e[e.UNITED_STATES_MINOR_OUTLYING_ISLANDS=243]="UNITED_STATES_MINOR_OUTLYING_ISLANDS",e[e.UZBEKISTAN=244]="UZBEKISTAN",e[e.VANUATU=245]="VANUATU",e[e.VATICAN_CITY=246]="VATICAN_CITY",e[e.VIRGIN_ISLANDS_BRITISH=247]="VIRGIN_ISLANDS_BRITISH",e[e.VIRGIN_ISLANDS_US=248]="VIRGIN_ISLANDS_US",e[e.WALLIS_AND_FUTUNA=249]="WALLIS_AND_FUTUNA",e[e.WESTERN_SAHARA=250]="WESTERN_SAHARA",e[e.YEMEN=251]="YEMEN",e[e.YUGOSLAVIA=252]="YUGOSLAVIA",e[e.ZAMBIA=253]="ZAMBIA",e[e.ZIMBABWE=254]="ZIMBABWE",e[e.COUNT=255]="COUNT"}(me||(me={})),function(e){e[e.NONE=0]="NONE",e[e.ALABAMA=1]="ALABAMA",e[e.ALASKA=2]="ALASKA",e[e.ALBERTA=3]="ALBERTA",e[e.ARIZONA=4]="ARIZONA",e[e.ARKANSAS=5]="ARKANSAS",e[e.AUSTRALIAN_CAPITAL_TERRITORY=6]="AUSTRALIAN_CAPITAL_TERRITORY",e[e.BRITISH_COLUMBIA=7]="BRITISH_COLUMBIA",e[e.CALIFORNIA=8]="CALIFORNIA",e[e.COLORADO=9]="COLORADO",e[e.CONNECTICUT=10]="CONNECTICUT",e[e.DELAWARE=11]="DELAWARE",e[e.DISTRICT_OF_COLUMBIA=12]="DISTRICT_OF_COLUMBIA",e[e.FLORIDA=13]="FLORIDA",e[e.GEORGIA=14]="GEORGIA",e[e.HAWAII=15]="HAWAII",e[e.IDAHO=16]="IDAHO",e[e.ILLINOIS=17]="ILLINOIS",e[e.INDIANA=18]="INDIANA",e[e.IOWA=19]="IOWA",e[e.KANSAS=20]="KANSAS",e[e.KENTUCKY=21]="KENTUCKY",e[e.LOUISIANA=22]="LOUISIANA",e[e.MAINE=23]="MAINE",e[e.MANITOBA=24]="MANITOBA",e[e.MARYLAND=25]="MARYLAND",e[e.MASSACHUSETTS=26]="MASSACHUSETTS",e[e.MICHIGAN=27]="MICHIGAN",e[e.MINNESOTA=28]="MINNESOTA",e[e.MISSISSIPPI=29]="MISSISSIPPI",e[e.MISSOURI=30]="MISSOURI",e[e.MONTANA=31]="MONTANA",e[e.NEBRASKA=32]="NEBRASKA",e[e.NEVADA=33]="NEVADA",e[e.NEW_BRUNSWICK=34]="NEW_BRUNSWICK",e[e.NEW_HAMPSHIRE=35]="NEW_HAMPSHIRE",e[e.NEW_JERSEY=36]="NEW_JERSEY",e[e.NEW_MEXICO=37]="NEW_MEXICO",e[e.NEW_SOUTH_WALES=38]="NEW_SOUTH_WALES",e[e.NEW_YORK=39]="NEW_YORK",e[e.NORTHERN_TERRITORY=40]="NORTHERN_TERRITORY",e[e.NORTH_CAROLINA=41]="NORTH_CAROLINA",e[e.NORTH_DAKOTA=42]="NORTH_DAKOTA",e[e.NOVA_SCOTIA=43]="NOVA_SCOTIA",e[e.OHIO=44]="OHIO",e[e.OKLAHOMA=45]="OKLAHOMA",e[e.ONTARIO=46]="ONTARIO",e[e.OREGON=47]="OREGON",e[e.PENNSYLVANIA=48]="PENNSYLVANIA",e[e.QUEBEC=49]="QUEBEC",e[e.QUEENSLAND=50]="QUEENSLAND",e[e.RHODE_ISLAND=51]="RHODE_ISLAND",e[e.SASKATCHEWAN=52]="SASKATCHEWAN",e[e.SOUTH_AUSTRALIA=53]="SOUTH_AUSTRALIA",e[e.SOUTH_CAROLINA=54]="SOUTH_CAROLINA",e[e.SOUTH_DAKOTA=55]="SOUTH_DAKOTA",e[e.TASMANIA=56]="TASMANIA",e[e.TENNESSEE=57]="TENNESSEE",e[e.TEXAS=58]="TEXAS",e[e.UTAH=59]="UTAH",e[e.VERMONT=60]="VERMONT",e[e.VICTORIA=61]="VICTORIA",e[e.VIRGINIA=62]="VIRGINIA",e[e.WASHINGTON=63]="WASHINGTON",e[e.WESTERN_AUSTRALIA=64]="WESTERN_AUSTRALIA",e[e.WEST_VIRGINIA=65]="WEST_VIRGINIA",e[e.WISCONSIN=66]="WISCONSIN",e[e.WYOMING=67]="WYOMING",e[e.YUKON=68]="YUKON",e[e.CIUDAD_DE_MEXICO=69]="CIUDAD_DE_MEXICO",e[e.JALISCO=70]="JALISCO",e[e.NEWFOUNDLAND_AND_LABRADOR=71]="NEWFOUNDLAND_AND_LABRADOR",e[e.NUEVO_LEON=72]="NUEVO_LEON",e[e.BAJA_CALIFORNIA=73]="BAJA_CALIFORNIA",e[e.CHIHUAHUA=74]="CHIHUAHUA",e[e.GUANAJUATO=75]="GUANAJUATO",e[e.GUERRERO=76]="GUERRERO",e[e.MEXICO=77]="MEXICO",e[e.MICHOACAN=78]="MICHOACAN",e[e.NEW_YORK_CITY=79]="NEW_YORK_CITY",e[e.TAMAULIPAS=80]="TAMAULIPAS",e[e.VERACRUZ=81]="VERACRUZ",e[e.CHIAPAS=82]="CHIAPAS",e[e.COAHUILA=83]="COAHUILA",e[e.DURANGO=84]="DURANGO",e[e.GUERRERO_COCULA=85]="GUERRERO_COCULA",e[e.GUERRERO_JUCHITAN=86]="GUERRERO_JUCHITAN",e[e.GUERRERO_TEPECOACUILCO=87]="GUERRERO_TEPECOACUILCO",e[e.GUERRERO_TLACOAPA=88]="GUERRERO_TLACOAPA",e[e.GUJARAT=89]="GUJARAT",e[e.HIDALGO=90]="HIDALGO",e[e.KARNATAKA=91]="KARNATAKA",e[e.KERALA=92]="KERALA",e[e.KHYBER_PAKHTUNKHWA=93]="KHYBER_PAKHTUNKHWA",e[e.MADHYA_PRADESH=94]="MADHYA_PRADESH",e[e.MAHARASHTRA=95]="MAHARASHTRA",e[e.MORELOS=96]="MORELOS",e[e.NAYARIT=97]="NAYARIT",e[e.OAXACA=98]="OAXACA",e[e.PUEBLA=99]="PUEBLA",e[e.PUNJAB=100]="PUNJAB",e[e.QUERETARO=101]="QUERETARO",e[e.SAN_LUIS_POTOSI=102]="SAN_LUIS_POTOSI",e[e.SINALOA=103]="SINALOA",e[e.SONORA=104]="SONORA",e[e.TABASCO=105]="TABASCO",e[e.TAMIL_NADU=106]="TAMIL_NADU",e[e.YUCATAN=107]="YUCATAN",e[e.ZACATECAS=108]="ZACATECAS",e[e.AGUASCALIENTES=109]="AGUASCALIENTES",e[e.BAJA_CALIFORNIA_SUR=110]="BAJA_CALIFORNIA_SUR",e[e.CAMPECHE=111]="CAMPECHE",e[e.COLIMA=112]="COLIMA",e[e.QUINTANA_ROO_BENITO_JUAREZ=113]="QUINTANA_ROO_BENITO_JUAREZ",e[e.UINTANA_ROO=114]="UINTANA_ROO",e[e.QUINTANA_ROO_SOLIDARIDAD=115]="QUINTANA_ROO_SOLIDARIDAD",e[e.TLAXCALA=116]="TLAXCALA",e[e.COUNT=117]="COUNT"}(Ie||(Ie={})),function(e){e[e.NONE=0]="NONE",e[e.CONSULAR_ID=1]="CONSULAR_ID",e[e.DL=2]="DL",e[e.DL_PUBLIC_SERVICES_CARD=3]="DL_PUBLIC_SERVICES_CARD",e[e.EMPLOYMENT_PASS=4]="EMPLOYMENT_PASS",e[e.FIN_CARD=5]="FIN_CARD",e[e.ID=6]="ID",e[e.MULTIPURPOSE_ID=7]="MULTIPURPOSE_ID",e[e.MyKad=8]="MyKad",e[e.MyKid=9]="MyKid",e[e.MyPR=10]="MyPR",e[e.MyTentera=11]="MyTentera",e[e.PAN_CARD=12]="PAN_CARD",e[e.PROFESSIONAL_ID=13]="PROFESSIONAL_ID",e[e.PUBLIC_SERVICES_CARD=14]="PUBLIC_SERVICES_CARD",e[e.RESIDENCE_PERMIT=15]="RESIDENCE_PERMIT",e[e.RESIDENT_ID=16]="RESIDENT_ID",e[e.TEMPORARY_RESIDENCE_PERMIT=17]="TEMPORARY_RESIDENCE_PERMIT",e[e.VOTER_ID=18]="VOTER_ID",e[e.WORK_PERMIT=19]="WORK_PERMIT",e[e.iKAD=20]="iKAD",e[e.MILITARY_ID=21]="MILITARY_ID",e[e.MyKAS=22]="MyKAS",e[e.SOCIAL_SECURITY_CARD=23]="SOCIAL_SECURITY_CARD",e[e.HEALTH_INSURANCE_CARD=24]="HEALTH_INSURANCE_CARD",e[e.PASSPORT=25]="PASSPORT",e[e.S_PASS=26]="S_PASS",e[e.ADDRESS_CARD=27]="ADDRESS_CARD",e[e.ALIEN_ID=28]="ALIEN_ID",e[e.ALIEN_PASSPORT=29]="ALIEN_PASSPORT",e[e.GREEN_CARD=30]="GREEN_CARD",e[e.MINORS_ID=31]="MINORS_ID",e[e.POSTAL_ID=32]="POSTAL_ID",e[e.PROFESSIONAL_DL=33]="PROFESSIONAL_DL",e[e.TAX_ID=34]="TAX_ID",e[e.WEAPON_PERMIT=35]="WEAPON_PERMIT",e[e.VISA=36]="VISA",e[e.BORDER_CROSSING_CARD=37]="BORDER_CROSSING_CARD",e[e.DRIVER_CARD=38]="DRIVER_CARD",e[e.GLOBAL_ENTRY_CARD=39]="GLOBAL_ENTRY_CARD",e[e.MyPolis=40]="MyPolis",e[e.NEXUS_CARD=41]="NEXUS_CARD",e[e.PASSPORT_CARD=42]="PASSPORT_CARD",e[e.PROOF_OF_AGE_CARD=43]="PROOF_OF_AGE_CARD",e[e.REFUGEE_ID=44]="REFUGEE_ID",e[e.TRIBAL_ID=45]="TRIBAL_ID",e[e.VETERAN_ID=46]="VETERAN_ID",e[e.CITIZENSHIP_CERTIFICATE=47]="CITIZENSHIP_CERTIFICATE",e[e.MY_NUMBER_CARD=48]="MY_NUMBER_CARD",e[e.COUNT=49]="COUNT"}(Ze||(Ze={})),function(e){e[e.NotAvailable=0]="NotAvailable",e[e.BlackAndWhite=1]="BlackAndWhite",e[e.Color=2]="Color"}(be||(be={})),function(e){e[e.NotAvailable=0]="NotAvailable",e[e.NotDetected=1]="NotDetected",e[e.Detected=2]="Detected"}(Re||(Re={})),function(e){e[e.Success=0]="Success",e[e.DetectionFailed=1]="DetectionFailed",e[e.ImagePreprocessingFailed=2]="ImagePreprocessingFailed",e[e.StabilityTestFailed=3]="StabilityTestFailed",e[e.ScanningWrongSide=4]="ScanningWrongSide",e[e.FieldIdentificationFailed=5]="FieldIdentificationFailed",e[e.MandatoryFieldMissing=6]="MandatoryFieldMissing",e[e.InvalidCharactersFound=7]="InvalidCharactersFound",e[e.ImageReturnFailed=8]="ImageReturnFailed",e[e.BarcodeRecognitionFailed=9]="BarcodeRecognitionFailed",e[e.MrzParsingFailed=10]="MrzParsingFailed",e[e.ClassFiltered=11]="ClassFiltered",e[e.UnsupportedClass=12]="UnsupportedClass",e[e.UnsupportedByLicense=13]="UnsupportedByLicense",e[e.AwaitingOtherSide=14]="AwaitingOtherSide",e[e.Count=15]="Count"}(ue||(ue={})),function(e){e[e.None=0]="None",e[e.MrzId=1]="MrzId",e[e.MrzVisa=2]="MrzVisa",e[e.MrzPassport=3]="MrzPassport",e[e.PhotoId=4]="PhotoId",e[e.FullRecognition=5]="FullRecognition",e[e.BarcodeId=6]="BarcodeId",e[e.Count=7]="Count"}(ge||(ge={})),function(e){e[e.None=0]="None",e[e.AAMVACompliant=1]="AAMVACompliant",e[e.ArgentinaID=2]="ArgentinaID",e[e.ArgentinaAlienID=3]="ArgentinaAlienID",e[e.ArgentinaDL=4]="ArgentinaDL",e[e.ColombiaID=5]="ColombiaID",e[e.ColombiaDL=6]="ColombiaDL",e[e.NigeriaVoterID=7]="NigeriaVoterID",e[e.NigeriaDL=8]="NigeriaDL",e[e.PanamaID=9]="PanamaID",e[e.SouthAfricaID=10]="SouthAfricaID"}(We||(We={}));class Ge{constructor(e){this.__licenseKey="",this.__engineLocation="",this.__mapperToRealConfig(e),this.__glare=!1,this.__detectionStatus=0,this.__quad={topLeft:{x:0,y:0},topRight:{x:0,y:0},bottomLeft:{x:0,y:0},bottomRight:{x:0,y:0}}}async initializeEngine(){try{const e=new Ve(this.__licenseKey);e.engineLocation=this.__engineLocation+"/FPhi.Engine.Microblink",e.allowHelloMessage=!1,this.__sdkInstance=await function(e){return W(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{if(!e||"object"!=typeof e)return void i(new _(j.wasmSettingsMissing));if("string"!=typeof e.licenseKey)return void i(new _(j.licenseKeyMissing));if(!e.wasmModuleName)return void i(new _(j.wasmModuleNameMissing));if("string"!=typeof e.engineLocation)return void i(new _(j.engineLocationInvalid));const l=function(){try{let e=localStorage.getItem("mb-user-id");return null===e&&(e=pe(),localStorage.setItem("mb-user-id",e)),e}catch(e){return pe()}}();try{const a=new Blob([String.raw`!function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function e(e,t,s,n){return new(s||(s=Promise))((function(r,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))}let t=0;class s{constructor(e){this.action=e,this.messageID=function(){const e=t;return t+=1,e}()}}class n extends s{constructor(e,t){super(n.action),this.wasmModuleName=e.wasmModuleName,this.licenseKey=e.licenseKey,this.userId=t,this.registerLoadCallback=null!==e.loadProgressCallback,this.allowHelloMessage=e.allowHelloMessage,this.engineLocation=e.engineLocation,this.wasmType=e.wasmType,this.numberOfWorkers=e.numberOfWorkers}}var r,i;n.action="init",function(e){e[e.Any=0]="Any",e[e.Recognizer=1]="Recognizer",e[e.RecognizerSettings=2]="RecognizerSettings",e[e.Callback=3]="Callback"}(r||(r={}));class o extends s{constructor(e,t){super(o.action),this.funcName=e,this.params=t}}o.action="invokeFunction";class a extends s{constructor(e,t){super(a.action),this.className=e,this.params=t}}a.action="createNewNativeObject";class c extends s{constructor(e,t,s){super(c.action),this.recognizerHandles=e,this.allowMultipleResults=t,this.registeredMetadataCallbacks=s}}c.action="createRecognizerRunner";class E extends s{constructor(e,t){super(E.action),this.recognizerHandles=e,this.allowMultipleResults=t}}E.action="reconfigureRecognizerRunner";class R extends s{constructor(){super(R.action)}}R.action="deleteRecognizerRunner";class l extends s{constructor(e,t,s){super(l.action),this.objectHandle=e,this.methodName=t,this.params=s}}l.action="invokeObject";class _ extends s{constructor(e){super(_.action),this.frame=e}getTransferrables(){return[this.frame.imageData.data.buffer]}}_.action="processImage";class u extends s{constructor(e){super(u.action),this.hardReset=e}}u.action="resetRecognizers";class I extends s{constructor(e){super(I.action),this.registeredMetadataCallbacks=e}}I.action="registerMetadataCallbacks";class d extends s{constructor(e){super(d.action),this.detectionOnlyMode=e}}d.action="setDetectionOnly";class N extends s{constructor(e){super(N.action),this.callbackNonEmpty=e}}N.action="setClearTimeoutCallback";class O extends s{constructor(e){super(O.action),this.cameraPreviewMirrored=e}}O.action="setCameraPreviewMirrored";class h extends s{constructor(e){super(h.action),this.userId=e}}h.action="getProductIntegrationInfo";class S{constructor(e,t,s){this.success=!0,this.error=null,this.messageID=e,this.success=t,this.error=s}}class g{constructor(e,t,s,n){this.success=!0,this.showOverlay=!0,this.messageID=e,this.success=t,this.showOverlay=s,this.wasmType=n}}class C extends S{constructor(e,t){super(e,!0,null),this.result=t}}class m extends S{constructor(e,t){super(e,!0,null),this.objectHandle=t}}class A extends S{constructor(e,t){super(e,!0,null),this.recognitionState=t}}class D extends S{constructor(e,t){super(e,!0,null),this.result=t}}class f{constructor(e){this.isLoadProgressMessage=!0,this.progress=e}}!function(e){e[e.onDebugText=0]="onDebugText",e[e.onDetectionFailed=1]="onDetectionFailed",e[e.onQuadDetection=2]="onQuadDetection",e[e.onPointsDetection=3]="onPointsDetection",e[e.onFirstSideResult=4]="onFirstSideResult",e[e.clearTimeoutCallback=5]="clearTimeoutCallback",e[e.onGlare=6]="onGlare",e[e.recognizerCallback=7]="recognizerCallback"}(i||(i={}));class M{constructor(e,t){this.isCallbackMessage=!0,this.callbackType=e,this.callbackParameters=t}}function T(e,t){return t=t||"",""===(e=e||"")?t:e.endsWith("/")?t.startsWith("/")?e+t.substring(1):e+t:t.startsWith("/")?e+t:e+"/"+t}var p,L,w;function y(t){return e(this,void 0,void 0,(function*(){const e=yield(async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,3,1,0,1,10,14,1,12,0,65,0,65,0,65,0,252,10,0,0,11])))(),s=yield(async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,12,1,10,0,67,0,0,0,0,252,0,26,11])))(),n=yield(async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,65,0,192,26,11])))(),r=yield(async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])))(),i=yield(async e=>{try{return"undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(e)}catch(e){return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]));if(!(e&&s&&n&&r))return p.Basic;if(!i)return p.Advanced;try{return new Worker(t+"/Worker.test.js").terminate(),p.AdvancedWithThreads}catch(e){return p.Advanced}}))}!function(e){e.Basic="BASIC",e.Advanced="ADVANCED",e.AdvancedWithThreads="ADVANCED_WITH_THREADS"}(p||(p={}));class U{constructor(e,t){if(!e.code||!e.message)throw Error("Instance of SDKError is required to have code and message.");this.message=e.message,this.code=e.code,this.details=t}}!function(e){e.WORKER_WASM_LOAD_FAILURE="WORKER_WASM_LOAD_FAILURE",e.WORKER_WASM_INIT_MISSING="WORKER_WASM_INIT_MISSING",e.WORKER_FUNCTION_INVOKE_FAILURE="WORKER_FUNCTION_INVOKE_FAILURE",e.WORKER_RECOGNIZER_CREATION_FAILURE="WORKER_RECOGNIZER_CREATION_FAILURE",e.WORKER_RUNNER_EXISTS="WORKER_RUNNER_EXISTS",e.WORKER_RUNNER_CREATION_FAILURE="WORKER_RUNNER_CREATION_FAILURE",e.WORKER_RUNNER_MISSING="WORKER_RUNNER_MISSING",e.WORKER_RUNNER_RECONFIGURE_FAILURE="WORKER_RUNNER_RECONFIGURE_FAILURE",e.WORKER_RUNNER_DELETED="WORKER_RUNNER_DELETED",e.WORKER_RUNNER_DELETE_FAILURE="WORKER_RUNNER_DELETE_FAILURE",e.WORKER_OBJECT_INVOKE_FAILURE="WORKER_OBJECT_INVOKE_FAILURE",e.WORKER_IMAGE_PROCESS_FAILURE="WORKER_IMAGE_PROCESS_FAILURE",e.WORKER_HANDLE_UNDEFINED="WORKER_HANDLE_UNDEFINED",e.WORKER_MESSAGE_ACTION_UNKNOWN="WORKER_MESSAGE_ACTION_UNKNOWN",e.WORKER_LICENSE_UNLOCK_ERROR="WORKER_LICENSE_UNLOCK_ERROR",e.WORKER_INTEGRATION_INFO_FAILURE="WORKER_INTEGRATION_INFO_FAILURE",e.LOCAL_SDK_RUNNER_MISSING="LOCAL_SDK_RUNNER_MISSING",e.LOCAL_SDK_RUNNER_EMPTY="LOCAL_SDK_RUNNER_EMPTY",e.LICENSE_UNLOCK_ERROR="LICENSE_UNLOCK_ERROR",e.FRAME_CAPTURE_SVG_UNSUPPORTED="FRAME_CAPTURE_SVG_UNSUPPORTED",e.FRAME_CAPTURE_CANVAS_MISSING="FRAME_CAPTURE_CANVAS_MISSING",e.SDK_WASM_SETTINGS_MISSING="SDK_WASM_SETTINGS_MISSING",e.SDK_LICENSE_KEY_MISSING="SDK_LICENSE_KEY_MISSING",e.SDK_WASM_MODULE_NAME_MISSING="SDK_WASM_MODULE_NAME_MISSING",e.SDK_ENGINE_LOCATION_INVALID="SDK_ENGINE_LOCATION_INVALID",e.SDK_MISSING="SDK_MISSING",e.SDK_RECOGNIZERS_MISSING="SDK_RECOGNIZERS_MISSING",e.VIDEO_RECOGNIZER_ELEMENT_MISSING="VIDEO_RECOGNIZER_ELEMENT_MISSING",e.VIDEO_RECOGNIZER_CAMERA_MISSING="VIDEO_RECOGNIZER_CAMERA_MISSING",e.VIDEO_RECOGNIZER_CAMERA_NOT_ALLOWED="VIDEO_RECOGNIZER_CAMERA_NOT_ALLOWED",e.VIDEO_RECOGNIZER_CAMERA_UNAVAILABLE="VIDEO_RECOGNIZER_CAMERA_UNAVAILABLE",e.VIDEO_RECOGNIZER_CAMERA_IN_USE="VIDEO_RECOGNIZER_CAMERA_IN_USE",e.VIDEO_RECOGNIZER_MEDIA_DEVICES_UNSUPPORTED="VIDEO_RECOGNIZER_MEDIA_DEVICES_UNSUPPORTED",e.VIDEO_RECOGNIZER_FEED_RELEASED="VIDEO_RECOGNIZER_FEED_RELEASED",e.VIDEO_RECOGNIZER_FEED_NOT_PAUSED="VIDEO_RECOGNIZER_FEED_NOT_PAUSED",e.VIDEO_RECOGNIZER_PLAY_REQUEST_INTERRUPTED="VIDEO_RECOGNIZER_PLAY_REQUEST_INTERRUPTED",e.VIDEO_RECOGNIZER_FEED_PAUSED="VIDEO_RECOGNIZER_FEED_PAUSED",e.VIDEO_RECOGNIZER_RECOGNIZERS_RESET_FAILURE="VIDEO_RECOGNIZER_RECOGNIZERS_RESET_FAILURE",e.VIDEO_RECOGNIZER_FEED_MISSING="VIDEO_RECOGNIZER_FEED_MISSING"}(L||(L={})),function(e){e.WORKER_HANDLE_UNDEFINED="Cannot find object with handle: undefined",e.WORKER_WASM_LOAD_FAILURE="Failed to load WASM in web worker!",e.WORKER_WASM_INIT_MISSING="WASM module is not initialized!",e.WORKER_FUNCTION_INVOKE_FAILURE="Failed to invoke function!",e.WORKER_RECOGNIZER_CREATION_FAILURE="Failed to create new recognizer!",e.WORKER_RUNNER_EXISTS="Recognizer runner is already created! Multiple instances are not allowed!",e.WORKER_RUNNER_CREATION_FAILURE="Failed to create new recognizer runner!",e.WORKER_RUNNER_MISSING="Recognizer runner is not created! There is nothing to reconfigure!",e.WORKER_RUNNER_RECONFIGURE_FAILURE="Failed to reconfigure recognizer runner!",e.WORKER_RUNNER_DELETED="Recognizer runner is already deleted!",e.WORKER_RUNNER_DELETE_FAILURE="Failed to delete recognizer runner!",e.WORKER_OBJECT_INVOKE_FAILURE="Failed to invoke object!",e.WORKER_IMAGE_PROCESS_FAILURE="Recognizer runner is not initialized! Cannot process image!",e.WORKER_INTEGRATION_INFO_FAILURE="Failed to get product integration info!",e.LOCAL_SDK_RUNNER_MISSING="Property nativeRecognizerRunner is not available!",e.LOCAL_SDK_RUNNER_EMPTY="Native RecognizerRunner cannot be empty!",e.LICENSE_TOKEN_STATE_INCORRECT="Internal error (Incorrect token state)",e.LICENSE_PAYLOAD_VERIFICATION_FAILED="Failed to verify server permission's digital signature!",e.LICENSE_PAYLOAD_CORRUPTED="Server permission payload is corrupted!",e.LICENSE_PERMISSION_EXPIRED="Internal error (server permission expired)",e.LICENSE_REMOTE_LOCKED="Provided license key has been remotely locked. Please contact support for more information!",e.FRAME_CAPTURE_SVG_UNSUPPORTED="Recognition of SVG elements not supported!",e.FRAME_CAPTURE_CANVAS_MISSING="Could not get canvas 2d context!",e.SDK_WASM_SETTINGS_MISSING="Missing WASM load settings!",e.SDK_LICENSE_KEY_MISSING="Missing license key!",e.SDK_WASM_MODULE_NAME_MISSING="Missing WASM module name!",e.SDK_ENGINE_LOCATION_INVALID="Setting property 'engineLocation' must be a string!",e.SDK_MISSING="SDK is not provided!",e.SDK_RECOGNIZERS_MISSING="To create RecognizerRunner at least 1 recognizer is required.",e.VIDEO_RECOGNIZER_ELEMENT_MISSING="Video element, i.e. camera feed is not provided!",e.VIDEO_RECOGNIZER_CAMERA_MISSING="Camera not found!",e.VIDEO_RECOGNIZER_CAMERA_NOT_ALLOWED="Camera not allowed!",e.VIDEO_RECOGNIZER_CAMERA_UNAVAILABLE="Camera not available!",e.VIDEO_RECOGNIZER_CAMERA_IN_USE="Camera in use!",e.VIDEO_RECOGNIZER_MEDIA_DEVICES_UNSUPPORTED="Media devices not supported by browser.",e.VIDEO_RECOGNIZER_FEED_RELEASED="The associated video feed has been released!",e.VIDEO_RECOGNIZER_FEED_NOT_PAUSED="The associated video feed is not paused. Use resumeRecognition instead!",e.VIDEO_RECOGNIZER_PLAY_REQUEST_INTERRUPTED="The play() request was interrupted or prevented by browser security rules!",e.VIDEO_RECOGNIZER_FEED_PAUSED="Cannot resume recognition while video feed is paused! Use recognize or startRecognition",e.VIDEO_RECOGNIZER_RECOGNIZERS_RESET_FAILURE="Could not reset recognizers!",e.VIDEO_RECOGNIZER_FEED_MISSING="Missing video feed!"}(w||(w={}));const F={licenseTokenStateIncorrect:{code:L.LICENSE_UNLOCK_ERROR,message:w.LICENSE_TOKEN_STATE_INCORRECT},licensePayloadVerificationFailed:{code:L.LICENSE_UNLOCK_ERROR,message:w.LICENSE_PAYLOAD_VERIFICATION_FAILED},licensePayloadCorrupted:{code:L.LICENSE_UNLOCK_ERROR,message:w.LICENSE_PAYLOAD_CORRUPTED},licensePermissionExpired:{code:L.LICENSE_UNLOCK_ERROR,message:w.LICENSE_PERMISSION_EXPIRED},licenseRemoteLocked:{code:L.LICENSE_UNLOCK_ERROR,message:w.LICENSE_REMOTE_LOCKED},licenseNetworkError:{code:L.LICENSE_UNLOCK_ERROR},licenseInvalid:{code:L.LICENSE_UNLOCK_ERROR}},b={imageProcessFailure:{message:w.WORKER_IMAGE_PROCESS_FAILURE,code:L.WORKER_IMAGE_PROCESS_FAILURE},objectInvokeFailure:{message:w.WORKER_OBJECT_INVOKE_FAILURE,code:L.WORKER_OBJECT_INVOKE_FAILURE},runnerDeleteFailure:{message:w.WORKER_RUNNER_DELETE_FAILURE,code:L.WORKER_RUNNER_DELETE_FAILURE},runnerDeleted:{message:w.WORKER_RUNNER_DELETED,code:L.WORKER_RUNNER_DELETED},runnerReconfigureFailure:{message:w.WORKER_RUNNER_RECONFIGURE_FAILURE,code:L.WORKER_RUNNER_RECONFIGURE_FAILURE},runnerMissing:{message:w.WORKER_RUNNER_MISSING,code:L.WORKER_RUNNER_MISSING},runnerCreationFailure:{message:w.WORKER_RUNNER_CREATION_FAILURE,code:L.WORKER_RUNNER_CREATION_FAILURE},runnerExists:{message:w.WORKER_RUNNER_EXISTS,code:L.WORKER_RUNNER_EXISTS},recognizerCreationFailure:{message:w.WORKER_RECOGNIZER_CREATION_FAILURE,code:L.WORKER_RECOGNIZER_CREATION_FAILURE},functionInvokeFailure:{message:w.WORKER_FUNCTION_INVOKE_FAILURE,code:L.WORKER_FUNCTION_INVOKE_FAILURE},wasmInitMissing:{message:w.WORKER_WASM_INIT_MISSING,code:L.WORKER_WASM_INIT_MISSING},wasmLoadFailure:{message:w.WORKER_WASM_LOAD_FAILURE,code:L.WORKER_WASM_LOAD_FAILURE},handleUndefined:{message:w.WORKER_HANDLE_UNDEFINED,code:L.WORKER_HANDLE_UNDEFINED},integrationInfoFailure:{message:w.WORKER_INTEGRATION_INFO_FAILURE,code:L.WORKER_INTEGRATION_INFO_FAILURE}};var k,K;!function(e){e[e.Invalid=0]="Invalid",e[e.RequiresServerPermission=1]="RequiresServerPermission",e[e.Valid=2]="Valid"}(k||(k={})),function(e){e.LicenseTokenStateInvalid="LICENSE_TOKEN_STATE_INVALID",e.NetworkError="NETWORK_ERROR",e.RemoteLock="REMOTE_LOCK",e.PermissionExpired="PERMISSION_EXPIRED",e.PayloadCorrupted="PAYLOAD_CORRUPTED",e.PayloadSignatureVerificationFailed="PAYLOAD_SIGNATURE_VERIFICATION_FAILED",e.IncorrectTokenState="INCORRECT_TOKEN_STATE"}(K||(K={}));function v(e){return{licenseId:e.licenseId,licensee:e.licensee,packageName:e.packageName,platform:"Browser",sdkName:e.sdkName,sdkVersion:e.sdkVersion}}var P;function W(t,s){return e(this,void 0,void 0,(function*(){try{const e=yield fetch("https://baltazar.microblink.com/api/v1/status/check",{method:"POST",headers:{"Content-Type":"application/json"},cache:"no-cache",body:JSON.stringify(v(t))});if(e.ok){const t=""+(yield e.text());return s.submitServerPermission(t)}return{status:P.NetworkError,lease:0,networkErrorDescription:"Server responded with status "+e.status}}catch(e){return{status:P.NetworkError,lease:0,networkErrorDescription:"Unexpected error: "+JSON.stringify(e)}}}))}function G(e){return e===p.AdvancedWithThreads}!function(e){e[e.Ok=0]="Ok",e[e.NetworkError=1]="NetworkError",e[e.RemoteLock=2]="RemoteLock",e[e.PermissionExpired=3]="PermissionExpired",e[e.PayloadCorrupted=4]="PayloadCorrupted",e[e.PayloadSignatureVerificationFailed=5]="PayloadSignatureVerificationFailed",e[e.IncorrectTokenState=6]="IncorrectTokenState"}(P||(P={}));new class{constructor(){this.context=self,this.wasmModule=null,this.nativeRecognizerRunner=null,this.objects={},this.nextObjectHandle=0,this.metadataCallbacks={},this.clearTimeoutCallback=null,this.context.onmessage=e=>{const t=e.data;switch(t.action){case n.action:this.processInitMessage(t);break;case o.action:this.processInvokeFunction(t);break;case a.action:this.processCreateNewRecognizer(t);break;case l.action:this.processInvokeObject(t);break;case c.action:this.processCreateRecognizerRunner(t);break;case E.action:this.processReconfigureRecognizerRunner(t);break;case R.action:this.processDeleteRecognizerRunner(t);break;case _.action:this.processImage(t);break;case u.action:this.resetRecognizers(t);break;case d.action:this.setDetectionOnly(t);break;case O.action:this.setCameraPreviewMirrored(t);break;case I.action:this.registerMetadataCallbacks(t);break;case N.action:this.registerClearTimeoutCallback(t);break;case h.action:this.processGetProductIntegrationInfo(t);break;default:throw new U({code:L.WORKER_MESSAGE_ACTION_UNKNOWN,message:"Unknown message action: "+JSON.stringify(t.action)})}}}getNextObjectHandle(){const e=this.nextObjectHandle;return this.nextObjectHandle=this.nextObjectHandle+1,e}notifyError(e,t){this.context.postMessage(new S(e.messageID,!1,t))}notifySuccess(e){this.context.postMessage(new S(e.messageID,!0,null))}notifyInitSuccess(e,t,s){this.context.postMessage(new g(e.messageID,!0,t,s))}unwrapParameters(e){const t=[];for(const s of e.params){let n=s.parameter;s.type===r.Recognizer?(n=this.objects[n],void 0===n&&this.notifyError(e,new U(b.handleUndefined))):s.type===r.RecognizerSettings&&(n=this.restoreFunctions(n)),t.push(n)}return t}restoreFunctions(e){const t=Object.keys(e);for(const s of t){const t=e[s];"object"==typeof t&&null!==t&&"parameter"in t&&"type"in t&&t.type===r.Callback&&(e[s]=(...e)=>{const s=new M(i.recognizerCallback,[t.parameter].concat(e));this.context.postMessage(s)})}return e}scanForTransferrables(e){if("object"==typeof e){const t=Object.keys(e),s=[];for(const n of t){const t=e[n];t instanceof ImageData?s.push(t.data.buffer):t instanceof Uint8Array?s.push(t.buffer):null!==t&&"object"==typeof t&&s.push(...this.scanForTransferrables(t))}return s}return[]}registerHeartBeat(e){this.unregisterHeartBeat(),this.lease=e;let t=e-Math.floor(Date.now()/1e3);t>120?t-=120:t/=2,this.inFlightHeartBeatTimeoutId=setTimeout((()=>{this.obtainNewServerPermission(!0)}),1e3*t)}unregisterHeartBeat(){this.lease&&delete this.lease,this.inFlightHeartBeatTimeoutId&&(clearTimeout(this.inFlightHeartBeatTimeoutId),delete this.inFlightHeartBeatTimeoutId)}obtainNewServerPermission(t){return e(this,void 0,void 0,(function*(){if(this.wasmModule){const e=this.wasmModule.getActiveLicenseTokenInfo(),s=yield W(e,this.wasmModule);switch(s.status){case P.Ok:case P.RemoteLock:this.registerHeartBeat(s.lease);break;case P.NetworkError:case P.PayloadSignatureVerificationFailed:case P.PayloadCorrupted:t?(console.warn("Problem with obtaining server permission. Will attempt in 10 seconds "+P[s.status]),this.inFlightHeartBeatTimeoutId=setTimeout((()=>{this.obtainNewServerPermission(!1)}),1e4)):console.error("Problem with obtaining server permission. "+P[s.status]);break;case P.IncorrectTokenState:case P.PermissionExpired:console.error("Internal error: "+P[s.status])}return s.status}return console.error("Internal inconsistency! Wasm module not initialized where it's expected to be!"),P.IncorrectTokenState}))}willSoonExpire(){if(this.lease){if(this.wasmModule.getActiveLicenseTokenInfo().unlockResult===k.Valid){const e=Math.floor(Date.now()/1e3);return 30>this.lease-e}return!0}return!1}calculateWasmType(t){return e(this,void 0,void 0,(function*(){return null!==t.wasmType?t.wasmType:yield y(t.engineLocation)}))}calculateEngineLocationPrefix(e,t){const s=T(""===e.engineLocation?self.location.origin:e.engineLocation,function(e){switch(e){case p.AdvancedWithThreads:return"advanced-threads";case p.Advanced:return"advanced";case p.Basic:return"basic"}}(t));return e.allowHelloMessage&&console.log("Engine location prefix is:",s),s}processInitMessage(t){return e(this,void 0,void 0,(function*(){const s=yield this.calculateWasmType(t),n=this.calculateEngineLocationPrefix(t,s);let r={locateFile:e=>T(n,e)};t.registerLoadCallback&&(r=Object.assign(r,{setStatus:e=>{const t=new f(function(e){if("Running..."===e)return 100;if(0===e.length)return 0;const t=/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/.exec(e);if(t)return 100*parseInt(t[2])/parseInt(t[4]);return NaN}(e));this.context.postMessage(t)}}));try{const i=T(n,t.wasmModuleName+".js");G(s)&&(r=function(e,t,s){return t&&t>0&&(e=Object.assign(e,{allowedThreads:t})),null!==s&&(e=Object.assign(e,{mainScriptUrlOrBlob:s})),e}(r,t.numberOfWorkers,i)),importScripts(i);(0,self[t.wasmModuleName])(r).then((n=>e(this,void 0,void 0,(function*(){G(s)&&(t.allowHelloMessage&&console.log("Waiting for thread workers to boot..."),yield function(t){return e(this,void 0,void 0,(function*(){t.threadWorkersReadyPromise&&(yield t.threadWorkersReadyPromise)}))}(n));const r=yield function(t,s,n,r){return e(this,void 0,void 0,(function*(){const e=r.initializeWithLicenseKey(t,n,s);switch(e.unlockResult){case k.Invalid:return{error:new U(Object.assign(Object.assign({},F.licenseInvalid),{message:e.licenseError}),{type:K.LicenseTokenStateInvalid})};case k.Valid:return{error:null,showOverlay:(i=e.isTrial,o=e.allowRemoveDemoOverlay,a=e.allowRemoveProductionOverlay,!(i&&o||!i&&a))};case k.RequiresServerPermission:{const t=yield W(e,r);switch(t.status){case P.Ok:return{error:null,lease:t.lease};case P.NetworkError:{let e="";return t.networkErrorDescription&&(e=" "+t.networkErrorDescription),{error:new U(Object.assign(Object.assign({},F.licenseNetworkError),{message:"There has been a network error while obtaining the server permission!"+e}),{type:K.NetworkError})}}case P.RemoteLock:return{error:new U(F.licenseRemoteLocked,{type:K.RemoteLock}),lease:t.lease};case P.PermissionExpired:return{error:new U(F.licensePermissionExpired,{type:K.PermissionExpired}),lease:t.lease};case P.PayloadCorrupted:return{error:new U(F.licensePayloadCorrupted,{type:K.PayloadCorrupted}),lease:t.lease};case P.PayloadSignatureVerificationFailed:return{error:new U(F.licensePayloadVerificationFailed,{type:K.PayloadSignatureVerificationFailed}),lease:t.lease};case P.IncorrectTokenState:return{error:new U(F.licenseTokenStateIncorrect,{type:K.IncorrectTokenState}),lease:t.lease}}}}var i,o,a}))}(t.licenseKey,t.allowHelloMessage,t.userId,n);null===r.error?(this.wasmModule=n,r.lease?this.registerHeartBeat(r.lease):this.unregisterHeartBeat(),this.notifyInitSuccess(t,!!r.showOverlay,s)):this.notifyError(t,r.error)}))),(e=>{this.notifyError(t,new U(b.wasmLoadFailure,e))}))}catch(e){this.notifyError(t,new U(b.wasmLoadFailure,e))}}))}processInvokeFunction(e){if(null===this.wasmModule)return void this.notifyError(e,new U(b.wasmInitMissing));const t=e.funcName,s=this.unwrapParameters(e);try{const n=this.wasmModule[t](...s);this.context.postMessage(new C(e.messageID,n))}catch(t){this.notifyError(e,new U(b.functionInvokeFailure,t))}}processCreateNewRecognizer(e){if(null===this.wasmModule)return void this.notifyError(e,new U(b.wasmInitMissing));const t=e.className,s=this.unwrapParameters(e);try{const n=new this.wasmModule[t](...s),r=this.getNextObjectHandle();this.objects[r]=n,this.context.postMessage(new m(e.messageID,r))}catch(t){this.notifyError(e,new U(b.recognizerCreationFailure,t))}}getRecognizers(e){const t=[];for(const s of e){t.push(this.objects[s])}return t}processCreateRecognizerRunner(t){return e(this,void 0,void 0,(function*(){if(null===this.wasmModule)this.notifyError(t,new U(b.wasmInitMissing));else if(null!==this.nativeRecognizerRunner)this.notifyError(t,new U(b.runnerExists));else{this.setupMetadataCallbacks(t.registeredMetadataCallbacks);try{if(this.willSoonExpire()){const e=yield this.obtainNewServerPermission(!1);if(e!==P.Ok){const s=P[e];return void this.notifyError(t,new U({code:L.WORKER_LICENSE_UNLOCK_ERROR,message:"Cannot initialize recognizers because of invalid server permission: \n                                    "+s},{type:K[s]}))}}const e=this.getRecognizers(t.recognizerHandles);this.nativeRecognizerRunner=new this.wasmModule.RecognizerRunner(e,t.allowMultipleResults,this.metadataCallbacks),this.notifySuccess(t)}catch(e){this.notifyError(t,new U(b.runnerCreationFailure,e))}}}))}processReconfigureRecognizerRunner(e){if(null===this.wasmModule)this.notifyError(e,new U(b.wasmInitMissing));else if(null===this.nativeRecognizerRunner)this.notifyError(e,new U(b.runnerMissing));else try{const t=this.getRecognizers(e.recognizerHandles);this.nativeRecognizerRunner.reconfigureRecognizers(t,e.allowMultipleResults),this.notifySuccess(e)}catch(t){this.notifyError(e,new U(b.runnerReconfigureFailure,t))}}processDeleteRecognizerRunner(e){if(null!==this.nativeRecognizerRunner)try{this.nativeRecognizerRunner.delete(),this.nativeRecognizerRunner=null,this.notifySuccess(e)}catch(t){this.notifyError(e,new U(b.runnerDeleteFailure,t))}else this.notifyError(e,new U(b.runnerDeleted))}wrapFunctions(e,t){if("object"!=typeof e)return e;const s=Object.assign({},e),n=Object.keys(s);for(const e of n){if("function"==typeof s[e]){s[e]={parameter:{recognizerHandle:t,callbackName:e},type:r.Callback}}}return s}processInvokeObject(e){try{const t=e.objectHandle,s=e.methodName,n=this.unwrapParameters(e),r=this.objects[t];if(void 0===r)this.notifyError(e,new U({message:"Cannot find object with handle: "+t,code:L.WORKER_HANDLE_UNDEFINED}));else{const i=this.wrapFunctions(r[s](...n),t),o=this.scanForTransferrables(i);"delete"===s&&delete this.objects[t],this.context.postMessage(new C(e.messageID,i),o)}}catch(t){this.notifyError(e,new U(b.objectInvokeFailure,t))}}processImage(e){if(null!==this.nativeRecognizerRunner)try{const t=this.nativeRecognizerRunner.processImage(e.frame);this.context.postMessage(new A(e.messageID,t))}catch(t){this.notifyError(e,new U(b.imageProcessFailure,t))}else this.notifyError(e,new U(b.imageProcessFailure))}resetRecognizers(e){if(null!==this.nativeRecognizerRunner)try{this.nativeRecognizerRunner.resetRecognizers(e.hardReset),this.notifySuccess(e)}catch(t){this.notifyError(e,new U(b.imageProcessFailure,t))}else this.notifyError(e,new U(b.imageProcessFailure))}setDetectionOnly(e){if(null!==this.nativeRecognizerRunner)try{this.nativeRecognizerRunner.setDetectionOnlyMode(e.detectionOnlyMode),this.notifySuccess(e)}catch(t){this.notifyError(e,new U(b.imageProcessFailure,t))}else this.notifyError(e,new U(b.imageProcessFailure))}setCameraPreviewMirrored(e){if(null!==this.nativeRecognizerRunner)try{this.nativeRecognizerRunner.setCameraPreviewMirrored(e.cameraPreviewMirrored),this.notifySuccess(e)}catch(t){this.notifyError(e,new U(b.imageProcessFailure,t))}else this.notifyError(e,new U(b.imageProcessFailure))}setupMetadataCallbacks(e){e.onDebugText?this.metadataCallbacks.onDebugText=e=>{const t=new M(i.onDebugText,[e]);this.context.postMessage(t)}:delete this.metadataCallbacks.onDebugText,e.onDetectionFailed?this.metadataCallbacks.onDetectionFailed=()=>{const e=new M(i.onDetectionFailed,[]);this.context.postMessage(e)}:delete this.metadataCallbacks.onDetectionFailed,e.onPointsDetection?this.metadataCallbacks.onPointsDetection=e=>{const t=new M(i.onPointsDetection,[e]);this.context.postMessage(t)}:delete this.metadataCallbacks.onPointsDetection,e.onQuadDetection?this.metadataCallbacks.onQuadDetection=e=>{const t=new M(i.onQuadDetection,[e]);this.context.postMessage(t)}:delete this.metadataCallbacks.onQuadDetection,e.onFirstSideResult?this.metadataCallbacks.onFirstSideResult=()=>{const e=new M(i.onFirstSideResult,[]);this.context.postMessage(e)}:delete this.metadataCallbacks.onFirstSideResult,e.onGlare?this.metadataCallbacks.onGlare=e=>{const t=new M(i.onGlare,[e]);this.context.postMessage(t)}:delete this.metadataCallbacks.onGlare}registerMetadataCallbacks(e){if(null!==this.nativeRecognizerRunner){this.setupMetadataCallbacks(e.registeredMetadataCallbacks);try{this.nativeRecognizerRunner.setJSDelegate(this.metadataCallbacks),this.notifySuccess(e)}catch(t){this.notifyError(e,new U(b.imageProcessFailure,t))}}else this.notifyError(e,new U(b.imageProcessFailure))}registerClearTimeoutCallback(e){if(null!==this.nativeRecognizerRunner){this.clearTimeoutCallback=e.callbackNonEmpty?{onClearTimeout:()=>{const e=new M(i.clearTimeoutCallback,[]);this.context.postMessage(e)}}:null;try{this.nativeRecognizerRunner.setClearTimeoutCallback(this.clearTimeoutCallback),this.notifySuccess(e)}catch(t){this.notifyError(e,new U(b.imageProcessFailure,t))}}else this.notifyError(e,new U(b.imageProcessFailure))}processGetProductIntegrationInfo(e){if(null!==this.wasmModule)try{const t=this.wasmModule.getActiveLicenseTokenInfo(),s={userId:e.userId,licenseId:t.licenseId,licensee:t.licensee,productName:t.sdkName,productVersion:t.sdkVersion,platform:"Browser",device:self.navigator.userAgent,packageName:t.packageName};this.context.postMessage(new D(e.messageID,s))}catch(t){this.notifyError(e,new U(b.objectInvokeFailure,t))}else this.notifyError(e,new U(b.wasmInitMissing))}}}();
`],{type:"application/javascript"}),n=URL.createObjectURL(a),s=new Worker(n);P.createWasmWorker(s,e,l).then((e=>{t(e)}),i)}catch(t){i(t)}}))}))}(e),this.__sdkRecognizer=await function(e){return W(this,void 0,void 0,(function*(){return e.mbWasmModule.newRecognizer("BlinkIdCombinedRecognizer")}))}(this.__sdkInstance),this.__sdkSettings=await this.__sdkRecognizer.currentSettings(),this.__sdkSettings.returnFullDocumentImage=!0,this.__sdkSettings.saveCameraFrames=!0,this.__sdkSettings.fullDocumentImageDpi=400,this.__sdkSettings.returnFaceImage=!0,this.__sdkSettings.faceImageDpi=400,this.__sdkSettings.returnSignatureImage=!0,this.__sdkSettings.signatureImageDpi=400,this.__sdkSettings.anonymizationMode=oe.FullResult,await this.__sdkRecognizer.updateSettings(this.__sdkSettings);const t={onQuadDetection:e=>{this.__detectionStatus=e.detectionStatus,this.__quad={topLeft:e.topLeft,topRight:e.topRight,bottomLeft:e.bottomLeft,bottomRight:e.bottomRight}},onGlare:e=>{this.__glare=e}};this.__sdkRunnerRecognizer=await function(e,t,i=!1,l={}){return W(this,void 0,void 0,(function*(){if("object"!=typeof e)throw new _(j.missing);if("object"!=typeof t||1>t.length)throw new _(j.recognizersMissing);return e.mbWasmModule.createRecognizerRunner(t,i,l)}))}(this.__sdkInstance,[this.__sdkRecognizer],!1,t)}catch(e){throw new Error("Fail to initialize the engine!")}}async detectImage(e,t){const i=function(e){let t,i,l=!1;if(e instanceof HTMLVideoElement)t=e.videoWidth,i=e.videoHeight,l=!0;else if(e instanceof HTMLImageElement)t=e.naturalWidth,i=e.naturalHeight;else{if(e instanceof SVGImageElement)throw new _(Q.svgUnsupported);t=e.width,i=e.height}te=te||document.createElement("canvas"),te.width=t,te.height=i;const a=te.getContext("2d");if(!a)throw new _(Q.canvasMissing);a.drawImage(e,0,0,te.width,te.height);const n=a.getImageData(0,0,te.width,te.height);return new ie(n,$.NoRotation,l)}(e),l=await this.__sdkRunnerRecognizer.processImage(i),a=await this.__sdkRecognizer.getResult();let n=this.__generateResultObject(l,a,t),s=0;switch(this.__detectionStatus){case se.Fail:s=1;break;case se.CameraTooHigh:s=3;break;case se.CameraTooNear:s=4;break;case se.DocumentTooCloseToEdge:s=5;break;case se.CameraAtAngle:s=2;break;case se.Partial:s=5}return n.detectionStatus={status:s,quad:this.__quad,glare:this.__glare,internalStatus:a.processingStatus},n}async cleanImageBuffer(){await this.__sdkRunnerRecognizer.resetRecognizers(!0)}async finalizeEngine(){this.__deleteWasmVar(this.__sdkRecognizer,this.__sdkRunnerRecognizer,this.__sdkSettings,this.__sdkInstance)}get __attributes(){return{licenseKey:{type:"string",property:"__licenseKey"},bundlePath:{type:"string",property:"__engineLocation"},imageFormat:{type:"string",property:"__imageFormat"},imageQuality:{type:"number",property:"__imageQuality"}}}get __scanResultType(){return{[ee.Valid]:0,[ee.StageValid]:0,[ee.Uncertain]:1,[ee.Empty]:1}}__mapperToRealConfig(e){for(const[t,i]of Object.entries(e))void 0!==this.__attributes[t]&&(this[this.__attributes[t].property]=i)}__generateResultObject(e,t,i){let l={};return e!==ee.Empty&&this.__validateResultDiagnostic(t.state,i)?(l.diagnostic=this.__scanResultType[t.state],l.simpleModeOutput=0,l.images={backDocument:this.__convertToImageOutput(t.fullDocumentBackImage.rawImage),frontDocument:this.__convertToImageOutput(t.fullDocumentFrontImage.rawImage),faceImage:this.__convertToImageOutput(t.faceImage.rawImage),signatureImage:this.__convertToImageOutput(t.signatureImage.rawImage)},l.imagesRaw={backDocument:t.fullDocumentBackImage.rawImage,frontDocument:t.fullDocumentFrontImage.rawImage,faceImage:t.faceImage.rawImage,signatureImage:t.signatureImage.rawImage},l.imagesFullsize={backDocument:this.__convertToImageOutput(t.backCameraFrame.frame),frontDocument:this.__convertToImageOutput(t.frontCameraFrame.frame),faceImage:this.__convertToImageOutput(t.faceImage.rawImage),signatureImage:this.__convertToImageOutput(t.signatureImage.rawImage)},l.extractionRaw={},l.extractionRaw.mrz={rawData:t.mrz.rawMRZString||null,opt1:t.mrz.opt1||null,opt2:t.mrz.opt2||null,firstName:t.mrz.secondaryID||null,lastName:t.mrz.primaryID||null,documentId:t.mrz.sanitizedOpt1||null,documentNumber:t.mrz.documentNumber||null,documentIssuer:t.mrz.issuer||null,dateOfExpiry:t.mrz.dateOfExpiry.originalString||null,dateOfBirth:t.mrz.dateOfBirth.originalString||null,gender:t.mrz.gender||null,nationality:t.mrz.nationality||null},l.extractionRaw.ocr={firstName:t.frontViz.firstName||null,lastName:t.frontViz.lastName||null,documentId:t.frontViz.personalIdNumber||null,documentNumber:t.frontViz.documentNumber||null,dateOfBirth:t.frontViz.dateOfBirth.originalString||null,dateOfExpiry:t.frontViz.dateOfExpiry.originalString||null,dateOfIssue:t.frontViz.dateOfIssue.originalString||null,gender:t.frontViz.sex||null,nationality:t.frontViz.nationality||null},l.extractionData={firstName:t.firstName||null,lastName:t.lastName.replaceAll("\n"," ")||null,gender:t.sex||null,nationality:t.nationality||null,dateOfBirth:t.dateOfBirth.originalString.replaceAll(" ","/")||null,placeOfBirth:t.placeOfBirth.replaceAll("\n",", ")||null,documentId:t.personalIdNumber||null,documentNumber:t.documentNumber||null,address:t.address.replaceAll("\n",", ")||null,documentCountryIssuer:t.classInfo.isoAlpha3CountryCode,documentType:this.__getDocumentType(t.classInfo.documentType),debug1:t.classInfo.documentType},t.dateOfExpiryPermanent?l.extractionData.dateOfIssue=t.dateOfIssue.originalString.replaceAll(" ","/")||null:l.extractionData.dateOfExpiry=t.dateOfExpiry.originalString.replaceAll(" ","/")||null):l.diagnostic=1,l}__getDocumentType(e){switch(e){case Ze.NONE:return 1;case Ze.ID:return 2;case Ze.PASSPORT_CARD:return 3;case Ze.VISA:return 4;case Ze.GREEN_CARD:return 5;case Ze.DRIVER_CARD:return 6;case Ze.RESIDENT_ID:return 7;case Ze.SOCIAL_SECURITY_CARD:return 8;case Ze.HEALTH_INSURANCE_CARD:return 9;case Ze.TEMPORARY_RESIDENCE_PERMIT:return 10;default:return 0}}__validateResultDiagnostic(t,i){return t===ee.StageValid&&i===e.Mode.Front||t===ee.Valid&&i===e.Mode.Back}__deleteWasmVar(...e){e.forEach((e=>{null!==e&&void 0!==e.delete&&e.delete()}))}__convertToImageOutput(e){if(null!==e){let t=document.createElement("canvas"),i=t.getContext("2d");return t.width=e.width,t.height=e.height,i.putImageData(e,0,0),t.toDataURL(this.__imageFormat,this.__imageQuality)}return null}}class Xe{static __engines={Dummy:g,Microblink:Ge,Facephi:u};static getAvailableEngines(){return Object.keys(Xe.__engines)}static generateInstance(e,t){return new Xe.__engines[e](t)}}let ye=null;class Ce{static worker=null;static getInternalLicenseResolve=null;static preinit=!1;static callGetInternalLicense=!1;static async __checkWorker(e){if(null===Ce.worker){let t=Ce,i=new Worker((null===ye&&(ye=URL.createObjectURL(new Blob([atob("dmFyIGU7Y29uc3QgdD0oZT0idW5kZWZpbmVkIiE9dHlwZW9mIGRvY3VtZW50JiZkb2N1bWVudC5jdXJyZW50U2NyaXB0P2RvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjOnZvaWQgMCxmdW5jdGlvbih0KXt2YXIgcixuLGEsbyxpLHUscyxjLGYsbCxkLHAsaCx5LG0sZyx2Oyh0PXZvaWQgMCE9PSh0PXR8fHt9KT90Ont9KS5yZWFkeT1uZXcgUHJvbWlzZSgoZnVuY3Rpb24oZSx0KXtuPWUsYT10fSkpO3ZhciB3PXt9O2ZvcihvIGluIHQpdC5oYXNPd25Qcm9wZXJ0eShvKSYmKHdbb109dFtvXSk7dmFyIGI9W10sVD0iIjsidW5kZWZpbmVkIiE9dHlwZW9mIGRvY3VtZW50JiZkb2N1bWVudC5jdXJyZW50U2NyaXB0JiYoVD1kb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyYyksZSYmKFQ9ZSksVD0wIT09VC5pbmRleE9mKCJibG9iOiIpP1Quc3Vic3RyKDAsVC5sYXN0SW5kZXhPZigiLyIpKzEpOiIiLHQucHJpbnR8fGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSk7dmFyICQ9dC5wcmludEVycnx8Y29uc29sZS53YXJuLmJpbmQoY29uc29sZSk7Zm9yKG8gaW4gdyl3Lmhhc093blByb3BlcnR5KG8pJiYodFtvXT13W29dKTt3PW51bGwsdC5hcmd1bWVudHMmJihiPXQuYXJndW1lbnRzKSx0LnRoaXNQcm9ncmFtJiZ0LnRoaXNQcm9ncmFtLHQucXVpdCYmdC5xdWl0LHQud2FzbUJpbmFyeSYmKGk9dC53YXNtQmluYXJ5KSx0Lm5vRXhpdFJ1bnRpbWUsIm9iamVjdCIhPXR5cGVvZiBXZWJBc3NlbWJseSYmVigibm8gbmF0aXZlIHdhc20gc3VwcG9ydCBkZXRlY3RlZCIpO3ZhciBfPSExLEM9InVuZGVmaW5lZCIhPXR5cGVvZiBUZXh0RGVjb2Rlcj9uZXcgVGV4dERlY29kZXIoInV0ZjgiKTp2b2lkIDA7ZnVuY3Rpb24gUChlLHQpe3JldHVybiBlP2Z1bmN0aW9uKGUsdCxyKXtmb3IodmFyIG49dCtyLGE9dDtlW2FdJiYhKGE+PW4pOykrK2E7aWYoYS10PjE2JiZlLnN1YmFycmF5JiZDKXJldHVybiBDLmRlY29kZShlLnN1YmFycmF5KHQsYSkpO2Zvcih2YXIgbz0iIjt0PGE7KXt2YXIgaT1lW3QrK107aWYoMTI4Jmkpe3ZhciB1PTYzJmVbdCsrXTtpZigxOTIhPSgyMjQmaSkpe3ZhciBzPTYzJmVbdCsrXTtpZigoaT0yMjQ9PSgyNDAmaSk/KDE1JmkpPDwxMnx1PDw2fHM6KDcmaSk8PDE4fHU8PDEyfHM8PDZ8NjMmZVt0KytdKTw2NTUzNilvKz1TdHJpbmcuZnJvbUNoYXJDb2RlKGkpO2Vsc2V7dmFyIGM9aS02NTUzNjtvKz1TdHJpbmcuZnJvbUNoYXJDb2RlKDU1Mjk2fGM+PjEwLDU2MzIwfDEwMjMmYyl9fWVsc2Ugbys9U3RyaW5nLmZyb21DaGFyQ29kZSgoMzEmaSk8PDZ8dSl9ZWxzZSBvKz1TdHJpbmcuZnJvbUNoYXJDb2RlKGkpfXJldHVybiBvfShjLGUsdCk6IiJ9ZnVuY3Rpb24gRChlLHQscixuKXtpZighKG4+MCkpcmV0dXJuIDA7Zm9yKHZhciBhPXIsbz1yK24tMSxpPTA7aTxlLmxlbmd0aDsrK2kpe3ZhciB1PWUuY2hhckNvZGVBdChpKTtpZih1Pj01NTI5NiYmdTw9NTczNDMmJih1PTY1NTM2KygoMTAyMyZ1KTw8MTApfDEwMjMmZS5jaGFyQ29kZUF0KCsraSkpLHU8PTEyNyl7aWYocj49bylicmVhazt0W3IrK109dX1lbHNlIGlmKHU8PTIwNDcpe2lmKHIrMT49bylicmVhazt0W3IrK109MTkyfHU+PjYsdFtyKytdPTEyOHw2MyZ1fWVsc2UgaWYodTw9NjU1MzUpe2lmKHIrMj49bylicmVhazt0W3IrK109MjI0fHU+PjEyLHRbcisrXT0xMjh8dT4+NiY2Myx0W3IrK109MTI4fDYzJnV9ZWxzZXtpZihyKzM+PW8pYnJlYWs7dFtyKytdPTI0MHx1Pj4xOCx0W3IrK109MTI4fHU+PjEyJjYzLHRbcisrXT0xMjh8dT4+NiY2Myx0W3IrK109MTI4fDYzJnV9fXJldHVybiB0W3JdPTAsci1hfWZ1bmN0aW9uIEEoZSl7Zm9yKHZhciB0PTAscj0wO3I8ZS5sZW5ndGg7KytyKXt2YXIgbj1lLmNoYXJDb2RlQXQocik7bj49NTUyOTYmJm48PTU3MzQzJiYobj02NTUzNisoKDEwMjMmbik8PDEwKXwxMDIzJmUuY2hhckNvZGVBdCgrK3IpKSxuPD0xMjc/Kyt0OnQrPW48PTIwNDc/MjpuPD02NTUzNT8zOjR9cmV0dXJuIHR9dmFyIE89InVuZGVmaW5lZCIhPXR5cGVvZiBUZXh0RGVjb2Rlcj9uZXcgVGV4dERlY29kZXIoInV0Zi0xNmxlIik6dm9pZCAwO2Z1bmN0aW9uIFMoZSx0KXtmb3IodmFyIHI9ZSxuPXI+PjEsYT1uK3QvMjshKG4+PWEpJiZsW25dOykrK247aWYoKHI9bjw8MSktZT4zMiYmTylyZXR1cm4gTy5kZWNvZGUoYy5zdWJhcnJheShlLHIpKTtmb3IodmFyIG89IiIsaT0wOyEoaT49dC8yKTsrK2kpe3ZhciB1PWZbZSsyKmk+PjFdO2lmKDA9PXUpYnJlYWs7bys9U3RyaW5nLmZyb21DaGFyQ29kZSh1KX1yZXR1cm4gb31mdW5jdGlvbiBGKGUsdCxyKXtpZih2b2lkIDA9PT1yJiYocj0yMTQ3NDgzNjQ3KSxyPDIpcmV0dXJuIDA7Zm9yKHZhciBuPXQsYT0oci09Mik8MiplLmxlbmd0aD9yLzI6ZS5sZW5ndGgsbz0wO288YTsrK28pe3ZhciBpPWUuY2hhckNvZGVBdChvKTtmW3Q+PjFdPWksdCs9Mn1yZXR1cm4gZlt0Pj4xXT0wLHQtbn1mdW5jdGlvbiBNKGUpe3JldHVybiAyKmUubGVuZ3RofWZ1bmN0aW9uIEUoZSx0KXtmb3IodmFyIHI9MCxuPSIiOyEocj49dC80KTspe3ZhciBhPWRbZSs0KnI+PjJdO2lmKDA9PWEpYnJlYWs7aWYoKytyLGE+PTY1NTM2KXt2YXIgbz1hLTY1NTM2O24rPVN0cmluZy5mcm9tQ2hhckNvZGUoNTUyOTZ8bz4+MTAsNTYzMjB8MTAyMyZvKX1lbHNlIG4rPVN0cmluZy5mcm9tQ2hhckNvZGUoYSl9cmV0dXJuIG59ZnVuY3Rpb24gVyhlLHQscil7aWYodm9pZCAwPT09ciYmKHI9MjE0NzQ4MzY0Nykscjw0KXJldHVybiAwO2Zvcih2YXIgbj10LGE9bityLTQsbz0wO288ZS5sZW5ndGg7KytvKXt2YXIgaT1lLmNoYXJDb2RlQXQobyk7aWYoaT49NTUyOTYmJmk8PTU3MzQzJiYoaT02NTUzNisoKDEwMjMmaSk8PDEwKXwxMDIzJmUuY2hhckNvZGVBdCgrK28pKSxkW3Q+PjJdPWksKHQrPTQpKzQ+YSlicmVha31yZXR1cm4gZFt0Pj4yXT0wLHQtbn1mdW5jdGlvbiBJKGUpe2Zvcih2YXIgdD0wLHI9MDtyPGUubGVuZ3RoOysrcil7dmFyIG49ZS5jaGFyQ29kZUF0KHIpO24+PTU1Mjk2JiZuPD01NzM0MyYmKytyLHQrPTR9cmV0dXJuIHR9ZnVuY3Rpb24gayhlKXt2YXIgdD1BKGUpKzEscj1udCh0KTtyZXR1cm4gciYmRChlLHMscix0KSxyfXQuSU5JVElBTF9NRU1PUlk7dmFyIFI9W10sWT1bXSxVPVtdLHg9W107ZnVuY3Rpb24gSChlKXtSLnVuc2hpZnQoZSl9ZnVuY3Rpb24gaihlKXt4LnVuc2hpZnQoZSl9WS5wdXNoKHtmdW5jOmZ1bmN0aW9uKCl7dHQoKX19KTt2YXIgej0wLE49bnVsbCxCPW51bGw7ZnVuY3Rpb24gVihlKXt0Lm9uQWJvcnQmJnQub25BYm9ydChlKSwkKGUrPSIiKSxfPSEwLGU9ImFib3J0KCIrZSsiKS4gQnVpbGQgd2l0aCAtcyBBU1NFUlRJT05TPTEgZm9yIG1vcmUgaW5mby4iO3ZhciByPW5ldyBXZWJBc3NlbWJseS5SdW50aW1lRXJyb3IoZSk7dGhyb3cgYShyKSxyfXQucHJlbG9hZGVkSW1hZ2VzPXt9LHQucHJlbG9hZGVkQXVkaW9zPXt9O3ZhciBMLEosRz0iRlBoaVNlbHBoSURUb2tlbml6ZXJXYXNtLndhc20iO2Z1bmN0aW9uIHEoZSl7Zm9yKDtlLmxlbmd0aD4wOyl7dmFyIHI9ZS5zaGlmdCgpO2lmKCJmdW5jdGlvbiIhPXR5cGVvZiByKXt2YXIgbj1yLmZ1bmM7Im51bWJlciI9PXR5cGVvZiBuP3ZvaWQgMD09PXIuYXJnP20uZ2V0KG4pKCk6bS5nZXQobikoci5hcmcpOm4odm9pZCAwPT09ci5hcmc/bnVsbDpyLmFyZyl9ZWxzZSByKHQpfX1MPUcsSj0iZGF0YTphcHBsaWNhdGlvbi9vY3RldC1zdHJlYW07YmFzZTY0LCIsKFN0cmluZy5wcm90b3R5cGUuc3RhcnRzV2l0aD9MLnN0YXJ0c1dpdGgoSik6MD09PUwuaW5kZXhPZihKKSl8fChyPUcsRz10LmxvY2F0ZUZpbGU/dC5sb2NhdGVGaWxlKHIsVCk6VCtyKTtmdW5jdGlvbiBYKGUpe3RoaXMuZXhjUHRyPWUsdGhpcy5wdHI9ZS0xNix0aGlzLnNldF90eXBlPWZ1bmN0aW9uKGUpe2RbdGhpcy5wdHIrOD4+Ml09ZX0sdGhpcy5nZXRfdHlwZT1mdW5jdGlvbigpe3JldHVybiBkW3RoaXMucHRyKzg+PjJdfSx0aGlzLnNldF9kZXN0cnVjdG9yPWZ1bmN0aW9uKGUpe2RbdGhpcy5wdHIrMD4+Ml09ZX0sdGhpcy5nZXRfZGVzdHJ1Y3Rvcj1mdW5jdGlvbigpe3JldHVybiBkW3RoaXMucHRyKzA+PjJdfSx0aGlzLnNldF9yZWZjb3VudD1mdW5jdGlvbihlKXtkW3RoaXMucHRyKzQ+PjJdPWV9LHRoaXMuc2V0X2NhdWdodD1mdW5jdGlvbihlKXtlPWU/MTowLHNbdGhpcy5wdHIrMTI+PjBdPWV9LHRoaXMuZ2V0X2NhdWdodD1mdW5jdGlvbigpe3JldHVybiAwIT1zW3RoaXMucHRyKzEyPj4wXX0sdGhpcy5zZXRfcmV0aHJvd249ZnVuY3Rpb24oZSl7ZT1lPzE6MCxzW3RoaXMucHRyKzEzPj4wXT1lfSx0aGlzLmdldF9yZXRocm93bj1mdW5jdGlvbigpe3JldHVybiAwIT1zW3RoaXMucHRyKzEzPj4wXX0sdGhpcy5pbml0PWZ1bmN0aW9uKGUsdCl7dGhpcy5zZXRfdHlwZShlKSx0aGlzLnNldF9kZXN0cnVjdG9yKHQpLHRoaXMuc2V0X3JlZmNvdW50KDApLHRoaXMuc2V0X2NhdWdodCghMSksdGhpcy5zZXRfcmV0aHJvd24oITEpfSx0aGlzLmFkZF9yZWY9ZnVuY3Rpb24oKXt2YXIgZT1kW3RoaXMucHRyKzQ+PjJdO2RbdGhpcy5wdHIrND4+Ml09ZSsxfSx0aGlzLnJlbGVhc2VfcmVmPWZ1bmN0aW9uKCl7dmFyIGU9ZFt0aGlzLnB0cis0Pj4yXTtyZXR1cm4gZFt0aGlzLnB0cis0Pj4yXT1lLTEsMT09PWV9fWZ1bmN0aW9uIFooKXtpZighWi5jYWxsZWQpe1ouY2FsbGVkPSEwO3ZhciBlPShuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKSx0PW5ldyBEYXRlKGUsMCwxKSxyPW5ldyBEYXRlKGUsNiwxKSxuPXQuZ2V0VGltZXpvbmVPZmZzZXQoKSxhPXIuZ2V0VGltZXpvbmVPZmZzZXQoKSxvPU1hdGgubWF4KG4sYSk7ZFtzdCgpPj4yXT02MCpvLGRbdXQoKT4+Ml09TnVtYmVyKG4hPWEpO3ZhciBpPWYodCksdT1mKHIpLHM9ayhpKSxjPWsodSk7YTxuPyhkW2l0KCk+PjJdPXMsZFtpdCgpKzQ+PjJdPWMpOihkW2l0KCk+PjJdPWMsZFtpdCgpKzQ+PjJdPXMpfWZ1bmN0aW9uIGYoZSl7dmFyIHQ9ZS50b1RpbWVTdHJpbmcoKS5tYXRjaCgvXCgoW0EtWmEteiBdKylcKSQvKTtyZXR1cm4gdD90WzFdOiJHTVQifX1mdW5jdGlvbiBLKGUpe3N3aXRjaChlKXtjYXNlIDE6cmV0dXJuIDA7Y2FzZSAyOnJldHVybiAxO2Nhc2UgNDpyZXR1cm4gMjtjYXNlIDg6cmV0dXJuIDM7ZGVmYXVsdDp0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIHR5cGUgc2l6ZTogIitlKX19dmFyIFE9dm9pZCAwO2Z1bmN0aW9uIGVlKGUpe2Zvcih2YXIgdD0iIixyPWU7Y1tyXTspdCs9UVtjW3IrK11dO3JldHVybiB0fXZhciB0ZT17fSxyZT17fSxuZT17fTtmdW5jdGlvbiBhZShlKXtpZih2b2lkIDA9PT1lKXJldHVybiJfdW5rbm93biI7dmFyIHQ9KGU9ZS5yZXBsYWNlKC9bXmEtekEtWjAtOV9dL2csIiQiKSkuY2hhckNvZGVBdCgwKTtyZXR1cm4gdD49NDgmJnQ8PTU3PyJfIitlOmV9ZnVuY3Rpb24gb2UoZSx0KXtyZXR1cm4gZT1hZShlKSxuZXcgRnVuY3Rpb24oImJvZHkiLCJyZXR1cm4gZnVuY3Rpb24gIitlKycoKSB7XG4gICAgInVzZSBzdHJpY3QiOyAgICByZXR1cm4gYm9keS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xufTtcbicpKHQpfWZ1bmN0aW9uIGllKGUsdCl7dmFyIHI9b2UodCwoZnVuY3Rpb24oZSl7dGhpcy5uYW1lPXQsdGhpcy5tZXNzYWdlPWU7dmFyIHI9bmV3IEVycm9yKGUpLnN0YWNrO3ZvaWQgMCE9PXImJih0aGlzLnN0YWNrPXRoaXMudG9TdHJpbmcoKSsiXG4iK3IucmVwbGFjZSgvXkVycm9yKDpbXlxuXSopP1xuLywiIikpfSkpO3JldHVybiByLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGUucHJvdG90eXBlKSxyLnByb3RvdHlwZS5jb25zdHJ1Y3Rvcj1yLHIucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIHZvaWQgMD09PXRoaXMubWVzc2FnZT90aGlzLm5hbWU6dGhpcy5uYW1lKyI6ICIrdGhpcy5tZXNzYWdlfSxyfXZhciB1ZT12b2lkIDA7ZnVuY3Rpb24gc2UoZSl7dGhyb3cgbmV3IHVlKGUpfXZhciBjZT12b2lkIDA7ZnVuY3Rpb24gZmUoZSl7dGhyb3cgbmV3IGNlKGUpfWZ1bmN0aW9uIGxlKGUsdCxyKXtmdW5jdGlvbiBuKHQpe3ZhciBuPXIodCk7bi5sZW5ndGghPT1lLmxlbmd0aCYmZmUoIk1pc21hdGNoZWQgdHlwZSBjb252ZXJ0ZXIgY291bnQiKTtmb3IodmFyIGE9MDthPGUubGVuZ3RoOysrYSlkZShlW2FdLG5bYV0pfWUuZm9yRWFjaCgoZnVuY3Rpb24oZSl7bmVbZV09dH0pKTt2YXIgYT1uZXcgQXJyYXkodC5sZW5ndGgpLG89W10saT0wO3QuZm9yRWFjaCgoZnVuY3Rpb24oZSx0KXtyZS5oYXNPd25Qcm9wZXJ0eShlKT9hW3RdPXJlW2VdOihvLnB1c2goZSksdGUuaGFzT3duUHJvcGVydHkoZSl8fCh0ZVtlXT1bXSksdGVbZV0ucHVzaCgoZnVuY3Rpb24oKXthW3RdPXJlW2VdLCsraT09PW8ubGVuZ3RoJiZuKGEpfSkpKX0pKSwwPT09by5sZW5ndGgmJm4oYSl9ZnVuY3Rpb24gZGUoZSx0LHIpe2lmKHI9cnx8e30sISgiYXJnUGFja0FkdmFuY2UiaW4gdCkpdGhyb3cgbmV3IFR5cGVFcnJvcigicmVnaXN0ZXJUeXBlIHJlZ2lzdGVyZWRJbnN0YW5jZSByZXF1aXJlcyBhcmdQYWNrQWR2YW5jZSIpO3ZhciBuPXQubmFtZTtpZihlfHxzZSgndHlwZSAiJytuKyciIG11c3QgaGF2ZSBhIHBvc2l0aXZlIGludGVnZXIgdHlwZWlkIHBvaW50ZXInKSxyZS5oYXNPd25Qcm9wZXJ0eShlKSl7aWYoci5pZ25vcmVEdXBsaWNhdGVSZWdpc3RyYXRpb25zKXJldHVybjtzZSgiQ2Fubm90IHJlZ2lzdGVyIHR5cGUgJyIrbisiJyB0d2ljZSIpfWlmKHJlW2VdPXQsZGVsZXRlIG5lW2VdLHRlLmhhc093blByb3BlcnR5KGUpKXt2YXIgYT10ZVtlXTtkZWxldGUgdGVbZV0sYS5mb3JFYWNoKChmdW5jdGlvbihlKXtlKCl9KSl9fWZ1bmN0aW9uIHBlKGUpe3NlKGUuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3MubmFtZSsiIGluc3RhbmNlIGFscmVhZHkgZGVsZXRlZCIpfXZhciBoZT0hMTtmdW5jdGlvbiB5ZShlKXt9ZnVuY3Rpb24gbWUoZSl7dmFyIHQ7ZS5jb3VudC52YWx1ZS09MSwwPT09ZS5jb3VudC52YWx1ZSYmKCh0PWUpLnNtYXJ0UHRyP3Quc21hcnRQdHJUeXBlLnJhd0Rlc3RydWN0b3IodC5zbWFydFB0cik6dC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzcy5yYXdEZXN0cnVjdG9yKHQucHRyKSl9ZnVuY3Rpb24gZ2UoZSl7cmV0dXJuInVuZGVmaW5lZCI9PXR5cGVvZiBGaW5hbGl6YXRpb25Hcm91cD8oZ2U9ZnVuY3Rpb24oZSl7cmV0dXJuIGV9LGUpOihoZT1uZXcgRmluYWxpemF0aW9uR3JvdXAoKGZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLm5leHQoKTshdC5kb25lO3Q9ZS5uZXh0KCkpe3ZhciByPXQudmFsdWU7ci5wdHI/bWUocik6Y29uc29sZS53YXJuKCJvYmplY3QgYWxyZWFkeSBkZWxldGVkOiAiK3IucHRyKX19KSksZ2U9ZnVuY3Rpb24oZSl7cmV0dXJuIGhlLnJlZ2lzdGVyKGUsZS4kJCxlLiQkKSxlfSx5ZT1mdW5jdGlvbihlKXtoZS51bnJlZ2lzdGVyKGUuJCQpfSxnZShlKSl9dmFyIHZlPXZvaWQgMCx3ZT1bXTtmdW5jdGlvbiBiZSgpe2Zvcig7d2UubGVuZ3RoOyl7dmFyIGU9d2UucG9wKCk7ZS4kJC5kZWxldGVTY2hlZHVsZWQ9ITEsZS5kZWxldGUoKX19ZnVuY3Rpb24gVGUoKXt9dmFyICRlPXt9O2Z1bmN0aW9uIF9lKGUsdCxyKXtpZih2b2lkIDA9PT1lW3RdLm92ZXJsb2FkVGFibGUpe3ZhciBuPWVbdF07ZVt0XT1mdW5jdGlvbigpe3JldHVybiBlW3RdLm92ZXJsb2FkVGFibGUuaGFzT3duUHJvcGVydHkoYXJndW1lbnRzLmxlbmd0aCl8fHNlKCJGdW5jdGlvbiAnIityKyInIGNhbGxlZCB3aXRoIGFuIGludmFsaWQgbnVtYmVyIG9mIGFyZ3VtZW50cyAoIithcmd1bWVudHMubGVuZ3RoKyIpIC0gZXhwZWN0cyBvbmUgb2YgKCIrZVt0XS5vdmVybG9hZFRhYmxlKyIpISIpLGVbdF0ub3ZlcmxvYWRUYWJsZVthcmd1bWVudHMubGVuZ3RoXS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LGVbdF0ub3ZlcmxvYWRUYWJsZT1bXSxlW3RdLm92ZXJsb2FkVGFibGVbbi5hcmdDb3VudF09bn19ZnVuY3Rpb24gQ2UoZSx0LHIsbixhLG8saSx1KXt0aGlzLm5hbWU9ZSx0aGlzLmNvbnN0cnVjdG9yPXQsdGhpcy5pbnN0YW5jZVByb3RvdHlwZT1yLHRoaXMucmF3RGVzdHJ1Y3Rvcj1uLHRoaXMuYmFzZUNsYXNzPWEsdGhpcy5nZXRBY3R1YWxUeXBlPW8sdGhpcy51cGNhc3Q9aSx0aGlzLmRvd25jYXN0PXUsdGhpcy5wdXJlVmlydHVhbEZ1bmN0aW9ucz1bXX1mdW5jdGlvbiBQZShlLHQscil7Zm9yKDt0IT09cjspdC51cGNhc3R8fHNlKCJFeHBlY3RlZCBudWxsIG9yIGluc3RhbmNlIG9mICIrci5uYW1lKyIsIGdvdCBhbiBpbnN0YW5jZSBvZiAiK3QubmFtZSksZT10LnVwY2FzdChlKSx0PXQuYmFzZUNsYXNzO3JldHVybiBlfWZ1bmN0aW9uIERlKGUsdCl7aWYobnVsbD09PXQpcmV0dXJuIHRoaXMuaXNSZWZlcmVuY2UmJnNlKCJudWxsIGlzIG5vdCBhIHZhbGlkICIrdGhpcy5uYW1lKSwwO3QuJCR8fHNlKCdDYW5ub3QgcGFzcyAiJytWZSh0KSsnIiBhcyBhICcrdGhpcy5uYW1lKSx0LiQkLnB0cnx8c2UoIkNhbm5vdCBwYXNzIGRlbGV0ZWQgb2JqZWN0IGFzIGEgcG9pbnRlciBvZiB0eXBlICIrdGhpcy5uYW1lKTt2YXIgcj10LiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzO3JldHVybiBQZSh0LiQkLnB0cixyLHRoaXMucmVnaXN0ZXJlZENsYXNzKX1mdW5jdGlvbiBBZShlLHQpe2lmKG51bGw9PT10KXJldHVybiB0aGlzLmlzUmVmZXJlbmNlJiZzZSgibnVsbCBpcyBub3QgYSB2YWxpZCAiK3RoaXMubmFtZSksdGhpcy5pc1NtYXJ0UG9pbnRlcj8ocj10aGlzLnJhd0NvbnN0cnVjdG9yKCksbnVsbCE9PWUmJmUucHVzaCh0aGlzLnJhd0Rlc3RydWN0b3Iscikscik6MDt0LiQkfHxzZSgnQ2Fubm90IHBhc3MgIicrVmUodCkrJyIgYXMgYSAnK3RoaXMubmFtZSksdC4kJC5wdHJ8fHNlKCJDYW5ub3QgcGFzcyBkZWxldGVkIG9iamVjdCBhcyBhIHBvaW50ZXIgb2YgdHlwZSAiK3RoaXMubmFtZSksIXRoaXMuaXNDb25zdCYmdC4kJC5wdHJUeXBlLmlzQ29uc3QmJnNlKCJDYW5ub3QgY29udmVydCBhcmd1bWVudCBvZiB0eXBlICIrKHQuJCQuc21hcnRQdHJUeXBlP3QuJCQuc21hcnRQdHJUeXBlLm5hbWU6dC4kJC5wdHJUeXBlLm5hbWUpKyIgdG8gcGFyYW1ldGVyIHR5cGUgIit0aGlzLm5hbWUpO3ZhciByLG49dC4kJC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzcztpZihyPVBlKHQuJCQucHRyLG4sdGhpcy5yZWdpc3RlcmVkQ2xhc3MpLHRoaXMuaXNTbWFydFBvaW50ZXIpc3dpdGNoKHZvaWQgMD09PXQuJCQuc21hcnRQdHImJnNlKCJQYXNzaW5nIHJhdyBwb2ludGVyIHRvIHNtYXJ0IHBvaW50ZXIgaXMgaWxsZWdhbCIpLHRoaXMuc2hhcmluZ1BvbGljeSl7Y2FzZSAwOnQuJCQuc21hcnRQdHJUeXBlPT09dGhpcz9yPXQuJCQuc21hcnRQdHI6c2UoIkNhbm5vdCBjb252ZXJ0IGFyZ3VtZW50IG9mIHR5cGUgIisodC4kJC5zbWFydFB0clR5cGU/dC4kJC5zbWFydFB0clR5cGUubmFtZTp0LiQkLnB0clR5cGUubmFtZSkrIiB0byBwYXJhbWV0ZXIgdHlwZSAiK3RoaXMubmFtZSk7YnJlYWs7Y2FzZSAxOnI9dC4kJC5zbWFydFB0cjticmVhaztjYXNlIDI6aWYodC4kJC5zbWFydFB0clR5cGU9PT10aGlzKXI9dC4kJC5zbWFydFB0cjtlbHNle3ZhciBhPXQuY2xvbmUoKTtyPXRoaXMucmF3U2hhcmUocixCZSgoZnVuY3Rpb24oKXthLmRlbGV0ZSgpfSkpKSxudWxsIT09ZSYmZS5wdXNoKHRoaXMucmF3RGVzdHJ1Y3RvcixyKX1icmVhaztkZWZhdWx0OnNlKCJVbnN1cHBvcnRpbmcgc2hhcmluZyBwb2xpY3kiKX1yZXR1cm4gcn1mdW5jdGlvbiBPZShlLHQpe2lmKG51bGw9PT10KXJldHVybiB0aGlzLmlzUmVmZXJlbmNlJiZzZSgibnVsbCBpcyBub3QgYSB2YWxpZCAiK3RoaXMubmFtZSksMDt0LiQkfHxzZSgnQ2Fubm90IHBhc3MgIicrVmUodCkrJyIgYXMgYSAnK3RoaXMubmFtZSksdC4kJC5wdHJ8fHNlKCJDYW5ub3QgcGFzcyBkZWxldGVkIG9iamVjdCBhcyBhIHBvaW50ZXIgb2YgdHlwZSAiK3RoaXMubmFtZSksdC4kJC5wdHJUeXBlLmlzQ29uc3QmJnNlKCJDYW5ub3QgY29udmVydCBhcmd1bWVudCBvZiB0eXBlICIrdC4kJC5wdHJUeXBlLm5hbWUrIiB0byBwYXJhbWV0ZXIgdHlwZSAiK3RoaXMubmFtZSk7dmFyIHI9dC4kJC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzcztyZXR1cm4gUGUodC4kJC5wdHIscix0aGlzLnJlZ2lzdGVyZWRDbGFzcyl9ZnVuY3Rpb24gU2UoZSl7cmV0dXJuIHRoaXMuZnJvbVdpcmVUeXBlKHBbZT4+Ml0pfWZ1bmN0aW9uIEZlKGUsdCxyKXtpZih0PT09cilyZXR1cm4gZTtpZih2b2lkIDA9PT1yLmJhc2VDbGFzcylyZXR1cm4gbnVsbDt2YXIgbj1GZShlLHQsci5iYXNlQ2xhc3MpO3JldHVybiBudWxsPT09bj9udWxsOnIuZG93bmNhc3Qobil9dmFyIE1lPXt9O2Z1bmN0aW9uIEVlKGUsdCl7cmV0dXJuIHQucHRyVHlwZSYmdC5wdHJ8fGZlKCJtYWtlQ2xhc3NIYW5kbGUgcmVxdWlyZXMgcHRyIGFuZCBwdHJUeXBlIiksISF0LnNtYXJ0UHRyVHlwZSE9ISF0LnNtYXJ0UHRyJiZmZSgiQm90aCBzbWFydFB0clR5cGUgYW5kIHNtYXJ0UHRyIG11c3QgYmUgc3BlY2lmaWVkIiksdC5jb3VudD17dmFsdWU6MX0sZ2UoT2JqZWN0LmNyZWF0ZShlLHskJDp7dmFsdWU6dH19KSl9ZnVuY3Rpb24gV2UoZSx0LHIsbixhLG8saSx1LHMsYyxmKXt0aGlzLm5hbWU9ZSx0aGlzLnJlZ2lzdGVyZWRDbGFzcz10LHRoaXMuaXNSZWZlcmVuY2U9cix0aGlzLmlzQ29uc3Q9bix0aGlzLmlzU21hcnRQb2ludGVyPWEsdGhpcy5wb2ludGVlVHlwZT1vLHRoaXMuc2hhcmluZ1BvbGljeT1pLHRoaXMucmF3R2V0UG9pbnRlZT11LHRoaXMucmF3Q29uc3RydWN0b3I9cyx0aGlzLnJhd1NoYXJlPWMsdGhpcy5yYXdEZXN0cnVjdG9yPWYsYXx8dm9pZCAwIT09dC5iYXNlQ2xhc3M/dGhpcy50b1dpcmVUeXBlPUFlOm4/KHRoaXMudG9XaXJlVHlwZT1EZSx0aGlzLmRlc3RydWN0b3JGdW5jdGlvbj1udWxsKToodGhpcy50b1dpcmVUeXBlPU9lLHRoaXMuZGVzdHJ1Y3RvckZ1bmN0aW9uPW51bGwpfWZ1bmN0aW9uIEllKGUscil7ZT1lZShlKTt2YXIgbj1mdW5jdGlvbigpe3ZhciBuLGEsbztyZXR1cm4tMSE9ZS5pbmRleE9mKCJqIik/KG49ZSxhPXIsbz1bXSxmdW5jdGlvbigpe28ubGVuZ3RoPWFyZ3VtZW50cy5sZW5ndGg7Zm9yKHZhciBlPTA7ZTxhcmd1bWVudHMubGVuZ3RoO2UrKylvW2VdPWFyZ3VtZW50c1tlXTtyZXR1cm4gZnVuY3Rpb24oZSxyLG4pe3ZhciBhLG8saTtyZXR1cm4tMSE9ZS5pbmRleE9mKCJqIik/KGE9cixvPW4saT10WyJkeW5DYWxsXyIrZV0sbyYmby5sZW5ndGg/aS5hcHBseShudWxsLFthXS5jb25jYXQobykpOmkuY2FsbChudWxsLGEpKTptLmdldChyKS5hcHBseShudWxsLG4pfShuLGEsbyl9KTptLmdldChyKX0oKTtyZXR1cm4iZnVuY3Rpb24iIT10eXBlb2YgbiYmc2UoInVua25vd24gZnVuY3Rpb24gcG9pbnRlciB3aXRoIHNpZ25hdHVyZSAiK2UrIjogIityKSxufXZhciBrZT12b2lkIDA7ZnVuY3Rpb24gUmUoZSl7dmFyIHQ9YXQoZSkscj1lZSh0KTtyZXR1cm4gb3QodCkscn1mdW5jdGlvbiBZZShlLHQpe3ZhciByPVtdLG49e307dGhyb3cgdC5mb3JFYWNoKChmdW5jdGlvbiBlKHQpe2lmKCFuW3RdJiYhcmVbdF0pe2lmKG5lW3RdKXJldHVybiB2b2lkIG5lW3RdLmZvckVhY2goZSk7ci5wdXNoKHQpLG5bdF09ITB9fSkpLG5ldyBrZShlKyI6ICIrci5tYXAoUmUpLmpvaW4oWyIsICJdKSl9ZnVuY3Rpb24gVWUoZSx0KXtmb3IodmFyIHI9W10sbj0wO248ZTtuKyspci5wdXNoKGRbKHQ+PjIpK25dKTtyZXR1cm4gcn1mdW5jdGlvbiB4ZShlKXtmb3IoO2UubGVuZ3RoOyl7dmFyIHQ9ZS5wb3AoKTtlLnBvcCgpKHQpfX1mdW5jdGlvbiBIZShlLHQscil7cmV0dXJuIGUgaW5zdGFuY2VvZiBPYmplY3R8fHNlKHIrJyB3aXRoIGludmFsaWQgInRoaXMiOiAnK2UpLGUgaW5zdGFuY2VvZiB0LnJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcnx8c2UocisnIGluY29tcGF0aWJsZSB3aXRoICJ0aGlzIiBvZiB0eXBlICcrZS5jb25zdHJ1Y3Rvci5uYW1lKSxlLiQkLnB0cnx8c2UoImNhbm5vdCBjYWxsIGVtc2NyaXB0ZW4gYmluZGluZyBtZXRob2QgIityKyIgb24gZGVsZXRlZCBvYmplY3QiKSxQZShlLiQkLnB0cixlLiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzLHQucmVnaXN0ZXJlZENsYXNzKX12YXIgamU9W10semU9W3t9LHt2YWx1ZTp2b2lkIDB9LHt2YWx1ZTpudWxsfSx7dmFsdWU6ITB9LHt2YWx1ZTohMX1dO2Z1bmN0aW9uIE5lKGUpe2U+NCYmMD09LS16ZVtlXS5yZWZjb3VudCYmKHplW2VdPXZvaWQgMCxqZS5wdXNoKGUpKX1mdW5jdGlvbiBCZShlKXtzd2l0Y2goZSl7Y2FzZSB2b2lkIDA6cmV0dXJuIDE7Y2FzZSBudWxsOnJldHVybiAyO2Nhc2UhMDpyZXR1cm4gMztjYXNlITE6cmV0dXJuIDQ7ZGVmYXVsdDp2YXIgdD1qZS5sZW5ndGg/amUucG9wKCk6emUubGVuZ3RoO3JldHVybiB6ZVt0XT17cmVmY291bnQ6MSx2YWx1ZTplfSx0fX1mdW5jdGlvbiBWZShlKXtpZihudWxsPT09ZSlyZXR1cm4ibnVsbCI7dmFyIHQ9dHlwZW9mIGU7cmV0dXJuIm9iamVjdCI9PT10fHwiYXJyYXkiPT09dHx8ImZ1bmN0aW9uIj09PXQ/ZS50b1N0cmluZygpOiIiK2V9ZnVuY3Rpb24gTGUoZSl7cmV0dXJuIGUlND09MCYmKGUlMTAwIT0wfHxlJTQwMD09MCl9ZnVuY3Rpb24gSmUoZSx0KXtmb3IodmFyIHI9MCxuPTA7bjw9dDtyKz1lW24rK10pO3JldHVybiByfWc9ZnVuY3Rpb24oKXtyZXR1cm4gcGVyZm9ybWFuY2Uubm93KCl9O3ZhciBHZT1bMzEsMjksMzEsMzAsMzEsMzAsMzEsMzEsMzAsMzEsMzAsMzFdLHFlPVszMSwyOCwzMSwzMCwzMSwzMCwzMSwzMSwzMCwzMSwzMCwzMV07ZnVuY3Rpb24gWGUoZSx0KXtmb3IodmFyIHI9bmV3IERhdGUoZS5nZXRUaW1lKCkpO3Q+MDspe3ZhciBuPUxlKHIuZ2V0RnVsbFllYXIoKSksYT1yLmdldE1vbnRoKCksbz0obj9HZTpxZSlbYV07aWYoISh0Pm8tci5nZXREYXRlKCkpKXtyLnNldERhdGUoci5nZXREYXRlKCkrdCk7YnJlYWt9dC09by1yLmdldERhdGUoKSsxLHIuc2V0RGF0ZSgxKSxhPDExP3Iuc2V0TW9udGgoYSsxKTooci5zZXRNb250aCgwKSxyLnNldEZ1bGxZZWFyKHIuZ2V0RnVsbFllYXIoKSsxKSl9cmV0dXJuIHJ9ZnVuY3Rpb24gWmUoZSl7cmV0dXJuIHBhcnNlSW50KGUpfWZ1bmN0aW9uIEtlKGUsdCxyKXt2YXIgbj1yPjA/cjpBKGUpKzEsYT1uZXcgQXJyYXkobiksbz1EKGUsYSwwLGEubGVuZ3RoKTtyZXR1cm4gdCYmKGEubGVuZ3RoPW8pLGF9IWZ1bmN0aW9uKCl7Zm9yKHZhciBlPW5ldyBBcnJheSgyNTYpLHQ9MDt0PDI1NjsrK3QpZVt0XT1TdHJpbmcuZnJvbUNoYXJDb2RlKHQpO1E9ZX0oKSx1ZT10LkJpbmRpbmdFcnJvcj1pZShFcnJvciwiQmluZGluZ0Vycm9yIiksY2U9dC5JbnRlcm5hbEVycm9yPWllKEVycm9yLCJJbnRlcm5hbEVycm9yIiksVGUucHJvdG90eXBlLmlzQWxpYXNPZj1mdW5jdGlvbihlKXtpZighKHRoaXMgaW5zdGFuY2VvZiBUZSYmZSBpbnN0YW5jZW9mIFRlKSlyZXR1cm4hMTtmb3IodmFyIHQ9dGhpcy4kJC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzcyxyPXRoaXMuJCQucHRyLG49ZS4kJC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzcyxhPWUuJCQucHRyO3QuYmFzZUNsYXNzOylyPXQudXBjYXN0KHIpLHQ9dC5iYXNlQ2xhc3M7Zm9yKDtuLmJhc2VDbGFzczspYT1uLnVwY2FzdChhKSxuPW4uYmFzZUNsYXNzO3JldHVybiB0PT09biYmcj09PWF9LFRlLnByb3RvdHlwZS5jbG9uZT1mdW5jdGlvbigpe2lmKHRoaXMuJCQucHRyfHxwZSh0aGlzKSx0aGlzLiQkLnByZXNlcnZlUG9pbnRlck9uRGVsZXRlKXJldHVybiB0aGlzLiQkLmNvdW50LnZhbHVlKz0xLHRoaXM7dmFyIGUsdD1nZShPYmplY3QuY3JlYXRlKE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKSx7JCQ6e3ZhbHVlOntjb3VudDooZT10aGlzLiQkKS5jb3VudCxkZWxldGVTY2hlZHVsZWQ6ZS5kZWxldGVTY2hlZHVsZWQscHJlc2VydmVQb2ludGVyT25EZWxldGU6ZS5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSxwdHI6ZS5wdHIscHRyVHlwZTplLnB0clR5cGUsc21hcnRQdHI6ZS5zbWFydFB0cixzbWFydFB0clR5cGU6ZS5zbWFydFB0clR5cGV9fX0pKTtyZXR1cm4gdC4kJC5jb3VudC52YWx1ZSs9MSx0LiQkLmRlbGV0ZVNjaGVkdWxlZD0hMSx0fSxUZS5wcm90b3R5cGUuZGVsZXRlPWZ1bmN0aW9uKCl7dGhpcy4kJC5wdHJ8fHBlKHRoaXMpLHRoaXMuJCQuZGVsZXRlU2NoZWR1bGVkJiYhdGhpcy4kJC5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSYmc2UoIk9iamVjdCBhbHJlYWR5IHNjaGVkdWxlZCBmb3IgZGVsZXRpb24iKSx5ZSh0aGlzKSxtZSh0aGlzLiQkKSx0aGlzLiQkLnByZXNlcnZlUG9pbnRlck9uRGVsZXRlfHwodGhpcy4kJC5zbWFydFB0cj12b2lkIDAsdGhpcy4kJC5wdHI9dm9pZCAwKX0sVGUucHJvdG90eXBlLmlzRGVsZXRlZD1mdW5jdGlvbigpe3JldHVybiF0aGlzLiQkLnB0cn0sVGUucHJvdG90eXBlLmRlbGV0ZUxhdGVyPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuJCQucHRyfHxwZSh0aGlzKSx0aGlzLiQkLmRlbGV0ZVNjaGVkdWxlZCYmIXRoaXMuJCQucHJlc2VydmVQb2ludGVyT25EZWxldGUmJnNlKCJPYmplY3QgYWxyZWFkeSBzY2hlZHVsZWQgZm9yIGRlbGV0aW9uIiksd2UucHVzaCh0aGlzKSwxPT09d2UubGVuZ3RoJiZ2ZSYmdmUoYmUpLHRoaXMuJCQuZGVsZXRlU2NoZWR1bGVkPSEwLHRoaXN9LFdlLnByb3RvdHlwZS5nZXRQb2ludGVlPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnJhd0dldFBvaW50ZWUmJihlPXRoaXMucmF3R2V0UG9pbnRlZShlKSksZX0sV2UucHJvdG90eXBlLmRlc3RydWN0b3I9ZnVuY3Rpb24oZSl7dGhpcy5yYXdEZXN0cnVjdG9yJiZ0aGlzLnJhd0Rlc3RydWN0b3IoZSl9LFdlLnByb3RvdHlwZS5hcmdQYWNrQWR2YW5jZT04LFdlLnByb3RvdHlwZS5yZWFkVmFsdWVGcm9tUG9pbnRlcj1TZSxXZS5wcm90b3R5cGUuZGVsZXRlT2JqZWN0PWZ1bmN0aW9uKGUpe251bGwhPT1lJiZlLmRlbGV0ZSgpfSxXZS5wcm90b3R5cGUuZnJvbVdpcmVUeXBlPWZ1bmN0aW9uKGUpe3ZhciB0LHI9dGhpcy5nZXRQb2ludGVlKGUpO2lmKCFyKXJldHVybiB0aGlzLmRlc3RydWN0b3IoZSksbnVsbDt2YXIgbj1NZVtmdW5jdGlvbihlLHQpe2Zvcih2b2lkIDA9PT10JiZzZSgicHRyIHNob3VsZCBub3QgYmUgdW5kZWZpbmVkIik7ZS5iYXNlQ2xhc3M7KXQ9ZS51cGNhc3QodCksZT1lLmJhc2VDbGFzcztyZXR1cm4gdH0odGhpcy5yZWdpc3RlcmVkQ2xhc3MscildO2lmKHZvaWQgMCE9PW4pe2lmKDA9PT1uLiQkLmNvdW50LnZhbHVlKXJldHVybiBuLiQkLnB0cj1yLG4uJCQuc21hcnRQdHI9ZSxuLmNsb25lKCk7dmFyIGE9bi5jbG9uZSgpO3JldHVybiB0aGlzLmRlc3RydWN0b3IoZSksYX1mdW5jdGlvbiBvKCl7cmV0dXJuIHRoaXMuaXNTbWFydFBvaW50ZXI/RWUodGhpcy5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUse3B0clR5cGU6dGhpcy5wb2ludGVlVHlwZSxwdHI6cixzbWFydFB0clR5cGU6dGhpcyxzbWFydFB0cjplfSk6RWUodGhpcy5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUse3B0clR5cGU6dGhpcyxwdHI6ZX0pfXZhciBpPSRlW3RoaXMucmVnaXN0ZXJlZENsYXNzLmdldEFjdHVhbFR5cGUocildO2lmKCFpKXJldHVybiBvLmNhbGwodGhpcyk7dD10aGlzLmlzQ29uc3Q/aS5jb25zdFBvaW50ZXJUeXBlOmkucG9pbnRlclR5cGU7dmFyIHU9RmUocix0aGlzLnJlZ2lzdGVyZWRDbGFzcyx0LnJlZ2lzdGVyZWRDbGFzcyk7cmV0dXJuIG51bGw9PT11P28uY2FsbCh0aGlzKTp0aGlzLmlzU21hcnRQb2ludGVyP0VlKHQucmVnaXN0ZXJlZENsYXNzLmluc3RhbmNlUHJvdG90eXBlLHtwdHJUeXBlOnQscHRyOnUsc21hcnRQdHJUeXBlOnRoaXMsc21hcnRQdHI6ZX0pOkVlKHQucmVnaXN0ZXJlZENsYXNzLmluc3RhbmNlUHJvdG90eXBlLHtwdHJUeXBlOnQscHRyOnV9KX0sdC5nZXRJbmhlcml0ZWRJbnN0YW5jZUNvdW50PWZ1bmN0aW9uKCl7cmV0dXJuIE9iamVjdC5rZXlzKE1lKS5sZW5ndGh9LHQuZ2V0TGl2ZUluaGVyaXRlZEluc3RhbmNlcz1mdW5jdGlvbigpe3ZhciBlPVtdO2Zvcih2YXIgdCBpbiBNZSlNZS5oYXNPd25Qcm9wZXJ0eSh0KSYmZS5wdXNoKE1lW3RdKTtyZXR1cm4gZX0sdC5mbHVzaFBlbmRpbmdEZWxldGVzPWJlLHQuc2V0RGVsYXlGdW5jdGlvbj1mdW5jdGlvbihlKXt2ZT1lLHdlLmxlbmd0aCYmdmUmJnZlKGJlKX0sa2U9dC5VbmJvdW5kVHlwZUVycm9yPWllKEVycm9yLCJVbmJvdW5kVHlwZUVycm9yIiksdC5jb3VudF9lbXZhbF9oYW5kbGVzPWZ1bmN0aW9uKCl7Zm9yKHZhciBlPTAsdD01O3Q8emUubGVuZ3RoOysrdCl2b2lkIDAhPT16ZVt0XSYmKytlO3JldHVybiBlfSx0LmdldF9maXJzdF9lbXZhbD1mdW5jdGlvbigpe2Zvcih2YXIgZT01O2U8emUubGVuZ3RoOysrZSlpZih2b2lkIDAhPT16ZVtlXSlyZXR1cm4gemVbZV07cmV0dXJuIG51bGx9O3ZhciBRZT17YzpmdW5jdGlvbihlKXtyZXR1cm4gbnQoZSsxNikrMTZ9LGI6ZnVuY3Rpb24oZSx0LHIpe3Rocm93IG5ldyBYKGUpLmluaXQodCxyKSxlfSx3OmZ1bmN0aW9uKGUsdCl7dmFyIHIsbixhLG8saSx1LHMsYyxmO3JldHVybiByPWUsbj10LFooKSxhPW5ldyBEYXRlKDFlMypkW3I+PjJdKSxkW24+PjJdPWEuZ2V0U2Vjb25kcygpLGRbbis0Pj4yXT1hLmdldE1pbnV0ZXMoKSxkW24rOD4+Ml09YS5nZXRIb3VycygpLGRbbisxMj4+Ml09YS5nZXREYXRlKCksZFtuKzE2Pj4yXT1hLmdldE1vbnRoKCksZFtuKzIwPj4yXT1hLmdldEZ1bGxZZWFyKCktMTkwMCxkW24rMjQ+PjJdPWEuZ2V0RGF5KCksbz1uZXcgRGF0ZShhLmdldEZ1bGxZZWFyKCksMCwxKSxpPShhLmdldFRpbWUoKS1vLmdldFRpbWUoKSkvODY0ZTV8MCxkW24rMjg+PjJdPWksZFtuKzM2Pj4yXT0tNjAqYS5nZXRUaW1lem9uZU9mZnNldCgpLGM9MHwoKHU9bmV3IERhdGUoYS5nZXRGdWxsWWVhcigpLDYsMSkuZ2V0VGltZXpvbmVPZmZzZXQoKSkhPShzPW8uZ2V0VGltZXpvbmVPZmZzZXQoKSkmJmEuZ2V0VGltZXpvbmVPZmZzZXQoKT09TWF0aC5taW4ocyx1KSksZFtuKzMyPj4yXT1jLGY9ZFtpdCgpKyhjPzQ6MCk+PjJdLGRbbis0MD4+Ml09ZixufSx5OmZ1bmN0aW9uKGUsdCxyLG4sYSl7dmFyIG89SyhyKTtkZShlLHtuYW1lOnQ9ZWUodCksZnJvbVdpcmVUeXBlOmZ1bmN0aW9uKGUpe3JldHVybiEhZX0sdG9XaXJlVHlwZTpmdW5jdGlvbihlLHQpe3JldHVybiB0P246YX0sYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpmdW5jdGlvbihlKXt2YXIgbjtpZigxPT09ciluPXM7ZWxzZSBpZigyPT09ciluPWY7ZWxzZXtpZig0IT09cil0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIGJvb2xlYW4gdHlwZSBzaXplOiAiK3QpO249ZH1yZXR1cm4gdGhpcy5mcm9tV2lyZVR5cGUobltlPj5vXSl9LGRlc3RydWN0b3JGdW5jdGlvbjpudWxsfSl9LGc6ZnVuY3Rpb24oZSxyLG4sYSxvLGksdSxzLGMsZixsLGQscCl7bD1lZShsKSxpPUllKG8saSkscyYmKHM9SWUodSxzKSksZiYmKGY9SWUoYyxmKSkscD1JZShkLHApO3ZhciBoPWFlKGwpOyFmdW5jdGlvbihlLHIsbil7dC5oYXNPd25Qcm9wZXJ0eShlKT8oc2UoIkNhbm5vdCByZWdpc3RlciBwdWJsaWMgbmFtZSAnIitlKyInIHR3aWNlIiksX2UodCxlLGUpLHQuaGFzT3duUHJvcGVydHkobikmJnNlKCJDYW5ub3QgcmVnaXN0ZXIgbXVsdGlwbGUgb3ZlcmxvYWRzIG9mIGEgZnVuY3Rpb24gd2l0aCB0aGUgc2FtZSBudW1iZXIgb2YgYXJndW1lbnRzICgiK24rIikhIiksdFtlXS5vdmVybG9hZFRhYmxlW25dPXIpOnRbZV09cn0oaCwoZnVuY3Rpb24oKXtZZSgiQ2Fubm90IGNvbnN0cnVjdCAiK2wrIiBkdWUgdG8gdW5ib3VuZCB0eXBlcyIsW2FdKX0pKSxsZShbZSxyLG5dLGE/W2FdOltdLChmdW5jdGlvbihyKXtyPXJbMF0sbz1hPyhuPXIucmVnaXN0ZXJlZENsYXNzKS5pbnN0YW5jZVByb3RvdHlwZTpUZS5wcm90b3R5cGU7dmFyIG4sbyx1PW9lKGgsKGZ1bmN0aW9uKCl7aWYoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpIT09Yyl0aHJvdyBuZXcgdWUoIlVzZSAnbmV3JyB0byBjb25zdHJ1Y3QgIitsKTtpZih2b2lkIDA9PT1tLmNvbnN0cnVjdG9yX2JvZHkpdGhyb3cgbmV3IHVlKGwrIiBoYXMgbm8gYWNjZXNzaWJsZSBjb25zdHJ1Y3RvciIpO3ZhciBlPW0uY29uc3RydWN0b3JfYm9keVthcmd1bWVudHMubGVuZ3RoXTtpZih2b2lkIDA9PT1lKXRocm93IG5ldyB1ZSgiVHJpZWQgdG8gaW52b2tlIGN0b3Igb2YgIitsKyIgd2l0aCBpbnZhbGlkIG51bWJlciBvZiBwYXJhbWV0ZXJzICgiK2FyZ3VtZW50cy5sZW5ndGgrIikgLSBleHBlY3RlZCAoIitPYmplY3Qua2V5cyhtLmNvbnN0cnVjdG9yX2JvZHkpLnRvU3RyaW5nKCkrIikgcGFyYW1ldGVycyBpbnN0ZWFkISIpO3JldHVybiBlLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pKSxjPU9iamVjdC5jcmVhdGUobyx7Y29uc3RydWN0b3I6e3ZhbHVlOnV9fSk7dS5wcm90b3R5cGU9Yzt2YXIgZCx5LG09bmV3IENlKGwsdSxjLHAsbixpLHMsZiksZz1uZXcgV2UobCxtLCEwLCExLCExKSx2PW5ldyBXZShsKyIqIixtLCExLCExLCExKSx3PW5ldyBXZShsKyIgY29uc3QqIixtLCExLCEwLCExKTtyZXR1cm4gJGVbZV09e3BvaW50ZXJUeXBlOnYsY29uc3RQb2ludGVyVHlwZTp3fSxkPWgseT11LHQuaGFzT3duUHJvcGVydHkoZCl8fGZlKCJSZXBsYWNpbmcgbm9uZXhpc3RhbnQgcHVibGljIHN5bWJvbCIpLHRbZF0ub3ZlcmxvYWRUYWJsZSx0W2RdPXksdFtkXS5hcmdDb3VudD11bmRlZmluZWQsW2csdix3XX0pKX0sZjpmdW5jdGlvbihlLHQscixuLGEsbyl7dD4wfHxWKCJBc3NlcnRpb24gZmFpbGVkOiB1bmRlZmluZWQiKTt2YXIgaT1VZSh0LHIpO2E9SWUobixhKTt2YXIgdT1bb10scz1bXTtsZShbXSxbZV0sKGZ1bmN0aW9uKGUpe3ZhciByPSJjb25zdHJ1Y3RvciAiKyhlPWVbMF0pLm5hbWU7aWYodm9pZCAwPT09ZS5yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keSYmKGUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHk9W10pLHZvaWQgMCE9PWUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHlbdC0xXSl0aHJvdyBuZXcgdWUoIkNhbm5vdCByZWdpc3RlciBtdWx0aXBsZSBjb25zdHJ1Y3RvcnMgd2l0aCBpZGVudGljYWwgbnVtYmVyIG9mIHBhcmFtZXRlcnMgKCIrKHQtMSkrIikgZm9yIGNsYXNzICciK2UubmFtZSsiJyEgT3ZlcmxvYWQgcmVzb2x1dGlvbiBpcyBjdXJyZW50bHkgb25seSBwZXJmb3JtZWQgdXNpbmcgdGhlIHBhcmFtZXRlciBjb3VudCwgbm90IGFjdHVhbCB0eXBlIGluZm8hIik7cmV0dXJuIGUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHlbdC0xXT1mdW5jdGlvbigpe1llKCJDYW5ub3QgY29uc3RydWN0ICIrZS5uYW1lKyIgZHVlIHRvIHVuYm91bmQgdHlwZXMiLGkpfSxsZShbXSxpLChmdW5jdGlvbihuKXtyZXR1cm4gZS5yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keVt0LTFdPWZ1bmN0aW9uKCl7YXJndW1lbnRzLmxlbmd0aCE9PXQtMSYmc2UocisiIGNhbGxlZCB3aXRoICIrYXJndW1lbnRzLmxlbmd0aCsiIGFyZ3VtZW50cywgZXhwZWN0ZWQgIisodC0xKSkscy5sZW5ndGg9MCx1Lmxlbmd0aD10O2Zvcih2YXIgZT0xO2U8dDsrK2UpdVtlXT1uW2VdLnRvV2lyZVR5cGUocyxhcmd1bWVudHNbZS0xXSk7dmFyIG89YS5hcHBseShudWxsLHUpO3JldHVybiB4ZShzKSxuWzBdLmZyb21XaXJlVHlwZShvKX0sW119KSksW119KSl9LGE6ZnVuY3Rpb24oZSx0LHIsbixhLG8saSx1KXt2YXIgcz1VZShyLG4pO3Q9ZWUodCksbz1JZShhLG8pLGxlKFtdLFtlXSwoZnVuY3Rpb24oZSl7dmFyIG49KGU9ZVswXSkubmFtZSsiLiIrdDtmdW5jdGlvbiBhKCl7WWUoIkNhbm5vdCBjYWxsICIrbisiIGR1ZSB0byB1bmJvdW5kIHR5cGVzIixzKX11JiZlLnJlZ2lzdGVyZWRDbGFzcy5wdXJlVmlydHVhbEZ1bmN0aW9ucy5wdXNoKHQpO3ZhciBjPWUucmVnaXN0ZXJlZENsYXNzLmluc3RhbmNlUHJvdG90eXBlLGY9Y1t0XTtyZXR1cm4gdm9pZCAwPT09Znx8dm9pZCAwPT09Zi5vdmVybG9hZFRhYmxlJiZmLmNsYXNzTmFtZSE9PWUubmFtZSYmZi5hcmdDb3VudD09PXItMj8oYS5hcmdDb3VudD1yLTIsYS5jbGFzc05hbWU9ZS5uYW1lLGNbdF09YSk6KF9lKGMsdCxuKSxjW3RdLm92ZXJsb2FkVGFibGVbci0yXT1hKSxsZShbXSxzLChmdW5jdGlvbihhKXt2YXIgdT1mdW5jdGlvbihlLHQscixuLGEpe3ZhciBvPXQubGVuZ3RoO288MiYmc2UoImFyZ1R5cGVzIGFycmF5IHNpemUgbWlzbWF0Y2ghIE11c3QgYXQgbGVhc3QgZ2V0IHJldHVybiB2YWx1ZSBhbmQgJ3RoaXMnIHR5cGVzISIpO2Zvcih2YXIgaT1udWxsIT09dFsxXSYmbnVsbCE9PXIsdT0hMSxzPTE7czx0Lmxlbmd0aDsrK3MpaWYobnVsbCE9PXRbc10mJnZvaWQgMD09PXRbc10uZGVzdHJ1Y3RvckZ1bmN0aW9uKXt1PSEwO2JyZWFrfXZhciBjPSJ2b2lkIiE9PXRbMF0ubmFtZSxmPSIiLGw9IiI7Zm9yKHM9MDtzPG8tMjsrK3MpZis9KDAhPT1zPyIsICI6IiIpKyJhcmciK3MsbCs9KDAhPT1zPyIsICI6IiIpKyJhcmciK3MrIldpcmVkIjt2YXIgZD0icmV0dXJuIGZ1bmN0aW9uICIrYWUoZSkrIigiK2YrIikge1xuaWYgKGFyZ3VtZW50cy5sZW5ndGggIT09ICIrKG8tMikrIikge1xudGhyb3dCaW5kaW5nRXJyb3IoJ2Z1bmN0aW9uICIrZSsiIGNhbGxlZCB3aXRoICcgKyBhcmd1bWVudHMubGVuZ3RoICsgJyBhcmd1bWVudHMsIGV4cGVjdGVkICIrKG8tMikrIiBhcmdzIScpO1xufVxuIjt1JiYoZCs9InZhciBkZXN0cnVjdG9ycyA9IFtdO1xuIik7dmFyIHA9dT8iZGVzdHJ1Y3RvcnMiOiJudWxsIixoPVsidGhyb3dCaW5kaW5nRXJyb3IiLCJpbnZva2VyIiwiZm4iLCJydW5EZXN0cnVjdG9ycyIsInJldFR5cGUiLCJjbGFzc1BhcmFtIl0seT1bc2UsbixhLHhlLHRbMF0sdFsxXV07Zm9yKGkmJihkKz0idmFyIHRoaXNXaXJlZCA9IGNsYXNzUGFyYW0udG9XaXJlVHlwZSgiK3ArIiwgdGhpcyk7XG4iKSxzPTA7czxvLTI7KytzKWQrPSJ2YXIgYXJnIitzKyJXaXJlZCA9IGFyZ1R5cGUiK3MrIi50b1dpcmVUeXBlKCIrcCsiLCBhcmciK3MrIik7IC8vICIrdFtzKzJdLm5hbWUrIlxuIixoLnB1c2goImFyZ1R5cGUiK3MpLHkucHVzaCh0W3MrMl0pO2lmKGkmJihsPSJ0aGlzV2lyZWQiKyhsLmxlbmd0aD4wPyIsICI6IiIpK2wpLGQrPShjPyJ2YXIgcnYgPSAiOiIiKSsiaW52b2tlcihmbiIrKGwubGVuZ3RoPjA/IiwgIjoiIikrbCsiKTtcbiIsdSlkKz0icnVuRGVzdHJ1Y3RvcnMoZGVzdHJ1Y3RvcnMpO1xuIjtlbHNlIGZvcihzPWk/MToyO3M8dC5sZW5ndGg7KytzKXt2YXIgbT0xPT09cz8idGhpc1dpcmVkIjoiYXJnIisocy0yKSsiV2lyZWQiO251bGwhPT10W3NdLmRlc3RydWN0b3JGdW5jdGlvbiYmKGQrPW0rIl9kdG9yKCIrbSsiKTsgLy8gIit0W3NdLm5hbWUrIlxuIixoLnB1c2gobSsiX2R0b3IiKSx5LnB1c2godFtzXS5kZXN0cnVjdG9yRnVuY3Rpb24pKX1yZXR1cm4gYyYmKGQrPSJ2YXIgcmV0ID0gcmV0VHlwZS5mcm9tV2lyZVR5cGUocnYpO1xucmV0dXJuIHJldDtcbiIpLGQrPSJ9XG4iLGgucHVzaChkKSxmdW5jdGlvbihlLHQpe2lmKCEoZSBpbnN0YW5jZW9mIEZ1bmN0aW9uKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJuZXdfIGNhbGxlZCB3aXRoIGNvbnN0cnVjdG9yIHR5cGUgIit0eXBlb2YgZSsiIHdoaWNoIGlzIG5vdCBhIGZ1bmN0aW9uIik7dmFyIHI9b2UoZS5uYW1lfHwidW5rbm93bkZ1bmN0aW9uTmFtZSIsKGZ1bmN0aW9uKCl7fSkpO3IucHJvdG90eXBlPWUucHJvdG90eXBlO3ZhciBuPW5ldyByLGE9ZS5hcHBseShuLHQpO3JldHVybiBhIGluc3RhbmNlb2YgT2JqZWN0P2E6bn0oRnVuY3Rpb24saCkuYXBwbHkobnVsbCx5KX0obixhLGUsbyxpKTtyZXR1cm4gdm9pZCAwPT09Y1t0XS5vdmVybG9hZFRhYmxlPyh1LmFyZ0NvdW50PXItMixjW3RdPXUpOmNbdF0ub3ZlcmxvYWRUYWJsZVtyLTJdPXUsW119KSksW119KSl9LHA6ZnVuY3Rpb24oZSx0LHIsbixhLG8saSx1LHMsYyl7dD1lZSh0KSxhPUllKG4sYSksbGUoW10sW2VdLChmdW5jdGlvbihlKXt2YXIgbj0oZT1lWzBdKS5uYW1lKyIuIit0LGY9e2dldDpmdW5jdGlvbigpe1llKCJDYW5ub3QgYWNjZXNzICIrbisiIGR1ZSB0byB1bmJvdW5kIHR5cGVzIixbcixpXSl9LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfTtyZXR1cm4gZi5zZXQ9cz9mdW5jdGlvbigpe1llKCJDYW5ub3QgYWNjZXNzICIrbisiIGR1ZSB0byB1bmJvdW5kIHR5cGVzIixbcixpXSl9OmZ1bmN0aW9uKGUpe3NlKG4rIiBpcyBhIHJlYWQtb25seSBwcm9wZXJ0eSIpfSxPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5yZWdpc3RlcmVkQ2xhc3MuaW5zdGFuY2VQcm90b3R5cGUsdCxmKSxsZShbXSxzP1tyLGldOltyXSwoZnVuY3Rpb24ocil7dmFyIGk9clswXSxmPXtnZXQ6ZnVuY3Rpb24oKXt2YXIgdD1IZSh0aGlzLGUsbisiIGdldHRlciIpO3JldHVybiBpLmZyb21XaXJlVHlwZShhKG8sdCkpfSxlbnVtZXJhYmxlOiEwfTtpZihzKXtzPUllKHUscyk7dmFyIGw9clsxXTtmLnNldD1mdW5jdGlvbih0KXt2YXIgcj1IZSh0aGlzLGUsbisiIHNldHRlciIpLGE9W107cyhjLHIsbC50b1dpcmVUeXBlKGEsdCkpLHhlKGEpfX1yZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucmVnaXN0ZXJlZENsYXNzLmluc3RhbmNlUHJvdG90eXBlLHQsZiksW119KSksW119KSl9LHg6ZnVuY3Rpb24oZSx0KXtkZShlLHtuYW1lOnQ9ZWUodCksZnJvbVdpcmVUeXBlOmZ1bmN0aW9uKGUpe3ZhciB0PXplW2VdLnZhbHVlO3JldHVybiBOZShlKSx0fSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIEJlKHQpfSxhcmdQYWNrQWR2YW5jZTo4LHJlYWRWYWx1ZUZyb21Qb2ludGVyOlNlLGRlc3RydWN0b3JGdW5jdGlvbjpudWxsfSl9LGw6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPUsocik7ZGUoZSx7bmFtZTp0PWVlKHQpLGZyb21XaXJlVHlwZTpmdW5jdGlvbihlKXtyZXR1cm4gZX0sdG9XaXJlVHlwZTpmdW5jdGlvbihlLHQpe2lmKCJudW1iZXIiIT10eXBlb2YgdCYmImJvb2xlYW4iIT10eXBlb2YgdCl0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY29udmVydCAiJytWZSh0KSsnIiB0byAnK3RoaXMubmFtZSk7cmV0dXJuIHR9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6ZnVuY3Rpb24oZSx0KXtzd2l0Y2godCl7Y2FzZSAyOnJldHVybiBmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5mcm9tV2lyZVR5cGUoaFtlPj4yXSl9O2Nhc2UgMzpyZXR1cm4gZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZnJvbVdpcmVUeXBlKHlbZT4+M10pfTtkZWZhdWx0OnRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gZmxvYXQgdHlwZTogIitlKX19KHQsbiksZGVzdHJ1Y3RvckZ1bmN0aW9uOm51bGx9KX0sZTpmdW5jdGlvbihlLHQscixuLGEpe3Q9ZWUodCksLTE9PT1hJiYoYT00Mjk0OTY3Mjk1KTt2YXIgbz1LKHIpLGk9ZnVuY3Rpb24oZSl7cmV0dXJuIGV9O2lmKDA9PT1uKXt2YXIgdT0zMi04KnI7aT1mdW5jdGlvbihlKXtyZXR1cm4gZTw8dT4+PnV9fXZhciBoPS0xIT10LmluZGV4T2YoInVuc2lnbmVkIik7ZGUoZSx7bmFtZTp0LGZyb21XaXJlVHlwZTppLHRvV2lyZVR5cGU6ZnVuY3Rpb24oZSxyKXtpZigibnVtYmVyIiE9dHlwZW9mIHImJiJib29sZWFuIiE9dHlwZW9mIHIpdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNvbnZlcnQgIicrVmUocikrJyIgdG8gJyt0aGlzLm5hbWUpO2lmKHI8bnx8cj5hKXRocm93IG5ldyBUeXBlRXJyb3IoJ1Bhc3NpbmcgYSBudW1iZXIgIicrVmUocikrJyIgZnJvbSBKUyBzaWRlIHRvIEMvQysrIHNpZGUgdG8gYW4gYXJndW1lbnQgb2YgdHlwZSAiJyt0KyciLCB3aGljaCBpcyBvdXRzaWRlIHRoZSB2YWxpZCByYW5nZSBbJytuKyIsICIrYSsiXSEiKTtyZXR1cm4gaD9yPj4+MDowfHJ9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6ZnVuY3Rpb24oZSx0LHIpe3N3aXRjaCh0KXtjYXNlIDA6cmV0dXJuIHI/ZnVuY3Rpb24oZSl7cmV0dXJuIHNbZV19OmZ1bmN0aW9uKGUpe3JldHVybiBjW2VdfTtjYXNlIDE6cmV0dXJuIHI/ZnVuY3Rpb24oZSl7cmV0dXJuIGZbZT4+MV19OmZ1bmN0aW9uKGUpe3JldHVybiBsW2U+PjFdfTtjYXNlIDI6cmV0dXJuIHI/ZnVuY3Rpb24oZSl7cmV0dXJuIGRbZT4+Ml19OmZ1bmN0aW9uKGUpe3JldHVybiBwW2U+PjJdfTtkZWZhdWx0OnRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gaW50ZWdlciB0eXBlOiAiK2UpfX0odCxvLDAhPT1uKSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfSxkOmZ1bmN0aW9uKGUsdCxyKXt2YXIgbj1bSW50OEFycmF5LFVpbnQ4QXJyYXksSW50MTZBcnJheSxVaW50MTZBcnJheSxJbnQzMkFycmF5LFVpbnQzMkFycmF5LEZsb2F0MzJBcnJheSxGbG9hdDY0QXJyYXldW3RdO2Z1bmN0aW9uIGEoZSl7dmFyIHQ9cCxyPXRbZT4+PTJdLGE9dFtlKzFdO3JldHVybiBuZXcgbih1LGEscil9ZGUoZSx7bmFtZTpyPWVlKHIpLGZyb21XaXJlVHlwZTphLGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6YX0se2lnbm9yZUR1cGxpY2F0ZVJlZ2lzdHJhdGlvbnM6ITB9KX0sbTpmdW5jdGlvbihlLHQpe3ZhciByPSJzdGQ6OnN0cmluZyI9PT0odD1lZSh0KSk7ZGUoZSx7bmFtZTp0LGZyb21XaXJlVHlwZTpmdW5jdGlvbihlKXt2YXIgdCxuPXBbZT4+Ml07aWYocilmb3IodmFyIGE9ZSs0LG89MDtvPD1uOysrbyl7dmFyIGk9ZSs0K287aWYobz09bnx8MD09Y1tpXSl7dmFyIHU9UChhLGktYSk7dm9pZCAwPT09dD90PXU6KHQrPSJcMCIsdCs9dSksYT1pKzF9fWVsc2V7dmFyIHM9bmV3IEFycmF5KG4pO2ZvcihvPTA7bzxuOysrbylzW29dPVN0cmluZy5mcm9tQ2hhckNvZGUoY1tlKzQrb10pO3Q9cy5qb2luKCIiKX1yZXR1cm4gb3QoZSksdH0sdG9XaXJlVHlwZTpmdW5jdGlvbihlLHQpe3QgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciYmKHQ9bmV3IFVpbnQ4QXJyYXkodCkpO3ZhciBuPSJzdHJpbmciPT10eXBlb2YgdDtufHx0IGluc3RhbmNlb2YgVWludDhBcnJheXx8dCBpbnN0YW5jZW9mIFVpbnQ4Q2xhbXBlZEFycmF5fHx0IGluc3RhbmNlb2YgSW50OEFycmF5fHxzZSgiQ2Fubm90IHBhc3Mgbm9uLXN0cmluZyB0byBzdGQ6OnN0cmluZyIpO3ZhciBhPShyJiZuP2Z1bmN0aW9uKCl7cmV0dXJuIEEodCl9OmZ1bmN0aW9uKCl7cmV0dXJuIHQubGVuZ3RofSkoKSxvPW50KDQrYSsxKTtpZihwW28+PjJdPWEsciYmbilEKHQsYyxvKzQsYSsxKTtlbHNlIGlmKG4pZm9yKHZhciBpPTA7aTxhOysraSl7dmFyIHU9dC5jaGFyQ29kZUF0KGkpO3U+MjU1JiYob3Qobyksc2UoIlN0cmluZyBoYXMgVVRGLTE2IGNvZGUgdW5pdHMgdGhhdCBkbyBub3QgZml0IGluIDggYml0cyIpKSxjW28rNCtpXT11fWVsc2UgZm9yKGk9MDtpPGE7KytpKWNbbys0K2ldPXRbaV07cmV0dXJuIG51bGwhPT1lJiZlLnB1c2gob3Qsbyksb30sYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpTZSxkZXN0cnVjdG9yRnVuY3Rpb246ZnVuY3Rpb24oZSl7b3QoZSl9fSl9LGk6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuLGEsbyxpLHU7cj1lZShyKSwyPT09dD8obj1TLGE9RixpPU0sbz1mdW5jdGlvbigpe3JldHVybiBsfSx1PTEpOjQ9PT10JiYobj1FLGE9VyxpPUksbz1mdW5jdGlvbigpe3JldHVybiBwfSx1PTIpLGRlKGUse25hbWU6cixmcm9tV2lyZVR5cGU6ZnVuY3Rpb24oZSl7Zm9yKHZhciByLGE9cFtlPj4yXSxpPW8oKSxzPWUrNCxjPTA7Yzw9YTsrK2Mpe3ZhciBmPWUrNCtjKnQ7aWYoYz09YXx8MD09aVtmPj51XSl7dmFyIGw9bihzLGYtcyk7dm9pZCAwPT09cj9yPWw6KHIrPSJcMCIscis9bCkscz1mK3R9fXJldHVybiBvdChlKSxyfSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUsbil7InN0cmluZyIhPXR5cGVvZiBuJiZzZSgiQ2Fubm90IHBhc3Mgbm9uLXN0cmluZyB0byBDKysgc3RyaW5nIHR5cGUgIityKTt2YXIgbz1pKG4pLHM9bnQoNCtvK3QpO3JldHVybiBwW3M+PjJdPW8+PnUsYShuLHMrNCxvK3QpLG51bGwhPT1lJiZlLnB1c2gob3Qscyksc30sYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpTZSxkZXN0cnVjdG9yRnVuY3Rpb246ZnVuY3Rpb24oZSl7b3QoZSl9fSl9LHo6ZnVuY3Rpb24oZSx0KXtkZShlLHtpc1ZvaWQ6ITAsbmFtZTp0PWVlKHQpLGFyZ1BhY2tBZHZhbmNlOjAsZnJvbVdpcmVUeXBlOmZ1bmN0aW9uKCl7fSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUsdCl7fX0pfSxuOk5lLG86ZnVuY3Rpb24oZSl7ZT40JiYoemVbZV0ucmVmY291bnQrPTEpfSxoOmZ1bmN0aW9uKGUsdCl7dmFyIHIsbjtyZXR1cm4gQmUoKHZvaWQgMD09PShuPXJlW3I9ZV0pJiZzZSgiX2VtdmFsX3Rha2VfdmFsdWUgaGFzIHVua25vd24gdHlwZSAiK1JlKHIpKSxlPW4pLnJlYWRWYWx1ZUZyb21Qb2ludGVyKHQpKX0sazpmdW5jdGlvbigpe1YoKX0sdjpmdW5jdGlvbihlLHQpe3ZhciByO2lmKDA9PT1lKXI9RGF0ZS5ub3coKTtlbHNle2lmKDEhPT1lJiY0IT09ZSlyZXR1cm4gZFtydCgpPj4yXT0yOCwtMTtyPWcoKX1yZXR1cm4gZFt0Pj4yXT1yLzFlM3wwLGRbdCs0Pj4yXT1yJTFlMyoxZTZ8MCwwfSx0OmZ1bmN0aW9uKGUsdCxyKXtjLmNvcHlXaXRoaW4oZSx0LHQrcil9LHU6ZnVuY3Rpb24oZSl7VigiT09NIil9LHE6ZnVuY3Rpb24oZSl7WigpO3ZhciB0PW5ldyBEYXRlKGRbZSsyMD4+Ml0rMTkwMCxkW2UrMTY+PjJdLGRbZSsxMj4+Ml0sZFtlKzg+PjJdLGRbZSs0Pj4yXSxkW2U+PjJdLDApLHI9ZFtlKzMyPj4yXSxuPXQuZ2V0VGltZXpvbmVPZmZzZXQoKSxhPW5ldyBEYXRlKHQuZ2V0RnVsbFllYXIoKSwwLDEpLG89bmV3IERhdGUodC5nZXRGdWxsWWVhcigpLDYsMSkuZ2V0VGltZXpvbmVPZmZzZXQoKSxpPWEuZ2V0VGltZXpvbmVPZmZzZXQoKSx1PU1hdGgubWluKGksbyk7aWYocjwwKWRbZSszMj4+Ml09TnVtYmVyKG8hPWkmJnU9PW4pO2Vsc2UgaWYocj4wIT0odT09bikpe3ZhciBzPU1hdGgubWF4KGksbyksYz1yPjA/dTpzO3Quc2V0VGltZSh0LmdldFRpbWUoKSs2ZTQqKGMtbikpfWRbZSsyND4+Ml09dC5nZXREYXkoKTt2YXIgZj0odC5nZXRUaW1lKCktYS5nZXRUaW1lKCkpLzg2NGU1fDA7cmV0dXJuIGRbZSsyOD4+Ml09ZixkW2U+PjJdPXQuZ2V0U2Vjb25kcygpLGRbZSs0Pj4yXT10LmdldE1pbnV0ZXMoKSxkW2UrOD4+Ml09dC5nZXRIb3VycygpLGRbZSsxMj4+Ml09dC5nZXREYXRlKCksZFtlKzE2Pj4yXT10LmdldE1vbnRoKCksdC5nZXRUaW1lKCkvMWUzfDB9LHM6ZnVuY3Rpb24oZSx0LHIsbil7dmFyIGEsbyxpPWRbbis0MD4+Ml0sdT17dG1fc2VjOmRbbj4+Ml0sdG1fbWluOmRbbis0Pj4yXSx0bV9ob3VyOmRbbis4Pj4yXSx0bV9tZGF5OmRbbisxMj4+Ml0sdG1fbW9uOmRbbisxNj4+Ml0sdG1feWVhcjpkW24rMjA+PjJdLHRtX3dkYXk6ZFtuKzI0Pj4yXSx0bV95ZGF5OmRbbisyOD4+Ml0sdG1faXNkc3Q6ZFtuKzMyPj4yXSx0bV9nbXRvZmY6ZFtuKzM2Pj4yXSx0bV96b25lOmk/UChpKToiIn0sYz1QKHIpLGY9eyIlYyI6IiVhICViICVkICVIOiVNOiVTICVZIiwiJUQiOiIlbS8lZC8leSIsIiVGIjoiJVktJW0tJWQiLCIlaCI6IiViIiwiJXIiOiIlSTolTTolUyAlcCIsIiVSIjoiJUg6JU0iLCIlVCI6IiVIOiVNOiVTIiwiJXgiOiIlbS8lZC8leSIsIiVYIjoiJUg6JU06JVMiLCIlRWMiOiIlYyIsIiVFQyI6IiVDIiwiJUV4IjoiJW0vJWQvJXkiLCIlRVgiOiIlSDolTTolUyIsIiVFeSI6IiV5IiwiJUVZIjoiJVkiLCIlT2QiOiIlZCIsIiVPZSI6IiVlIiwiJU9IIjoiJUgiLCIlT0kiOiIlSSIsIiVPbSI6IiVtIiwiJU9NIjoiJU0iLCIlT1MiOiIlUyIsIiVPdSI6IiV1IiwiJU9VIjoiJVUiLCIlT1YiOiIlViIsIiVPdyI6IiV3IiwiJU9XIjoiJVciLCIlT3kiOiIleSJ9O2Zvcih2YXIgbCBpbiBmKWM9Yy5yZXBsYWNlKG5ldyBSZWdFeHAobCwiZyIpLGZbbF0pO3ZhciBwPVsiU3VuZGF5IiwiTW9uZGF5IiwiVHVlc2RheSIsIldlZG5lc2RheSIsIlRodXJzZGF5IiwiRnJpZGF5IiwiU2F0dXJkYXkiXSxoPVsiSmFudWFyeSIsIkZlYnJ1YXJ5IiwiTWFyY2giLCJBcHJpbCIsIk1heSIsIkp1bmUiLCJKdWx5IiwiQXVndXN0IiwiU2VwdGVtYmVyIiwiT2N0b2JlciIsIk5vdmVtYmVyIiwiRGVjZW1iZXIiXTtmdW5jdGlvbiB5KGUsdCxyKXtmb3IodmFyIG49Im51bWJlciI9PXR5cGVvZiBlP2UudG9TdHJpbmcoKTplfHwiIjtuLmxlbmd0aDx0OyluPXJbMF0rbjtyZXR1cm4gbn1mdW5jdGlvbiBtKGUsdCl7cmV0dXJuIHkoZSx0LCIwIil9ZnVuY3Rpb24gZyhlLHQpe3ZhciByO2Z1bmN0aW9uIG4oZSl7cmV0dXJuIGU8MD8tMTplPjA/MTowfXJldHVybiAwPT09KHI9bihlLmdldEZ1bGxZZWFyKCktdC5nZXRGdWxsWWVhcigpKSkmJjA9PT0ocj1uKGUuZ2V0TW9udGgoKS10LmdldE1vbnRoKCkpKSYmKHI9bihlLmdldERhdGUoKS10LmdldERhdGUoKSkpLHJ9ZnVuY3Rpb24gdihlKXtzd2l0Y2goZS5nZXREYXkoKSl7Y2FzZSAwOnJldHVybiBuZXcgRGF0ZShlLmdldEZ1bGxZZWFyKCktMSwxMSwyOSk7Y2FzZSAxOnJldHVybiBlO2Nhc2UgMjpyZXR1cm4gbmV3IERhdGUoZS5nZXRGdWxsWWVhcigpLDAsMyk7Y2FzZSAzOnJldHVybiBuZXcgRGF0ZShlLmdldEZ1bGxZZWFyKCksMCwyKTtjYXNlIDQ6cmV0dXJuIG5ldyBEYXRlKGUuZ2V0RnVsbFllYXIoKSwwLDEpO2Nhc2UgNTpyZXR1cm4gbmV3IERhdGUoZS5nZXRGdWxsWWVhcigpLTEsMTEsMzEpO2Nhc2UgNjpyZXR1cm4gbmV3IERhdGUoZS5nZXRGdWxsWWVhcigpLTEsMTEsMzApfX1mdW5jdGlvbiB3KGUpe3ZhciB0PVhlKG5ldyBEYXRlKGUudG1feWVhcisxOTAwLDAsMSksZS50bV95ZGF5KSxyPW5ldyBEYXRlKHQuZ2V0RnVsbFllYXIoKSwwLDQpLG49bmV3IERhdGUodC5nZXRGdWxsWWVhcigpKzEsMCw0KSxhPXYociksbz12KG4pO3JldHVybiAwPj1nKGEsdCk/MD49ZyhvLHQpP3QuZ2V0RnVsbFllYXIoKSsxOnQuZ2V0RnVsbFllYXIoKTp0LmdldEZ1bGxZZWFyKCktMX12YXIgYj17IiVhIjpmdW5jdGlvbihlKXtyZXR1cm4gcFtlLnRtX3dkYXldLnN1YnN0cmluZygwLDMpfSwiJUEiOmZ1bmN0aW9uKGUpe3JldHVybiBwW2UudG1fd2RheV19LCIlYiI6ZnVuY3Rpb24oZSl7cmV0dXJuIGhbZS50bV9tb25dLnN1YnN0cmluZygwLDMpfSwiJUIiOmZ1bmN0aW9uKGUpe3JldHVybiBoW2UudG1fbW9uXX0sIiVDIjpmdW5jdGlvbihlKXtyZXR1cm4gbSgoZS50bV95ZWFyKzE5MDApLzEwMHwwLDIpfSwiJWQiOmZ1bmN0aW9uKGUpe3JldHVybiBtKGUudG1fbWRheSwyKX0sIiVlIjpmdW5jdGlvbihlKXtyZXR1cm4geShlLnRtX21kYXksMiwiICIpfSwiJWciOmZ1bmN0aW9uKGUpe3JldHVybiB3KGUpLnRvU3RyaW5nKCkuc3Vic3RyaW5nKDIpfSwiJUciOmZ1bmN0aW9uKGUpe3JldHVybiB3KGUpfSwiJUgiOmZ1bmN0aW9uKGUpe3JldHVybiBtKGUudG1faG91ciwyKX0sIiVJIjpmdW5jdGlvbihlKXt2YXIgdD1lLnRtX2hvdXI7cmV0dXJuIDA9PXQ/dD0xMjp0PjEyJiYodC09MTIpLG0odCwyKX0sIiVqIjpmdW5jdGlvbihlKXtyZXR1cm4gbShlLnRtX21kYXkrSmUoTGUoZS50bV95ZWFyKzE5MDApP0dlOnFlLGUudG1fbW9uLTEpLDMpfSwiJW0iOmZ1bmN0aW9uKGUpe3JldHVybiBtKGUudG1fbW9uKzEsMil9LCIlTSI6ZnVuY3Rpb24oZSl7cmV0dXJuIG0oZS50bV9taW4sMil9LCIlbiI6ZnVuY3Rpb24oKXtyZXR1cm4iXG4ifSwiJXAiOmZ1bmN0aW9uKGUpe3JldHVybiBlLnRtX2hvdXI+PTAmJmUudG1faG91cjwxMj8iQU0iOiJQTSJ9LCIlUyI6ZnVuY3Rpb24oZSl7cmV0dXJuIG0oZS50bV9zZWMsMil9LCIldCI6ZnVuY3Rpb24oKXtyZXR1cm4iXHQifSwiJXUiOmZ1bmN0aW9uKGUpe3JldHVybiBlLnRtX3dkYXl8fDd9LCIlVSI6ZnVuY3Rpb24oZSl7dmFyIHQ9bmV3IERhdGUoZS50bV95ZWFyKzE5MDAsMCwxKSxyPTA9PT10LmdldERheSgpP3Q6WGUodCw3LXQuZ2V0RGF5KCkpLG49bmV3IERhdGUoZS50bV95ZWFyKzE5MDAsZS50bV9tb24sZS50bV9tZGF5KTtpZigwPmcocixuKSl7dmFyIGE9SmUoTGUobi5nZXRGdWxsWWVhcigpKT9HZTpxZSxuLmdldE1vbnRoKCktMSktMzE7cmV0dXJuIG0oTWF0aC5jZWlsKCgzMS1yLmdldERhdGUoKSthK24uZ2V0RGF0ZSgpKS83KSwyKX1yZXR1cm4gMD09PWcocix0KT8iMDEiOiIwMCJ9LCIlViI6ZnVuY3Rpb24oZSl7dmFyIHQ9bmV3IERhdGUoZS50bV95ZWFyKzE5MDAsMCw0KSxyPW5ldyBEYXRlKGUudG1feWVhcisxOTAxLDAsNCksbj12KHQpLGE9dihyKSxvPVhlKG5ldyBEYXRlKGUudG1feWVhcisxOTAwLDAsMSksZS50bV95ZGF5KTtyZXR1cm4gMD5nKG8sbik/IjUzIjowPj1nKGEsbyk/IjAxIjptKE1hdGguY2VpbCgobi5nZXRGdWxsWWVhcigpPGUudG1feWVhcisxOTAwP2UudG1feWRheSszMi1uLmdldERhdGUoKTplLnRtX3lkYXkrMS1uLmdldERhdGUoKSkvNyksMil9LCIldyI6ZnVuY3Rpb24oZSl7cmV0dXJuIGUudG1fd2RheX0sIiVXIjpmdW5jdGlvbihlKXt2YXIgdD1uZXcgRGF0ZShlLnRtX3llYXIsMCwxKSxyPTE9PT10LmdldERheSgpP3Q6WGUodCwwPT09dC5nZXREYXkoKT8xOjctdC5nZXREYXkoKSsxKSxuPW5ldyBEYXRlKGUudG1feWVhcisxOTAwLGUudG1fbW9uLGUudG1fbWRheSk7aWYoMD5nKHIsbikpe3ZhciBhPUplKExlKG4uZ2V0RnVsbFllYXIoKSk/R2U6cWUsbi5nZXRNb250aCgpLTEpLTMxO3JldHVybiBtKE1hdGguY2VpbCgoMzEtci5nZXREYXRlKCkrYStuLmdldERhdGUoKSkvNyksMil9cmV0dXJuIDA9PT1nKHIsdCk/IjAxIjoiMDAifSwiJXkiOmZ1bmN0aW9uKGUpe3JldHVybihlLnRtX3llYXIrMTkwMCkudG9TdHJpbmcoKS5zdWJzdHJpbmcoMil9LCIlWSI6ZnVuY3Rpb24oZSl7cmV0dXJuIGUudG1feWVhcisxOTAwfSwiJXoiOmZ1bmN0aW9uKGUpe3ZhciB0PWUudG1fZ210b2ZmO3JldHVybih0Pj0wPyIrIjoiLSIpK1N0cmluZygiMDAwMCIrKHQ9KHQ9TWF0aC5hYnModCkvNjApLzYwKjEwMCt0JTYwKSkuc2xpY2UoLTQpfSwiJVoiOmZ1bmN0aW9uKGUpe3JldHVybiBlLnRtX3pvbmV9LCIlJSI6ZnVuY3Rpb24oKXtyZXR1cm4iJSJ9fTtmb3IodmFyIGwgaW4gYiljLmluZGV4T2YobCk+PTAmJihjPWMucmVwbGFjZShuZXcgUmVnRXhwKGwsImciKSxiW2xdKHUpKSk7dmFyIFQ9S2UoYywhMSk7cmV0dXJuIFQubGVuZ3RoPnQ/MDooYT1ULG89ZSxzLnNldChhLG8pLFQubGVuZ3RoLTEpfSxyOmZ1bmN0aW9uKGUsdCxyKXtmb3IodmFyIG49UCh0KSxhPSJcXCFAIyReJiooKSs9LVtdL3t9fDo8Pj8sLiIsbz0wLGk9YS5sZW5ndGg7bzxpOysrbyluPW4ucmVwbGFjZShuZXcgUmVnRXhwKCJcXCIrYVtvXSwiZyIpLCJcXCIrYVtvXSk7dmFyIHU9eyIlQSI6IiVhIiwiJUIiOiIlYiIsIiVjIjoiJWEgJWIgJWQgJUg6JU06JVMgJVkiLCIlRCI6IiVtXFwvJWRcXC8leSIsIiVlIjoiJWQiLCIlRiI6IiVZLSVtLSVkIiwiJWgiOiIlYiIsIiVSIjoiJUhcXDolTSIsIiVyIjoiJUlcXDolTVxcOiVTXFxzJXAiLCIlVCI6IiVIXFw6JU1cXDolUyIsIiV4IjoiJW1cXC8lZFxcLyg/OiV5fCVZKSIsIiVYIjoiJUhcXDolTVxcOiVTIn07Zm9yKHZhciBzIGluIHUpbj1uLnJlcGxhY2Uocyx1W3NdKTt2YXIgYz17IiVhIjoiKD86U3VuKD86ZGF5KT8pfCg/Ok1vbig/OmRheSk/KXwoPzpUdWUoPzpzZGF5KT8pfCg/OldlZCg/Om5lc2RheSk/KXwoPzpUaHUoPzpyc2RheSk/KXwoPzpGcmkoPzpkYXkpPyl8KD86U2F0KD86dXJkYXkpPykiLCIlYiI6Iig/Okphbig/OnVhcnkpPyl8KD86RmViKD86cnVhcnkpPyl8KD86TWFyKD86Y2gpPyl8KD86QXByKD86aWwpPyl8TWF5fCg/Okp1big/OmUpPyl8KD86SnVsKD86eSk/KXwoPzpBdWcoPzp1c3QpPyl8KD86U2VwKD86dGVtYmVyKT8pfCg/Ok9jdCg/Om9iZXIpPyl8KD86Tm92KD86ZW1iZXIpPyl8KD86RGVjKD86ZW1iZXIpPykiLCIlQyI6IlxcZFxcZCIsIiVkIjoiMFsxLTldfFsxLTldKD8hXFxkKXwxXFxkfDJcXGR8MzB8MzEiLCIlSCI6IlxcZCg/IVxcZCl8WzAsMV1cXGR8MjB8MjF8MjJ8MjMiLCIlSSI6IlxcZCg/IVxcZCl8MFxcZHwxMHwxMXwxMiIsIiVqIjoiMDBbMS05XXwwP1sxLTldKD8hXFxkKXwwP1sxLTldXFxkKD8hXFxkKXxbMSwyXVxcZFxcZHwzWzAtNl1cXGQiLCIlbSI6IjBbMS05XXxbMS05XSg/IVxcZCl8MTB8MTF8MTIiLCIlTSI6IjBcXGR8XFxkKD8hXFxkKXxbMS01XVxcZCIsIiVuIjoiXFxzIiwiJXAiOiJBTXxhbXxQTXxwbXxBXFwuTVxcLnxhXFwubVxcLnxQXFwuTVxcLnxwXFwubVxcLiIsIiVTIjoiMFxcZHxcXGQoPyFcXGQpfFsxLTVdXFxkfDYwIiwiJVUiOiIwXFxkfFxcZCg/IVxcZCl8WzEtNF1cXGR8NTB8NTF8NTJ8NTMiLCIlVyI6IjBcXGR8XFxkKD8hXFxkKXxbMS00XVxcZHw1MHw1MXw1Mnw1MyIsIiV3IjoiWzAtNl0iLCIleSI6IlxcZFxcZCIsIiVZIjoiXFxkXFxkXFxkXFxkIiwiJSUiOiIlIiwiJXQiOiJcXHMifTtmb3IodmFyIGYgaW4gYyluPW4ucmVwbGFjZShmLCIoIitmK2NbZl0rIikiKTt2YXIgbD1bXTtmb3Iobz1uLmluZGV4T2YoIiUiKTtvPj0wO289bi5pbmRleE9mKCIlIikpbC5wdXNoKG5bbysxXSksbj1uLnJlcGxhY2UobmV3IFJlZ0V4cCgiXFwlIituW28rMV0sImciKSwiIik7dmFyIHA9bmV3IFJlZ0V4cCgiXiIrbiwiaSIpLmV4ZWMoUChlKSk7aWYocCl7dmFyIGg9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKGUsdCxyKXtyZXR1cm4ibnVtYmVyIiE9dHlwZW9mIGV8fGlzTmFOKGUpP3Q6ZT49dD9lPD1yP2U6cjp0fXJldHVybnt5ZWFyOmUoZFtyKzIwPj4yXSsxOTAwLDE5NzAsOTk5OSksbW9udGg6ZShkW3IrMTY+PjJdLDAsMTEpLGRheTplKGRbcisxMj4+Ml0sMSwzMSksaG91cjplKGRbcis4Pj4yXSwwLDIzKSxtaW46ZShkW3IrND4+Ml0sMCw1OSksc2VjOmUoZFtyPj4yXSwwLDU5KX19KCkseT1mdW5jdGlvbihlKXt2YXIgdD1sLmluZGV4T2YoZSk7aWYodD49MClyZXR1cm4gcFt0KzFdfTtpZigoXz15KCJTIikpJiYoaC5zZWM9WmUoXykpLChfPXkoIk0iKSkmJihoLm1pbj1aZShfKSksXz15KCJIIikpaC5ob3VyPVplKF8pO2Vsc2UgaWYoXz15KCJJIikpe3ZhciBtPVplKF8pOyhfPXkoInAiKSkmJihtKz0iUCI9PT1fLnRvVXBwZXJDYXNlKClbMF0/MTI6MCksaC5ob3VyPW19aWYoXz15KCJZIikpaC55ZWFyPVplKF8pO2Vsc2UgaWYoXz15KCJ5Iikpe3ZhciBnPVplKF8pOyhfPXkoIkMiKSk/Zys9MTAwKlplKF8pOmcrPWc8Njk/MmUzOjE5MDAsaC55ZWFyPWd9aWYoKF89eSgibSIpKT9oLm1vbnRoPVplKF8pLTE6KF89eSgiYiIpKSYmKGgubW9udGg9e0pBTjowLEZFQjoxLE1BUjoyLEFQUjozLE1BWTo0LEpVTjo1LEpVTDo2LEFVRzo3LFNFUDo4LE9DVDo5LE5PVjoxMCxERUM6MTF9W18uc3Vic3RyaW5nKDAsMykudG9VcHBlckNhc2UoKV18fDApLF89eSgiZCIpKWguZGF5PVplKF8pO2Vsc2UgaWYoXz15KCJqIikpZm9yKHZhciB2PVplKF8pLHc9TGUoaC55ZWFyKSxiPTA7YjwxMjsrK2Ipe3ZhciBUPUplKHc/R2U6cWUsYi0xKTt2PD1UKyh3P0dlOnFlKVtiXSYmKGguZGF5PXYtVCl9ZWxzZSBpZihfPXkoImEiKSl7dmFyICQ9Xy5zdWJzdHJpbmcoMCwzKS50b1VwcGVyQ2FzZSgpO2lmKF89eSgiVSIpKXt2YXIgXyxDPXtTVU46MCxNT046MSxUVUU6MixXRUQ6MyxUSFU6NCxGUkk6NSxTQVQ6Nn1bJF0sRD1aZShfKTtBPTA9PT0oTz1uZXcgRGF0ZShoLnllYXIsMCwxKSkuZ2V0RGF5KCk/WGUoTyxDKzcqKEQtMSkpOlhlKE8sNy1PLmdldERheSgpK0MrNyooRC0xKSksaC5kYXk9QS5nZXREYXRlKCksaC5tb250aD1BLmdldE1vbnRoKCl9ZWxzZSBpZihfPXkoIlciKSl7dmFyIEEsTztDPXtNT046MCxUVUU6MSxXRUQ6MixUSFU6MyxGUkk6NCxTQVQ6NSxTVU46Nn1bJF0sRD1aZShfKSxBPTE9PT0oTz1uZXcgRGF0ZShoLnllYXIsMCwxKSkuZ2V0RGF5KCk/WGUoTyxDKzcqKEQtMSkpOlhlKE8sNy1PLmdldERheSgpKzErQys3KihELTEpKSxoLmRheT1BLmdldERhdGUoKSxoLm1vbnRoPUEuZ2V0TW9udGgoKX19dmFyIFM9bmV3IERhdGUoaC55ZWFyLGgubW9udGgsaC5kYXksaC5ob3VyLGgubWluLGguc2VjLDApO3JldHVybiBkW3I+PjJdPVMuZ2V0U2Vjb25kcygpLGRbcis0Pj4yXT1TLmdldE1pbnV0ZXMoKSxkW3IrOD4+Ml09Uy5nZXRIb3VycygpLGRbcisxMj4+Ml09Uy5nZXREYXRlKCksZFtyKzE2Pj4yXT1TLmdldE1vbnRoKCksZFtyKzIwPj4yXT1TLmdldEZ1bGxZZWFyKCktMTkwMCxkW3IrMjQ+PjJdPVMuZ2V0RGF5KCksZFtyKzI4Pj4yXT1KZShMZShTLmdldEZ1bGxZZWFyKCkpP0dlOnFlLFMuZ2V0TW9udGgoKS0xKStTLmdldERhdGUoKS0xLGRbciszMj4+Ml09MCxlK0tlKHBbMF0pLmxlbmd0aC0xfXJldHVybiAwfSxqOmZ1bmN0aW9uKGUpe3ZhciB0PURhdGUubm93KCkvMWUzfDA7cmV0dXJuIGUmJihkW2U+PjJdPXQpLHR9fSxldD1mdW5jdGlvbigpe3ZhciBlPXthOlFlfTtmdW5jdGlvbiByKGUscil7dmFyIG4sYT1lLmV4cG9ydHM7dC5hc209YSx1PW49dC5hc20uQS5idWZmZXIsdC5IRUFQOD1zPW5ldyBJbnQ4QXJyYXkobiksdC5IRUFQMTY9Zj1uZXcgSW50MTZBcnJheShuKSx0LkhFQVAzMj1kPW5ldyBJbnQzMkFycmF5KG4pLHQuSEVBUFU4PWM9bmV3IFVpbnQ4QXJyYXkobiksdC5IRUFQVTE2PWw9bmV3IFVpbnQxNkFycmF5KG4pLHQuSEVBUFUzMj1wPW5ldyBVaW50MzJBcnJheShuKSx0LkhFQVBGMzI9aD1uZXcgRmxvYXQzMkFycmF5KG4pLHQuSEVBUEY2ND15PW5ldyBGbG9hdDY0QXJyYXkobiksbT10LmFzbS5DLGZ1bmN0aW9uKGUpe2lmKHotLSx0Lm1vbml0b3JSdW5EZXBlbmRlbmNpZXMmJnQubW9uaXRvclJ1bkRlcGVuZGVuY2llcyh6KSwwPT16JiYobnVsbCE9PU4mJihjbGVhckludGVydmFsKE4pLE49bnVsbCksQikpe3ZhciByPUI7Qj1udWxsLHIoKX19KCl9aWYoeisrLHQubW9uaXRvclJ1bkRlcGVuZGVuY2llcyYmdC5tb25pdG9yUnVuRGVwZW5kZW5jaWVzKHopLHQuaW5zdGFudGlhdGVXYXNtKXRyeXtyZXR1cm4gdC5pbnN0YW50aWF0ZVdhc20oZSxyKX1jYXRjaChlKXtyZXR1cm4gJCgiTW9kdWxlLmluc3RhbnRpYXRlV2FzbSBjYWxsYmFjayBmYWlsZWQgd2l0aCBlcnJvcjogIitlKSwhMX12YXIgbj1mdW5jdGlvbihlLHQpe3RyeXthPWZ1bmN0aW9uKGUpe3RyeXtpZihlPT1HJiZpKXJldHVybiBuZXcgVWludDhBcnJheShpKTt0aHJvdyJzeW5jIGZldGNoaW5nIG9mIHRoZSB3YXNtIGZhaWxlZDogeW91IGNhbiBwcmVsb2FkIGl0IHRvIE1vZHVsZVsnd2FzbUJpbmFyeSddIG1hbnVhbGx5LCBvciBlbWNjLnB5IHdpbGwgZG8gdGhhdCBmb3IgeW91IHdoZW4gZ2VuZXJhdGluZyBIVE1MIChidXQgbm90IEpTKSJ9Y2F0Y2goZSl7VihlKX19KGUpLG49bmV3IFdlYkFzc2VtYmx5Lk1vZHVsZShhKSxyPW5ldyBXZWJBc3NlbWJseS5JbnN0YW5jZShuLHQpfWNhdGNoKGUpe3ZhciByLG4sYSxvPWUudG9TdHJpbmcoKTt0aHJvdyAkKCJmYWlsZWQgdG8gY29tcGlsZSB3YXNtIG1vZHVsZTogIitvKSwoby5pbmRleE9mKCJpbXBvcnRlZCBNZW1vcnkiKT49MHx8by5pbmRleE9mKCJtZW1vcnkgaW1wb3J0Iik+PTApJiYkKCJNZW1vcnkgc2l6ZSBpbmNvbXBhdGliaWxpdHkgaXNzdWVzIG1heSBiZSBkdWUgdG8gY2hhbmdpbmcgSU5JVElBTF9NRU1PUlkgYXQgcnVudGltZSB0byBzb21ldGhpbmcgdG9vIGxhcmdlLiBVc2UgQUxMT1dfTUVNT1JZX0dST1dUSCB0byBhbGxvdyBhbnkgc2l6ZSBtZW1vcnkgKGFuZCBhbHNvIG1ha2Ugc3VyZSBub3QgdG8gc2V0IElOSVRJQUxfTUVNT1JZIGF0IHJ1bnRpbWUgdG8gc29tZXRoaW5nIHNtYWxsZXIgdGhhbiBpdCB3YXMgYXQgY29tcGlsZSB0aW1lKS4iKSxlfXJldHVybltyLG5dfShHLGUpO3JldHVybiByKG5bMF0sblsxXSksdC5hc219KCksdHQ9dC5fX193YXNtX2NhbGxfY3RvcnM9ZXQuQixydD10Ll9fX2Vycm5vX2xvY2F0aW9uPWV0LkQsbnQ9dC5fbWFsbG9jPWV0LkUsYXQ9dC5fX19nZXRUeXBlTmFtZT1ldC5GO3QuX19fZW1iaW5kX3JlZ2lzdGVyX25hdGl2ZV9hbmRfYnVpbHRpbl90eXBlcz1ldC5HO3ZhciBvdD10Ll9mcmVlPWV0LkgsaXQ9dC5fX2dldF90em5hbWU9ZXQuSSx1dD10Ll9fZ2V0X2RheWxpZ2h0PWV0Lkosc3Q9dC5fX2dldF90aW1lem9uZT1ldC5LO2Z1bmN0aW9uIGN0KGUpe2Z1bmN0aW9uIHIoKXshdiYmKHY9ITAsdC5jYWxsZWRSdW49ITAsX3x8KHEoWSkscShVKSxuKHQpLHQub25SdW50aW1lSW5pdGlhbGl6ZWQmJnQub25SdW50aW1lSW5pdGlhbGl6ZWQoKSxmdW5jdGlvbigpe2lmKHQucG9zdFJ1bilmb3IoImZ1bmN0aW9uIj09dHlwZW9mIHQucG9zdFJ1biYmKHQucG9zdFJ1bj1bdC5wb3N0UnVuXSk7dC5wb3N0UnVuLmxlbmd0aDspaih0LnBvc3RSdW4uc2hpZnQoKSk7cSh4KX0oKSkpfWU9ZXx8YiwhKHo+MCkmJihmdW5jdGlvbigpe2lmKHQucHJlUnVuKWZvcigiZnVuY3Rpb24iPT10eXBlb2YgdC5wcmVSdW4mJih0LnByZVJ1bj1bdC5wcmVSdW5dKTt0LnByZVJ1bi5sZW5ndGg7KUgodC5wcmVSdW4uc2hpZnQoKSk7cShSKX0oKSx6PjB8fCh0LnNldFN0YXR1cz8odC5zZXRTdGF0dXMoIlJ1bm5pbmcuLi4iKSxzZXRUaW1lb3V0KChmdW5jdGlvbigpe3NldFRpbWVvdXQoKGZ1bmN0aW9uKCl7dC5zZXRTdGF0dXMoIiIpfSksMSkscigpfSksMSkpOnIoKSkpfWlmKEI9ZnVuY3Rpb24gZSgpe3Z8fGN0KCksdnx8KEI9ZSl9LHQucnVuPWN0LHQucHJlSW5pdClmb3IoImZ1bmN0aW9uIj09dHlwZW9mIHQucHJlSW5pdCYmKHQucHJlSW5pdD1bdC5wcmVJbml0XSk7dC5wcmVJbml0Lmxlbmd0aD4wOyl0LnByZUluaXQucG9wKCkoKTtyZXR1cm4gY3QoKSx0fSk7bGV0IHI9bnVsbDtzZWxmLm9ubWVzc2FnZT1mdW5jdGlvbihlKXtzd2l0Y2goZS5kYXRhLmNtZCl7Y2FzZSJwcmVJbml0IjooYXN5bmMgZT0+e2xldCBuPWF3YWl0KGF3YWl0IGZldGNoKGUuYnVuZGxlUGF0aCsiL0ZQaGlTZWxwaElEVG9rZW5pemVyV2FzbS53YXNtIikpLmFycmF5QnVmZmVyKCk7cj1hd2FpdCB0KHt3YXNtQmluYXJ5Om59KSxzZWxmLnBvc3RNZXNzYWdlKHtjbWQ6InByZUluaXQifSl9KShlLmRhdGEpO2JyZWFrO2Nhc2UiZ2V0SW50ZXJuYWxMaWNlbnNlIjooYXN5bmMgZT0+e2xldCB0PW5ldyByLlNlbHBoSUREb2N1bWVudFJhd0RhdGE7dC5zZXRMaWNlbnNlSGV4KGUudG9rZW4udG9VcHBlckNhc2UoKSk7bGV0IG49dC5nZXRMaWNlbnNlU3RhdHVzKCksYT10LmdldExpY2Vuc2VEb2N1bWVudCgpLG89dC5nZXRMaWNlbnNlRW5naW5lVHlwZSgpO3NlbGYucG9zdE1lc3NhZ2Uoe2NtZDoiZ2V0SW50ZXJuYWxMaWNlbnNlIix0b2tlbjphLGVuZ2luZVR5cGU6byxzdGF0dXM6bn0pfSkoZS5kYXRhKTticmVhaztjYXNlImRlc3Ryb3kiOihhc3luYygpPT57W3JdLmZvckVhY2goKGU9PntudWxsIT09ZSYmdm9pZCAwIT09ZS5kZWxldGUmJmUuZGVsZXRlKCl9KSksY2xvc2UoKX0pKGUuZGF0YSl9fTs=")],{type:"text/javascript"}))),ye));return i.postMessage({cmd:"preInit",bundlePath:e}),new Promise((e=>{i.onmessage=l=>{"preInit"===l.data.cmd&&(t.worker=i,e())}}))}}static async getInternalLicense(e,t){return await Ce.__checkWorker(e),Ce.worker.postMessage({cmd:"getInternalLicense",token:t}),new Promise((e=>{Ce.worker.onmessage=t=>{"getInternalLicense"===t.data.cmd&&e({token:t.data.token,engineType:t.data.engineType})}}))}static destroyWorker(){null!==Ce.worker&&(Ce.worker.postMessage({cmd:"destroy"}),Ce.worker=null)}}const Ne={};Ne.SelphID=e,Ne.SelphID.RecorderType={Local:0,Remote:1},Ne.SelphID.ConfigurationManager=class{constructor(){this.container=null,this.language="en",this.dpiList=[163,326,489],this.cameraWidth=1920,this.cameraHeight=1080,this.cameraId=null,this.showLog=!1,this.bundlePath="",this.resourcesPath=this.bundlePath+"/FPhi.Widget.Resources",this.accessibility=!1,this.accessibleElements=["button","buttonImage"],this.onExtractionFinish=null,this.onUserCancel=null,this.onExceptionCaptured=null,this.onExtractionTimeout=null,this.onModuleLoaded=null,this.onTrackStatus=null,this.mode=e.Mode.Full,this.captureMode=e.CaptureMode.DoubleSide,this.license="",this.askSimpleMode=!0,this.previewCapture=!0,this.blurredThreshold=.1,this.cameraOverflow=!1,this.forceLandscape=!1,this.canvasHD=!1,this.cropFactor=1,this.initialTip=!1,this.captureTimeout=10,this.captureRetries=3,this.graphPath=this.bundlePath+"/graph.xml",this.imageFormat="image/png",this.imageQuality=.95,this.externalCamera=!1,this.videoRecord=!1,this.videoRecordRate=3,this.videoRecordScale=.5,this.videoRecordType=e.RecorderType.Local,this.startSimpleMode=!1,this.cameraMirror=!0,this.documentType=e.DocumentType.IDCard,this.scanMode=e.ScanMode.Search,this.specificData="ES"}setContainer(e){this.container=e}getContainer(){return this.container}setLanguage(e){this.language=e}getLanguage(){return this.language}setDpiList(e){this.dpiList=e}getDpiList(){return this.dpiList}setResourcesPath(e){this.resourcesPath=e}getResourcesPath(){return this.resourcesPath}setBundlePath(e){this.bundlePath=e,this.graphPath=this.bundlePath+"/graph.xml",this.resourcesPath=this.bundlePath+"/FPhi.Widget.Resources"}getBundlePath(){return this.bundlePath}setGraphPath(e){this.graphPath=e}getGraphPath(){return this.graphPath}setCameraWidth(e){this.cameraWidth=e}getCameraWidth(){return this.cameraWidth}setCameraHeight(e){this.cameraHeight=e}getCameraHeight(){return this.cameraHeight}setOnExtractionFinish(e){this.onExtractionFinish=e}getOnExtractionFinish(){return this.onExtractionFinish}setOnUserCancel(e){this.onUserCancel=e}getOnUserCancel(){return this.onUserCancel}setOnExceptionCaptured(e){this.onExceptionCaptured=e}getOnExceptionCaptured(){return this.onExceptionCaptured}setOnExtractionTimeout(e){this.onExtractionTimeout=e}getOnExtractionTimeout(){return this.onExtractionTimeout}setOnModuleLoaded(e){this.onModuleLoaded=e}getOnModuleLoaded(){return this.onModuleLoaded}setOnTrackStatus(e){this.onTrackStatus=e}getOnTrackStatus(){return this.onTrackStatus}setMode(e){this.mode=e}getMode(){return this.mode}setAskSimpleMode(e){this.askSimpleMode=e}getAskSimpleMode(){return this.askSimpleMode}setPreviewCapture(e){this.previewCapture=e}getPreviewCapture(){return this.previewCapture}setDocumentAspectRatio(e){this.documentAspectRatio=e}getDocumentAspectRatio(){return this.documentAspectRatio}setCropFactor(e){this.cropFactor=e,this.cropFactor<1&&(this.cropFactor=1)}getCropFactor(){return this.cropFactor}setForceLandscape(e){this.forceLandscape=e}getForceLandscape(){return this.forceLandscape}setCanvasHD(e){this.canvasHD=e}getCanvasHD(){return this.canvasHD}setCaptureTimeout(e){this.captureTimeout=e}getCaptureTimeout(){return this.captureTimeout}setCaptureRetries(e){this.captureRetries=e}getCaptureRetries(){return this.captureRetries}setImageFormat(e){this.imageFormat=e}getImageFormat(){return this.imageFormat}setImageQuality(e){this.imageQuality=e}getImageQuality(){return this.imageQuality}setCameraId(e){this.cameraId=e}getCameraId(){return this.cameraId}setInitialTip(e){this.initialTip=e}getInitialTip(){return this.initialTip}setVideoRecord(e){this.videoRecord=e}getVideoRecord(){return this.videoRecord}setVideoRecordRate(e){this.videoRecordRate=e}getVideoRecordRate(){return this.videoRecordRate}setVideoRecordScale(e){this.videoRecordScale=e}getVideoRecordScale(){return this.videoRecordScale}setVideoRecordType(e){this.videoRecordType=e}getVideoRecordType(){return this.videoRecordType}setShowLog(e){this.showLog=e}getShowLog(){return this.showLog}setStartSimpleMode(e){this.startSimpleMode=e}getStartSimpleMode(){return this.startSimpleMode}setAccessibility(e){this.accessibility=e}getAccessibility(){return this.accessibility}setAccessibleElements(e){this.accessibleElements=e}getAccessibleElements(){return this.accessibleElements}setDocumentType(e){this.documentType=e}getDocumentType(){return this.documentType}setScanMode(e){this.scanMode=e}getScanMode(){return this.scanMode}setSpecificData(e){this.specificData=e}getSpecificData(){return this.specificData}setCameraOverflow(e){this.cameraOverflow=e}getCameraOverflow(){return this.cameraOverflow}setCaptureMode(e){this.captureMode=e}getCaptureMode(){return this.captureMode}setLicense(e){this.license=e}getLicense(){return this.license}getBlurredThreshold(){return this.blurredThreshold}setBlurredThreshold(e){this.blurredThreshold=e}setExternalCamera(e){this.externalCamera=e}getExternalCamera(){return this.externalCamera}setCameraMirror(e){this.cameraMirror=e}getCameraMirror(){return this.cameraMirror}},Ne.SelphID.SimpleMode=class{constructor(e){this.cm=e,this.path=this.isPathAbsolute(this.cm.getBundlePath())?this.cm.getBundlePath():this.getScriptPath()+this.cm.getBundlePath(),this.baseURL=this.isPathAbsolute(this.cm.getResourcesPath())?this.cm.getResourcesPath():this.getScriptPath()+this.cm.getResourcesPath(),this.devicePixelRatio=window.devicePixelRatio,!1===e.getCanvasHD()&&(this.devicePixelRatio=1),this.secondsWidget=0,this.secondsState=0}OnResourceManagerStatus(e,t){t&&(e.rmReady||(e.rmReady=!0,e.CheckDependencies(e)))}CheckDependencies(e){if(1==e.rmReady&&void 0!==e.drawer){var t=new CustomEvent("FPhi.SelphID.ModuleLoaded.event");e.cm.getContainer().dispatchEvent(t);var i=this.canvas;switch(null!=i&&(i.style.display="inline-block"),e.drawer.rm=e.rm,e.canvas,e.drawer.setCanvasSize(e.cameraContainer.offsetWidth,e.cameraContainer.offsetHeight),e.cm.getMode()){case d.SelphID.Mode.Full:case d.SelphID.Mode.Front:e.newState(d.SelphID.SimpleModeStates.InfoFront);break;default:e.newState(d.SelphID.SimpleModeStates.InfoBack)}}}start(){this.onTrackStatus=this.cm.getOnTrackStatus(),this.divContainer=this.cm.getContainer(),this.onCanvasResizeContext=this.onCanvasResize.bind(this),window.addEventListener("resize",this.onCanvasResizeContext,!1),this.cameraContainer=document.createElement("div"),this.cameraContainer.id="cameraContainer",this.cameraContainer.style.overflow="hidden",this.cameraContainer.style.position="relative",this.cameraContainer.style.width=this.cm.getContainer().offsetWidth+"px",this.cameraContainer.style.height=this.cm.getContainer().offsetHeight+"px",this.cm.getContainer().appendChild(this.cameraContainer);var e=document.createElement("canvas");e.id="display",e.style="position:absolute; top:0px; left:0px; zIndex:1;",this.cameraContainer.appendChild(e),e.width=this.cameraContainer.offsetWidth*this.devicePixelRatio,e.height=this.cameraContainer.offsetHeight*this.devicePixelRatio,e.style.width=this.cameraContainer.offsetWidth+"px",e.style.height=this.cameraContainer.offsetHeight+"px",e.onclick=this.canvasOnClick.bind(this),e.addEventListener("mousemove",this.canvasOnMove.bind(this),!1),this.canvas=e;let t=document.createElement("input");t.type="file",t.accept="image/*",t.capture="environment",t.style="visibility:hidden",t.addEventListener("change",this.fileCaptureEvent.bind(this)),this.cm.getContainer().appendChild(t),this.inputFromDevice=t,this.cm.getContainer().addEventListener("FPhi.SelphID.Finish.event",this.cm.getOnExtractionFinish(),!0),this.cm.getContainer().addEventListener("FPhi.SelphID.UserCancel.event",this.cm.getOnUserCancel(),!0),this.cm.getContainer().addEventListener("FPhi.SelphID.ModuleLoaded.event",this.cm.getOnModuleLoaded(),!0),this.cm.getContainer().addEventListener("FPhi.SelphID.TrackStatus.event",this.onTrackStatus,!0),this.rm=new a(this.baseURL,this.cm.getLanguage(),this,this.OnResourceManagerStatus,this.cm.getDpiList(),window.devicePixelRatio,1),this.widgetTime=performance.now(),this.drawer=new s({mode:this.cm.getMode(),preview:this.cm.getPreviewCapture(),documentAspectRatio:85.6/53.98}),this.CheckDependencies(this)}stop(){this.cm.getContainer().removeChild(this.cameraContainer),this.cameraContainer=null,this.onCanvasResizeContext&&(window.removeEventListener("resize",this.onCanvasResizeContext,!1),this.onCanvasResizeContext=void 0),null!=this.rm&&(this.rm.caller=null,this.rm=null),null!=this.drawer&&(this.drawer=null),this.cm.getContainer().removeEventListener("FPhi.SelphID.Finish.event",this.onExtractionFinish,!0),this.cm.getContainer().removeEventListener("FPhi.SelphID.UserCancel.event",this.onUserCancel,!0),this.cm.getContainer().removeEventListener("FPhi.SelphID.ModuleLoaded.event",this.onModuleLoaded,!0),this.cm.getContainer().removeEventListener("FPhi.SelphID.TrackStatus.event",this.onTrackStatus,!0)}newState(e){if(this.inputFromDevice.value="",this.stateTime=performance.now(),this.secondsWidget=(this.actualTime-this.widgetTime)/1e3,this.secondsState=(this.actualTime-this.stateTime)/1e3,this.state=e,this.resourceParent=this.drawer.getResourceIdForState(d.SelphID.SimpleModeStatesStr[this.state]),this.elements=null,null!=this.resourceParent&&(this.elements=this.rm.getElements(this.resourceParent,this.drawer.landscape)),null!=this.onTrackStatus&&this.divContainer){var t=new CustomEvent("FPhi.SelphID.TrackStatus.event",{detail:{code:d.SelphID.TrackStatus.ChangeState,timeStamp:this.secondsWidget,data:d.SelphID.SimpleModeStatesStr[this.state]}});this.divContainer.dispatchEvent(t)}this.draw(this)}async finish(){var e=null,t=null;this.frontImage&&(e=await this.convertImage(this.frontImage,this.cm.getImageFormat(),this.cm.getImageQuality())),this.backImage&&(t=await this.convertImage(this.backImage,this.cm.getImageFormat(),this.cm.getImageQuality()));var i={images:{backDocument:t.src||null,frontDocument:e.src||null},simpleModeOutput:1},l=new CustomEvent("FPhi.SelphID.Finish.event",{detail:i});this.cm.getContainer().dispatchEvent(l),this.stop()}rotateImage(e,t,i){return new Promise(((l,a)=>{let n=document.createElement("canvas");n.width=e.height,n.height=e.width;let s=n.getContext("2d");s.save(),s.translate(n.width/2,n.height/2),s.rotate(-Math.PI/2),s.drawImage(e,-e.width/2,-e.height/2),s.restore();let d=document.createElement("img");d.onload=()=>{l(d)},d.src=n.toDataURL(t,i)}))}convertImage(e,t,i){return new Promise(((l,a)=>{let n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(e,0,0);let s=document.createElement("img");s.onload=()=>{l(s)},s.src=n.toDataURL(t,i)}))}fileCaptureEvent(e){let t=new FileReader;t.onload=e=>{switch(this.state){case d.SelphID.SimpleModeStates.InfoFront:this.previewImage=document.createElement("img"),this.previewImage.src=e.target.result,this.frontImage=this.previewImage,this.newState(d.SelphID.SimpleModeStates.PreviewFront);break;case d.SelphID.SimpleModeStates.InfoBack:this.previewImage=document.createElement("img"),this.previewImage.src=e.target.result,this.backImage=this.previewImage,this.newState(d.SelphID.SimpleModeStates.PreviewBack)}},t.readAsDataURL(e.target.files[0])}getLayoutFromXML(e,t,i,l,a){let n="LEFT",s="TOP",d=i,c=!1;if(this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"width")){null==d&&(d={});var h=this.rm.getSetupFloat(e,t,this.drawer.landscape,"width");d.width=h<=1?h*l:h,c=!0}if(this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"height")){null==d&&(d={});var o=this.rm.getSetupFloat(e,t,this.drawer.landscape,"height");d.height=o<=1?o*a:o,c=!0}if(this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"xAnchor")&&(n=this.rm.getSetupAlign(e,t,this.drawer.landscape,"xAnchor")),this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"yAnchor")&&(s=this.rm.getSetupAlign(e,t,this.drawer.landscape,"yAnchor")),this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"x")){null==d&&(d={});var r=this.rm.getSetupFloat(e,t,this.drawer.landscape,"x");d.x=r<=1&&r>=-1?r*l:r,"CENTER"==n?d.x=l/2-d.width/2+d.x:"RIGHT"==n&&(d.x=l-d.width+d.x),c=!0}if(this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"y")){null==d&&(d={});var m=this.rm.getSetupFloat(e,t,this.drawer.landscape,"y");d.y=m<=1&&m>=-1?m*a:m,"CENTER"==s?d.y=a/2-d.height/2+d.y:"BOTTOM"==s&&(d.y=a-d.height+d.y),c=!0}return d}draw(e){if(null!=e.drawer){e.actualTime=performance.now(),e.secondsWidget=(e.actualTime-e.widgetTime)/1e3,e.secondsState=(e.actualTime-e.stateTime)/1e3;var t=e.canvas.getContext("2d",{alpha:!0}),i=t.canvas.width,l=t.canvas.height;if(t.clearRect(0,0,i,l),this.canvasWidth=i,this.canvasHeight=l,t.save(),t.scale(e.devicePixelRatio,e.devicePixelRatio),null!=e.elements){var a={contour:[!1,!1,!1,!1]};a.previewImage=e.previewImage,a.forceLandscape=e.cm.getForceLandscape(),a.state=d.SelphID.SimpleModeStatesStr[e.state];for(var n=0;n<e.elements.length;n++)if("button"!=e.elements[n].type&&"buttonImage"!=e.elements[n].type||0!=e.interactible){var s=e.drawer.getLayout(t,e.resourceParent,e.elements[n].id,e.elements[n].type,e.secondsWidget,e.secondsState,"",a);if(null!=s&&(s=e.getLayoutFromXML(e.resourceParent,e.elements[n].id,s,i,l)),null!=s){e.elements[n].layout=s;var c=e.elements[n].mode,h=!1;if(null!=c){for(var o=c.split("|"),r=0;r<o.length;r++)if("Normal"==o[r]){h=!0;break}}else h=!0;1==h&&e.drawer.draw(t,s,e.resourceParent,e.elements[n].id,e.elements[n].type,e.secondsWidget,e.secondsState,e.cm.getMode(),a)}}}t.restore(),setTimeout(e.draw,0,e)}}onCanvasResize(){var e=this.canvas;e.getContext("2d",{alpha:!0}),this.cameraContainer.style.width=this.cm.getContainer().offsetWidth+"px",this.cameraContainer.style.height=this.cm.getContainer().offsetHeight+"px",e.width=this.cameraContainer.offsetWidth*this.devicePixelRatio,e.height=this.cameraContainer.offsetHeight*this.devicePixelRatio,e.style.width=this.cameraContainer.offsetWidth+"px",e.style.height=this.cameraContainer.offsetHeight+"px",this.drawer.setCanvasSize(this.cameraContainer.offsetWidth,this.cameraContainer.offsetHeight),this.elements=this.rm.getElements(this.resourceParent,this.drawer.landscape)}canvasOnMove(e){if(null!=this.elements)for(var t=this.elements.length-1;t>=0;t--)if(null!=this.elements[t].layout&&e.offsetX>=this.elements[t].layout.x&&e.offsetX<this.elements[t].layout.x+this.elements[t].layout.width&&e.offsetY>=this.elements[t].layout.y&&e.offsetY<this.elements[t].layout.y+this.elements[t].layout.height){this.drawer.onMouseMove(e.target,this.elements[t].layout,this.resourceParent,this.elements[t].id,this.elements[t].type);break}}async canvasOnClick(e){if(null==this.elements)return;let t=null;for(var i=this.elements.length-1;i>=0;i--){let a=e.offsetX,n=e.offsetY;if(null!=this.elements[i].layout&&a>=this.elements[i].layout.x&&a<this.elements[i].layout.x+this.elements[i].layout.width&&n>=this.elements[i].layout.y&&n<this.elements[i].layout.y+this.elements[i].layout.height){if(t=this.elements[i].id,"button_start"==t)this.inputFromDevice.click();else if("button_repeat"==t)this.state==d.SelphID.SimpleModeStates.PreviewFront?this.newState(d.SelphID.SimpleModeStates.InfoFront):this.newState(d.SelphID.SimpleModeStates.InfoBack);else if("button_ok"==t)this.state==d.SelphID.SimpleModeStates.PreviewFront&&this.cm.getMode()==d.SelphID.Mode.Full?this.newState(d.SelphID.SimpleModeStates.InfoBack):this.finish();else if("button_rotate"==t)this.state==d.SelphID.SimpleModeStates.PreviewFront?(this.frontImage=await this.rotateImage(this.frontImage,this.cm.getImageFormat(),this.cm.getImageQuality()),this.previewImage=this.frontImage):(this.backImage=await this.rotateImage(this.backImage,this.cm.getImageFormat(),this.cm.getImageQuality()),this.previewImage=this.backImage);else if("button_exit"==t){var l=new CustomEvent("FPhi.SelphID.UserCancel.event");this.cm.getContainer().dispatchEvent(l),this.stop()}break}}}isPathAbsolute(e){return/^(?:\/|.+:\/\/|http)/.test(e)}getScriptPath(){return String((new Error).stack).replace(/^Error.*\n/,"").split("\n")[1].match(/http.*\.js/)[0].split("/").slice(0,-1).join("/")+"/"}},Ne.SelphID.DocumentType={0:"UNKNOWN",1:"NONE",2:"ID",3:"PASSPORT",4:"VISA",5:"GREEN_CARD",6:"DRIVING_LICENSE",7:"RESIDENT_ID",8:"SOCIAL_SECURITY_CARD",9:"HEALTH_INSURANCE_CARD",10:"TEMPORARY_RESIDENCE"},Ne.ExceptionType={CameraError:0,ExtractorError:1,ControlNotInitializedError:2,ImageCropResizeError:3,UnexpectedCaptureError:4},Ne.SelphID.Widget=function(e){this.showLog=e.getShowLog(),this.version="4.1.1.178",this.printLog("FPhi.SelphID.Widget version: "+this.version+" - enable showLog property to display detailed info."),this.cm=e,this.divContainer=this.cm.getContainer(),this.captureTimeout=this.cm.getCaptureTimeout(),this.captureRetries=this.cm.getCaptureRetries(),this.onExtractionFinish=this.cm.getOnExtractionFinish(),this.onUserCancel=this.cm.getOnUserCancel(),this.onExceptionCaptured=this.cm.getOnExceptionCaptured(),this.onExtractionTimeout=this.cm.getOnExtractionTimeout(),this.onModuleLoaded=this.cm.getOnModuleLoaded(),this.onTrackStatus=this.cm.getOnTrackStatus(),this.cameraReady=!1,this.contour=[!1,!1,!1,!1],this.cameraMustFlip=this.cm.getCameraMirror(),this.cameraFrontSide=!1,this.mode=this.cm.getMode(),this.status=Ne.SelphID.Mode.Full,this.blurredThreshold=this.cm.getBlurredThreshold(),this.preview=this.cm.getPreviewCapture(),this.graphPath=this.isPathAbsolute(this.cm.getGraphPath())?this.cm.getGraphPath():this.getScriptPath()+this.cm.getGraphPath(),this.cropFactor=this.cm.getCropFactor(),this.devicePixelRatio=window.devicePixelRatio,!1===this.cm.getCanvasHD()&&(this.devicePixelRatio=1),this.bundlePath=this.isPathAbsolute(this.cm.getBundlePath())?this.cm.getBundlePath():this.getScriptPath()+this.cm.getBundlePath(),this.showLog&&this.printLog("FPhi.SelphID.Widget: Serving from URL: "+this.bundlePath),this.resourceParent=null,this.language=this.cm.getLanguage(),this.expectedExternalCamera=this.cm.getExternalCamera(),this.fontSizeFactor=this.canvasHeight/500,this.fpsTime=performance.now(),this.baseURL=this.isPathAbsolute(this.cm.getResourcesPath())?this.cm.getResourcesPath():this.getScriptPath()+this.cm.getResourcesPath(),this.showLog&&this.printLog("FPhi.SelphID.Widget: Serving resources from URL: "+this.baseURL),this.dpiList=this.cm.getDpiList(),this.imageFormat=this.cm.getImageFormat(),this.imageQuality=this.cm.getImageQuality(),this.rmReady=!1,this.graphReady=!1,this.rm=new a(this.baseURL,this.language,this,this.OnResourceManagerStatus,this.dpiList,window.devicePixelRatio,this.canvasSizeFactor),this.graph=new t.k(this.graphPath,this.OnGraphReady.bind(this),this.OnGraphNewState.bind(this)),this.drawer=new s({mode:this.mode,preview:this.preview,documentAspectRatio:85.6/53.98,enableButtonCamera:!this.expectedExternalCamera}),this.divContainer.addEventListener("FPhi.SelphID.Finish.event",this.onExtractionFinish,!0),this.divContainer.addEventListener("FPhi.SelphID.UserCancel.event",this.onUserCancel,!0),this.divContainer.addEventListener("FPhi.SelphID.ExtractionTimeout.event",this.onExtractionTimeout,!0),this.divContainer.addEventListener("FPhi.SelphID.ExceptionCaptured.event",this.onExceptionCaptured,!0),this.divContainer.addEventListener("FPhi.SelphID.ModuleLoaded.event",this.onModuleLoaded,!0),this.divContainer.addEventListener("FPhi.SelphID.TrackStatus.event",this.onTrackStatus,!0)},Ne.SelphID.Widget.prototype={constructor:Ne.SelphID.Widget,language:"es",privateCanvas:null,extractor:null,extractorLiveness:null,extractorVersion:"",lastDetectResult:null,lastExtractionResult:null,lastExtractionResultWizard:null,actualTime:0,actualTimePrev:0,idContainer:null,divContainer:null,extractorContainer:null,videoSelectId:null,cameraContainer:null,cameraWidth:null,cameraHeight:null,cameraRotation:0,expectedExternalCamera:null,canvasWidth:void 0,canvasHeight:void 0,cameraStream:null,selectedSource:null,samplePeriod:0,blurredThreshold:0,debug:!1,interactible:!0,stopCameraStream:!0,globalTimeout:30,sceneTimeout:30,fps:0,fpse:0,fpsframes:0,fpseframes:0,fpsTime:null,fontSizeFactor:1,canvasSizeFactor:1,cameraList:[],graphPath:"/graph.xml",Start:async function(e){if(this.printLog("SelphId: Init process - Widget Web Internals starting"),""===this.cm.getLicense())return console.error("FPhi.SelphID.Widget: The Widget is not license correctly, stopping execution..."),this.divContainer.dispatchEvent(new CustomEvent("FPhi.SelphID.ExceptionCaptured.event",{detail:{exceptionType:"licenseError",message:"FPhi.SelphID.Widget: The Widget is not license correctly, stopping execution..."}})),void this.Stop();let t=await Ce.getInternalLicense(this.bundlePath,this.cm.getLicense());if(-1===Xe.getAvailableEngines().findIndex((e=>t.engineType===e)))return console.error("FPhi.SelphID.Widget: The Widget license is not supported by this version, please contact support team!"),this.divContainer.dispatchEvent(new CustomEvent("FPhi.SelphID.ExceptionCaptured.event",{detail:{exceptionType:"licenseError",message:"FPhi.SelphID.Widget: The Widget license is not supported by this version, please contact support team!"}})),void this.Stop();try{this.engine=Xe.generateInstance(t.engineType,{licenseKey:t.token,bundlePath:this.bundlePath,imageFormat:this.imageFormat,imageQuality:this.imageQuality,accessibility:this.accessibility,blurredThreshold:100*this.blurredThreshold}),this.engine.initializeEngine().then((()=>{this.engineLoaded=!0,this.CheckDependencies(this)}))}catch(e){return this.divContainer.dispatchEvent(new CustomEvent("FPhi.SelphID.ExceptionCaptured.event",{detail:{exceptionType:"engineError",message:"FPhi.SelphID.Widget: "+e.message}})),void this.Stop()}if(this.cameraContainer=document.createElement("div"),this.cameraContainer.id="cameraContainer",this.cameraContainer.style.overflow="hidden",this.cameraContainer.style.position="relative",this.cameraContainer.style.width=this.divContainer.offsetWidth+"px",this.cameraContainer.style.height=this.divContainer.offsetHeight+"px",this.divContainer.appendChild(this.cameraContainer),this.printLog("SelphId: Init process - Camera Container linked"),this.checkCanvasDimensions(),this.gifWait=document.createElement("img"),this.gifWait.style.display="none",this.gifWaitOnLoadContext=this.onWaitingLoaded.bind(this),this.gifWait.addEventListener("load",this.gifWaitOnLoadContext),this.gifWait.src=this.baseURL+"/resources/163dpi/1_loading_selphID.gif",this.cameraContainer.appendChild(this.gifWait),this.printLog("SelphId: Init process - Showing the loading animation"),this.cropFactor<=0){let e=new CustomEvent("FPhi.SelphID.ExceptionCaptured.event",{detail:{message:"Invalid value of CropFactor. Must be greather than 0.",exceptionType:3}});this.divContainer.dispatchEvent(e),this.cropFactor=1}if(this.resizeFactor<=0){let e=new CustomEvent("FPhi.SelphID.ExceptionCaptured.event",{detail:{message:"Invalid value of ResizeFactor. Must be greather than 0.",exceptionType:3}});this.divContainer.dispatchEvent(e),this.resizeFactor=1}this.sceneTimeout<=0&&(this.sceneTimeout=0),window.location!==window.parent.location&&this.printLog("SelphId: widget running inside iframe.");let i=document.createElement("canvas");if(i.id="display",i.style="position:absolute; top:0px; left:0px; zIndex:1;",this.cameraContainer.appendChild(i),i.width=this.cameraContainer.offsetWidth*this.devicePixelRatio,i.height=this.cameraContainer.offsetHeight*this.devicePixelRatio,i.style.width=this.cameraContainer.offsetWidth+"px",i.style.height=this.cameraContainer.offsetHeight+"px",this.canvas=i,this.canvasRotated=document.createElement("canvas"),this.canvasRotated.width=i.height*this.devicePixelRatio,this.canvasRotated.height=i.width*this.devicePixelRatio,this.onCanvasResizeContext=this.onCanvasResize.bind(this),window.addEventListener("resize",this.onCanvasResizeContext,!1),this.printLog("SelphId: Init process - Canvas linked"),this.initCamera(this.cameraContainer,this.cameraWidth,this.cameraHeight),console.log(e),null!=e){this.printLog("FPhi.Selphi.Widget: Detected external camera stream, using this..."),this.stopCameraStream=!1,this.cameraStream=e,this.video.srcObject=e;const t=e.getVideoTracks()[0];this.cameraName=t.label,this.video.onloadedmetadata=this.videoLoaded.bind(this),this.video.play(),this.setCameraPosition(this.canvas,this.video)}else if(this.expectedExternalCamera)this.printLog("FPhi.SelphID.Widget: Entering into loading state until waits the external camera...");else{this.printLog("FPhi.SelphID.Widget: No detected external camera stream, running own stream..."),this.printLog("SelphId: Init process - Checked parameters are correctly"),document.featurePolicy&&!1===document.featurePolicy.allowsFeature("camera")&&(this.printLog("SelphId: Feature Policy issue: Camera feature is restricted in the actual environment. Check your server HTTP Headers."),this.printLog("https://developers.google.com/web/updates/2018/06/feature-policy#js")),await this.grantVideoPermission(),this.printLog("SelphId: Init process - Checked camera permissions"),this.cameras=await navigator.mediaDevices.enumerateDevices(),this.cameraCount=0,this.printLog("SelphId: Camera enumeration");let e=[];for(const t of this.cameras)if("videoinput"===t.kind){if(null==this.cm.getCameraId()){let i=await navigator.mediaDevices.getUserMedia({video:{deviceId:t.deviceId}});if(i.getVideoTracks().length>0&&"function"==typeof i.getVideoTracks()[0].getCapabilities){const l=i.getVideoTracks()[0].getCapabilities();"environment"==l.facingMode&&(l.focusDistance?.max<1e3?(e.push(l),this.printLog("SelphId: environment camera with id: "+t.deviceId+" - focusDistance: "+JSON.stringify(l.focusDistance))):this.printLog("SelphId: ignoring environment (focusDistance) camera with id: "+t.deviceId+" - focusDistance: "+JSON.stringify(l.focusDistance)))}i.getTracks().forEach((e=>{e.stop()}))}this.cameraCount++,this.printLog("SelphId: camera with id: "+t.deviceId)}if(this.printLog("Environment cameras: "+e.length),e.length>0){e.sort(((e,t)=>e.focusDistance?.max-t.focusDistance?.max));const t=Math.floor(e.length/2);this.forceCameraId=e[t].deviceId,this.printLog("SelphId: forced camera with id: "+this.forceCameraId)}this.printLog("SelphId: "+this.cameraCount+" cameras found."),this.printLog("SelphId: Init process - Checked available cameras"),this.selectedSource=null,this.setVideoInput(this),this.stopCameraStream=!0}this.widgetTime=performance.now(),this.stateTime=this.widgetTime,this.printLog("SelphId: Init process - Started Widget")},StartManual:function(){this.selphIDSimpleMode=new Ne.SelphID.SimpleMode(this.cm),this.selphIDSimpleMode.start()},Stop:function(){null!==this.divContainer&&(this.onCanvasResizeContext&&(window.removeEventListener("resize",this.onCanvasResizeContext,!1),this.onCanvasResizeContext=void 0),void 0!==this.onExtractionFinish&&null!==this.onExtractionFinish&&this.divContainer.removeEventListener("FPhi.SelphID.Finish.event",this.onExtractionFinish,!0),void 0!==this.onUserCancel&&null!==this.onUserCancel&&this.divContainer.removeEventListener("FPhi.SelphID.UserCancel.event",this.onUserCancel,!0),void 0!==this.onExtractionTimeout&&null!==this.onExtractionTimeout&&this.divContainer.removeEventListener("FPhi.SelphID.ExtractionTimeout.event",this.onExtractionTimeout,!0),void 0!==this.onExceptionCaptured&&null!==this.onExceptionCaptured&&this.divContainer.removeEventListener("FPhi.SelphID.ExceptionCaptured.event",this.onExceptionCaptured,!0),void 0!==this.onModuleLoaded&&null!==this.onModuleLoaded&&this.divContainer.removeEventListener("FPhi.SelphID.ModuleLoaded.event",this.onModuleLoaded,!0),void 0!==this.onTrackStatus&&null!==this.onTrackStatus&&this.divContainer.removeEventListener("FPhi.SelphID.TrackStatus.event",this.onTrackStatus,!0),null!==this.cameraContainer&&this.divContainer.removeChild(this.cameraContainer),this.divContainer=null,this.cameraContainer=null),null!==this.cameraStream&&(!0===this.stopCameraStream&&this.cameraStream.getVideoTracks()[0].stop(),this.video.pause()),null!==this.rm&&void 0!==this.rm&&(this.rm.caller=null,this.rm=null),null!==this.graph&&void 0!==this.graph&&(this.graph=null),null!==this.drawer&&void 0!==this.drawer&&(this.drawer=null),null!==this.rmScript&&void 0!==this.rmScript&&(this.rmScript.onreadystatechange=null,this.rmScript.onload=null,this.rmScript=null),null!==this.graphScript&&void 0!==this.graphScript&&(this.graphScript.onreadystatechange=null,this.graphScript.onload=null,this.graphScript=null),null!==this.drawerScript&&void 0!==this.drawerScript&&(this.drawerScript.onload=null,this.drawerScript=null),this.engine&&this.engine.finalizeEngine(),Ce.destroyWorker()},onWaitingLoaded:function(){let e=this.cameraContainer.offsetHeight/2-this.gifWait.height/2,t=this.cameraContainer.offsetWidth/2-this.gifWait.width/2;this.gifWait.style="position:absolute; top:"+e+"px; left:"+t+"px;"},onCanvasResize:function(){let e=this.canvas,t=e.getContext("2d",{alpha:!0}),i=this.video;this.cameraWidth=i.videoWidth,this.cameraHeight=i.videoHeight,0===this.cameraRotation||2===this.cameraRotation?(this.privateCanvas.width=this.cameraWidth,this.privateCanvas.height=this.cameraHeight):(this.privateCanvas.width=this.cameraHeight,this.privateCanvas.height=this.cameraWidth),this.imagesProcessed=0,this.cameraContainer.style.width=this.divContainer.offsetWidth+"px",this.cameraContainer.style.height=this.divContainer.offsetHeight+"px",e.width=this.cameraContainer.offsetWidth*this.devicePixelRatio,e.height=this.cameraContainer.offsetHeight*this.devicePixelRatio,e.style.width=this.cameraContainer.offsetWidth+"px",e.style.height=this.cameraContainer.offsetHeight+"px",this.canvasRotated.width=e.height,this.canvasRotated.height=e.width,e.width<e.height&&this.cm.forceLandscape?(this.drawer.setCanvasSize(this.cameraContainer.offsetHeight,this.cameraContainer.offsetWidth),this.elements=this.rm.getElements(this.resourceParent,!0)):(this.drawer.setCanvasSize(this.cameraContainer.offsetWidth,this.cameraContainer.offsetHeight),this.elements=this.rm.getElements(this.resourceParent,this.drawer.landscape)),this.checkCanvasDimensions(),this.startVideos(this),this.setCameraPosition(t,i)},checkCanvasDimensions:function(){this.cameraContainer.offsetWidth<this.cameraContainer.offsetHeight&&this.cm.forceLandscape?((this.cameraContainer.offsetWidth<400||this.cameraContainer.offsetHeight<550)&&this.printLog("Selphid: Warning!!! Minimum visual dimensions check failed. "),this.printLog("Selphid: Actual widget size: "+this.cameraContainer.offsetWidth+"x"+this.cameraContainer.offsetHeight),this.printLog("Selphid: Minimum widget size: 400x550")):((this.cameraContainer.offsetWidth<550||this.cameraContainer.offsetHeight<400)&&this.printLog("Selphid: Warning!!! Minimum visual dimensions check failed. "),this.printLog("Selphid: Actual widget size: "+this.cameraContainer.offsetWidth+"x"+this.cameraContainer.offsetHeight),this.printLog("Selphid: Minimum widget size: 550x400"))},printLog:function(e){this.showLog&&console.log(e)},onOrientationChange:function(){window.screen.orientation},GetAvailableCameras:function(){return navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then(this.gotDevices).catch(this.handleCameraError):null},compareArray:function(e,t){if(!e)return!1;if(!t)return!1;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0},setCameraPosition:function(e,t){let i=this.drawer.getCameraRect(e,this.cameraWidth,this.cameraHeight,this.cameraContainer.offsetWidth,this.cameraContainer.offsetHeight,this.resourceParent);if(0==this.cm.getCameraOverflow()){let t=this.drawer.getDocRectScreenSpace(this.cameraContainer.offsetWidth,this.cameraContainer.offsetHeight,0);i=this.drawer.getCameraRect(e,this.cameraWidth,this.cameraHeight,t.width,t.height,this.resourceParent),i.x+=t.x,i.y+=t.y,i.x*=1,i.y*=1,i.width+=.5,i.height+=.5}let l="0deg";!0===this.cameraMustFlip&&(l="180deg"),i.visible?t.style="position:absolute; top:"+i.y+"px; left:"+i.x+"px; width:"+i.width+"px; height:"+i.height+"px; transform:rotateY("+l+"); zIndex:0;":t.style="position:absolute; top:-10000px; left:0px; width:"+i.width+"px; height:"+i.height+"px; transform:rotateY("+l+"); zIndex:0;"},OnGraphNewState:async function(e){this.stateTime=performance.now();let t=this.canvas;this.secondsWidget=(this.actualTime-this.widgetTime)/1e3,this.secondsState=(this.actualTime-this.stateTime)/1e3,this.state=e,this.resourceParent=this.drawer.getResourceIdForState(e);let i=this.video;if(this.setCameraPosition(t.getContext("2d",{alpha:!0}),i),"UCNothing"===this.state||void 0===this.state){this.actualTime=this.stateTime,this.widgetTime=this.stateTime;let e=this.canvas;null!=e&&(e.style.display="inline-block"),this.video&&(this.video.style.display="inline-block")}if(this.printLog("SelphId: state: "+e),null!=this.elements)for(let e=0;e<this.elements.length;e++)null!=this.elements[e].videoPlayer&&(this.elements[e].videoPlayer.pause(),this.elements[e].videoPlayer.removeAttribute("src"),this.elements[e].videoPlayer.removeEventListener("ended",this.videoplayerEnded.bind(self),!1),this.elements[e].videoPlayer.load(),this.elements[e].videoPlayer=null);if(this.elements=null,null!=this.resourceParent&&(this.canvas.width<this.canvas.height&&this.cm.forceLandscape?this.elements=this.rm.getElements(this.resourceParent,!0):this.elements=this.rm.getElements(this.resourceParent,this.drawer.landscape),this.startVideos(this)),"UCNothing"===e)this.clockNewScenario=performance.now(),this.lastExtractionResult=null,this.privateImages=[],this.retries=0,this.status=Ne.SelphID.Mode.Front;else if("UCCapture"===e)this.clockNewScenario=performance.now(),this.imagesProcessed=0,this.imageCaptured=!1,this.imageCapturedTime=0,this.previewImage=void 0,this.contour=[!1,!1,!1,!1],this.status===Ne.SelphID.Mode.Back?this.privateImages.length=1:this.privateImages=[];else if("UCCaptureCameraSwitch"===e){let e=this;if(null!=this.cameraStream){let t=this.cameraStream.getVideoTracks()[0].getSettings().deviceId,l=await navigator.mediaDevices.enumerateDevices(),a=-1,n=-1;for(let e=0;e<l.length;e++)if(l[e].deviceId===t){a=e;break}for(let e=a+1;e<l.length;e++)if("videoinput"===l[e].kind){n=e;break}if(-1===n)for(let e=0;e<l.length;e++)if("videoinput"===l[e].kind){n=e;break}if(-1!==n&&n!==a){this.video.pause(),this.cameraStream.getVideoTracks().forEach((function(e){e.stop()})),this.cameraStream=null,this.video.srcObject=null;let t=this.cm.getCameraWidth(),a=this.cm.getCameraHeight(),s={video:{deviceId:l[n].deviceId,width:t,height:a},audio:!1};navigator.mediaDevices.getUserMedia(s).then((function(t){let a=t.getVideoTracks()[0].getSettings();a&&(e.cameraMustFlip="environment"!==a.facingMode&&e.cm.getCameraMirror()),e.cameraStream=t,e.cameraId=e.cameraStream.getVideoTracks()[0].getSettings().deviceId,i.srcObject=t,e.switchTimeoutHandler=setTimeout((()=>{e.video.pause(),e.cameraStream.getVideoTracks().forEach((function(e){e.stop()})),this.retries=0,e.graph.sendMessage("retry")}),5e3),i.play().then((()=>{e.printLog("Selphid: Camera switch success. New camera with id: "+l[n].deviceId),clearTimeout(e.switchTimeoutHandler),e.setCameraPosition(e.canvas.getContext("2d",{alpha:!0}),e.video),e.graph.sendMessage("cameraSwitched")})).catch((t=>{e.printLog("Selphid: Camera switch unsuccess."),e.printLog(t),clearTimeout(e.switchTimeoutHandler),this.retries=0,e.graph.sendMessage("retry")}))})).catch((function(t){e.printLog("SelphId: Fatal error camera switch..."),e.printLog(t)}))}else this.printLog("SelphId: Camera switch aborted. Only 1 available camera."),this.graph.sendMessage("cameraSwitched")}}else if("UCPreview"===e)this.clockNewScenario=performance.now();else if("UCRepeat"===e)this.imageCaptured=!1,this.status=Ne.SelphID.Mode.Front,this.retries=0,this.engine.cleanImageBuffer(Ne.SelphID.Mode.Front),this.graph.sendMessage("repeat");else if("UCPreviewDecision"===e)this.cm.getCaptureMode()===Ne.SelphID.CaptureMode.DoubleSide&&this.status===Ne.SelphID.Mode.Front?this.graph.sendMessage("Next"):this.graph.sendMessage("Finish");else if("UCFlip"===e)this.status=Ne.SelphID.Mode.Back,this.retries=0;else if("UCCancelByUser"===e){this.clockNewScenario=performance.now();let e=new CustomEvent("FPhi.SelphID.UserCancel.event");this.divContainer.dispatchEvent(e),this.Stop()}else if("UCFinish"===e){this.results.cameraId=this.cameraId,this.cm.getVideoRecord()&&(this.results.video=this.recordedVideo);let e=new CustomEvent("FPhi.SelphID.Finish.event",{detail:this.results});this.divContainer.dispatchEvent(e),this.Stop()}else if("UCTimeout"===e)this.divContainer.dispatchEvent(new CustomEvent("FPhi.SelphID.ExtractionTimeout.event")),this.Stop();else if("UCErrors"===e){let e={livenessMoveFails:this.livenessMoveActualFailedAttempts,livenessMoveHistory:this.livenessMoveHistory,livenessMoveStabilizedHistory:this.livenessMoveStabilizedStatusHistory,livenessMoveStabilizedStatus:this.livenessMoveLastStabilizedStatus};if(null!=this.lastExtractionResult&&null!=this.lastExtractionResult.sunGlassesScore&&(e.sunGlassesScore=this.lastExtractionResult.sunGlassesScore),this.logAllImages){let t=[];for(let e=0;e<this.privateImages.length;e++)void 0!==this.privateImages[e]&&t.push(this.getImgTag(this.privateImages[e],this.cropImage,this.cropFactor,this.imageFormat,this.imageQuality));e.images=t,e.timeStamp=this.privateLivenessResults}if(this.clockNewScenario=performance.now(),this.livenessDiagnostic<0)this.divContainer.dispatchEvent(new CustomEvent("FPhi.SelphID.ExtractionTimeout.event",{detail:e}));else{e.livenessErrorType=this.livenessDiagnostic;let t=new CustomEvent("FPhi.SelphID.LivenessError.event",{detail:e});this.divContainer.dispatchEvent(t)}}else if("UCWaitRecording"===e){if(this.cm.getVideoRecord()){this.printLog("SelphId: generating movie"),this.agProcessing=!0;let e=this;this.agProcessingFirst=performance.now(),this.recorder.generateVideo().then((function(t){e.recorderFinish=!0,e.recordedVideo=t}),(function(t){e.recorderFinish=!0,e.printLog("SelphId: Error generating video")}))}}else"UCJumpSimpleMode"===e&&(this.Stop(),this.StartManual());if(this.divContainer){let t=new CustomEvent("FPhi.SelphID.TrackStatus.event",{detail:{code:Ne.SelphID.TrackStatus.ChangeState,timeStamp:this.secondsWidget,data:e}});if(this.divContainer.dispatchEvent(t),this.cm.getAccessibility()&&void 0!==this.elements){let e=this.canvas.getContext("2d",{alpha:!0});this.canvas.width<this.canvas.height&&this.cm.forceLandscape&&(e=this.canvasRotated.getContext("2d",{alpha:!0}));let t=e.canvas.width,i=e.canvas.height,l={};l.state=this.state;let a=[];null===this.elements&&(this.elements=[]);for(let n=0;n<this.elements.length;n++)if(this.cm.getAccessibleElements().includes(this.elements[n].type)){let s=this.drawer.getLayout(e,this.resourceParent,this.elements[n].id,this.elements[n].type,this.secondsWidget,this.secondsState,"Normal",l);null!=s&&(s=this.getLayoutFromXML(this.resourceParent,this.elements[n].id,s,t,i)),null!=s&&a.push({id:this.elements[n].id,type:this.elements[n].type,x:s.x*this.devicePixelRatio,y:s.y*this.devicePixelRatio,width:s.width*this.devicePixelRatio,height:s.height*this.devicePixelRatio})}let n=new CustomEvent("FPhi.SelphID.TrackStatus.event",{detail:{code:Ne.SelphID.TrackStatus.AccessibilityData,timeStamp:this.secondsWidget,data:a}});this.divContainer.dispatchEvent(n)}}null!=this.graph&&this.graph.sendMessage("SetStatusFinished")},getImageData:function(e){let t=e.getContext("2d",{alpha:!0}),i=e.height,l=e.width;return{width:l,height:i,pixels:t.getImageData(0,0,l,i),time:performance.now()}},getImgTag:function(e,t,i,l,a){let n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e.pixels,0,0);let s=document.createElement("canvas");if(t&&void 0!==e.extractionResult&&void 0!==e.extractionResult.face){let t=e.extractionResult.face.width*i,l=e.extractionResult.face.height*i,a=e.extractionResult.face.x-(i-1)*e.extractionResult.face.width/2,d=e.extractionResult.face.y-(i-1)*e.extractionResult.face.height/2;a<0&&(t+=a,a=0),d<0&&(l+=d,d=0),a+t>=e.width&&(t=e.width-a),d+l>=e.height&&(l=e.height-d),s.width=t,s.height=l,s.getContext("2d").drawImage(n,a,d,t,l,0,0,s.width,s.height)}else s.width=e.width,s.height=e.height,s.getContext("2d").drawImage(n,0,0,s.width,s.height);let d=document.createElement("img");return d.src=s.toDataURL(this.imageFormat,this.imageQuality),d},startVideos:function(e){if(null!=e.elements)for(let t=0;t<e.elements.length;t++)if("video"===e.elements[t].type){let i=document.createElement("video");i.hidden=!0,i.playsinline=!0,i.loop=!1,i.muted=!0,i.autoplay=!0,i.controls=!0,i.src=e.rm.getResourceUrlBase(e.rm.getSetupResourceId(e.resourceParent,e.elements[t].id,e.canvas.width<e.canvas.height,"value")),i.addEventListener("ended",e.videoplayerEnded.bind(e),!1),i.setAttribute("playsinline",""),i.setAttribute("webkit-playsinline",""),i.play(),e.elements[t].videoPlayer=i,this.printLog("SelphId: start of video: "+e.elements[t].id,e.elements[t])}},canvasOnMove:function(e){if(void 0!==this.elements)for(let t=this.elements.length-1;t>=0;t--)if(void 0!==this.elements[t].layout&&e.offsetX>=this.elements[t].layout.x&&e.offsetX<this.elements[t].layout.x+this.elements[t].layout.width&&e.offsetY>=this.elements[t].layout.y&&e.offsetY<this.elements[t].layout.y+this.elements[t].layout.height){this.drawer.onMouseMove(e.target,this.elements[t].layout,this.resourceParent,this.elements[t].id,this.elements[t].type);break}},routeClick:function(e,t){this.canvasOnClick({offsetX:e,offsetY:t})},canvasOnClick:function(e){if("UCErrors"===this.state){if(e.offsetX,e.offsetY>this.canvasHeight-this.buttonHeight){let e;-1===this.livenessDiagnostic?(e=new CustomEvent("FPhi.SelphID.TimeoutErrorButtonClick.event"),this.divContainer.dispatchEvent(e)):(e=new CustomEvent("FPhi.SelphID.LivenessErrorButtonClick.event"),this.divContainer.dispatchEvent(e))}}else{if(void 0===this.elements)return;let t=null;for(let i=this.elements.length-1;i>=0;i--){let l=e.offsetX,a=e.offsetY;if(this.canvas.width<this.canvas.height&&this.cm.forceLandscape&&(l=e.offsetY,a=this.canvas.width/this.devicePixelRatio-e.offsetX),null!=this.elements[i].layout&&l>=this.elements[i].layout.x&&l<this.elements[i].layout.x+this.elements[i].layout.width&&a>=this.elements[i].layout.y&&a<this.elements[i].layout.y+this.elements[i].layout.height){t=this.elements[i].id;let e=new CustomEvent("FPhi.SelphID.TrackStatus.event",{detail:{code:Ne.SelphID.TrackStatus.Tap,timeStamp:this.secondsWidget,data:t}});this.divContainer.dispatchEvent(e);let l="Click//"+this.elements[i].id;this.graph.sendMessage(l);break}}}},initCamera:function(e,t,i){let l=this.canvas;if(!this.video){let t=document.createElement("video");t.id="live",t.setAttribute("playsinline",""),t.setAttribute("webkit-playsinline",""),t.setAttribute("autoplay",""),t.setAttribute("muted",""),t.style.display="none",e.insertBefore(t,e.firstChild),this.video=t}l.imageSmoothingEnabled=!0,l&&(l.style.display="none",l.onclick=this.canvasOnClick.bind(this),l.addEventListener("mousemove",this.canvasOnMove.bind(this),!1),this.privateCanvas=document.createElement("canvas"),0===this.cameraRotation||2===this.cameraRotation?(this.privateCanvas.width=t,this.privateCanvas.height=i):(this.privateCanvas.width=i,this.privateCanvas.height=t))},grantVideoPermission:async function(){try{let e={video:{width:640,height:480},audio:!1};(await navigator.mediaDevices.getUserMedia(e)).getTracks().forEach((e=>{e.stop()}))}catch(e){}},setVideoInput:function(e){e.canvas&&e.playDevice(e,e.cm.getCameraId())},playDevice:async function(e,t){let i=this.video;if(this.canvas.getContext("2d",{alpha:!0}),window.stream&&window.stream.getTracks().forEach((e=>{e.stop()})),e.forceCameraId&&(t=e.forceCameraId),null!=t){let l={video:{deviceId:t,width:e.cm.getCameraWidth(),height:e.cm.getCameraHeight()},audio:!1};navigator.mediaDevices.getUserMedia(l).then((function(t){let l=t.getVideoTracks()[0].getSettings();l&&(e.cameraMustFlip="environment"!==l.facingMode&&e.cm.getCameraMirror()),e.cameraStream=t,e.cameraId=e.cameraStream.getVideoTracks()[0].getSettings().deviceId,i.srcObject=t,i.addEventListener("loadedmetadata",e.videoLoaded.bind(e),!1),i.play()})).catch((function(t){e.printLog("SelphId: Error open camera with id: "+e.cm.getCameraId()),e.printLog(t),e.playDevice(e,null)}))}else{let t=e.cm.getCameraWidth(),l=e.cm.getCameraHeight(),a={video:{width:t,height:l,facingMode:{exact:!0===e.cameraFrontSide?"user":"environment"},zoom:1,focusMode:"continuous",exposureMode:"continuous"},audio:!1};navigator.mediaDevices.getUserMedia(a).then((function(t){let l=t.getVideoTracks()[0].getConstraints();l&&(e.cameraMustFlip="environment"!==l.facingMode.exact&&e.cm.getCameraMirror()),e.cameraId=e.cameraStream.getVideoTracks()[0].getSettings().deviceId,i.srcObject=t,i.addEventListener("loadedmetadata",e.videoLoaded.bind(e),!1),i.play()})).catch((function(a){let n={video:{width:t,height:l,facingMode:{exact:!0!==e.cameraFrontSide?"user":"environment"},zoom:1,focusMode:"continuous",exposureMode:"continuous"},audio:!1};e.cameraMustFlip=!0!==e.cameraFrontSide&&e.cm.getCameraMirror(),navigator.mediaDevices.getUserMedia(n).then((function(t){let l=t.getVideoTracks()[0].getConstraints();l&&(e.cameraMustFlip="environment"!==l.facingMode.exact&&e.cm.getCameraMirror()),e.cameraStream=t,e.cameraId=e.cameraStream.getVideoTracks()[0].getSettings().deviceId,i.srcObject=t,i.addEventListener("loadedmetadata",e.videoLoaded.bind(e),!1),i.play()})).catch((function(a){let n={video:{width:t,height:l,facingMode:"environment",zoom:1,focusMode:"continuous",exposureMode:"continuous"},audio:!1};navigator.mediaDevices.getUserMedia(n).then((function(t){e.cameraMustFlip=!(e.mobileCheck()|e.isIpadOS())&&e.cm.getCameraMirror(),e.cameraStream=t,e.cameraId=e.cameraStream.getVideoTracks()[0].getSettings().deviceId,i.srcObject=t,i.addEventListener("loadedmetadata",e.videoLoaded.bind(e),!1),i.play()})).catch((function(t){console.log(t),e.printLog("SelphId: Camera error");let i=new CustomEvent("FPhi.SelphID.ExceptionCaptured.event",{detail:{message:"Camera not found.",exceptionType:0}});e.divContainer.dispatchEvent(i)}))}))}))}},handleRecorderDataAvailable:function(e){e.data&&e.data.size>0&&this.recordedBlobs.push(e.data)},handleRecorderOnStop:function(e){this.recorderFinish=!0},mobileCheck:function(){let e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},isIpadOS:function(){return navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)},gotDevices:function(e){let t=0;for(let i=0;i!==e.length;++i)"videoinput"===e[i].kind&&t++;this.cameraList=new Array(t);let i=0;for(let t=0;t!==e.length;++t){let l=e[t];if("videoinput"===l.kind){let e=document.createElement("option");e.value=l.deviceId,e.text=l.label,this.cameraList[i]=e,i++}}let l=new CustomEvent("FPhi.SelphID.Cameras.event",{detail:{cameras:this.cameraList}});this.divContainer.dispatchEvent(l)},handleCameraError:function(e){},getLayoutFromXML:function(e,t,i,l,a){let n="LEFT",s="TOP",d=i,c=!1;if(this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"width")){null==d&&(d={});let i=this.rm.getSetupFloat(e,t,this.drawer.landscape,"width");d.width=i<=1?i*l:i,c=!0}if(this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"height")){null==d&&(d={});let i=this.rm.getSetupFloat(e,t,this.drawer.landscape,"height");d.height=i<=1?i*a:i,c=!0}if(this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"xAnchor")&&(n=this.rm.getSetupAlign(e,t,this.drawer.landscape,"xAnchor")),this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"yAnchor")&&(s=this.rm.getSetupAlign(e,t,this.drawer.landscape,"yAnchor")),this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"x")){null==d&&(d={});let i=this.rm.getSetupFloat(e,t,this.drawer.landscape,"x");d.x=i<=1&&i>=-1?i*l:i,"CENTER"===n?d.x=l/2-d.width/2+d.x:"RIGHT"===n&&(d.x=l-d.width+d.x),c=!0}if(this.rm.isAttributeAvailable(e,t,this.drawer.landscape,"y")){null==d&&(d={});let i=this.rm.getSetupFloat(e,t,this.drawer.landscape,"y");d.y=i<=1&&i>=-1?i*a:i,"CENTER"===s?d.y=a/2-d.height/2+d.y:"BOTTOM"===s&&(d.y=a-d.height+d.y),c=!0}return d},draw:function(e,t){if(null==e.drawer)return;let i=e.canvas.getContext("2d",{alpha:!0});e.canvas.width<e.canvas.height&&e.cm.forceLandscape&&(i=e.canvasRotated.getContext("2d",{alpha:!0}));let l=i.canvas.width,a=i.canvas.height;i.clearRect(0,0,l,a),this.canvasWidth=l,this.canvasHeight=a,e.fpsframes++,e.actualTimePrev=e.actualTime,e.actualTime=performance.now();let n=(e.actualTime-e.fpsTime)/1e3;n>1&&(e.fps=e.fpsframes/n,e.fpseframes>0?e.fpse=e.fpseframes/n:e.fpse=0,e.fpsTime=e.actualTime,e.fpsframes=0,e.fpseframes=0);let s="Normal";if("UCCaptureStatus"===e.state&&!1===e.imageCaptured&&(s="Warning"),e.iterateAutomata(e,t,i),e.secondsWidget=(e.actualTime-e.widgetTime)/1e3,e.secondsState=(e.actualTime-e.stateTime)/1e3,i.save(),i.scale(e.devicePixelRatio,e.devicePixelRatio),void 0!==e.elements&&null!==e.elements){let n={progress:0};n.state=e.state,n.contour=e.contour,n.status=e.status,n.previewImage=e.previewImage,n.forceLandscape=e.cm.getForceLandscape(),n.diagnostic=e.diagnostic,n.cameraOverflow=e.cm.getCameraOverflow();for(let d=0;d<e.elements.length;d++){if(("button"===e.elements[d].type||"buttonImage"===e.elements[d].type)&&!1===e.interactible)continue;let c=e.drawer.getLayout(i,e.resourceParent,e.elements[d].id,e.elements[d].type,e.secondsWidget,e.secondsState,s,n);if(null!=c&&(c=e.getLayoutFromXML(e.resourceParent,e.elements[d].id,c,l,a)),null!=c){e.elements[d].layout=c;let l=e.elements[d].mode,a=!1;if(null!=l){let e=l.split("|");for(let t=0;t<e.length;t++)if(e[t]===s){a=!0;break}}else a=!0;if(!0===a){if("video"===e.elements[d].type)n.player=e.elements[d].videoPlayer;else if("camera"===e.elements[d].type){let i=e.privateCanvas.getContext("2d");switch(i.save(),e.cameraRotation){case 0:i.drawImage(t,0,0,e.cameraWidth,e.cameraHeight);break;case 1:case 3:i.translate(e.cameraHeight/2,e.cameraWidth/2),i.rotate(Math.PI/2*e.cameraRotation),i.drawImage(t,-e.cameraWidth/2,-e.cameraHeight/2);break;case 2:i.translate(e.cameraWidth/2,e.cameraHeight/2),i.rotate(Math.PI/2*e.cameraRotation),i.drawImage(t,-e.cameraWidth/2,-e.cameraHeight/2)}switch(i.restore(),n.camera=e.privateCanvas,e.cameraRotation){case 0:case 2:n.width=e.cameraWidth,n.height=e.cameraHeight;break;default:n.width=e.cameraHeight,n.height=e.cameraWidth}n.cameraRotation=e.cameraRotation,n.cameraMustFlip=e.cameraMustFlip}e.cm.getAccessibility()&&e.cm.getAccessibleElements().includes(e.elements[d].type)||e.drawer.draw(i,c,e.resourceParent,e.elements[d].id,e.elements[d].type,e.secondsWidget,e.secondsState,s,n)}}}}else if("UCErrors"===e.state){i.fillStyle="white",i.fillRect(0,0,l,a);let t=e.livenessErrorString,n=15*e.fontSizeFactor,s=e.rm.getSetupResourceId("facephi-widget-conf","","font_warning_message");i.font=n+"px '"+s+"'",i.fillStyle="black";let d=t.split("\n");for(let t=0;t<d.length;t++){let a=i.measureText(d[t]),s=330*e.canvasSizeFactor+n*t;i.fillText(d[t],l/2-a.width/2,s)}let c=e.livenessErrorImage,h=e.scaleRect({width:c.width,height:c.height},{x:.03*l,y:.378*a,width:.94*l,height:.1*a},!0);i.drawImage(c,h.x,h.y,h.width,h.height),e.drawButton(e,i,{x:0,y:a-e.buttonHeight,width:l,height:e.buttonHeight},"Results","button_finish"),e.secondsState}else"UCTimeout"===e.state&&(i.fillStyle="white",i.fillRect(0,0,l,a));if(e.debug){let t=4;if(i.fillStyle="#ff000044",i.fillRect(0,51,250,320),i.lineWidth=1,i.strokeStyle="#ff000088",i.strokeRect(0,51,250,320),i.font="14px Verdana",e.drawBorderedText(i,"Version"+e.extractorVersion,3,20*t,"black","white"),t++,e.drawBorderedText(i,"Preview: "+e.preview,3,20*t,"black","white"),t++,e.drawBorderedText(i,"State: "+e.state,3,20*t,"black","white"),t++,e.drawBorderedText(i,"FPS: "+e.fps.toFixed(2),3,20*t,"black","white"),t++,e.drawBorderedText(i,"FPS Extractor: "+e.fpse.toFixed(2),3,20*t,"black","white"),t++,e.drawBorderedText(i,"Camera size: "+e.cameraWidth+"x"+e.cameraHeight+" px",3,20*t,"black","white"),t++,e.drawBorderedText(i,"Canvas size: "+l+"x"+a+" px",3,20*t,"black","white"),t++,e.drawBorderedText(i,"Camera rotation: "+e.cameraRotation,3,20*t,"black","white"),t++,e.drawBorderedText(i,"WidgetTime: "+e.secondsWidget.toFixed(2),3,20*t,"black","white"),t++,e.drawBorderedText(i,"StateTime: "+e.secondsState.toFixed(2),3,20*t,"black","white"),t++,e.drawBorderedText(i,"Operating mode: "+s,3,20*t,"black","white"),t++,e.drawBorderedText(i,"Internal status: "+e.detectionStatus?.internalStatus,3,20*t,"black","white"),t++,e.drawBorderedText(i,"Detection status: "+Z[e.detectionStatus?.status],3,20*t,"black","white"),t++,e.drawBorderedText(i,"Glare detection: "+e.detectionStatus?.glare,3,20*t,"black","white"),t++,e.docRect){let t=l/e.devicePixelRatio/4,a=t/e.cameraWidth,n=e.cameraHeight*a;i.drawImage(e.privateCanvas,0,0,e.cameraWidth,e.cameraHeight,l/e.devicePixelRatio-t-5,55,t,n)}}if(i.restore(),e.canvas.width<e.canvas.height&&e.cm.forceLandscape){let t=e.canvas.getContext("2d",{alpha:!0});t.clearRect(0,0,t.canvas.width,t.canvas.height),t.save(),t.translate(t.canvas.width/2,t.canvas.height/2),t.rotate(Math.PI/2),t.drawImage(e.canvasRotated,-t.canvas.height/2,-t.canvas.width/2),t.restore()}setTimeout(e.draw,e.samplePeriod,e,t)},drawBorderedText:function(e,t,i,l,a,n){e.fillStyle=a,e.fillText(t,i,l),e.fillStyle=n,e.fillText(t,i-1,l-2)},openFullScreen:function(e){let t;e.requestFullscreen?t=e.requestFullscreen():e.mozRequestFullScreen?t=e.mozRequestFullScreen():e.webkitRequestFullscreen?t=e.webkitRequestFullscreen():e.msRequestFullscreen&&(t=e.msRequestFullscreen()),t.catch((function(e){}))},iterateAutomata:function(e,t,i){if(!1!==e.cameraReady){if("UCNothing"===e.state)e.workerWorking=!1,e.graph.sendMessage("SetMode//0,0,0,"+(!0===e.cm.getInitialTip()?"1":"0"));else if("UCCapture"===e.state){if(0==e.workerWorking)if(!0===e.imageCaptured&&e.secondsWidget-e.imageCapturedTime>1||e.secondsState>e.captureTimeout&&e.captureTimeout>0)e.graph.sendMessage("CaptureFinish");else{let l=e.privateCanvas.getContext("2d");switch(l.save(),e.cameraRotation){case 0:l.drawImage(t,0,0,e.cameraWidth,e.cameraHeight);break;case 1:case 3:l.translate(e.cameraHeight/2,e.cameraWidth/2),l.rotate(Math.PI/2*e.cameraRotation),l.drawImage(t,-e.cameraWidth/2,-e.cameraHeight/2);break;case 2:l.translate(e.cameraWidth/2,e.cameraHeight/2),l.rotate(Math.PI/2*e.cameraRotation),l.drawImage(t,-e.cameraWidth/2,-e.cameraHeight/2)}if(l.restore(),e.canvas.width<e.canvas.height&&e.cm.forceLandscape){let t=e.drawer.getDocRectScreenSpace(i.canvas.width,i.canvas.height),l={x:i.canvas.height-(t.y+t.height),y:t.x,width:t.height,height:t.width};e.docRect=e.drawer.fromScreenToCamera(i,e.cameraWidth,e.cameraHeight,i.canvas.height,i.canvas.width,e.cameraMustFlip,l)}else e.docRect=e.drawer.getDocRect(i,e.cameraWidth,e.cameraHeight,e.cameraContainer.offsetWidth,e.cameraContainer.offsetHeight,e.cameraMustFlip);e.docRect.x-=(1.2*e.docRect.width-e.docRect.width)/2,e.docRect.y-=(1.2*e.docRect.height-e.docRect.height)/2,e.docRect.width*=1.2,e.docRect.height*=1.2,e.docRect.x+e.docRect.width>e.cameraWidth&&(e.docRect.width=e.cameraWidth-e.docRect.x),e.docRect.y+e.docRect.height>e.cameraHeight&&(e.docRect.height=e.cameraHeight-e.docRect.y),e.fpseframes++,e.workerWorking=!0,this.engine.detectImage(e.privateCanvas,e.status).then((t=>{e.detectionStatus=t.detectionStatus,e.results=t,e.diagnostic=t.detectionStatus.status,e.cm.getCaptureMode()==Ne.SelphID.CaptureMode.SingleSide||e.status===Ne.SelphID.Mode.Front&&e.cm.getCaptureMode()===Ne.SelphID.CaptureMode.DoubleSide?0===t.diagnostic&&null!==t.images.frontDocument&&null!==t.images.frontDocument.rawImage&&(e.previewImage=e.getImg(t.imagesRaw.frontDocument),e.imageCaptured=!0):e.status===Ne.SelphID.Mode.Back&&0===t.diagnostic&&null!==t.images&&null!==t.images.backDocument&&null!==t.images.backDocument.rawImage&&(e.previewImage=e.getImg(t.imagesRaw.backDocument),e.imageCaptured=!0),e.workerWorking=!1}),(t=>{console.error(t),e.workerWorking=!1}))}}else"UCCaptureStatus"===e.state?e.secondsState>1.5&&(!0===this.imageCaptured?this.preview?this.graph.sendMessage("Preview"):this.cm.getCaptureMode()===Ne.SelphID.CaptureMode.DoubleSide&&this.status===Ne.SelphID.Mode.Front?this.graph.sendMessage("Next"):this.graph.sendMessage("Finish"):(this.retries++,this.retries>=this.captureRetries&&this.captureRetries>0&&!1===this.debug?this.cm.getAskSimpleMode()?this.graph.sendMessage("TimeoutPreview"):this.graph.sendMessage("Timeout"):this.graph.sendMessage("Fail"))):"UCPreview"===e.state||("UCFlip"===e.state?e.secondsState>1&&e.graph.sendMessage("Timer"):"UCWaitRecording"===e.state&&(e.cm.getVideoRecord()?e.recorderFinish&&e.graph.sendMessage("Finish"):e.graph.sendMessage("Finish")));if(e.cm.getVideoRecord()&&e.recorder.isReady()){e.privateRecordCanvasContext.drawImage(t,0,0,e.privateRecordCanvas.width,e.privateRecordCanvas.height);let i=e.privateRecordCanvasContext.getImageData(0,0,e.privateRecordCanvas.width,e.privateRecordCanvas.height);e.recorder.addFrame(i)}}},getImg:function(e){let t=new ImageData(e.data,e.width,e.height,{colorSpace:e.colorSpace}),i=document.createElement("canvas");i.width=e.width,i.height=e.height,i.getContext("2d").putImageData(t,0,0);const l=i.toDataURL();let a=document.createElement("img");return a.src=l,a},getVideoSources:function(e){let t=null;navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then((function(i){let l=i.filter((function(e){return"video"===e.kind})).map((function(e,t){return e.id}));t=l[0],e.setVideoInput(e)})):MediaStreamTrack.getSources((function(i){let l=i.filter((function(e){return"video"===e.kind})).map((function(e,t){return e.id}));t=l[0],e.setVideoInput(e)})),null==t&&e.printLog("selectedSource==null")},isPathAbsolute:function(e){return/^(?:\/|.+:\/\/|http)/.test(e)},getScriptPath:function(){return String((new Error).stack).replace(/^Error.*\n/,"").split("\n")[1].match(/http.*\.js/)[0].split("/").slice(0,-1).join("/")+"/"},OnResourceManagerStatus:function(e,t){null!==e&&t&&(e.rmReady=!0,e.CheckDependencies(e))},OnGraphReady:function(e){this.graphReady=!0,this.CheckDependencies(this)},CheckDependencies:async function(e){if(!0===e.rmReady&&void 0!==e.drawer&&!0===e.graphReady&&!0===e.cameraReady&&1==e.engineLoaded&&"UCNothing"!==e.graph.state){let t=e.canvas;null!=t&&(t.style.display="none");let i=new CustomEvent("FPhi.SelphID.ModuleLoaded.event",{detail:{cameraWidth:e.cameraWidth,cameraHeight:e.cameraHeight}});this.divContainer.dispatchEvent(i),e.drawer.rm=e.rm,e.drawer.cameraCount=e.cameraCount;let l=e.canvas;e.canvas.width<e.canvas.height&&e.cm.forceLandscape?(e.drawer.setCanvasSize(e.cameraContainer.offsetHeight,e.cameraContainer.offsetWidth),l=e.canvasRotated):e.drawer.setCanvasSize(e.cameraContainer.offsetWidth,e.cameraContainer.offsetHeight),e.graph.setInitialState("UCNothing"),l.getContext("2d",{alpha:!0}),e.draw(e,e.video),e.cameraContainer.removeChild(e.gifWait)}},videoLoaded:function(e){let t=!0;!0===this.cameraReady&&(t=!1),this.cameraWidth=e.target.videoWidth,this.cameraHeight=e.target.videoHeight,0===this.cameraRotation||2===this.cameraRotation?(this.privateCanvas.width=this.cameraWidth,this.privateCanvas.height=this.cameraHeight):(this.privateCanvas.width=this.cameraHeight,this.privateCanvas.height=this.cameraWidth),this.cameraReady=!0,this.video,this.canvas.getContext("2d",{alpha:!0});let i=document.createElement("canvas");if(i.width=this.cameraWidth,i.height=this.cameraHeight,this.workerCanvas=i,this.workerCanvasContext=i.getContext("2d").getImageData(0,0,this.cameraWidth,this.cameraHeight),this.cm.getVideoRecord()){switch(this.printLog("Selphi: Video recording enabled..."),this.videoRecordWidth=this.cameraWidth*this.cm.getVideoRecordScale(),this.videoRecordHeight=this.cameraHeight*this.cm.getVideoRecordScale(),this.cm.getVideoRecordType()){case Ne.SelphID.RecorderType.Local:this.recorder=new h(this.cameraWidth*this.cm.getVideoRecordScale(),this.cameraHeight*this.cm.getVideoRecordScale(),this.cm.getVideoRecordRate(),this.bundlePath);break;case Ne.SelphID.RecorderType.Remote:this.recorder=new r(this.cameraWidth*this.cm.getVideoRecordScale(),this.cameraHeight*this.cm.getVideoRecordScale(),this.cm.getVideoRecordRate(),this.bundlePath)}this.privateRecordCanvas=document.createElement("canvas"),this.privateRecordCanvas.width=this.videoRecordWidth,this.privateRecordCanvas.height=this.videoRecordHeight,this.privateRecordCanvasContext=this.privateRecordCanvas.getContext("2d")}t&&this.CheckDependencies(this)},videoFrame:function(e){this.canvasVideoPlayer.getContext("2d").drawImage(e.target,0,0)},videoplayerEnded:function(e){"UCWizardCompleted"===this.state?this.graph.sendMessage("VideoFinished"):e.target.play()}},Ne.SelphID.CheckCapabilities=async function(){let e={};return e.video_devices=await(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"==e.kind)).length>0,e.wasm=(()=>{try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch(e){}return!1})(),e.wasm_pthreads=!1,!0===e.wasm&&"function"==typeof SharedArrayBuffer&&(e.wasm_pthreads=!0),e},Ne.SelphID.Component=I,customElements.define("facephi-selphid",Ne.SelphID.Component)})();var a=l.l;export{a as FPhi};